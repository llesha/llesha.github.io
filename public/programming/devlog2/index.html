<!DOCTYPE html>
<html lang="en">

<body>
<div class="singlePage">
    <link rel="stylesheet" href="css/colors.css"><link rel="stylesheet" href="css/styles.css">
<button id="change-theme-button">dark</button>
    <article>
      <h1>Devlog 2. Link class. Removing state</h1>
      <p class="meta">
        
        <p>Link class is for evaluating links. A link is a statement in form of <code>a.b.c</code>, where all expressions
after dots (in this case <code>b</code> and <code>c</code>) are either identifiers<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, indexes<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> or invocations<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.
Expression before the dot is anything, even the ternary operator.
These expressions are link children.</p>
<h3 id="link-evaluation">Link evaluation</h3>
<p>Links are resolved iteratively, starting from the first expression. Every evaluated expression
returns a property (a type or a primitive). But the first child might be a name of an imported
file, therefore it is resolved differently from all the next children.</p>
<p>During dynamic creation of a class it is important to know what parts of the link are
assigned. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Start</span> {
</span></span><span style="display:flex;"><span>    a = mid.end.endProperty <span style="color:#75715e">// a is not assigned until mid, end and endProperty are
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    mid = Middle()
</span></span><span style="display:flex;"><span>    mid.end.addedEndProperty = <span style="color:#e6db74">&#34;anotherEndValue&#34;</span> <span style="color:#75715e">/** it is applicable for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        left hand-side of assignment too. mid and end need to be assigned first
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        **/</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Middle</span> {
</span></span><span style="display:flex;"><span>    end = End()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">End</span> {
</span></span><span style="display:flex;"><span>    endProperty = <span style="color:#e6db74">&#34;endValue&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="adding-state-encountering-problems">Adding state, encountering problems</h3>
<p>For convenience, I added these properties to the link instance:</p>
<ul>
<li><code>index</code>: index of currently resolved child</li>
<li><code>currentVariable</code>: value of currently resolved child</li>
<li><code>currentParent</code>: previously resolved child</li>
<li><code>table</code>: symbolTable with <code>currentVariable</code> as <code>variableTable</code></li>
<li><code>initialTable</code>: symbolTable before link
evaluation, used to resolve function arguments. It is useful in the following code:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A</span> {
</span></span><span style="display:flex;"><span>    a = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    b = B()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">aFunction</span>() {
</span></span><span style="display:flex;"><span>        b.bFun(a, b) <span style="color:#75715e">/** here table will change variableTable to B instance, therefore a and b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            properties will not be found for bFun call. That&#39;s why invocation arguments are resolved
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            using initialTable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            **/</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">B</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">bFun</span>(arg1,arg2) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>These variables are cleared after the end of the evaluation. However, I didn&rsquo;t think about
recursive functions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A</span> {
</span></span><span style="display:flex;"><span>    a = <span style="color:#66d9ef">if</span>(iter &lt; <span style="color:#ae81ff">5</span>) A() <span style="color:#66d9ef">else</span> Nothing()
</span></span><span style="display:flex;"><span>    iter = <span style="color:#66d9ef">if</span>(parent <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> parent.iter <span style="color:#75715e">/** parent is a special property.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        It returns an instance from which this instance is created or 0 **/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">str</span>() {<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;iter, &#34;</span> + a.str()}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Nothing</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">str</span>() { <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;end&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In that case, when calling <code>str()</code>, variable values weren&rsquo;t cleared. I might&rsquo;ve come up with some
hack, but again, I knew that was bad
solution. Link represents a token, it is not a place to store evaluation values. So I moved state
to function arguments. Link is still a poorly written class that has bugs. I work on fixing them
and refactoring Link.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Identifier is a word, starting with a letter. All other symbols are letters, underscores or
numbers&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Index is a token for getting a value from string, array or dictionary. It is an identifier
with square brackets. Square brackets contain index (or a key, if identifier is a name of a
dictionary). <code>arrayName[2]</code>, <code>dictionaryName[&quot;key&quot;]</code>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Invocation is a function call or a class constructor. <code>call(a+b, someArgument=value)</code>
, <code>ClassA(propertyName=value)</code>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </p>
      <ul class="tags">
          
      </ul>
    </article>
    <footer>
    Made by llesha Â© 2024
</footer>
<script type="module" src="js/loader.js"></script>

</div>
</body>
</html>
