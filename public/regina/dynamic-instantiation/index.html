<!doctype html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/svg+xml" href="//localhost:1313/svg/icon.svg">
  <script src="//localhost:1313/js/loader.js"></script>
  <meta name="generator" content="Hugo 0.123.1">
  <link rel="stylesheet" href="//localhost:1313/css/colors.css"><link rel="stylesheet" href="//localhost:1313/css/styles.css">
  
  
  <title>Dynamic instantiation | llesha</title>
  <script type="module" src="//localhost:1313/js/interactive.js"></script>
</head>

<body>
  <div id="nav-border" class="container">
  <nav id="nav" class="nav justify-content-center">
    <div style="text-align: center; font-size: larger;">
      
      
      <a class="nav-link" href="/">Home</a>
      
      
      <a class="nav-link" href="/projects/">Projects</a>
      
      
      <a class="nav-link" href="/tags/">Tags</a>
      
    </div>
    <button id="change-theme-button">dark</button>
    <div style="justify-content: center;">
      <a href="https://github.com/llesha">GitHub</a>
      <a href="https://stackoverflow.com/users/19933941/llesha">StackOverflow</a>
      <a href="https://www.linkedin.com/in/llesha">LinkedIn</a>
    </div>
  </nav>
</div>
  <main id="main">
    

<h1>Dynamic instantiation</h1>




<i data-feather="calendar"></i> <time datetime="2022-09-20">20 September 2022</time>



<br><br>
<h2 id="tldr">TLDR</h2>
<p>Difference between other languages and ReGIna is dynamic instantiation. In
short, properties in classes will be assigned only after their dependencies are assigned, allowing
recursive properties
of same class <code>A</code> inside class <code>A</code>.</p>
<h2 id="idea">Idea</h2>
<p>Classes can have references to other classes inside them as
properties. These property-classes are evaluated dynamically. Take a look at this example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Node</span> <span class="n">export</span> <span class="n">rect</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// export = false - can deny export
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">iter</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="n">parent</span><span class="p">.</span><span class="n">iter</span> <span class="p">+</span> <span class="m">1</span> <span class="k">else</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">childNode</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">iter</span> <span class="o">==</span> <span class="m">5</span><span class="p">)</span> <span class="n">Nothing</span><span class="p">()</span> <span class="k">else</span> <span class="n">Node</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">position</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">childNode</span> <span class="k">is</span> <span class="n">Node</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="n">Position</span><span class="p">(</span><span class="n">childNode</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span> <span class="n">childNode</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="n">Position</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Node</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This will create following svg:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-svg" data-lang="svg"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;svg&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&#34;4&#34;</span> <span class="na">y=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&#34;3&#34;</span> <span class="na">y=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&#34;2&#34;</span> <span class="na">y=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&#34;1&#34;</span> <span class="na">y=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&#34;0&#34;</span> <span class="na">y=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/svg&gt;</span>
</span></span></code></pre></div><p>First algorithm creates empty Node() (we&rsquo;ll call it <em>Node0</em>) from main(). Then, starting from top
to bottom:</p>
<ol>
<li>algorithm assigns <strong>iter</strong> of <em>Node0</em> to 0 because parent returns 0 as an equivalent of null.</li>
<li>After that, <strong>childNode</strong> is assigned a new Node (<em>Node1</em>).</li>
<li><strong>position</strong> cannot be assigned because <strong>childNode.position</strong> is not yet assigned. Algorithm
goes to
childNode.position, that is <em>Node1</em>.position and tries to assign it. However, childNode is
required, so we go to *
Node1*.childNode, which needs iter.</li>
</ol>
<p><em>It&rsquo;s not important to consider while assigning values, but it shows why there cannot be any cyclic
dependencies for properties</em>.</p>
<h2 id="how-not-to-write-code-with-dynamic-instantiation">How not to write code with dynamic instantiation</h2>
<h3 id="bad-class-function">Bad class function</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FunctionOveruse</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">prop</span> <span class="p">=</span> <span class="n">make</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">make</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FunctionOveruse</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">prop</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Both lines in <code>make()</code> will execute forever.</p>
<p>To make functions as expressive as possible, it is important to allow class instantiating inside
them. If</p>
<p>We either make internal class functions (which is purely decompositional thing) or make
instantiating inside functions
possible (and <code>fun main()</code> as an entry point)</p>



  </main>
</body>

</html>