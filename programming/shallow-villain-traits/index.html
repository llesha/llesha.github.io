<!doctype html><html><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Shallow traits of a villain</title><style title="Twine CSS">ï»¿@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-.1em}75%{top:.1em}0%,to{top:0}}@keyframes shudder{25%{left:.1em}75%{left:-.1em}0%,to{left:0}}@keyframes buoy{25%{top:.25em}75%{top:-.25em}0%,to{top:0}}@keyframes sway{25%{left:.25em}75%{left:-.25em}0%,to{left:0}}@keyframes pulse{0%{transform:scale(0,0)}20%{transform:scale(1.2,1.2)}40%{transform:scale(.9,.9)}60%{transform:scale(1.05,1.05)}80%{transform:scale(.925,.925)}to{transform:scale(1,1)}}@keyframes zoom-in{0%{transform:scale(0,0)}to{transform:scale(1,1)}}@keyframes shudder-in{0%,to{transform:translateX(0)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-.6em)}75%{transform:translateX(.6em)}85%{transform:translateX(-.2em)}95%{transform:translateX(.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-.6em)}75%{transform:translateY(.6em)}85%{transform:translateY(-.2em)}95%{transform:translateY(.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0;top:0}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block!important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:400;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags)'">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags)'">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name)'">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name)'">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name)'">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type)'" name="' attr(name)'">'}.debug-mode tw-open-button[replay]{display:inline}.debug-mode tw-expression{display:inline-block!important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2)!important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name)":)";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=""]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1)!important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]<" attr(name)"|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1)!important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right,rgba(255,204,189,0) 0%,rgba(255,204,189,.25) 50%,rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right,rgba(255,204,189,.25) 0%,rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right,rgba(255,204,189,0) 0%,rgba(255,204,189,.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type)' "' attr(name)'"'}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:"..."}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap!important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:10em;min-height:1em;padding:0 .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 transparent transparent #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:"â"}tw-debugger th[data-col][data-order=desc]::after{content:"â"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:400;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:700}tw-debugger .variable-type{color:#575757;font-weight:400;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=""]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0 0 .5em .5em;border-top:none}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:transparent #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 transparent}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3)!important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width:576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:700;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=" color"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=" color"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=" color"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=" color"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6)1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:transparent 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6)2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:transparent 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width:576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:transparent;font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:transparent;font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:transparent;font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media(min-width:576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}tw-enchantment[style*=width]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:.5em 0;font-size:66px;font-family:verdana,sans-serif}tw-icon[alt]{opacity:.2;cursor:pointer}tw-icon[alt]:hover{opacity:.4}tw-icon[data-label]::after{font-weight:700;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .4rem;padding:3px;white-space:pre}tw-folddown::after{content:"â¶"}tw-folddown.open::after{content:"â¼"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline!important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0 0 .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1,end)infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block!important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block!important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block!important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block!important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block!important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block!important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block!important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block!important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block!important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block!important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block!important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block!important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block!important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block!important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block!important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block!important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block!important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block!important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block!important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block!important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block!important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block!important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block!important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block!important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block!important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block!important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}</style></head><body><tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play Shallow traits of a villain.</tw-noscript></noscript></tw-story><tw-storydata name="Shallow traits of a villain" startnode=1 creator=Twine creator-version=2.4.0 format=Harlowe format-version=3.3.0 ifid=A0F52356-FB65-4050-A9F2-7B098A68E5D4 options tags zoom=1 hidden><style role=stylesheet id=twine-user-stylesheet type=text/twine-css></style><script role=script id=twine-user-script type=text/twine-javascript></script><tw-passagedata pid=1 name=Introduction tags position=475,325 size=100,100>(set: $guess to 0)
(set: $additional to 0)
##Introduction
This is an interactive quiz, exploring shallow traits of a villain.
Before you [[start->Backstory]], picture a particular (text-colour:orange)[antagonist] from a movie. You would have to answer questions about (text-colour:orange)[him] (he/him pronouns are used, because villain is he).
#### How to interact:
//On this page all results are reset. Click links if they are correct about your chosen antagonist. If a link becomes green, you can click it again. In that case it won't be counted.//</tw-passagedata><tw-passagedata pid=2 name=Goal tags position=850,325 size=100,100>##Goal
(link:"Save a relative")[(set: $guess to it + 1)''Save a relative'', but with a cost of (link:"more people dead or injured")[(cycling-link:"(text-colour:lime)[â more people dead or injured](set: $additional to it + 1)","more people dead or injured(set: $additional to it - 1)")] ((link-reveal: 'trolley problem')[(open-url: 'https://en.wikipedia.org/wiki/Trolley_problem')], but number of harmed people is unreasonably big)]
(link:"Money")[(set: $guess to it + 1)''Money'', even if he (link:"has a lot")[(cycling-link:"(text-colour:lime)[â has a lot](set: $additional to it + 1)","has a lot(set: $additional to it - 1)")]]
(link:"Wants to get a powerful artifact")[(set: $guess to it + 1)''Wants to get a powerful artifact'' to get money or (link:"kill many people")[(set: $additional to it + 1)''kill many people'', that are somehow related to (text-colour:orange)[his] childhood trauma, but (link:"in reality are innocent")[(cycling-link:"(text-colour:lime)[â in reality are innocent](set: $additional to it + 1)","in reality are innocent(set: $additional to it - 1)")]]]
(link:"Avenge someone")[(set: $guess to it + 1)''Avenge (text-colour:purple)[someone]'', disregarding the fact that (text-colour:purple)[that someone](link:" wouldn't approve (text-colour:orange)[his] actions")[(cycling-link:"(text-colour:lime)[â wouldn't approve (text-colour:orange)[his] actions](set: $additional to it + 1)"," wouldn't approve (text-colour:orange)[his] actions(set: $additional to it - 1)")]]
---
=|=
[[Go back->Backstory]]
=|=
[[Next section->Appearance]]
|==|</tw-passagedata><tw-passagedata pid=3 name=Backstory tags position=675,325 size=100,100>
##Backstory
(link:"Has a child trauma or lost a close person")[(set: $guess to it + 1)''Has a child trauma or lost a close person '' in a way that for him justifies (link:"his bad actions")[(cycling-link:"(text-colour:lime)[â his bad actions](set: $additional to it + 1)","his bad actions(set: $additional to it - 1)")] or created his
strange (link:"principles")[(set: $additional to it + 1)''principles'', which are more important than moral ones.]]
(link:"Was preparing to kill a protagonist for n years")[(set: $guess to it + 1)''Was preparing to kill a protagonist for n years'', could've killed him a lot sooner, but waited because of:
* (link:"an odd reason")[(cycling-link:"(text-colour:lime)[â an odd reason](set: $additional to it + 1)","an odd reason(set: $additional to it - 1)")],
* (link:"some superstition")[(cycling-link:"(text-colour:lime)[â some superstition](set: $additional to it + 1)","some superstition(set: $additional to it - 1)")],
* or a (link:"plot part")[(cycling-link:"(text-colour:lime)[â plot part](set: $additional to it + 1)","plot part(set: $additional to it - 1)")], that was added specifically to make a (text-colour:orange)[villain] unable to destroy a protagonist at his most vulnerable]
(link:"Was bullied")[(set: $guess to it + 1)''Was bullied'' and wants a revenge, that involves harming people that have nothing to do with (text-colour:orange)[his] bullies] or (link:"is a bully")[(set: $guess to it + 1)''is a bully'', but (link:"is a coward")[(cycling-link:"(text-colour:lime)[â is a coward](set: $additional to it + 1)","is a coward(set: $additional to it - 1)")] and relies on (text-colour:orange)[his] henchmen to support (text-colour:orange)[his] cruelty]
---
=|=
[[Go back->Introduction]]
=|=
[[Next section->Goal]]
|==|
</tw-passagedata><tw-passagedata pid=4 name=Appearance tags position=1000,350 size=100,100>##Appearance
(link:"Is a male")[''Is a male'', ok, this one is not counted, because most protagonists and antagonists are male]
(link:"Is ugly")[(set: $guess to it + 1)''Ugly'' and often (link:"shows ugly emotions")[(cycling-link:"(text-colour:lime)[â shows ugly emotions](set: $additional to it + 1)","shows ugly emotions(set: $additional to it - 1)")], like anger, disgust, hatred]
(link:"Has some kind of prosthetic or a contraption")[(set: $guess to it + 1)''Has some kind of prosthetic or a contraption'', especially (link:"a head one")[(cycling-link:"(text-colour:lime)[â a head one](set: $additional to it + 1)","a head one(set: $additional to it - 1)")]]
(link:"Lost a part of his body")[(set: $guess to it + 1)''Lost a part of his body'', usually replaced by a prosthetic]
(link:"Other visible disability, that is not an absence of a body part")[(set: $guess to it + 1)Other visible disability, that is not an absence of a body part:
* a huge scar or a scar on a face
* (link:"limp")[(set: $additional to it + 1)''limp'' and has a spooky cane, that he (link:"uses to hurt people")[(cycling-link:"(text-colour:lime)[â uses to hurt people](set: $additional to it + 1)","uses to hurt people(set: $additional to it - 1)")]]]
(link:"Is bald, balding and has a large forehead")[(set: $guess to it + 1)Show me a good bald character with a large forehead. I don't think there are a lot of them]
(link:"is from a foreign country")[(set: $guess to it + 1)is from (link:"Russia or Mexico")[(cycling-link:"(text-colour:lime)[â Russia or Mexico](set: $additional to it + 1)","Russia or Mexico(set: $additional to it - 1)")], probably (link:"speaks English with a thick accent")[(cycling-link:"(text-colour:lime)[â speaks English with a thick accent](set: $additional to it + 1)","speaks English with a thick accent(set: $additional to it - 1)")] to emphasize cultural differences with a protagonist]
---
=|=
[[Go back->Goal]]
=|=
[[Next section->Behavior]]
|==|</tw-passagedata><tw-passagedata pid=5 name=Behavior tags position=900,475 size=100,100>##Behavior
(link:"Arrogant")[(cycling-link:"(text-colour:lime)[â Arrogant](set: $guess to it + 1)","Arrogant(set: $guess to it - 1)")]
(link:"Gets angry very fast")[(cycling-link:"(text-colour:lime)[â Gets angry very fast](set: $guess to it + 1)","Gets angry very fast(set: $guess to it - 1)")]
(link:"Lustful")[(cycling-link:"(text-colour:lime)[â Lustful](set: $guess to it + 1)","Lustful(set: $guess to it - 1)")]
(link:"Addicted to substance")[(cycling-link:"(text-colour:lime)[â Addicted to substance](set: $guess to it + 1)","Addicted to substance(set: $guess to it - 1)")]
(link:"Eats a lot")[(cycling-link:"(text-colour:lime)[â Eats a lot](set: $guess to it + 1)","Eats a lot(set: $guess to it - 1)")]
(link:"Uses poisoning")[(cycling-link:"(text-colour:lime)[â Uses poisoning](set: $guess to it + 1)","Uses poisoning(set: $guess to it - 1)")]
(link:"Likes money more than humans")[(cycling-link:"(text-colour:lime)[â Likes money more than humans](set: $guess to it + 1)","Likes money more than humans(set: $guess to it - 1)")]
(link:"Betrayed a friend to get some kind of promotion")[(cycling-link:"(text-colour:lime)[â Betrayed a friend to get some kind of promotion](set: $guess to it + 1)","Betrayed a friend to get some kind of promotion(set: $guess to it - 1)")]
(link:"Kills his own men")[(set: $guess to it + 1)''Kills his own men'', especially in a fit of rage, when he (link:"heard or discovered some unpleasant news")[(cycling-link:"(text-colour:lime)[â heard or discovered some unpleasant news](set: $additional to it + 1)","heard or discovered some unpleasant news(set: $additional to it - 1)")]]
---
=|=
[[Go back->Appearance]]
=|=
[[Next section->Behavior2]]
|==|</tw-passagedata><tw-passagedata pid=6 name=Behavior2 tags position=900,625 size=100,100>##Behavior 2
(link:"Thinks that (text-colour:orange)[he] was betrayed")[(set: $guess to it + 1)''Thinks that (text-colour:orange)[he] was betrayed'', but actually there is a (link:"misunderstanding.")[(set: $additional to it + 1)''misunderstanding.''
If this misunderstanding is resolved, will continue to harm a "traitor" due to some messed up reason that (text-colour:orange)[he] (link:"just came up with")[(cycling-link:"(set: $additional to it + 1)(text-colour:lime)[â just came up with]","(set: $additional to it - 1)just came up with")]]]
(link:"Wants to solve an existing problem")[(set: $guess to it + 1)''Wants to solve an actual problem'', but uses crazy methods, that will lead to (link:"a different, maybe bigger problem")[(cycling-link:"(set: $additional to it + 1)(text-colour:lime)[â a different, maybe bigger problem]","(set: $additional to it - 1)a different, maybe bigger problem")]]
(link:"Has a high tolerance for violence")[(set: $guess to it + 1)''Has a high tolerance for violence'' (probably there is a (link:"scene")[(cycling-link:"(set: $additional to it + 1)(text-colour:lime)[â scene]","(set: $additional to it - 1)scene")], where (text-colour:orange)[he] eats or drinks listening to screams of others suffering or dying)]
---
=|=
[[Go back->Behavior]]
=|=
[[Next section->Ending]]
|==|</tw-passagedata><tw-passagedata pid=7 name=Ending tags position=750,550 size=100,100>##Ending
* (link:"Dies")[(set: $guess to it + 1)''Dies'' from:
* (link:"his own gear or contraption")[(cycling-link:"(set: $additional to it + 1)(text-colour:lime)[â his own gear or contraption]","(set: $additional to it - 1)his own gear or contraption")]
* (link:"falling")[(set: $additional to it + 1)''falling'' after a battle with a hero. Maybe accidentally pushed himself off a cliff or something, it shouldn't look like hero is cruel]]
* put in jail
* (link:"put with people he hates")[(set: $guess to it + 1)''put with people he hates'', but in a position where he cannot harm them]
---
=|=
[[Go back->Behavior2]]
=|=
[[Results]]
|==|</tw-passagedata><tw-passagedata pid=8 name=Results tags position=700,675 size=100,100>##Results
(set: $percentage to $guess/28 * 100)
(set: $percentage to (round: $percentage))
$guess / 28 were true about your villain, its $percentage%
Also $additional additional facts were true (those which are not shown before you click a link)
---
=|=
[[Go back->Ending]]
=|=
[[Again->Introduction]]
|==|</tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main=harlowe>"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _createForOfIteratorHelper(e,n){if(t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"],!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var t,s=0,n=function(){},o,i,a;return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return i=!0,a=!1,{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(a)throw o}}}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,o){if(e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"],null!=e){var e,i,a,n=[],s=!0,r=!1;try{for(e=e.call(t);!(s=(i=e.next()).done)&&(n.push(i.value),!o||n.length!==o);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==e.return||e.return()}finally{if(r)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=n[t];return s}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var j,c,e,o,d,r,b,a,t,i,n,u,O,w,v,y,l,f,h;function s(e,t){return O.call(e,t)}function p(e,i){var d,l,c,o,m,a,p,t,u,f,s=i&&i.split("/"),r=n.map,h=r&&r["*"]||{};if(e){for(i=(e=e.split("/")).length-1,n.nodeIdCompat&&v.test(e[i])&&(e[i]=e[i].replace(v,"")),"."===e[0].charAt(0)&&s&&(e=s.slice(0,s.length-1).concat(e)),t=0;t<e.length;t++)"."===(f=e[t])?(e.splice(t,1),--t):".."===f&&(0===t||1===t&&".."===e[2]||".."===e[t-1]||0<t&&(e.splice(t-1,2),t-=2));e=e.join("/")}if((s||h)&&r){for(t=(d=e.split("/")).length;0<t;--t){if(l=d.slice(0,t).join("/"),s)for(u=s.length;0<u;--u)if(c=(c=r[s.slice(0,u).join("/")])&&c[l]){o=c,m=t;break}if(o)break;!a&&h&&h[l]&&(a=h[l],p=t)}!o&&a&&(o=a,m=p),o&&(d.splice(0,m,o),e=d.join("/"))}return e}function _(e,t){return function(){var n=w.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),r.apply(o,n.concat([e,t]))}}function m(e){var n;if(s(i,e)&&(n=i[e],delete i[e],u[e]=!0,d.apply(o,n)),!s(t,e)&&!s(u,e))throw new Error("No "+e);return t[e]}function g(e){var n,t=e?e.indexOf("!"):-1;return-1<t&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function x(e){return e?g(e):[]}t={},i={},n={},u={},O=Object.prototype.hasOwnProperty,w=[].slice,v=/\.js$/,b=function(e,n){var s,i,o=g(e),t=o[0],n=n[1];return e=o[1],t&&(s=m(t=p(t,n))),t?e=s&&s.normalize?s.normalize(e,(i=n,function(e){return p(e,i)})):p(e,n):(t=(o=g(e=p(e,n)))[0],e=o[1],t&&(s=m(t))),{f:t?t+"!"+e:e,n:e,pr:t,p:s}},a={require:function(e){return _(e)},exports:function(e){var n=t[e];return void 0!==n?n:t[e]={}},module:function(e){return{id:e,uri:"",exports:t[e],config:(s=e,function(){return n&&n.config&&n.config[s]||{}})};var s}},d=function(e,h,l,g){var d,n,p,r,v,c=[],f=_typeof(l),j=x(g=g||e);if("undefined"===f||"function"===f){for(h=!h.length&&l.length?["require","exports","module"]:h,r=0;r<h.length;r+=1)if("require"===(n=(p=b(h[r],j)).f))c[r]=a.require(e);else if("exports"===n)c[r]=a.exports(e),v=!0;else if("module"===n)d=c[r]=a.module(e);else if(s(t,n)||s(i,n)||s(u,n))c[r]=m(n);else{if(!p.p)throw new Error(e+" missing "+n);p.p.load(p.n,_(g,!0),function(e){return function(n){t[e]=n}}(n),{}),c[r]=t[n]}f=l?l.apply(t[e],c):void 0,e&&(d&&d.exports!==o&&d.exports!==t[e]?t[e]=d.exports:f===o&&v||(t[e]=f))}else e&&(t[e]=l)},j=c=r=function(e,t,s,i,c){if("string"==typeof e)return a[e]?a[e](t):m(b(e,x(t)).f);if(!e.splice){if((n=e).deps&&r(n.deps,n.callback),!t)return;t.splice?(e=t,t=s,s=null):e=o}return t=t||function(){},"function"==typeof s&&(s=i,i=c),i?d(o,e,t,s):setTimeout(function(){d(o,e,t,s)},4),r},r.config=function(e){return r(e)},j._defined=t,(e=function(e,n,o){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(o=n,n=[]),s(t,e)||s(i,e)||(i[e]=[e,n,o])}).amd={jQuery:!0},e("almond",function(){}),y=this,l=function(){function m(e){try{return e(),!1}catch(e){return!0}}function l(e){try{return e()}catch(e){return!1}}function d(t,e,n){z(k(e),function(s){var i=e[s];o(t,s,i,!!n)})}function e9(e,t){return!!Object.setPrototypeOf&&l(function(){function n(t){return t=new e(t),Object.setPrototypeOf(t,n.prototype),t}return Object.setPrototypeOf(n,e),n.prototype=e0(e.prototype,{constructor:{value:n}}),t(n)})}function U(){}function q(e){return(e=Number(e))<-1||f(e)?NaN:0===e||e===1/0?e:-1===e?-1/0:1+e-1==0?e:e*(el(1+e)/(1+e-1))}function t_(e){return"[object Arguments]"===S(e)}function n(e,t,n){var s=e[t];o(e,t,n,!0),g(e[t],s)}var tS,L,tL=Function.call.bind(Function.apply),a=Function.call.bind(Function.call),ei=Array.isArray,k=Object.keys,tz=(tS=m,function(){return!tL(tS,this,arguments)}),c=!!Object.defineProperty&&!m(function(){return Object.defineProperty({},"x",{get:function(){}})}),eo="foo"===function(){}.name,z=Function.call.bind(Array.prototype.forEach),ez=Function.call.bind(Array.prototype.reduce),tV=Function.call.bind(Array.prototype.filter),tK=Function.call.bind(Array.prototype.some),o=function(e,t,n,s){!s&&t in e||(c?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n}):e[t]=n)},S=Function.call.bind(Object.prototype.toString),eE="function"==typeof/abc/?function(e){return"function"==typeof e&&"[object Function]"===S(e)}:function(e){return"function"==typeof e},er=function(e,t,n){if(!c)throw new TypeError("getters require true ES5 support");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:n})},tY=function(t,e,s){if(!c)throw new TypeError("getters require true ES5 support");var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(s,e,{configurable:n.configurable,enumerable:n.enumerable,get:function(){return t[e]},set:function(n){t[e]=n}})},eK=function(e,t,n){var s;c?((s=Object.getOwnPropertyDescriptor(e,t)).value=n,Object.defineProperty(e,t,s)):e[t]=n},tQ=function(t,n,e){c?Object.defineProperty(t,n,e):"value"in e&&(t[n]=e.value)},g=function(t,e){e&&eE(e.toString)&&o(t,"toString",e.toString.bind(e),!0)},e0=Object.create||function(s,e){function t(){}t.prototype=s;var n=new t;return void 0!==e&&k(e).forEach(function(t){tQ(n,t,e[t])}),n},t=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}(),et=t.isFinite,t$=Function.call.bind(String.prototype.indexOf),tJ=Function.apply.bind(Array.prototype.indexOf),eT=Function.call.bind(Array.prototype.concat),G=Function.call.bind(String.prototype.slice),D=Function.call.bind(Array.prototype.push),tB=Function.apply.bind(Array.prototype.push),eY=Function.call.bind(Array.prototype.join),nn=Function.call.bind(Array.prototype.shift),$=Math.max,K=Math.min,ed=Math.floor,E=Math.abs,W=Math.exp,el=Math.log,eu=Math.sqrt,e8=Function.call.bind(Object.prototype.hasOwnProperty),h=t.Map,tq=h&&h.prototype.delete,es=h&&h.prototype.get,en=h&&h.prototype.has,tN=h&&h.prototype.set,i=t.Symbol||{},ey=i.species||"@@species",f=Number.isNaN||function(e){return e!=e},eb=Number.isFinite||function(e){return"number"==typeof e&&et(e)},X=eE(Math.sign)?Math.sign:function(e){return e=Number(e),0===e||f(e)?e:e<0?-1:1},e5=t_(arguments)?t_:function(e){return null!==e&&"object"===_typeof(e)&&"number"==typeof e.length&&0<=e.length&&"[object Array]"!==S(e)&&"[object Function]"===S(e.callee)},u={primitive:function(e){return null===e||"function"!=typeof e&&"object"!==_typeof(e)},string:function(e){return"[object String]"===S(e)},regex:function(e){return"[object RegExp]"===S(e)},symbol:function(e){return"function"==typeof t.Symbol&&"symbol"===_typeof(e)}},N="function"==typeof i&&"function"==typeof i.for&&u.symbol(i()),y=u.symbol(i.iterator)?i.iterator:"_es6-shim iterator_",tb,ea,s,T,tD,eF,Z,w,tT,ty,tO,t9,t7,tg,tp,tZ,A,eU,eJ,te,tt,tn,ts,eW,ti,ta,tP,tc,tl,td,tu,t1,t4,tw,eN,tx,tC,tE,tk,eq,eh,r,F,ee,em,eS,Y,eA,ek,ep,e6,e1,tA,v,tW,tU,b,e7,ew,tf,t8,eO,eQ,eG,p;t.Set&&"function"==typeof(new t.Set)["@@iterator"]&&(y="@@iterator"),t.Reflect||o(t,"Reflect",{},!0);var eg,ex,eC,eP,e$,eB,eI,eH,V=t.Reflect,eD=String,eM="undefined"!=typeof document&&document?document.all:null,O=null==eM?function(e){return null==e}:function(e){return null==e&&e!==eM},e={Call:function(t,n){var s=2<arguments.length?arguments[2]:[];if(!e.IsCallable(t))throw new TypeError(t+" is not a function");return tL(t,n,s)},RequireObjectCoercible:function(e,t){if(O(e))throw new TypeError(t||"Cannot call method on "+e);return e},TypeIsObject:function(e){return null!=e&&!0!==e&&!1!==e&&("function"==typeof e||"object"===_typeof(e)||e===eM)},ToObject:function(t,n){return Object(e.RequireObjectCoercible(t,n))},IsCallable:eE,IsConstructor:function(t){return e.IsCallable(t)},ToInt32:function(t){return e.ToNumber(t)>>0},ToUint32:function(t){return e.ToNumber(t)>>>0},ToNumber:function(e){if(N&&"[object Symbol]"===S(e))throw new TypeError("Cannot convert a Symbol value to a number");return+e},ToInteger:function(t){return t=e.ToNumber(t),f(t)?0:0!==t&&eb(t)?(0<t?1:-1)*ed(E(t)):t},ToLength:function(t){return t=e.ToInteger(t),t<=0?0:t>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t},SameValue:function(e,t){return e===t?0!==e||1/e==1/t:f(e)&&f(t)},SameValueZero:function(e,t){return e===t||f(e)&&f(t)},IsIterable:function(t){return e.TypeIsObject(t)&&(void 0!==t[y]||e5(t))},GetIterator:function(t){if(e5(t))return new L(t,"value");var n=e.GetMethod(t,y);if(!e.IsCallable(n))throw new TypeError("value is not an iterable");if(t=e.Call(n,t),!e.TypeIsObject(t))throw new TypeError("bad iterator");return t},GetMethod:function(t,n){if(t=e.ToObject(t)[n],!O(t)){if(!e.IsCallable(t))throw new TypeError("Method not callable: "+n);return t}},IteratorComplete:function(e){return!!e.done},IteratorClose:function(n,i){var s,t,o=e.GetMethod(n,"return");if(void 0!==o){try{s=e.Call(o,n)}catch(e){t=e}if(!i){if(t)throw t;if(!e.TypeIsObject(s))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(t){if(t=1<arguments.length?t.next(arguments[1]):t.next(),!e.TypeIsObject(t))throw new TypeError("bad iterator");return t},IteratorStep:function(t){return t=e.IteratorNext(t),!e.IteratorComplete(t)&&t},Construct:function(s,n,t,o){return t=void 0===t?s:t,!o&&V.construct?V.construct(s,n,t):(t=t.prototype,e.TypeIsObject(t)||(t=Object.prototype),t=e0(t),n=e.Call(s,t,n),e.TypeIsObject(n)?n:t)},SpeciesConstructor:function(t,n){if(t=t.constructor,void 0===t)return n;if(!e.TypeIsObject(t))throw new TypeError("Bad constructor");if(t=t[ey],O(t))return n;if(!e.IsConstructor(t))throw new TypeError("Bad @@species");return t},CreateHTML:function(t,n,s,o){var i=e.ToString(t),t="<"+n;return""!==s&&(t+=" "+s+'="'+e.ToString(o).replace(/"/g,"&quot;")+'"'),t+">"+i+"</"+n+">"},IsRegExp:function(t){if(!e.TypeIsObject(t))return!1;var n=t[i.match];return void 0!==n?!!n:u.regex(t)},ToString:function(e){if(N&&"[object Symbol]"===S(e))throw new TypeError("Cannot convert a Symbol value to a number");return eD(e)}};c&&N&&(I=function(e){if(u.symbol(i[e]))return i[e];var t=i.for("Symbol."+e);return Object.defineProperty(i,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t},u.symbol(i.search)||(eg=I("search"),ex=String.prototype.search,o(RegExp.prototype,eg,function(t){return e.Call(ex,t,[this])}),n(String.prototype,"search",function(t){var n=e.RequireObjectCoercible(this),s;if(!O(t))if(s=e.GetMethod(t,eg),void 0!==s)return e.Call(s,t,[n]);return e.Call(ex,n,[e.ToString(t)])})),u.symbol(i.replace)||(eC=I("replace"),eP=String.prototype.replace,o(RegExp.prototype,eC,function(t,n){return e.Call(eP,t,[this,n])}),n(String.prototype,"replace",function(t,n){var s=e.RequireObjectCoercible(this),o;if(!O(t))if(o=e.GetMethod(t,eC),void 0!==o)return e.Call(o,t,[s,n]);return e.Call(eP,s,[e.ToString(t),n])})),u.symbol(i.split)||(e$=I("split"),eB=String.prototype.split,o(RegExp.prototype,e$,function(t,n){return e.Call(eB,t,[this,n])}),n(String.prototype,"split",function(t,n){var s=e.RequireObjectCoercible(this),o;if(!O(t))if(o=e.GetMethod(t,e$),void 0!==o)return e.Call(o,t,[s,n]);return e.Call(eB,s,[e.ToString(t),n])})),x=(Z=u.symbol(i.match))&&((s={})[i.match]=function(){return 42},42!=="a".match(s)),Z&&!x||(eI=I("match"),eH=String.prototype.match,o(RegExp.prototype,eI,function(t){return e.Call(eH,t,[this])}),n(String.prototype,"match",function(t){var n=e.RequireObjectCoercible(this),s;if(!O(t))if(s=e.GetMethod(t,eI),void 0!==s)return e.Call(s,t,[n]);return e.Call(eH,n,[e.ToString(t)])})));function tm(e,t,n){g(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),c?z(Object.getOwnPropertyNames(e),function(s){s in U||n[s]||tY(e,s,t)}):z(Object.keys(e),function(s){s in U||n[s]||(t[s]=e[s])}),t.prototype=e.prototype,eK(e.prototype,"constructor",t)}function tX(){return this}function ec(e){c&&!e8(e,ey)&&er(e,ey,tX)}function _(e,t){o(e,y,t=t||function(){return this}),!e[y]&&u.symbol(y)&&(e[y]=t)}function t5(o,i,a){var t,n,s;if(t=o,n=i,s=a,c?Object.defineProperty(t,n,{configurable:!0,enumerable:!0,writable:!0,value:s}):t[n]=s,!e.SameValue(o[i],a))throw new TypeError("property is nonconfigurable")}function ev(c,t,r,s){if(!e.TypeIsObject(c))throw new TypeError("Constructor requires `new`: "+t.name);t=t.prototype,e.TypeIsObject(t)||(t=r);var n,a,i=e0(t);for(n in s)e8(s,n)&&(a=s[n],o(i,n,a,!0));return i}String.fromCodePoint&&1!==String.fromCodePoint.length&&(tb=String.fromCodePoint,n(String,"fromCodePoint",function(){return e.Call(tb,this,arguments)})),ea={fromCodePoint:function(){for(var t,n=[],s=0,o=arguments.length;s<o;s++){if(t=Number(arguments[s]),!e.SameValue(t,e.ToInteger(t))||t<0||1114111<t)throw new RangeError("Invalid code point "+t);t<65536?D(n,String.fromCharCode(t)):(t-=65536,D(n,String.fromCharCode(55296+(t>>10))),D(n,String.fromCharCode(t%1024+56320)))}return eY(n,"")},raw:function(s){var a,s=e.ToObject(s,"bad template"),s=(a=e.ToObject(s.raw,"bad raw value")).length,o=e.ToLength(s),t,i,n;if(o<=0)return"";for(i=[],n=0;n<o&&(t=e.ToString(n),t=e.ToString(a[t]),D(i,t),!(o<=n+1));)t=e.ToString(n+1<arguments.length?arguments[n+1]:""),D(i,t),n+=1;return eY(i,"")}},String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&n(String,"raw",ea.raw),d(String,ea);function ej(t,e){return e<1?"":e%2?ej(t,e-1)+t:(e=ej(t,e/2))+e}s={repeat:function(t){var n=e.ToString(e.RequireObjectCoercible(this)),t=e.ToInteger(t);if(t<0||1/0<=t)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return ej(n,t)},startsWith:function(t){if(s=e.ToString(e.RequireObjectCoercible(this)),e.IsRegExp(t))throw new TypeError('Cannot call method "startsWith" with a regex');var s,t=e.ToString(t),n=$(e.ToInteger(n=1<arguments.length?arguments[1]:n),0);return G(s,n,n+t.length)===t},endsWith:function(t){if(s=e.ToString(e.RequireObjectCoercible(this)),e.IsRegExp(t))throw new TypeError('Cannot call method "endsWith" with a regex');var s,o=e.ToString(t),t=s.length,n=void 0===(n=1<arguments.length?arguments[1]:n)?t:e.ToInteger(n),t=K($(n,0),t);return G(s,t-o.length,t)===o},includes:function(t){if(e.IsRegExp(t))throw new TypeError('"includes" does not accept a RegExp');var n,t=e.ToString(t);return-1!==t$(this,t,n=1<arguments.length?arguments[1]:n)},codePointAt:function(n){var s=e.ToString(e.RequireObjectCoercible(this)),t=e.ToInteger(n),o=s.length;if(0<=t&&t<o)return n=s.charCodeAt(t),n<55296||56319<n||t+1===o?n:(t=s.charCodeAt(t+1),t<56320||57343<t?n:1024*(n-55296)+(t-56320)+65536)}},String.prototype.includes&&!1!=="a".includes("a",1/0)&&n(String.prototype,"includes",s.includes),String.prototype.startsWith&&String.prototype.endsWith&&(w=m(function(){return"/a/".startsWith(/a/)}),T=l(function(){return!1==="abc".startsWith("a",1/0)}),w&&T||(n(String.prototype,"startsWith",s.startsWith),n(String.prototype,"endsWith",s.endsWith))),N&&(l(function(){var e=/a/;return e[i.match]=!1,"/a/".startsWith(e)})||n(String.prototype,"startsWith",s.startsWith),l(function(){var e=/a/;return e[i.match]=!1,"/a/".endsWith(e)})||n(String.prototype,"endsWith",s.endsWith),l(function(){var e=/a/;return e[i.match]=!1,"/a/".includes(e)})||n(String.prototype,"includes",s.includes)),d(String.prototype,s);function tM(){return e.ToString(e.RequireObjectCoercible(this)).replace(tI,"")}var Z=["	\n\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join(""),tI=new RegExp("(^["+Z+"]+)|(["+Z+"]+$)","g"),x=["\x85","\u200b","\ufffe"].join(""),I=new RegExp("["+x+"]","g"),ea=/^[-+]0x[0-9a-f]+$/i,w=x.trim().length!==x.length;o(String.prototype,"trim",tM,w);function H(e){return{value:e,done:0===arguments.length}}function e_(t){e.RequireObjectCoercible(t),this._s=e.ToString(t),this._i=0}e_.prototype.next=function(){var e=this._s,t=this._i,s,n;return void 0===e||t>=e.length?(this._s=void 0,H()):(s=e.charCodeAt(t),n=s<55296||56319<s||t+1===e.length||(n=e.charCodeAt(t+1))<56320||57343<n?1:2,this._i=t+n,H(e.substr(t,n)))},_(e_.prototype),_(String.prototype,function(){return new e_(this)}),T={from:function(l){if(void 0===(s=1<arguments.length?arguments[1]:s))d=!1;else{if(!e.IsCallable(s))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(i=arguments[2]),d=!0}if(void 0!==(e5(l)||e.GetMethod(l,y))){for(var s,d,i,n,r=e.IsConstructor(this)?Object(new this):[],u=e.GetIterator(l),t=0,o,h,c;;){if(!1===(n=e.IteratorStep(u)))break;n=n.value;try{d&&(n=void 0===i?s(n,t):a(s,i,n,t)),r[t]=n}catch(t){throw e.IteratorClose(u,!0),t}t+=1}c=t}else{h=e.ToObject(l),c=e.ToLength(h.length);for(r=e.IsConstructor(this)?Object(new this(c)):new Array(c),t=0;t<c;++t)o=h[t],d&&(o=void 0===i?s(o,t):a(s,i,o,t)),t5(r,t,o)}return r.length=c,r},of:function(){for(var t=arguments.length,s=ei(this)||!e.IsCallable(this)?new Array(t):e.Construct(this,[t]),n=0;n<t;++n)t5(s,n,arguments[n]);return s.length=t,s}},d(Array,T),ec(Array),d((L=function(e,t){this.i=0,this.array=e,this.kind=t}).prototype,{next:function(){var t=this.i,n=this.array,s,o;if(!(this instanceof L))throw new TypeError("Not an ArrayIterator");return void 0!==n&&t<e.ToLength(n.length)?(o=this.kind,"key"===o?s=t:"value"===o?s=n[t]:"entry"===o&&(s=[t,n[t]]),this.i=t+1,H(s)):(this.array=void 0,H())}}),_(L.prototype),Array.of===T.of||function(){function e(e){this.length=e}e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}()||n(Array,"of",T.of),s={copyWithin:function(r,a){var i=e.ToObject(this),n=e.ToLength(i.length),r=e.ToInteger(r),a=e.ToInteger(a),s=r<0?$(n+r,0):K(r,n),o=a<0?$(n+a,0):K(a,n),t=void 0===(t=2<arguments.length?arguments[2]:t)?n:e.ToInteger(t),t=t<0?$(n+t,0):K(t,n),c=K(t-o,n-s),l=1;for(o<s&&s<o+c&&(l=-1,o+=c-1,s+=c-1);0<c;)o in i?i[s]=i[o]:delete i[s],o+=l,s+=l,--c;return i},fill:function(r){1<arguments.length&&(n=arguments[1]),2<arguments.length&&(t=arguments[2]);for(var t,i=e.ToObject(this),s=e.ToLength(i.length),n=e.ToInteger(void 0===n?0:n),a=(t=e.ToInteger(void 0===t?s:t))<0?s+t:t,o=n<0?$(s+n,0):K(n,s);o<s&&o<a;++o)i[o]=r;return i},find:function(o){var s=e.ToObject(this),r=e.ToLength(s.length),t,i,n;if(!e.IsCallable(o))throw new TypeError("Array#find: predicate must be a function");for(i=1<arguments.length?arguments[1]:null,n=0;n<r;n++)if(t=s[n],i){if(a(o,i,t,n,s))return t}else if(o(t,n,s))return t},findIndex:function(s){var n=e.ToObject(this),i=e.ToLength(n.length),o,t;if(!e.IsCallable(s))throw new TypeError("Array#findIndex: predicate must be a function");for(o=1<arguments.length?arguments[1]:null,t=0;t<i;t++)if(o){if(a(s,o,n[t],t,n))return t}else if(s(n[t],t,n))return t;return-1},keys:function(){return new L(this,"key")},values:function(){return new L(this,"value")},entries:function(){return new L(this,"entry")}},Array.prototype.keys&&!e.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!e.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[y]&&(d(Array.prototype,{values:Array.prototype[y]}),u.symbol(i.unscopables)&&(Array.prototype[i.unscopables].values=!0)),eo&&Array.prototype.values&&"values"!==Array.prototype.values.name&&(tD=Array.prototype.values,n(Array.prototype,"values",function(){return e.Call(tD,this,arguments)}),o(Array.prototype,y,Array.prototype.values,!0)),d(Array.prototype,s),1/[!0].indexOf(!0,-0)<0&&o(Array.prototype,"indexOf",function(){var e=tJ(this,arguments);return 0===e&&1/e<0?0:e},!0),_(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&_(Object.getPrototypeOf([].values())),Z=l(function(){return 0===Array.from({length:-1}).length}),w=1===(w=Array.from([0].entries())).length&&ei(w[0])&&0===w[0][0]&&0===w[0][1],Z&&w||n(Array,"from",T.from),l(function(){return Array.from([0],void 0)})||(eF=Array.from,n(Array,"from",function(t){return 1<arguments.length&&void 0!==arguments[1]?e.Call(eF,this,arguments):a(eF,this,t)}));function B(t,n){var e={length:tZ};return e[n?(e.length>>>0)-1:0]=!0,l(function(){return a(t,e,function(){throw new RangeError("should not reach here")},[]),!0})}tZ=-(Math.pow(2,32)-1),B(Array.prototype.forEach)||(tT=Array.prototype.forEach,n(Array.prototype,"forEach",function(){return e.Call(tT,0<=this.length?this:[],arguments)})),B(Array.prototype.map)||(ty=Array.prototype.map,n(Array.prototype,"map",function(){return e.Call(ty,0<=this.length?this:[],arguments)})),B(Array.prototype.filter)||(tO=Array.prototype.filter,n(Array.prototype,"filter",function(){return e.Call(tO,0<=this.length?this:[],arguments)})),B(Array.prototype.some)||(t9=Array.prototype.some,n(Array.prototype,"some",function(){return e.Call(t9,0<=this.length?this:[],arguments)})),B(Array.prototype.every)||(t7=Array.prototype.every,n(Array.prototype,"every",function(){return e.Call(t7,0<=this.length?this:[],arguments)})),B(Array.prototype.reduce)||(tg=Array.prototype.reduce,n(Array.prototype,"reduce",function(){return e.Call(tg,0<=this.length?this:[],arguments)})),B(Array.prototype.reduceRight,!0)||(tp=Array.prototype.reduceRight,n(Array.prototype,"reduceRight",function(){return e.Call(tp,0<=this.length?this:[],arguments)}));var C,t0,tr,to,eZ,w=8!==Number("0o10"),T=2!==Number("0b10"),x=tK(x,function(e){return 0===Number(e+0+e)});function tR(n){t=0<arguments.length?u.primitive(n)?n:function(t){var e;if("function"==typeof t.valueOf&&(e=t.valueOf(),u.primitive(e)))return e;if("function"==typeof t.toString&&(e=t.toString(),u.primitive(e)))return e;throw new TypeError("No default value")}(n):0,"string"==typeof t&&(t=e.Call(tM,t),t0(t)?t=parseInt(G(t,2),2):tr(t)?t=parseInt(G(t,2),8):(to(t)||eZ(t))&&(t=NaN));var t,s=this,n=l(function(){return C.prototype.valueOf.call(s),!0});return s instanceof tR&&!n?new C(t):C(t)}(w||T||x)&&(C=Number,A=/^0o[0-7]+$/i,t0=(x=/^0b[01]+$/i).test.bind(x),tr=A.test.bind(A),to=I.test.bind(I),eZ=ea.test.bind(ea),tm(C,A=tR,{}),d(A,{NaN:C.NaN,MAX_VALUE:C.MAX_VALUE,MIN_VALUE:C.MIN_VALUE,NEGATIVE_INFINITY:C.NEGATIVE_INFINITY,POSITIVE_INFINITY:C.POSITIVE_INFINITY}),Number=A,eK(t,"Number",A)),A=Math.pow(2,53)-1,d(Number,{MAX_SAFE_INTEGER:A,MIN_SAFE_INTEGER:-A,EPSILON:2220446049250313e-31,parseInt:t.parseInt,parseFloat:t.parseFloat,isFinite:eb,isInteger:function(t){return eb(t)&&e.ToInteger(t)===t},isSafeInteger:function(e){return Number.isInteger(e)&&E(e)<=Number.MAX_SAFE_INTEGER},isNaN:f}),o(Number,"parseInt",t.parseInt,Number.parseInt!==t.parseInt),1===[,1].find(function(){return!0})&&n(Array.prototype,"find",s.find),0!==[,1].findIndex(function(){return!0})&&n(Array.prototype,"findIndex",s.findIndex);function e4(e,t){c&&t4(e,t)&&Object.defineProperty(e,t,{enumerable:!1})}function nt(){for(var t=Number(this),n=arguments.length,s=n-t,o=new Array(s<0?0:s),e=t;e<n;++e)o[e-t]=arguments[e];return o}function eX(e){return function(t,n){return t[n]=e[n],t}}function ne(s,t){var n,o=k(Object(t));return e.IsCallable(Object.getOwnPropertySymbols)&&(n=tV(Object.getOwnPropertySymbols(Object(t)),t4(t))),ez(eT(o,n||[]),eX(t),s)}t4=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),s={assign:function(t){return t=e.ToObject(t,"Cannot convert undefined or null to object"),ez(e.Call(nt,1,arguments),ne,t)},is:function(t,n){return e.SameValue(t,n)}},Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}}()&&n(Object,"assign",s.assign),d(Object,s),c&&(R={setPrototypeOf:function(t,o){function n(t,n){return function(n,t){if(!e.TypeIsObject(n))throw new TypeError("cannot set prototype on a non-object");if(null!==t&&!e.TypeIsObject(t))throw new TypeError("can only set prototype to an object or null"+t)}(t,n),a(s,t,n),t}var s;try{s=t.getOwnPropertyDescriptor(t.prototype,o).set,a(s,{},null)}catch(e){if(t.prototype!=={}[o])return;s=function(e){this[o]=e},n.polyfill=n(n({},null),t.prototype)instanceof t}return n}(Object,"__proto__")},d(Object,R)),Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&(eU=Object.create(null),eJ=Object.getPrototypeOf,te=Object.setPrototypeOf,Object.getPrototypeOf=function(e){return e=eJ(e),e===eU?null:e},Object.setPrototypeOf=function(t,e){return te(t,null===e?eU:e)},Object.setPrototypeOf.polyfill=!1),m(function(){return Object.keys("foo")})&&(tt=Object.keys,n(Object,"keys",function(t){return tt(e.ToObject(t))}),k=Object.keys),m(function(){return Object.keys(/a/g)})&&(tn=Object.keys,n(Object,"keys",function(e){if(u.regex(e)){var t,n=[];for(t in e)e8(e,t)&&D(n,t);return n}return tn(e)}),k=Object.keys),!Object.getOwnPropertyNames||m(function(){return Object.getOwnPropertyNames("foo")})&&(ts="object"===("undefined"==typeof window?"undefined":_typeof(window))?Object.getOwnPropertyNames(window):[],eW=Object.getOwnPropertyNames,n(Object,"getOwnPropertyNames",function(t){if(t=e.ToObject(t),"[object Window]"===S(t))try{return eW(t)}catch(e){return eT([],ts)}return eW(t)})),!Object.getOwnPropertyDescriptor||m(function(){return Object.getOwnPropertyDescriptor("foo","bar")})&&(ti=Object.getOwnPropertyDescriptor,n(Object,"getOwnPropertyDescriptor",function(t,n){return ti(e.ToObject(t),n)})),!Object.seal||m(function(){return Object.seal("foo")})&&(ta=Object.seal,n(Object,"seal",function(t){return e.TypeIsObject(t)?ta(t):t})),!Object.isSealed||m(function(){return Object.isSealed("foo")})&&(tP=Object.isSealed,n(Object,"isSealed",function(t){return!e.TypeIsObject(t)||tP(t)})),!Object.freeze||m(function(){return Object.freeze("foo")})&&(tc=Object.freeze,n(Object,"freeze",function(t){return e.TypeIsObject(t)?tc(t):t})),!Object.isFrozen||m(function(){return Object.isFrozen("foo")})&&(tl=Object.isFrozen,n(Object,"isFrozen",function(t){return!e.TypeIsObject(t)||tl(t)})),!Object.preventExtensions||m(function(){return Object.preventExtensions("foo")})&&(td=Object.preventExtensions,n(Object,"preventExtensions",function(t){return e.TypeIsObject(t)?td(t):t})),!Object.isExtensible||m(function(){return Object.isExtensible("foo")})&&(tu=Object.isExtensible,n(Object,"isExtensible",function(t){return!!e.TypeIsObject(t)&&tu(t)})),!Object.getPrototypeOf||m(function(){return Object.getPrototypeOf("foo")})&&(t1=Object.getPrototypeOf,n(Object,"getPrototypeOf",function(t){return t1(e.ToObject(t))})),s=c&&(P=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags"))&&e.IsCallable(P.get),c&&!s&&er(RegExp.prototype,"flags",function(){if(!e.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var t="";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.unicode&&(t+="u"),this.sticky&&(t+="y"),t});var eV,t2,t3,th,eL,R=c&&l(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),P=N&&c&&((M=/./)[i.match]=!1,RegExp(M)===M),s=l(function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})}),M=s&&l(function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})});s&&M||(eV=RegExp.prototype.toString,o(RegExp.prototype,"toString",function(){var t=e.RequireObjectCoercible(this);return u.regex(t)?a(eV,t):"/"+eD(t.source)+"/"+eD(t.flags)},!0),g(RegExp.prototype.toString,eV)),!c||R&&!P||(t2=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,Q=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},t3=e.IsCallable(Q.get)?Q.get:function(){return this.source},tm(th=RegExp,r=function s(t,n){var o=e.IsRegExp(t);return!(this instanceof s)&&o&&void 0===n&&t.constructor===s?t:u.regex(t)?new s(e.Call(t3,t),void 0===n?e.Call(t2,t):n):(o&&(t.source,void 0===n&&t.flags),new th(t,n))},{$input:!0}),RegExp=r,eK(t,"RegExp",r)),c&&z(k(eL={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"}),function(e){e in RegExp&&!(eL[e]in RegExp)&&er(RegExp,eL[e],function(){return RegExp[e]})}),ec(RegExp);var e2=1/Number.EPSILON,e3=Math.pow(2,-23),tG=Math.pow(2,127)*(2-e3),eR=Math.pow(2,-126),J=Math.E,ef=Math.LOG2E,tH=Math.LOG10E,tj=Number.prototype.clz;delete Number.prototype.clz;function t6(e,t,n){return E(1-e/t)/Number.EPSILON<(n||8)}s={acosh:function(t){var e=Number(t);return f(e)||t<1?NaN:1===e?0:e===1/0?e:(t=1/(e*e),e<2)?q(e-1+eu(1-t)*e):(e/=2,q(e+eu(1-t)*e-1)+1/ef)},asinh:function(n){if(e=Number(n),0===e||!et(e))return e;var t=E(e),n=t*t,e=X(e);return t<1?e*q(t+n/(eu(1+n)+1)):e*(q(t/2+eu(1+1/n)*t/2-1)+1/ef)},atanh:function(t){var e=Number(t);return 0===e?e:-1===e?-1/0:1===e?1/0:f(e)||e<-1||1<e?NaN:(t=E(e),X(e)*q(2*t/(1-t))/2)},cbrt:function(n){if(e=Number(n),0===e)return e;var e,n=e<0,t=(e=n?-e:e)===1/0?1/0:(e/((t=W(el(e)/3))*t)+2*t)/3;return n?-t:t},clz32:function(t){return t=Number(t),t=e.ToUint32(t),0===t?32:tj?e.Call(tj,t):31-ed(el(t+.5)*ef)},cosh:function(e){return e=Number(e),0===e?1:f(e)?NaN:et(e)?(e=W(E(e)-1),(e+1/(e*J*J))*(J/2)):1/0},expm1:function(s){if(e=Number(s),e===-1/0)return-1;if(!et(e)||0===e)return e;if(.5<E(e))return W(e)-1;for(var e,n=e,t=0,o=1;t+n!==t;)t+=n,n*=e/(o+=1);return t},hypot:function(){for(var n=0,e=0,s=0,t;s<arguments.length;++s)t=E(Number(arguments[s])),e<t?(n*=e/t*(e/t),n+=1,e=t):n+=0<t?t/e*(t/e):t;return e===1/0?1/0:e*eu(n)},log2:function(e){return el(e)*ef},log10:function(e){return el(e)*tH},log1p:q,sign:X,sinh:function(n){var e=Number(n),t;return!et(e)||0===e?e:(t=E(e),t<1)?(n=Math.expm1(t),X(e)*n*(1+1/(n+1))/2):(t=W(t-1),X(e)*(t-1/(t*J*J))*(J/2))},tanh:function(e){return e=Number(e),f(e)||0===e?e:20<=e?1:e<=-20?-1:(Math.expm1(e)-Math.expm1(-e))/(W(e)+W(-e))},trunc:function(e){return e=Number(e),e<0?-ed(-e):ed(e)},imul:function(t,n){var s=e.ToUint32(t),o=e.ToUint32(n),t=65535&s,n=65535&o;return t*n+((s>>>16&65535)*n+t*(o>>>16&65535)<<16>>>0)|0},fround:function(e){if(t=Number(e),0===t||t===1/0||t===-1/0||f(t))return t;var t,n=X(t),e=E(t);return e<eR?n*(e/eR/e3+e2-e2)*eR*e3:(t=(1+e3/Number.EPSILON)*e,e=t-(t-e),tG<e||f(e)?n*(1/0):n*e)}},d(Math,s),o(Math,"sinh",s.sinh,Math.sinh(710)===1/0),o(Math,"cosh",s.cosh,Math.cosh(710)===1/0),o(Math,"log1p",s.log1p,-1e-17!==Math.log1p(-1e-17)),o(Math,"asinh",s.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),o(Math,"asinh",s.asinh,Math.asinh(1e300)===1/0),o(Math,"atanh",s.atanh,0===Math.atanh(1e-300)),o(Math,"tanh",s.tanh,-2e-17!==Math.tanh(-2e-17)),o(Math,"acosh",s.acosh,Math.acosh(Number.MAX_VALUE)===1/0),o(Math,"acosh",s.acosh,!t6(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON))),o(Math,"cbrt",s.cbrt,!t6(Math.cbrt(1e-300),1e-100)),o(Math,"sinh",s.sinh,-2e-17!==Math.sinh(-2e-17)),M=Math.expm1(10),o(Math,"expm1",s.expm1,22025.465794806718<M||M<22025.465794806718),o(Math,"hypot",s.hypot,Math.hypot(1/0,NaN)!==1/0);var R=Math.round,P=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),Q=[1+e2,2*e2-1].every(function(e){return Math.round(e)===e});o(Math,"round",function(t){var e=ed(t);return t-e<.5?e:-1===e?-0:e+1},!P||!Q),g(Math.round,R),tw=Math.imul,-5!==Math.imul(4294967295,5)&&(Math.imul=s.imul,g(Math.imul,tw)),2!==Math.imul.length&&n(Math,"imul",function(){return e.Call(tw,Math,arguments)}),r=function(){if(m=t.setTimeout,"function"==typeof m||"object"===_typeof(m)){e.IsPromise=function(t){return!!e.TypeIsObject(t)&&void 0!==t._promise},n=function(n){if(!e.IsConstructor(n))throw new TypeError("Bad promise constructor");var t=this;if(t.resolve=void 0,t.reject=void 0,t.promise=new n(function(e,n){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError("Bad Promise implementation!");t.resolve=e,t.reject=n}),!e.IsCallable(t.resolve)||!e.IsCallable(t.reject))throw new TypeError("Bad promise constructor")},"undefined"!=typeof window&&e.IsCallable(window.postMessage)&&(c=function(){var e=[],t="zero-timeout-message";return window.addEventListener("message",function(n){n.source===window&&n.data===t&&(n.stopPropagation(),0!==e.length&&nn(e)())},!0),function(n){D(e,n),window.postMessage(t,"*")}});var m,c,n,r,j,p,b=e.IsCallable(t.setImmediate)?t.setImmediate:"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.nextTick?process.nextTick:(r=t.Promise,(j=r&&r.resolve&&r.resolve())?function(e){return j.then(e)}:e.IsCallable(c)?c():function(e){m(e,0)}),O=function(e){return e},y=function(e){throw e},i={},o=function(e,t,n){b(function(){w(e,t,n)})},w=function(s,e,o){var t,n;if(e===i)return s(o);try{t=s(o),n=e.resolve}catch(s){t=s,n=e.reject}n(t)},g=function(n,s){var e=n._promise,i=e.reactionLength,a,t;if(0<i&&(o(e.fulfillReactionHandler0,e.reactionCapability0,s),e.fulfillReactionHandler0=void 0,e.rejectReactions0=void 0,e.reactionCapability0=void 0,1<i))for(a=1,t=0;a<i;a++,t+=3)o(e[t+0],e[t+2],s),n[t+0]=void 0,n[t+1]=void 0,n[t+2]=void 0;e.result=s,e.state=1,e.reactionLength=0},h=function(n,s){var e=n._promise,i=e.reactionLength,a,t;if(0<i&&(o(e.rejectReactionHandler0,e.reactionCapability0,s),e.fulfillReactionHandler0=void 0,e.rejectReactions0=void 0,e.reactionCapability0=void 0,1<i))for(a=1,t=0;a<i;a++,t+=3)o(e[t+1],e[t+2],s),n[t+0]=void 0,n[t+1]=void 0,n[t+2]=void 0;e.result=s,e.state=2,e.reactionLength=0},v=function(t){var n=!1;return{resolve:function(s){var o;if(!n){if(n=!0,s===t)return h(t,new TypeError("Self resolution"));if(!e.TypeIsObject(s))return g(t,s);try{o=s.then}catch(e){return h(t,e)}if(!e.IsCallable(o))return g(t,s);b(function(){_(t,s,o)})}},reject:function(e){if(!n)return n=!0,h(t,e)}}},u=function(e,t,n,s){e===p?a(e,t,n,s,i):a(e,t,n,s)},_=function(t,n,s){var e=v(t),t=e.resolve,e=e.reject;try{u(s,n,t,e)}catch(t){e(t)}},s=f,l=s.prototype;return d(s,{all:function(t){if(!e.TypeIsObject(this))throw new TypeError("Promise is not object");var i,s,o=new n(this);try{return function(n,d,t){for(var a,r,l=n.iterator,o=[],s={count:1},i=0,c,h;;){try{if(!1===(a=e.IteratorStep(l))){n.done=!0;break}r=a.value}catch(e){throw n.done=!0,e}o[i]=void 0,c=d.resolve(r),h=function(n,e,s,o){var t=!1;return function(i){t||(t=!0,e[n]=i,0==--o.count&&(0,s.resolve)(e))}}(i,o,t,s),s.count+=1,u(c.then,c,h,t.reject),i+=1}return 0==--s.count&&(0,t.resolve)(o),t.promise}(s={iterator:i=e.GetIterator(t),done:!1},this,o)}catch(n){if(t=n,s&&!s.done)try{e.IteratorClose(i,!0)}catch(e){t=e}return(0,o.reject)(t),o.promise}},race:function(t){if(!e.TypeIsObject(this))throw new TypeError("Promise is not object");var i,s,o=new n(this);try{return function(t,a,n){for(var o,i,s,r=t.iterator;;){try{if(!1===(o=e.IteratorStep(r))){t.done=!0;break}i=o.value}catch(e){throw t.done=!0,e}s=a.resolve(i),u(s.then,s,n.resolve,n.reject)}return n.promise}(s={iterator:i=e.GetIterator(t),done:!1},this,o)}catch(n){if(t=n,s&&!s.done)try{e.IteratorClose(i,!0)}catch(e){t=e}return(0,o.reject)(t),o.promise}},reject:function(s){if(!e.TypeIsObject(this))throw new TypeError("Bad promise constructor");var t=new n(this);return(0,t.reject)(s),t.promise},resolve:function(t){if(!e.TypeIsObject(this))throw new TypeError("Bad promise constructor");if(e.IsPromise(t)&&t.constructor===this)return t;var s=new n(this);return(0,s.resolve)(t),s.promise}}),d(l,{catch:function(e){return this.then(null,e)},then:function(t,r){if(!e.IsPromise(this))throw new TypeError("not a promise");var l,a=e.SpeciesConstructor(this,s),c=2<arguments.length&&arguments[2]===i&&a===s?i:new n(a),d=e.IsCallable(t)?t:O,a=e.IsCallable(r)?r:y,t=this._promise;if(0===t.state)0===t.reactionLength?(t.fulfillReactionHandler0=d,t.rejectReactionHandler0=a,t.reactionCapability0=c):(t[0+(r=3*(t.reactionLength-1))]=d,t[1+r]=a,t[2+r]=c),t.reactionLength+=1;else if(1===t.state)l=t.result,o(d,c,l);else{if(2!==t.state)throw new TypeError("unexpected Promise state");l=t.result,o(a,c,l)}return c.promise}}),i=new n(s),p=l.then,s}function f(t){if(!(this instanceof f))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!e.IsCallable(t))throw new TypeError("not a valid resolver");var n=ev(this,f,l,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),s=v(n),o=s.reject;try{t(s.resolve,o)}catch(e){o(e)}return n}}(),t.Promise&&(delete t.Promise.accept,delete t.Promise.defer,delete t.Promise.prototype.chain),"function"==typeof r&&(d(t,{Promise:r}),M=e9(t.Promise,function(e){return e.resolve(42).then(function(){})instanceof e}),P=!m(function(){return t.Promise.reject(42).then(null,5).then(null,U)}),Q=m(function(){return t.Promise.call(3,U)}),R=function(e){var t=e.resolve(5);t.constructor={},e=e.resolve(t);try{e.then(null,U).then(null,U)}catch(e){return!0}return t===e}(t.Promise),s=c&&(eq=0,eh=Object.defineProperty({},"then",{get:function(){eq+=1}}),Promise.resolve(eh),1===eq),(eN=function t(e){var n=new Promise(e);e(3,function(){}),this.then=n.then,this.constructor=t}).prototype=Promise.prototype,eN.all=Promise.all,eh=l(function(){return!!eN.all([1,2])}),M&&P&&Q&&!R&&s&&!eh||(Promise=r,n(t,"Promise",r)),1!==Promise.all.length&&(tx=Promise.all,n(Promise,"all",function(){return e.Call(tx,this,arguments)})),1!==Promise.race.length&&(tC=Promise.race,n(Promise,"race",function(){return e.Call(tC,this,arguments)})),1!==Promise.resolve.length&&(tE=Promise.resolve,n(Promise,"resolve",function(){return e.Call(tE,this,arguments)})),1!==Promise.reject.length&&(tk=Promise.reject,n(Promise,"reject",function(){return e.Call(tk,this,arguments)})),e4(Promise,"all"),e4(Promise,"race"),e4(Promise,"resolve"),e4(Promise,"reject"),ec(Promise));function tF(e){var t=k(ez(e,function(e,t){return e[t]=!0,e},{}));return e.join(":")===t.join(":")}tW=tF(["z","a","bb"]),tU=tF(["z",1,"a","3",2]),c&&(F=function(t,n){return n||tW?O(t)?"^"+e.ToString(t):"string"==typeof t?"$"+t:"number"==typeof t?tU?t:"n"+t:"boolean"==typeof t?"b"+t:null:null},ee=function(){return Object.create?Object.create(null):{}},em=function(r,s,t){if(ei(t)||u.string(t))z(t,function(t){if(!e.TypeIsObject(t))throw new TypeError("Iterator value "+t+" is not an entry object");s.set(t[0],t[1])});else if(t instanceof r)a(r.prototype.forEach,t,function(e,t){s.set(t,e)});else{if(!O(t)){if(i=s.set,!e.IsCallable(i))throw new TypeError("bad map");o=e.GetIterator(t)}if(void 0!==o)for(;;){var o,i,n=e.IteratorStep(o);if(!1===n)break;n=n.value;try{if(!e.TypeIsObject(n))throw new TypeError("Iterator value "+n+" is not an entry object");a(i,s,n[0],n[1])}catch(t){throw e.IteratorClose(o,!0),t}}}},eS=function(r,n,t){if(ei(t)||u.string(t))z(t,function(e){n.add(e)});else if(t instanceof r)a(r.prototype.forEach,t,function(e){n.add(e)});else{if(!O(t)){if(i=n.add,!e.IsCallable(i))throw new TypeError("bad set");s=e.GetIterator(t)}if(void 0!==s)for(;;){var s,i,o=e.IteratorStep(s);if(!1===o)break;o=o.value;try{a(i,n,o)}catch(t){throw e.IteratorClose(s,!0),t}}}},Y={Map:function(){function n(e,t){this.key=e,this.value=t,this.next=null,this.prev=null}var s={},c,i;n.prototype.isRemoved=function(){return this.key===s};function t(t,n){if(!e.TypeIsObject(t)||!c(t))throw new TypeError("Method Map.prototype."+n+" called on incompatible receiver "+e.ToString(t))}function r(e,n){t(e,"[[MapIterator]]"),this.head=e._head,this.i=this.head,this.kind=n}c=function(e){return!!e._es6map},_(r.prototype={isMapIterator:!0,next:function(){if(!this.isMapIterator)throw new TypeError("Not a MapIterator");var t,e=this.i,n=this.kind,s=this.head;if(void 0===this.i)return H();for(;e.isRemoved()&&e!==s;)e=e.prev;for(;e.next!==s;)if(!(e=e.next).isRemoved())return t="key"===n?e.key:"value"===n?e.value:[e.key,e.value],this.i=e,H(t);return this.i=void 0,H()}});function o(){if(!(this instanceof o))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var t=ev(this,o,i,{_es6map:!0,_head:null,_map:h?new h:null,_size:0,_storage:ee()}),e=new n(null,null);return e.next=e.prev=e,t._head=e,0<arguments.length&&em(o,t,arguments[0]),t}return er(i=o.prototype,"size",function(){if(void 0===this._size)throw new TypeError("size method called on incompatible Map");return this._size}),d(i,{get:function(o){if(t(this,"get"),i=F(o,!0),null!==i)return(n=this._storage[i])?n.value:void 0;if(this._map)return(n=es.call(this._map,o))?n.value:void 0;for(var n,i,a=this._head,s=a;(s=s.next)!==a;)if(e.SameValueZero(s.key,o))return s.value},has:function(n){if(t(this,"has"),o=F(n,!0),null!==o)return void 0!==this._storage[o];if(this._map)return en.call(this._map,n);for(var o,i=this._head,s=i;(s=s.next)!==i;)if(e.SameValueZero(s.key,n))return!0;return!1},set:function(o,i){t(this,"set");var s,r=this._head,a=r,c=F(o,!0);if(null!==c){if(void 0!==this._storage[c])return this._storage[c].value=i,this;s=this._storage[c]=new n(o,i),a=r.prev}else this._map&&(en.call(this._map,o)?es.call(this._map,o).value=i:(s=new n(o,i),tN.call(this._map,o,s),a=r.prev));for(;(a=a.next)!==r;)if(e.SameValueZero(a.key,o))return a.value=i,this;return s=s||new n(o,i),e.SameValue(-0,o)&&(s.key=0),s.next=this._head,s.prev=this._head.prev,(s.prev.next=s).next.prev=s,this._size+=1,this},delete:function(o){t(this,"delete");var a=this._head,n=a,i=F(o,!0);if(null!==i){if(void 0===this._storage[i])return!1;n=this._storage[i].prev,delete this._storage[i]}else if(this._map){if(!en.call(this._map,o))return!1;n=es.call(this._map,o).prev,tq.call(this._map,o)}for(;(n=n.next)!==a;)if(e.SameValueZero(n.key,o))return n.key=s,n.value=s,n.prev.next=n.next,n.next.prev=n.prev,--this._size,!0;return!1},clear:function(){t(this,"clear"),this._map=h?new h:null,this._size=0,this._storage=ee();for(var n=this._head,e=n,o=e.next;(e=o)!==n;)e.key=s,e.value=s,o=e.next,e.next=e.prev=n;n.next=n.prev=n},keys:function(){return t(this,"keys"),new r(this,"key")},values:function(){return t(this,"values"),new r(this,"value")},entries:function(){return t(this,"entries"),new r(this,"key+value")},forEach:function(n){t(this,"forEach");for(var s=1<arguments.length?arguments[1]:null,o=this.entries(),e=o.next();!e.done;e=o.next())s?a(n,s,e.value[1],e.value[0],this):n(e.value[1],e.value[0],this)}}),_(i,i.entries),o}(),Set:function(){function n(t,s){if(!e.TypeIsObject(t)||!(n=t)._es6set||void 0===n._storage)throw new TypeError("Set.prototype."+s+" called on incompatible receiver "+e.ToString(t));var n}function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var e=ev(this,t,r,{_es6set:!0,"[[SetData]]":null,_storage:ee()});if(!e._es6set)throw new TypeError("bad set");return 0<arguments.length&&eS(t,e,arguments[0]),e}function s(e){var t;e["[[SetData]]"]||(t=new Y.Map,e["[[SetData]]"]=t,z(k(e._storage),function(e){e=function(t){var e=t;if("^null"===e)return null;if("^undefined"!==e)return t=e.charAt(0),"$"===t?G(e,1):"n"===t?+G(e,1):"b"===t?"btrue"===e:+e}(e),t.set(e,e)}),e["[[SetData]]"]=t),e._storage=null}var r=t.prototype,i;return er(t.prototype,"size",function(){return n(this,"size"),this._storage?k(this._storage).length:(s(this),this["[[SetData]]"].size)}),d(t.prototype,{has:function(e){var t;return n(this,"has"),this._storage&&null!==(t=F(e))?!!this._storage[t]:(s(this),this["[[SetData]]"].has(e))},add:function(e){var t;return n(this,"add"),this._storage&&null!==(t=F(e))?this._storage[t]=!0:(s(this),this["[[SetData]]"].set(e,e)),this},delete:function(t){if(n(this,"delete"),this._storage&&null!==(e=F(t))){var e,o=e8(this._storage,e);return delete this._storage[e]&&o}return s(this),this["[[SetData]]"].delete(t)},clear:function(){n(this,"clear"),this._storage&&(this._storage=ee()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return n(this,"values"),s(this),new i(this["[[SetData]]"].values())},entries:function(){return n(this,"entries"),s(this),new i(this["[[SetData]]"].entries())},forEach:function(t){n(this,"forEach");var o=1<arguments.length?arguments[1]:null,e=this;s(e),this["[[SetData]]"].forEach(function(s,n){o?a(t,o,n,n,e):t(n,n,e)})}}),o(t.prototype,"keys",t.prototype.values,!0),_(t.prototype,t.prototype.values),i=function(e){this.it=e},i.prototype={isSetIterator:!0,next:function(){if(!this.isSetIterator)throw new TypeError("Not a SetIterator");return this.it.next()}},_(i.prototype),t}()},t.Set&&!Set.prototype.delete&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys)&&(t.Set=Y.Set),(t.Map||t.Set)&&(l(function(){return 2===new Map([[1,2]]).get(1)})||(t.Map=function n(){if(!(this instanceof n))throw new TypeError('Constructor Map requires "new"');var e=new h;return 0<arguments.length&&em(n,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.Map.prototype),e},t.Map.prototype=e0(h.prototype),o(t.Map.prototype,"constructor",t.Map,!0),g(t.Map,h)),p=new Map,(r=new Map([[1,0],[2,0],[3,0],[4,0]])).set(-0,r),r=r.get(0)===r&&r.get(-0)===r&&r.has(0)&&r.has(-0),p=p.set(1,2)===p,r&&p||n(Map.prototype,"set",function(e,t){return a(tN,this,0===e?0:e,t),this}),r||(d(Map.prototype,{get:function(e){return a(es,this,0===e?0:e)},has:function(e){return a(en,this,0===e?0:e)}},!0),g(Map.prototype.get,es),g(Map.prototype.has,en)),p=new Set,r=Set.prototype.delete&&Set.prototype.add&&Set.prototype.has&&((v=p).delete(0),v.add(-0),!v.has(0)),v=p.add(1)===p,r&&v||(eA=Set.prototype.add,Set.prototype.add=function(e){return a(eA,this,0===e?0:e),this},g(Set.prototype.add,eA)),r||(ek=Set.prototype.has,Set.prototype.has=function(e){return a(ek,this,0===e?0:e)},g(Set.prototype.has,ek),ep=Set.prototype.delete,Set.prototype.delete=function(e){return a(ep,this,0===e?0:e)},g(Set.prototype.delete,ep)),p=e9(t.Map,function(e){var t=new e([]);return t.set(42,42),t instanceof e}),v=Object.setPrototypeOf&&!p,r=function(){try{return!(t.Map()instanceof t.Map)}catch(e){return e instanceof TypeError}}(),0===t.Map.length&&!v&&r||(t.Map=function t(){if(!(this instanceof t))throw new TypeError('Constructor Map requires "new"');var e=new h;return 0<arguments.length&&em(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.prototype),e},t.Map.prototype=h.prototype,o(t.Map.prototype,"constructor",t.Map,!0),g(t.Map,h)),v=e9(t.Set,function(e){var t=new e([]);return t.add(42,42),t instanceof e}),r=Object.setPrototypeOf&&!v,v=function(){try{return!(t.Set()instanceof t.Set)}catch(e){return e instanceof TypeError}}(),0===t.Set.length&&!r&&v||(e6=t.Set,t.Set=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');var e=new e6;return 0<arguments.length&&eS(t,e,arguments[0]),delete e.constructor,Object.setPrototypeOf(e,t.prototype),e},t.Set.prototype=e6.prototype,o(t.Set.prototype,"constructor",t.Set,!0),g(t.Set,e6)),e1=new t.Map,v=!l(function(){return e1.keys().next().done}),("function"!=typeof t.Map.prototype.clear||0!==(new t.Set).size||0!==e1.size||"function"!=typeof t.Map.prototype.keys||"function"!=typeof t.Set.prototype.keys||"function"!=typeof t.Map.prototype.forEach||"function"!=typeof t.Set.prototype.forEach||tz(t.Map)||tz(t.Set)||"function"!=typeof e1.keys().next||v||!p)&&d(t,{Map:Y.Map,Set:Y.Set},!0),t.Set.prototype.keys!==t.Set.prototype.values&&o(t.Set.prototype,"keys",t.Set.prototype.values,!0),_(Object.getPrototypeOf((new t.Map).keys())),_(Object.getPrototypeOf((new t.Set).keys())),eo&&"has"!==t.Set.prototype.has.name&&(tA=t.Set.prototype.has,n(t.Set.prototype,"has",function(e){return a(tA,this,e)}))),d(t,Y),ec(t.Map),ec(t.Set));function j(t){if(!e.TypeIsObject(t))throw new TypeError("target must be an object")}b={apply:function(){return e.Call(e.Call,null,arguments)},construct:function(t,s){if(!e.IsConstructor(t))throw new TypeError("First argument must be a constructor.");var n=2<arguments.length?arguments[2]:t;if(!e.IsConstructor(n))throw new TypeError("new.target must be a constructor.");return e.Construct(t,s,n,"internal")},deleteProperty:function(e,t){if(j(e),c){var n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return!1}return delete e[t]},has:function(e,t){return j(e),t in e}},Object.getOwnPropertyNames&&Object.assign(b,{ownKeys:function(t){j(t);var n=Object.getOwnPropertyNames(t);return e.IsCallable(Object.getOwnPropertySymbols)&&tB(n,Object.getOwnPropertySymbols(t)),n}});function tv(e){return!m(e)}return Object.preventExtensions&&Object.assign(b,{isExtensible:function(e){return j(e),Object.isExtensible(e)},preventExtensions:function(e){return j(e),tv(function(){return Object.preventExtensions(e)})}}),c&&(e7=function(t,s,o){var n=Object.getOwnPropertyDescriptor(t,s);return n?"value"in n?n.value:n.get?e.Call(n.get,o):void 0:(t=Object.getPrototypeOf(t),null===t?void 0:e7(t,s,o))},ew=function(s,o,i,t){var n=Object.getOwnPropertyDescriptor(s,o);if(!n){if(s=Object.getPrototypeOf(s),null!==s)return ew(s,o,i,t);n={value:void 0,writable:!0,enumerable:!0,configurable:!0}}return"value"in n?!!n.writable&&!!e.TypeIsObject(t)&&(Object.getOwnPropertyDescriptor(t,o)?V.defineProperty(t,o,{value:i}):V.defineProperty(t,o,{value:i,writable:!0,enumerable:!0,configurable:!0})):!!n.set&&(a(n.set,t,i),!0)},Object.assign(b,{defineProperty:function(e,t,n){return j(e),tv(function(){return Object.defineProperty(e,t,n)})},getOwnPropertyDescriptor:function(e,t){return j(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){return j(e),e7(e,t,2<arguments.length?arguments[2]:e)},set:function(e,t,n){return j(e),ew(e,t,n,3<arguments.length?arguments[3]:e)}})),Object.getPrototypeOf&&(tf=Object.getPrototypeOf,b.getPrototypeOf=function(e){return j(e),tf(e)}),Object.setPrototypeOf&&b.getPrototypeOf&&Object.assign(b,{setPrototypeOf:function(t,n){if(j(t),null!==n&&!e.TypeIsObject(n))throw new TypeError("proto must be an object or null");return n===V.getPrototypeOf(t)||!(V.isExtensible&&!V.isExtensible(t))&&!function(t,n){for(var e=n;e;){if(t===e)return!0;e=b.getPrototypeOf(e)}return!1}(t,n)&&(Object.setPrototypeOf(t,n),!0)}}),Object.keys(b).forEach(function(i){var s;i=b[s=i],e.IsCallable(t.Reflect[s])?l(function(){return t.Reflect[s](1),t.Reflect[s](NaN),t.Reflect[s](!0),!0})&&n(t.Reflect,s,i):o(t.Reflect,s,i)}),eO=t.Reflect.getPrototypeOf,eo&&eO&&"getPrototypeOf"!==eO.name&&n(t.Reflect,"getPrototypeOf",function(e){return a(eO,t.Reflect,e)}),t.Reflect.setPrototypeOf&&l(function(){return t.Reflect.setPrototypeOf(1,{}),!0})&&n(t.Reflect,"setPrototypeOf",b.setPrototypeOf),t.Reflect.defineProperty&&(l(function(){var e=!t.Reflect.defineProperty(1,"test",{value:1}),n="function"!=typeof Object.preventExtensions||!t.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&n})||n(t.Reflect,"defineProperty",b.defineProperty)),t.Reflect.construct&&(l(function(){function e(){}return t.Reflect.construct(function(){},[],e)instanceof e})||n(t.Reflect,"construct",b.construct)),"Invalid Date"!==String(new Date(NaN))&&(t8=Date.prototype.toString,n(Date.prototype,"toString",function(){var t=+this;return t!=t?"Invalid Date":e.Call(t8,this)})),eQ={anchor:function(t){return e.CreateHTML(this,"a","name",t)},big:function(){return e.CreateHTML(this,"big","","")},blink:function(){return e.CreateHTML(this,"blink","","")},bold:function(){return e.CreateHTML(this,"b","","")},fixed:function(){return e.CreateHTML(this,"tt","","")},fontcolor:function(t){return e.CreateHTML(this,"font","color",t)},fontsize:function(t){return e.CreateHTML(this,"font","size",t)},italics:function(){return e.CreateHTML(this,"i","","")},link:function(t){return e.CreateHTML(this,"a","href",t)},small:function(){return e.CreateHTML(this,"small","","")},strike:function(){return e.CreateHTML(this,"strike","","")},sub:function(){return e.CreateHTML(this,"sub","","")},sup:function(){return e.CreateHTML(this,"sup","","")}},z(Object.keys(eQ),function(o){var t,s=String.prototype[o];(!e.IsCallable(s)||(t=a(s,"",' " '),s=eT([],t.match(/"/g)).length,t!==t.toLowerCase()||2<s))&&n(String.prototype,o,eQ[o])}),p=function(){if(!N)return!1;var e="object"===("undefined"==typeof JSON?"undefined":_typeof(JSON))&&"function"==typeof JSON.stringify?JSON.stringify:null,t;return!!e&&(void 0!==e(i())||("[null]"!==e([i()])||(t={a:i()},t[i()]=!0,"{}"!==e(t))))}(),eo=l(function(){return!N||"{}"===JSON.stringify(Object(i()))&&"[{}]"===JSON.stringify([Object(i())])}),!p&&eo||(eG=JSON.stringify,n(JSON,"stringify",function(t){if("symbol"!==_typeof(t)){var n,s,t=[t];return ei(n=1<arguments.length?arguments[1]:n)?t.push(n):(s=e.IsCallable(n)?n:null,t.push(function(t,e){if(e=s?a(s,this,t,e):e,"symbol"!==_typeof(e))return u.symbol(e)?eX({})(e):e})),2<arguments.length&&t.push(arguments[2]),eG.apply(this,t)}})),t},"function"==typeof e&&e.amd?e("es6-shim",l):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=l():y.returnExports=l(),f="undefined"!=typeof window?window:this,h=function(o,tM){function s(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item}function S(e){return null!=e&&e===e.window}var b=[],eZ=Object.getPrototypeOf,_=b.slice,eQ=b.flat?function(e){return b.flat.call(e)}:function(e){return b.concat.apply([],e)},e4=b.push,et=b.indexOf,X={},eX=X.toString,J=X.hasOwnProperty,eY=J.toString,tS=eY.call(Object),a={},i=o.document,tA={type:!0,src:!0,nonce:!0,noModule:!0},t,p,eL,eN,tk,g,tw,e0,t_,ty,e9,d,th,ef,eC,eE,ek,eA,ed,eM,Z,h,el,tr,M,Y,to,tn,e$,P,tc,tl,t4,e5,tE,R,r,eD,eh,tF,tT,ts;function eU(a,e,s){var t,o,n=(s=s||i).createElement("script");if(n.text=a,e)for(t in tA)(o=e[t]||e.getAttribute&&e.getAttribute(t))&&n.setAttribute(t,o);s.head.appendChild(n).parentNode.removeChild(n)}function E(e){return null==e?e+"":"object"===_typeof(e)||"function"==typeof e?X[eX.call(e)]||"object":_typeof(e)}t=function e(t,n){return new e.fn.init(t,n)};function es(e){var t=!!e&&"length"in e&&e.length,n=E(e);return!s(e)&&!S(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}t.fn=t.prototype={jquery:"3.6.0",constructor:t,length:0,toArray:function(){return _.call(this)},get:function(e){return null==e?_.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){return e=t.merge(this.constructor(),e),e.prevObject=this,e},each:function(e){return t.each(this,e)},map:function(e){return this.pushStack(t.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(_.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(t.grep(this,function(t,e){return(e+1)%2}))},odd:function(){return this.pushStack(t.grep(this,function(t,e){return e%2}))},eq:function(e){var t=this.length,e=+e+(e<0?t:0);return this.pushStack(0<=e&&e<t?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:e4,sort:b.sort,splice:b.splice},t.extend=t.fn.extend=function(){var c,i,n,r,a,e=arguments[0]||{},o=1,d=arguments.length,l=!1;for("boolean"==typeof e&&(l=e,e=arguments[o]||{},o++),"object"===_typeof(e)||s(e)||(e={}),o===d&&(e=this,o--);o<d;o++)if(null!=(c=arguments[o]))for(i in c)n=c[i],"__proto__"!==i&&e!==n&&(l&&n&&(t.isPlainObject(n)||(r=Array.isArray(n)))?(a=e[i],a=r&&!Array.isArray(a)?[]:r||t.isPlainObject(a)?a:{},r=!1,e[i]=t.extend(l,a,n)):void 0!==n&&(e[i]=n));return e},t.extend({expando:"jQuery"+("3.6.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){return!(!e||"[object Object]"!==eX.call(e))&&(!(e=eZ(e))||"function"==typeof(e=J.call(e,"constructor")&&e.constructor)&&eY.call(e)===tS)},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(t,e,n){eU(t,{nonce:e&&e.nonce},n)},each:function(t,n){var s,e=0;if(es(t))for(s=t.length;e<s&&!1!==n.call(t[e],e,t[e]);e++);else for(e in t)if(!1===n.call(t[e],e,t[e]))break;return t},makeArray:function(e,n){return n=n||[],null!=e&&(es(Object(e))?t.merge(n,"string"==typeof e?[e]:e):e4.call(n,e)),n},inArray:function(t,e,n){return null==e?-1:et.call(e,t,n)},merge:function(e,n){for(var o=+n.length,t=0,s=e.length;t<o;t++)e[s++]=n[t];return e.length=s,e},grep:function(t,s,o){for(var n=[],e=0,i=t.length,a=!o;e<i;e++)!s(t[e],e)!=a&&n.push(t[e]);return n},map:function(t,o,i){var a,n,e=0,s=[];if(es(t))for(a=t.length;e<a;e++)null!=(n=o(t[e],e,i))&&s.push(n);else for(e in t)null!=(n=o(t[e],e,i))&&s.push(n);return eQ(s)},guid:1,support:a}),"function"==typeof Symbol&&(t.fn[Symbol.iterator]=b[Symbol.iterator]),t.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){X["[object "+e+"]"]=e.toLowerCase()}),p=function(K){function m(e,t){return e="0x"+e.slice(1)-65536,t||(e<0?String.fromCharCode(65536+e):String.fromCharCode(e>>10|55296,1023&e|56320))}function eo(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}function en(){g()}var x,o,e,M,et,k,W,Z,F,v,O,g,n,r,c,a,j,S,C,i="sizzle"+ +new Date,u=K.document,h=0,e6=0,G=D(),ee=D(),ea=D(),R=D(),B=function(e,t){return e===t&&(O=!0),0},ef={}.hasOwnProperty,_=[],e8=_.pop,em=_.push,p=_.push,Y=_.slice,y=function(t,n){for(var e=0,s=t.length;e<s;e++)if(t[e]===n)return e;return-1},H="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",t="[\\x20\\t\\r\\n\\f]",b="(?:\\\\[\\da-fA-F]{1,6}"+t+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",es="\\["+t+"*("+b+")(?:"+t+"*([*^$|!~]?=)"+t+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+b+"))|)"+t+"*\\]",$=":("+b+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+es+")*)|.*)\\)|)",eh=new RegExp(t+"+","g"),z=new RegExp("^"+t+"+|((?:^|[^\\\\])(?:\\\\.)*)"+t+"+$","g"),e3=new RegExp("^"+t+"*,"+t+"*"),X=new RegExp("^"+t+"*([>+~]|"+t+")"+t+"*"),e2=new RegExp(t+"|>"),e0=new RegExp($),e4=new RegExp("^"+b+"$"),L={ID:new RegExp("^#("+b+")"),CLASS:new RegExp("^\\.("+b+")"),TAG:new RegExp("^("+b+"|[*])"),ATTR:new RegExp("^"+es),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+t+"*(even|odd|(([+-]|)(\\d*)n|)"+t+"*(?:([+-]|)"+t+"*(\\d+)|))"+t+"*\\)|)","i"),bool:new RegExp("^(?:"+H+")$","i"),needsContext:new RegExp("^"+t+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+t+"*((?:-\\d)?\\d*)"+t+"*\\)|)(?=[^-]|$)","i")},e1=/HTML$/i,eu=/^(?:input|select|textarea|button)$/i,ed=/^h\d$/i,E=/^[^{]+\{\s*\[native \w/,el=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,V=/[+~]/,f=new RegExp("\\\\[\\da-fA-F]{1,6}"+t+"?|\\\\([^\\r\\n\\f])","g"),J=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ep=N(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{p.apply(_=Y.call(u.childNodes),u.childNodes),_[u.childNodes.length].nodeType}catch(e){p={apply:_.length?function(e,t){em.apply(e,Y.call(t))}:function(e,n){for(var t=e.length,s=0;e[t++]=n[s++];);e.length=t-1}}}function s(s,e,t,b){var v,l,d,m,f,r,h=e&&e.ownerDocument,u=e?e.nodeType:9;if(t=t||[],"string"!=typeof s||!s||1!==u&&9!==u&&11!==u)return t;if(!b&&(g(e),e=e||n,c)){if(11!==u&&(m=el.exec(s)))if(r=m[1]){if(9===u){{if(!(l=e.getElementById(r)))return t;if(l.id===r)return t.push(l),t}}else if(h&&(l=h.getElementById(r))&&C(e,l)&&l.id===r)return t.push(l),t}else{if(m[2])return p.apply(t,e.getElementsByTagName(s)),t;if((r=m[3])&&o.getElementsByClassName&&e.getElementsByClassName)return p.apply(t,e.getElementsByClassName(r)),t}if(o.qsa&&!R[s+" "]&&(!a||!a.test(s))&&(1!==u||"object"!==e.nodeName.toLowerCase())){if(r=s,h=e,1===u&&(e2.test(s)||X.test(s))){for((h=V.test(s)&&P(e.parentNode)||e)===e&&o.scope||((d=e.getAttribute("id"))?d=d.replace(J,eo):e.setAttribute("id",d=i)),v=(f=k(s)).length;v--;)f[v]=(d?"#"+d:":scope")+" "+A(f[v]);r=f.join(",")}try{return p.apply(t,h.querySelectorAll(r)),t}catch(e){R(s,!0)}finally{d===i&&e.removeAttribute("id")}}}return Z(s.replace(z,"$1"),e,t,b)}function D(){var n=[];function t(s,o){return n.push(s+" ")>e.cacheLength&&delete t[n.shift()],t[s+" "]=o}return t}function d(e){return e[i]=!0,e}function l(t){var e=n.createElement("fieldset");try{return!!t(e)}catch(e){return!1}finally{e.parentNode&&e.parentNode.removeChild(e)}}function U(s,o){for(var t=s.split("|"),n=t.length;n--;)e.attrHandle[t[n]]=o}function ei(t,n){var e=n&&t,s=e&&1===t.nodeType&&1===n.nodeType&&t.sourceIndex-n.sourceIndex;if(s)return s;if(e)for(;e=e.nextSibling;)if(e===n)return-1;return t?1:-1}function er(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ep(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function w(e){return d(function(t){return t=+t,d(function(n,a){for(var s,o=e([],n.length,t),i=o.length;i--;)n[s=o[i]]&&(n[s]=!(a[s]=n[s]))})})}function P(e){return e&&void 0!==e.getElementsByTagName&&e}for(x in o=s.support={},et=s.isXML=function(e){var t=e&&e.namespaceURI,e=e&&(e.ownerDocument||e).documentElement;return!e1.test(t||e&&e.nodeName||"HTML")},g=s.setDocument=function(d){var s,d=d?d.ownerDocument||d:u;return d!=n&&9===d.nodeType&&d.documentElement&&(r=(n=d).documentElement,c=!et(n),u!=n&&(s=n.defaultView)&&s.top!==s&&(s.addEventListener?s.addEventListener("unload",en,!1):s.attachEvent&&s.attachEvent("onunload",en)),o.scope=l(function(e){return r.appendChild(e).appendChild(n.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),o.attributes=l(function(e){return e.className="i",!e.getAttribute("className")}),o.getElementsByTagName=l(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),o.getElementsByClassName=E.test(n.getElementsByClassName),o.getById=l(function(e){return r.appendChild(e).id=i,!n.getElementsByName||!n.getElementsByName(i).length}),o.getById?(e.filter.ID=function(e){var t=e.replace(f,m);return function(e){return e.getAttribute("id")===t}},e.find.ID=function(e,t){if(void 0!==t.getElementById&&c)return e=t.getElementById(e),e?[e]:[]}):(e.filter.ID=function(e){var t=e.replace(f,m);return function(e){return e=void 0!==e.getAttributeNode&&e.getAttributeNode("id"),e&&e.value===t}},e.find.ID=function(t,s){if(void 0!==s.getElementById&&c){var n,o,i,e=s.getElementById(t);if(e){if((n=e.getAttributeNode("id"))&&n.value===t)return[e];for(i=s.getElementsByName(t),o=0;e=i[o++];)if((n=e.getAttributeNode("id"))&&n.value===t)return[e]}return[]}}),e.find.TAG=o.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):o.qsa?e.querySelectorAll(t):void 0}:function(t,o){var e,n=[],i=0,s=o.getElementsByTagName(t);if("*"!==t)return s;for(;e=s[i++];)1===e.nodeType&&n.push(e);return n},e.find.CLASS=o.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&c)return e.getElementsByClassName(t)},j=[],a=[],(o.qsa=E.test(n.querySelectorAll))&&(l(function(e){var s;r.appendChild(e).innerHTML="<a id='"+i+"'></a><select id='"+i+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&a.push("[*^$]="+t+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||a.push("\\["+t+"*(?:value|"+H+")"),e.querySelectorAll("[id~="+i+"-]").length||a.push("~="),(s=n.createElement("input")).setAttribute("name",""),e.appendChild(s),e.querySelectorAll("[name='']").length||a.push("\\["+t+"*name"+t+"*="+t+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||a.push(":checked"),e.querySelectorAll("a#"+i+"+*").length||a.push(".#.+[+~]"),e.querySelectorAll("\\"),a.push("[\\r\\n\\f]")}),l(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var s=n.createElement("input");s.setAttribute("type","hidden"),e.appendChild(s).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&a.push("name"+t+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&a.push(":enabled",":disabled"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&a.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),a.push(",.*:")})),(o.matchesSelector=E.test(S=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.oMatchesSelector||r.msMatchesSelector))&&l(function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),j.push("!=",$)}),a=a.length&&new RegExp(a.join("|")),j=j.length&&new RegExp(j.join("|")),s=E.test(r.compareDocumentPosition),C=s||E.test(r.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,e=e&&e.parentNode;return t===e||!(!e||1!==e.nodeType||!(n.contains?n.contains(e):t.compareDocumentPosition&&16&t.compareDocumentPosition(e)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},B=s?function(e,t){if(e===t)return O=!0,0;var s=!e.compareDocumentPosition-!t.compareDocumentPosition;return s||(1&(s=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===s?e==n||e.ownerDocument==u&&C(u,e)?-1:t==n||t.ownerDocument==u&&C(u,t)?1:v?y(v,e)-y(v,t):0:4&s?-1:1)}:function(s,o){if(s===o)return O=!0,0;var e,t=0,r=s.parentNode,c=o.parentNode,i=[s],a=[o];if(!r||!c)return s==n?-1:o==n?1:r?-1:c?1:v?y(v,s)-y(v,o):0;if(r===c)return ei(s,o);for(e=s;e=e.parentNode;)i.unshift(e);for(e=o;e=e.parentNode;)a.unshift(e);for(;i[t]===a[t];)t++;return t?ei(i[t],a[t]):i[t]==u?-1:a[t]==u?1:0}),n},s.matches=function(e,t){return s(e,null,null,t)},s.matchesSelector=function(t,e){if(g(t),o.matchesSelector&&c&&!R[e+" "]&&(!j||!j.test(e))&&(!a||!a.test(e)))try{var i=S.call(t,e);if(i||o.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){R(e,!0)}return 0<s(e,n,null,[t]).length},s.contains=function(e,t){return(e.ownerDocument||e)!=n&&g(e),C(e,t)},s.attr=function(s,i){(s.ownerDocument||s)!=n&&g(s);var t=e.attrHandle[i.toLowerCase()],t=t&&ef.call(e.attrHandle,i.toLowerCase())?t(s,i,!c):void 0;return void 0!==t?t:o.attributes||!c?s.getAttribute(i):(t=s.getAttributeNode(i))&&t.specified?t.value:null},s.escape=function(e){return(e+"").replace(J,eo)},s.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},s.uniqueSort=function(e){var s,i=[],t=0,n=0;if(O=!o.detectDuplicates,v=!o.sortStable&&e.slice(0),e.sort(B),O){for(;s=e[n++];)s===e[n]&&(t=i.push(n));for(;t--;)e.splice(i[t],1)}return v=null,e},M=s.getText=function(e){var s,n="",o=0,t=e.nodeType;if(t){if(1===t||9===t||11===t){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=M(e)}else if(3===t||4===t)return e.nodeValue}else for(;s=e[o++];)n+=M(s);return n},(e=s.selectors={cacheLength:50,createPseudo:d,match:L,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(f,m),e[3]=(e[3]||e[4]||e[5]||"").replace(f,m),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||s.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&s.error(e[0]),e},PSEUDO:function(e){var n,t=!e[6]&&e[2];return L.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":t&&e0.test(t)&&(n=k(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(e[0]=e[0].slice(0,n),e[2]=t.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(f,m).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var n=G[e+" "];return n||(n=new RegExp("(^|"+t+")"+e+"("+t+"|$)"))&&G(e,function(e){return n.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,t,e){return function(o){return o=s.attr(o,n),null==o?"!="===t:!t||(o+="","="===t?o===e:"!="===t?o!==e:"^="===t?e&&0===o.indexOf(e):"*="===t?e&&-1<o.indexOf(e):"$="===t?e&&o.slice(-e.length)===e:"~="===t?-1<(" "+o.replace(eh," ")+" ").indexOf(e):"|="===t&&(o===e||o.slice(0,e.length+1)===e+"-"))}},CHILD:function(e,r,c,n,o){var a="nth"!==e.slice(0,3),s="last"!==e.slice(-4),t="of-type"===r;return 1===n&&0===o?function(e){return!!e.parentNode}:function(u,_,y){var m,v,d,r,l,p,g=a!=s?"nextSibling":"previousSibling",f=u.parentNode,j=t&&u.nodeName.toLowerCase(),b=!y&&!t,c=!1;if(f){if(a){for(;g;){for(r=u;r=r[g];)if(t?r.nodeName.toLowerCase()===j:1===r.nodeType)return!1;p=g="only"===e&&!p&&"nextSibling"}return!0}if(p=[s?f.firstChild:f.lastChild],s&&b){for(c=(l=(m=(v=(d=(r=f)[i]||(r[i]={}))[r.uniqueID]||(d[r.uniqueID]={}))[e]||[])[0]===h&&m[1])&&m[2],r=l&&f.childNodes[l];r=++l&&r&&r[g]||(c=l=0)||p.pop();)if(1===r.nodeType&&++c&&r===u){v[e]=[h,l,c];break}}else if(!1===(c=b?l=(m=(v=(d=(r=u)[i]||(r[i]={}))[r.uniqueID]||(d[r.uniqueID]={}))[e]||[])[0]===h&&m[1]:c))for(;(r=++l&&r&&r[g]||(c=l=0)||p.pop())&&((t?r.nodeName.toLowerCase()!==j:1!==r.nodeType)||!++c||(b&&((v=(d=r[i]||(r[i]={}))[r.uniqueID]||(d[r.uniqueID]={}))[e]=[h,c]),r!==u)););return(c-=o)===n||c%n==0&&0<=c/n}}},PSEUDO:function(t,o){var a,n=e.pseudos[t]||e.setFilters[t.toLowerCase()]||s.error("unsupported pseudo: "+t);return n[i]?n(o):1<n.length?(a=[t,t,"",o],e.setFilters.hasOwnProperty(t.toLowerCase())?d(function(e,a){for(var i,t=n(e,o),s=t.length;s--;)e[i=y(e,t[s])]=!(a[i]=t[s])}):function(e){return n(e,0,a)}):n}},pseudos:{not:d(function(s){var e=[],n=[],t=W(s.replace(z,"$1"));return t[i]?d(function(n,o,r,i){for(var s,a=t(n,null,i,[]),e=n.length;e--;)(s=a[e])&&(n[e]=!(o[e]=s))}):function(s,i,o){return e[0]=s,t(e,null,o,n),e[0]=null,!n.pop()}}),has:d(function(e){return function(t){return 0<s(e,t).length}}),contains:d(function(e){return e=e.replace(f,m),function(t){return-1<(t.textContent||M(t)).indexOf(e)}}),lang:d(function(e){return e4.test(e||"")||s.error("unsupported lang: "+e),e=e.replace(f,m).toLowerCase(),function(t){var n;do if(n=c?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType)return!1}}),target:function(t){var e=K.location&&K.location.hash;return e&&e.slice(1)===t.id},root:function(e){return e===r},focus:function(e){return e===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:er(!1),disabled:er(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(t){return!e.pseudos.empty(t)},header:function(e){return ed.test(e.nodeName)},input:function(e){return eu.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(e=e.getAttribute("type"))||"text"===e.toLowerCase())},first:w(function(){return[0]}),last:w(function(t,e){return[e-1]}),eq:w(function(n,t,e){return[e<0?e+t:e]}),even:w(function(t,n){for(var e=0;e<n;e+=2)t.push(e);return t}),odd:w(function(t,n){for(var e=1;e<n;e+=2)t.push(e);return t}),lt:w(function(n,t,e){for(var s=e<0?e+t:t<e?t:e;0<=--s;)n.push(s);return n}),gt:w(function(t,n,e){for(var s=e<0?e+n:e;++s<n;)t.push(s);return t})}}).pseudos.nth=e.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})e.pseudos[x]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(x);for(x in{submit:!0,reset:!0})e.pseudos[x]=function(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}(x);function Q(){}function A(t){for(var e=0,s=t.length,n="";e<s;e++)n+=t[e].value;return n}function N(t,n,c){var e=n.dir,s=n.next,o=s||e,a=c&&"parentNode"===o,r=e6++;return n.first?function(n,s,o){for(;n=n[e];)if(1===n.nodeType||a)return t(n,s,o);return!1}:function(n,u,l){var d,c,m=[h,r];if(l){for(;n=n[e];)if((1===n.nodeType||a)&&t(n,u,l))return!0}else for(;n=n[e];)if(1===n.nodeType||a)if(d=(c=n[i]||(n[i]={}))[n.uniqueID]||(c[n.uniqueID]={}),s&&s===n.nodeName.toLowerCase())n=n[e]||n;else{if((c=d[o])&&c[0]===h&&c[1]===r)return m[2]=c[2];if((d[o]=m)[2]=t(n,u,l))return!0}return!1}}function I(e){return 1<e.length?function(n,s,o){for(var t=e.length;t--;)if(!e[t](n,s,o))return!1;return!0}:e[0]}function T(n,i,s,a,r){for(var t,o=[],e=0,c=n.length,l=null!=i;e<c;e++)(t=n[e])&&(s&&!s(t,a,r)||(o.push(t),l&&i.push(e)));return o}function q(n,a,o,t,e,r){return t&&!t[i]&&(t=q(t)),e&&!e[i]&&(e=q(e,r)),d(function(h,u,d,m){var c,r,l,v=[],g=[],b=u.length,j=h||function(o,t,n){for(var e=0,i=t.length;e<i;e++)s(o,t[e],n);return n}(a||"*",d.nodeType?[d]:d,[]),f=!n||!h&&a?j:T(j,v,n,d,m),i=o?e||(h?n:b||t)?[]:u:f;if(o&&o(f,i,d,m),t)for(c=T(i,g),t(c,[],d,m),r=c.length;r--;)(l=c[r])&&(i[g[r]]=!(f[g[r]]=l));if(h){if(e||n){if(e){for(c=[],r=i.length;r--;)(l=i[r])&&c.push(f[r]=l);e(null,i=[],c,m)}for(r=i.length;r--;)(l=i[r])&&-1<(c=e?y(h,l):v[r])&&(h[c]=!(u[c]=l))}}else i=T(i===u?i.splice(b,i.length):i),e?e(null,u,i,m):p.apply(u,i)})}function ec(i,t){function a(b,f,w,y,u){var l,j,m,v=0,a="0",_=b&&[],d=[],O=F,x=b||r&&e.find.TAG("*",u),C=h+=null==O?1:Math.random()||.1,E=x.length;for(u&&(F=f==n||f||u);a!==E&&null!=(l=x[a]);a++){if(r&&l){for(j=0,f||l.ownerDocument==n||(g(l),w=!c);m=i[j++];)if(m(l,f||n,w)){y.push(l);break}u&&(h=C)}o&&((l=!m&&l)&&v--,b&&_.push(l))}if(v+=a,o&&a!==v){for(j=0;m=t[j++];)m(_,d,f,w);if(b){if(0<v)for(;a--;)_[a]||d[a]||(d[a]=e8.call(y));d=T(d)}p.apply(y,d),u&&!b&&0<d.length&&1<v+t.length&&s.uniqueSort(y)}return u&&(h=C,F=O),_}var o=0<t.length,r=0<i.length;return o?d(a):a}return Q.prototype=e.filters=e.pseudos,e.setFilters=new Q,k=s.tokenize=function(a,d){var o,n,c,i,t,r,l,u=ee[a+" "];if(u)return d?0:u.slice(0);for(t=a,r=[],l=e.preFilter;t;){for(i in o&&!(n=e3.exec(t))||(n&&(t=t.slice(n[0].length)||t),r.push(c=[])),o=!1,(n=X.exec(t))&&(o=n.shift(),c.push({value:o,type:n[0].replace(z," ")}),t=t.slice(o.length)),e.filter)!(n=L[i].exec(t))||l[i]&&!(n=l[i](n))||(o=n.shift(),c.push({value:o,type:i,matches:n}),t=t.slice(o.length));if(!o)break}return d?t.length:t?s.error(a):ee(a,r).slice(0)},W=s.compile=function(n,s){var o,a=[],r=[],t=ea[n+" "];if(!t){for(o=(s=s||k(n)).length;o--;)((t=function d(t){for(var r,o,s,c=t.length,l=e.relative[t[0].type],u=l||e.relative[" "],n=l?1:0,h=N(function(e){return e===r},u,!0),m=N(function(e){return-1<y(r,e)},u,!0),a=[function(n,t,e){return e=!l&&(e||t!==F)||((r=t).nodeType?h:m)(n,t,e),r=null,e}];n<c;n++)if(o=e.relative[t[n].type])a=[N(I(a),o)];else{if((o=e.filter[t[n].type].apply(null,t[n].matches))[i]){for(s=++n;s<c&&!e.relative[t[s].type];s++);return q(1<n&&I(a),1<n&&A(t.slice(0,n-1).concat({value:" "===t[n-2].type?"*":""})).replace(z,"$1"),o,n<s&&d(t.slice(n,s)),s<c&&d(t=t.slice(s)),s<c&&A(t))}a.push(o)}return I(a)}(s[o]))[i]?a:r).push(t);(t=ea(n,ec(r,a))).selector=n}return t},Z=s.select=function(n,t,o,i){var r,s,a,u,h,d="function"==typeof n&&n,l=!i&&k(n=d.selector||n);if(o=o||[],1===l.length){if(2<(s=l[0]=l[0].slice(0)).length&&"ID"===(a=s[0]).type&&9===t.nodeType&&c&&e.relative[s[1].type]){if(!(t=(e.find.ID(a.matches[0].replace(f,m),t)||[])[0]))return o;d&&(t=t.parentNode),n=n.slice(s.shift().value.length)}for(r=L.needsContext.test(n)?0:s.length;r--&&(a=s[r],!e.relative[u=a.type]);)if((h=e.find[u])&&(i=h(a.matches[0].replace(f,m),V.test(s[0].type)&&P(t.parentNode)||t))){if(s.splice(r,1),!(n=i.length&&A(s)))return p.apply(o,i),o;break}}return(d||W(n,l))(i,t,!c,o,!t||V.test(n)&&P(t.parentNode)||t),o},o.sortStable=i.split("").sort(B).join("")===i,o.detectDuplicates=!!O,g(),o.sortDetached=l(function(e){return 1&e.compareDocumentPosition(n.createElement("fieldset"))}),l(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||U("type|href|height|width",function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),o.attributes&&l(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||U("value",function(e,n,t){if(!t&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),l(function(e){return null==e.getAttribute("disabled")})||U(H,function(t,e,n){if(!n)return!0===t[e]?e.toLowerCase():(e=t.getAttributeNode(e))&&e.specified?e.value:null}),s}(o),t.find=p,t.expr=p.selectors,t.expr[":"]=t.expr.pseudos,t.uniqueSort=t.unique=p.uniqueSort,t.text=p.getText,t.isXMLDoc=p.isXML,t.contains=p.contains,t.escapeSelector=p.escape;function z(e,o,n){for(var s=[],i=void 0!==n;(e=e[o])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&t(e).is(n))break;s.push(e)}return s}function eV(e,n){for(var t=[];e;e=e.nextSibling)1===e.nodeType&&e!==n&&t.push(e);return t}eL=t.expr.match.needsContext;function u(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}eN=/^<([a-z][^/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function e8(n,e,o){return s(e)?t.grep(n,function(t,n){return!!e.call(t,n,t)!==o}):e.nodeType?t.grep(n,function(t){return t===e!==o}):"string"!=typeof e?t.grep(n,function(t){return-1<et.call(e,t)!==o}):t.filter(e,n,o)}t.filter=function(e,n,o){var s=n[0];return o&&(e=":not("+e+")"),1===n.length&&1===s.nodeType?t.find.matchesSelector(s,e)?[s]:[]:t.find.matches(e,t.grep(n,function(e){return 1===e.nodeType}))},t.fn.extend({find:function(s){var e,n,o=this.length,i=this;if("string"!=typeof s)return this.pushStack(t(s).filter(function(){for(e=0;e<o;e++)if(t.contains(i[e],this))return!0}));for(n=this.pushStack([]),e=0;e<o;e++)t.find(s,i[e],n);return 1<o?t.uniqueSort(n):n},filter:function(e){return this.pushStack(e8(this,e||[],!1))},not:function(e){return this.pushStack(e8(this,e||[],!0))},is:function(e){return!!e8(this,"string"==typeof e&&eL.test(e)?t(e):e||[],!1).length}}),tk=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,(t.fn.init=function(e,n,a){if(!e)return this;if(a=a||tC,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):s(e)?void 0!==a.ready?a.ready(e):e(t):t.makeArray(e,this);if(!(o="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:tk.exec(e))||!o[1]&&n)return(!n||n.jquery?n||a:this.constructor(n)).find(e);if(o[1]){if(n=n instanceof t?n[0]:n,t.merge(this,t.parseHTML(o[1],n&&n.nodeType?n.ownerDocument||n:i,!0)),eN.test(o[1])&&t.isPlainObject(n))for(var o in n)s(this[o])?this[o](n[o]):this.attr(o,n[o]);return this}return(e=i.getElementById(o[2]))&&(this[0]=e,this.length=1),this}).prototype=t.fn;var tC=t(i),tx=/^(?:parents|prev(?:Until|All))/,tO={children:!0,contents:!0,next:!0,prev:!0};function eF(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}t.fn.extend({has:function(n){var e=t(n,this),s=e.length;return this.filter(function(){for(var n=0;n<s;n++)if(t.contains(this,e[n]))return!0})},closest:function(n,a){var e,o=0,r=this.length,s=[],i="string"!=typeof n&&t(n);if(!eL.test(n))for(;o<r;o++)for(e=this[o];e&&e!==a;e=e.parentNode)if(e.nodeType<11&&(i?-1<i.index(e):1===e.nodeType&&t.find.matchesSelector(e,n))){s.push(e);break}return this.pushStack(1<s.length?t.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?et.call(t(e),this[0]):et.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,n){return this.pushStack(t.uniqueSort(t.merge(this.get(),t(e,n))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),t.each({parent:function(e){return(e=e.parentNode)&&11!==e.nodeType?e:null},parents:function(e){return z(e,"parentNode")},parentsUntil:function(e,n,t){return z(e,"parentNode",t)},next:function(e){return eF(e,"nextSibling")},prev:function(e){return eF(e,"previousSibling")},nextAll:function(e){return z(e,"nextSibling")},prevAll:function(e){return z(e,"previousSibling")},nextUntil:function(e,n,t){return z(e,"nextSibling",t)},prevUntil:function(e,n,t){return z(e,"previousSibling",t)},siblings:function(e){return eV((e.parentNode||{}).firstChild,e)},children:function(e){return eV(e.firstChild)},contents:function(e){return null!=e.contentDocument&&eZ(e.contentDocument)?e.contentDocument:(u(e,"template")&&(e=e.content||e),t.merge([],e.childNodes))}},function(e,n){t.fn[e]=function(i,o){var s=t.map(this,n,i);return(o="Until"!==e.slice(-5)?i:o)&&"string"==typeof o&&(s=t.filter(o,s)),1<this.length&&(tO[e]||t.uniqueSort(s),tx.test(e)&&s.reverse()),this.pushStack(s)}}),g=/[^\x20\t\r\n\f]+/g;function F(e){return e}function K(e){throw e}function eS(e,n,o,i){var t;try{e&&s(t=e.promise)?t.call(e).done(n).fail(o):e&&s(t=e.then)?t.call(e,n,o):n.apply(void 0,[e].slice(i))}catch(e){o.apply(void 0,[e])}}t.Callbacks=function(o){o="string"==typeof o?(h=o,l={},t.each(h.match(g)||[],function(t,e){l[e]=!0}),l):t.extend({},o);function m(){for(i=i||o.once,u=c=!0;r.length;a=-1)for(n=r.shift();++a<e.length;)!1===e[a].apply(n[0],n[1])&&o.stopOnFalse&&(a=e.length,n=!1);o.memory||(n=!1),c=!1,i&&(e=n?[]:"")}var h,l,c,n,u,i,e=[],r=[],a=-1,d={add:function(){return e&&(n&&!c&&(a=e.length-1,r.push(n)),function n(i){t.each(i,function(i,t){s(t)?o.unique&&d.has(t)||e.push(t):t&&t.length&&"string"!==E(t)&&n(t)})}(arguments),n&&!c&&m()),this},remove:function(){return t.each(arguments,function(o,s){for(var n;-1<(n=t.inArray(s,e,n));)e.splice(n,1),n<=a&&a--}),this},has:function(n){return n?-1<t.inArray(n,e):0<e.length},empty:function(){return e=e&&[],this},disable:function(){return i=r=[],e=n="",this},disabled:function(){return!e},lock:function(){return i=r=[],n||c||(e=n=""),this},locked:function(){return!!i},fireWith:function(t,e){return i||(e=[t,(e=e||[]).slice?e.slice():e],r.push(e),c||m()),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!u}};return d},t.extend({Deferred:function(a){var n=[["notify","progress",t.Callbacks("memory"),t.Callbacks("memory"),2],["resolve","done",t.Callbacks("once memory"),t.Callbacks("once memory"),0,"resolved"],["reject","fail",t.Callbacks("once memory"),t.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return e.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var o=arguments;return t.Deferred(function(i){t.each(n,function(a,t){var n=s(o[t[4]])&&o[t[4]];e[t[1]](function(){var e=n&&n.apply(this,arguments);e&&s(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[t[0]+"With"](this,n?[e]:arguments)})}),o=null}).promise()},then:function(a,r,c){var e=0;function i(r,n,c,a){return function(){function h(){var t,o;if(!(r<e)){if((t=c.apply(l,d))===n.promise())throw new TypeError("Thenable self-resolution");o=t&&("object"===_typeof(t)||"function"==typeof t)&&t.then,s(o)?a?o.call(t,i(e,n,F,a),i(e,n,K,a)):(e++,o.call(t,i(e,n,F,a),i(e,n,K,a),i(e,n,F,n.notifyWith))):(c!==F&&(l=void 0,d=[t]),(a||n.resolveWith)(l,d))}}var l=this,d=arguments,u=a?h:function(){try{h()}catch(s){t.Deferred.exceptionHook&&t.Deferred.exceptionHook(s,u.stackTrace),e<=r+1&&(c!==K&&(l=void 0,d=[s]),n.rejectWith(l,d))}};r?u():(t.Deferred.getStackHook&&(u.stackTrace=t.Deferred.getStackHook()),o.setTimeout(u))}}return t.Deferred(function(e){n[0][3].add(i(0,e,s(c)?c:F,e.notifyWith)),n[1][3].add(i(0,e,s(a)?a:F)),n[2][3].add(i(0,e,s(r)?r:K))}).promise()},promise:function(e){return null!=e?t.extend(e,i):i}},e={};return t.each(n,function(o,t){var s=t[2],a=t[5];i[t[1]]=s.add,a&&s.add(function(){r=a},n[3-o][2].disable,n[3-o][3].disable,n[0][2].lock,n[0][3].lock),s.add(t[3].fire),e[t[0]]=function(){return e[t[0]+"With"](this===e?void 0:this,arguments),this},e[t[0]+"With"]=s.fireWith}),i.promise(e),a&&a.call(e,e),e},when:function(c){function a(t){return function(n){r[t]=this,o[t]=1<arguments.length?_.call(arguments):n,--i||e.resolveWith(r,o)}}var i=arguments.length,n=i,r=Array(n),o=_.call(arguments),e=t.Deferred();if(i<=1&&(eS(c,e.done(a(n)).resolve,e.reject,!i),"pending"===e.state()||s(o[n]&&o[n].then)))return e.then();for(;n--;)eS(o[n],a(n),e.reject);return e.promise()}}),tw=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/,t.Deferred.exceptionHook=function(e,t){o.console&&o.console.warn&&e&&tw.test(e.name)&&o.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},t.readyException=function(e){o.setTimeout(function(){throw e})},e0=t.Deferred();function q(){i.removeEventListener("DOMContentLoaded",q),o.removeEventListener("load",q),t.ready()}t.fn.ready=function(e){return e0.then(e).catch(function(e){t.readyException(e)}),this},t.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--t.readyWait:t.isReady)||(t.isReady=!0)!==e&&0<--t.readyWait||e0.resolveWith(i,[t])}}),t.ready.then=e0.then,"complete"===i.readyState||"loading"!==i.readyState&&!i.documentElement.doScroll?o.setTimeout(t.ready):(i.addEventListener("DOMContentLoaded",q),o.addEventListener("load",q));function j(e,n,i,a,l,d,r){var o=0,u=e.length,c=null==i;if("object"===E(i))for(o in l=!0,i)j(e,n,o,i[o],!0,d,r);else if(void 0!==a&&(l=!0,s(a)||(r=!0),n=c?r?(n.call(e,a),null):(c=n,function(e,s,n){return c.call(t(e),n)}):n))for(;o<u;o++)n(e[o],i,r?a:a.call(e[o],o,n(e[o],i)));return l?e:c?n.call(e):u?n(e[0],i):d}t_=/^-ms-/,ty=/-([a-z])/g;function tj(t,e){return e.toUpperCase()}function v(e){return e.replace(t_,"ms-").replace(ty,tj)}function B(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function I(){this.expando=t.expando+I.uid++}I.uid=1,I.prototype={cache:function(e){var t=e[this.expando];return t||(t={},B(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(s,e,o){var t,n=this.cache(s);if("string"==typeof e)n[v(e)]=o;else for(t in e)n[v(t)]=e[t];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][v(t)]},access:function(n,e,t){return void 0===e||e&&"string"==typeof e&&void 0===t?this.get(n,e):(this.set(n,e,t),void 0!==t?t:e)},remove:function(n,e){var o,s=n[this.expando];if(void 0!==s){if(void 0!==e)for(o=(e=Array.isArray(e)?e.map(v):(e=v(e))in s?[e]:e.match(g)||[]).length;o--;)delete s[e[o]];void 0!==e&&!t.isEmptyObject(s)||(n.nodeType?n[this.expando]=void 0:delete n[this.expando])}},hasData:function(e){return e=e[this.expando],void 0!==e&&!t.isEmptyObject(e)}};var n=new I,l=new I,tg=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,tf=/[A-Z]/g;function eb(n,s,t){var o,e;if(void 0===t&&1===n.nodeType)if(o="data-"+s.replace(tf,"-$&").toLowerCase(),"string"==typeof(t=n.getAttribute(o))){try{t="true"===(e=t)||"false"!==e&&("null"===e?null:e===+e+""?+e:tg.test(e)?JSON.parse(e):e)}catch(e){}l.set(n,s,t)}else t=void 0;return t}t.extend({hasData:function(e){return l.hasData(e)||n.hasData(e)},data:function(e,t,n){return l.access(e,t,n)},removeData:function(e,t){l.remove(e,t)},_data:function(e,t,s){return n.access(e,t,s)},_removeData:function(e,t){n.remove(e,t)}}),t.fn.extend({data:function(t,r){var o,s,i,e=this[0],a=e&&e.attributes;if(void 0!==t)return"object"===_typeof(t)?this.each(function(){l.set(this,t)}):j(this,function(s){var n;return e&&void 0===s?void 0!==(n=l.get(e,t))||void 0!==(n=eb(e,t))?n:void 0:void this.each(function(){l.set(this,t,s)})},null,r,1<arguments.length,null,!0);if(this.length&&(i=l.get(e),1===e.nodeType&&!n.get(e,"hasDataAttrs"))){for(o=a.length;o--;)a[o]&&0===(s=a[o].name).indexOf("data-")&&(s=v(s.slice(5)),eb(e,s,i[s]));n.set(e,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){l.remove(this,e)})}}),t.extend({queue:function(o,i,s){var e;if(o)return e=n.get(o,i=(i||"fx")+"queue"),s&&(!e||Array.isArray(s)?e=n.access(o,i,t.makeArray(s)):e.push(s)),e||[]},dequeue:function(n,e){e=e||"fx";var s=t.queue(n,e),a=s.length,o=s.shift(),i=t._queueHooks(n,e);"inprogress"===o&&(o=s.shift(),a--),o&&("fx"===e&&s.unshift("inprogress"),delete i.stop,o.call(n,function(){t.dequeue(n,e)},i)),!a&&i&&i.empty.fire()},_queueHooks:function(e,o){var s=o+"queueHooks";return n.get(e,s)||n.access(e,s,{empty:t.Callbacks("once memory").add(function(){n.remove(e,[o+"queue",s])})})}}),t.fn.extend({queue:function(e,n){var s=2;return"string"!=typeof e&&(n=e,e="fx",s--),arguments.length<s?t.queue(this[0],e):void 0===n?this:this.each(function(){var s=t.queue(this,e,n);t._queueHooks(this,e),"fx"===e&&"inprogress"!==s[0]&&t.dequeue(this,e)})},dequeue:function(e){return this.each(function(){t.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){function a(){--r||c.resolveWith(o,[o])}var s,r=1,c=t.Deferred(),o=this,l=this.length;for("string"!=typeof e&&(i=e,e=void 0),e=e||"fx";l--;)(s=n.get(o[l],e+"queueHooks"))&&s.empty&&(r++,s.empty.add(a));return a(),c.promise(i)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),y=["Top","Right","Bottom","Left"],O=i.documentElement,k=function(e){return t.contains(e.ownerDocument,e)},tm={composed:!0};O.getRootNode&&(k=function(e){return t.contains(e.ownerDocument,e)||e.getRootNode(tm)===e.ownerDocument});function W(e,n){return"none"===(e=n||e).style.display||""===e.style.display&&k(e)&&"none"===t.css(e,"display")}function tt(a,o,n,i){var l,c,d=20,u=i?function(){return i.cur()}:function(){return t.css(a,o,"")},r=u(),s=n&&n[3]||(t.cssNumber[o]?"":"px"),e=a.nodeType&&(t.cssNumber[o]||"px"!==s&&+r)&&V.exec(t.css(a,o));if(e&&e[3]!==s){for(s=s||e[3],e=+(r/=2)||1;d--;)t.style(a,o,e+s),(1-c)*(1-(c=u()/r||.5))<=0&&(d=0),e/=c;t.style(a,o,(e*=2)+s),n=n||[]}return n&&(e=+e||+r||0,l=n[1]?e+(n[1]+1)*n[2]:+n[2],i&&(i.unit=s,i.start=e,i.end=l)),l}e9={};function C(c,u){for(var l,s,i,o,r,a=[],e=0,d=c.length;e<d;e++)(s=c[e]).style&&(l=s.style.display,u?("none"===l&&(a[e]=n.get(s,"display")||null,a[e]||(s.style.display="")),""===s.style.display&&W(s)&&(a[e]=(r=o=void 0,o=(i=s).ownerDocument,r=i.nodeName,(i=e9[r])||(o=o.body.appendChild(o.createElement(r)),i=t.css(o,"display"),o.parentNode.removeChild(o),e9[r]=i="none"===i?"block":i)))):"none"!==l&&(a[e]="none",n.set(s,"display",l)));for(e=0;e<d;e++)null!=a[e]&&(c[e].style.display=a[e]);return c}t.fn.extend({show:function(){return C(this,!0)},hide:function(){return C(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){W(this)?t(this).show():t(this).hide()})}});var L=/^(?:checkbox|radio)$/i,ev=/<([a-z][^/\0>\x20\t\r\n\f]*)/i,eg=/^$|^module$|\/(?:java|ecma)script/i;r=i.createDocumentFragment().appendChild(i.createElement("div")),(p=i.createElement("input")).setAttribute("type","radio"),p.setAttribute("checked","checked"),p.setAttribute("name","t"),r.appendChild(p),a.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,r.innerHTML="<textarea>x</textarea>",a.noCloneChecked=!!r.cloneNode(!0).lastChild.defaultValue,r.innerHTML="<option></option>",a.option=!!r.lastChild,d={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function c(e,n){var s=void 0!==e.getElementsByTagName?e.getElementsByTagName(n||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(n||"*"):[];return void 0===n||n&&u(e,n)?t.merge([e],s):s}function e2(t,s){for(var e=0,o=t.length;e<o;e++)n.set(t[e],"globalEval",!s||n.get(s[e],"globalEval"))}d.tbody=d.tfoot=d.colgroup=d.caption=d.thead,d.th=d.td,a.option||(d.optgroup=d.option=[1,"<select multiple='multiple'>","</select>"]),th=/<|&#?\w+;/;function e6(u,l,p,f,m){for(var e,n,s,h,r,i=l.createDocumentFragment(),a=[],o=0,g=u.length;o<g;o++)if((e=u[o])||0===e)if("object"===E(e))t.merge(a,e.nodeType?[e]:e);else if(th.test(e)){for(n=n||i.appendChild(l.createElement("div")),s=(ev.exec(e)||["",""])[1].toLowerCase(),s=d[s]||d._default,n.innerHTML=s[1]+t.htmlPrefilter(e)+s[2],r=s[0];r--;)n=n.lastChild;t.merge(a,n.childNodes),(n=i.firstChild).textContent=""}else a.push(l.createTextNode(e));for(i.textContent="",o=0;e=a[o++];)if(f&&-1<t.inArray(e,f))m&&m.push(e);else if(h=k(e),n=c(i.appendChild(e),"script"),h&&e2(n),p)for(r=0;e=n[r++];)eg.test(e.type||"")&&p.push(e);return i}ef=/^([^.]*)(?:\.(.+)|)/;function T(){return!0}function A(){return!1}function t3(e,t){return e===function(){try{return i.activeElement}catch(e){}}()==("focus"===t)}function e3(o,i,n,s,e,c){var a,r;if("object"===_typeof(i)){for(r in"string"!=typeof n&&(s=s||n,n=void 0),i)e3(o,r,n,s,i[r],c);return o}if(null==s&&null==e?(e=n,s=n=void 0):null==e&&("string"==typeof n?(e=s,s=void 0):(e=s,s=n,n=void 0)),!1===e)e=A;else if(!e)return o;return 1===c&&(a=e,(e=function(e){return t().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=t.guid++)),o.each(function(){t.event.add(this,i,e,s,n)})}function G(s,e,o){o?(n.set(s,e,!1),t.event.add(s,e,{namespace:!1,handler:function(i){var r,a,s=n.get(this,e);if(1&i.isTrigger&&this[e]){if(s.length)(t.event.special[e]||{}).delegateType&&i.stopPropagation();else if(s=_.call(arguments),n.set(this,e,s),r=o(this,e),this[e](),s!==(a=n.get(this,e))||r?n.set(this,e,!1):a={},s!==a)return i.stopImmediatePropagation(),i.preventDefault(),a&&a.value}else s.length&&(n.set(this,e,{value:t.event.trigger(t.extend(s[0],t.Event.prototype),s.slice(1),this)}),i.stopImmediatePropagation())}})):void 0===n.get(s,e)&&t.event.add(s,e,T)}t.event={global:{},add:function(c,p,o,v,i){var m,l,d,h,s,a,e,f,r,u=n.get(c);if(B(c))for(o.handler&&(o=(m=o).handler,i=m.selector),i&&t.find.matchesSelector(O,i),o.guid||(o.guid=t.guid++),(d=u.events)||(d=u.events=Object.create(null)),(l=u.handle)||(l=u.handle=function(e){return void 0!==t&&t.event.triggered!==e.type?t.event.dispatch.apply(c,arguments):void 0}),h=(p=(p||"").match(g)||[""]).length;h--;)e=r=(s=ef.exec(p[h])||[])[1],f=(s[2]||"").split(".").sort(),e&&(a=t.event.special[e]||{},e=(i?a.delegateType:a.bindType)||e,a=t.event.special[e]||{},s=t.extend({type:e,origType:r,data:v,handler:o,guid:o.guid,selector:i,needsContext:i&&t.expr.match.needsContext.test(i),namespace:f.join(".")},m),(r=d[e])||((r=d[e]=[]).delegateCount=0,a.setup&&!1!==a.setup.call(c,v,f,l)||c.addEventListener&&c.addEventListener(e,l)),a.add&&(a.add.call(c,s),s.handler.guid||(s.handler.guid=o.guid)),i?r.splice(r.delegateCount++,0,s):r.push(s),t.event.global[e]=!0)},remove:function(o,h,p,c,j){var u,v,r,l,d,s,i,a,e,f,b,m=n.hasData(o)&&n.get(o);if(m&&(l=m.events)){for(d=(h=(h||"").match(g)||[""]).length;d--;)if(e=b=(r=ef.exec(h[d])||[])[1],f=(r[2]||"").split(".").sort(),e){for(i=t.event.special[e]||{},a=l[e=(c?i.delegateType:i.bindType)||e]||[],r=r[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),v=u=a.length;u--;)s=a[u],!j&&b!==s.origType||p&&p.guid!==s.guid||r&&!r.test(s.namespace)||c&&c!==s.selector&&("**"!==c||!s.selector)||(a.splice(u,1),s.selector&&a.delegateCount--,i.remove&&i.remove.call(o,s));v&&!a.length&&(i.teardown&&!1!==i.teardown.call(o,f,m.handle)||t.removeEvent(o,e,m.handle),delete l[e])}else for(e in l)t.event.remove(o,e+h[d],p,c,!0);t.isEmptyObject(l)&&n.remove(o,"handle events")}},dispatch:function(i){var o,c,a,s,l,r=new Array(arguments.length),e=t.event.fix(i),d=(n.get(this,"events")||Object.create(null))[e.type]||[],i=t.event.special[e.type]||{};for(r[0]=e,o=1;o<arguments.length;o++)r[o]=arguments[o];if(e.delegateTarget=this,!i.preDispatch||!1!==i.preDispatch.call(this,e)){for(l=t.event.handlers.call(this,e,d),o=0;(a=l[o++])&&!e.isPropagationStopped();)for(e.currentTarget=a.elem,c=0;(s=a.handlers[c++])&&!e.isImmediatePropagationStopped();)e.rnamespace&&!1!==s.namespace&&!e.rnamespace.test(s.namespace)||(e.handleObj=s,e.data=s.data,void 0!==(s=((t.event.special[s.origType]||{}).handle||s.handler).apply(a.elem,r))&&!1===(e.result=s)&&(e.preventDefault(),e.stopPropagation()));return i.postDispatch&&i.postDispatch.call(this,e),e.result}},handlers:function(s,o){var i,d,n,a,r,l=[],c=o.delegateCount,e=s.target;if(c&&e.nodeType&&!("click"===s.type&&1<=s.button))for(;e!==this;e=e.parentNode||this)if(1===e.nodeType&&("click"!==s.type||!0!==e.disabled)){for(a=[],r={},i=0;i<c;i++)void 0===r[n=(d=o[i]).selector+" "]&&(r[n]=d.needsContext?-1<t(n,this).index(e):t.find(n,this,null,[e]).length),r[n]&&a.push(d);a.length&&l.push({elem:e,handlers:a})}return e=this,c<o.length&&l.push({elem:e,handlers:o.slice(c)}),l},addProp:function(e,n){Object.defineProperty(t.Event.prototype,e,{enumerable:!0,configurable:!0,get:s(n)?function(){if(this.originalEvent)return n(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[t.expando]?e:new t.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){return e=this||e,L.test(e.type)&&e.click&&u(e,"input")&&G(e,"click",T),!1},trigger:function(e){return e=this||e,L.test(e.type)&&e.click&&u(e,"input")&&G(e,"click"),!0},_default:function(e){return e=e.target,L.test(e.type)&&e.click&&u(e,"input")&&n.get(e,"click")||u(e,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},t.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},t.Event=function(e,n){if(!(this instanceof t.Event))return new t.Event(e,n);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?T:A,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,n&&t.extend(this,n),this.timeStamp=e&&e.timeStamp||Date.now(),this[t.expando]=!0},t.Event.prototype={constructor:t.Event,isDefaultPrevented:A,isPropagationStopped:A,isImmediatePropagationStopped:A,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=T,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=T,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=T,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},t.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},t.event.addProp),t.each({focus:"focusin",blur:"focusout"},function(e,n){t.event.special[e]={setup:function(){return G(this,e,t3),!1},trigger:function(){return G(this,e),!0},_default:function(){return!0},delegateType:n}}),t.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(n,e){t.event.special[n]={delegateType:e,bindType:e,handle:function(n){var o,s=n.relatedTarget,i=n.handleObj;return s&&(s===this||t.contains(this,s))||(n.type=i.origType,o=i.handler.apply(this,arguments),n.type=e),o}}}),t.fn.extend({on:function(e,t,n,s){return e3(this,e,t,n,s)},one:function(e,t,n,s){return e3(this,e,t,n,s,1)},off:function(e,s,o){var n,i;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,t(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"!==_typeof(e))return!1!==s&&"function"!=typeof s||(o=s,s=void 0),!1===o&&(o=A),this.each(function(){t.event.remove(this,e,o,s)});for(i in e)this.off(i,s,e[i]);return this}});var t2=/<script|<style|<link/i,t0=/checked\s*(?:[^=]|=\s*.checked.)/i,t1=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function eR(e,n){return u(e,"table")&&u(11!==n.nodeType?n:n.firstChild,"tr")&&t(e).children("tbody")[0]||e}function tu(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function td(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function ey(e,s){var o,r,i,a;if(1===s.nodeType){if(n.hasData(e)&&(a=n.get(e).events))for(i in n.remove(s,"handle events"),a)for(o=0,r=a[i].length;o<r;o++)t.event.add(s,i,a[i][o]);l.hasData(e)&&(e=l.access(e),e=t.extend({},e),l.set(s,e))}}function D(i,l,v,g){l=eQ(l);var d,p,r,f,e,h,o=0,u=i.length,j=u-1,m=l[0],b=s(m);if(b||1<u&&"string"==typeof m&&!a.checkClone&&t0.test(m))return i.each(function(e){var t=i.eq(e);b&&(l[0]=m.call(this,e,t.html())),D(t,l,v,g)});if(u&&(p=(d=e6(l,i[0].ownerDocument,!1,i,g)).firstChild,1===d.childNodes.length&&(d=p),p||g)){for(f=(r=t.map(c(d,"script"),tu)).length;o<u;o++)e=d,o!==j&&(e=t.clone(e,!0,!0),f&&t.merge(r,c(e,"script"))),v.call(i[o],e,o);if(f)for(h=r[r.length-1].ownerDocument,t.map(r,td),o=0;o<f;o++)e=r[o],eg.test(e.type||"")&&!n.access(e,"globalEval")&&t.contains(h,e)&&(e.src&&"module"!==(e.type||"").toLowerCase()?t._evalUrl&&!e.noModule&&t._evalUrl(e.src,{nonce:e.nonce||e.getAttribute("nonce")},h):eU(e.textContent.replace(t1,""),e,h))}return i}function ew(n,s,o){for(var e,a=s?t.filter(s,n):n,i=0;null!=(e=a[i]);i++)o||1!==e.nodeType||t.cleanData(c(e)),e.parentNode&&(o&&k(e)&&e2(c(e,"script")),e.parentNode.removeChild(e));return n}t.extend({htmlPrefilter:function(e){return e},clone:function(n,h,m){var e,u,o,s,r,l,d,i=n.cloneNode(!0),f=k(n);if(!(a.noCloneChecked||1!==n.nodeType&&11!==n.nodeType||t.isXMLDoc(n)))for(s=c(i),e=0,u=(o=c(n)).length;e<u;e++)r=o[e],l=s[e],d=void 0,"input"===(d=l.nodeName.toLowerCase())&&L.test(r.type)?l.checked=r.checked:"input"!==d&&"textarea"!==d||(l.defaultValue=r.defaultValue);if(h)if(m)for(o=o||c(n),s=s||c(i),e=0,u=o.length;e<u;e++)ey(o[e],s[e]);else ey(n,i);return 0<(s=c(i,"script")).length&&e2(s,!f&&c(n,"script")),i},cleanData:function(a){for(var s,e,o,r=t.event.special,i=0;void 0!==(e=a[i]);i++)if(B(e)){if(s=e[n.expando]){if(s.events)for(o in s.events)r[o]?t.event.remove(e,o):t.removeEvent(e,o,s.handle);e[n.expando]=void 0}e[l.expando]&&(e[l.expando]=void 0)}}}),t.fn.extend({detach:function(e){return ew(this,e,!0)},remove:function(e){return ew(this,e)},text:function(e){return j(this,function(e){return void 0===e?t.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return D(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||eR(this,e).appendChild(e)})},prepend:function(){return D(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=eR(this,e)).insertBefore(e,t.firstChild)})},before:function(){return D(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return D(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,n=0;null!=(e=this[n]);n++)1===e.nodeType&&(t.cleanData(c(e,!1)),e.textContent="");return this},clone:function(e,n){return e=null!=e&&e,n=n??e,this.map(function(){return t.clone(this,e,n)})},html:function(e){return j(this,function(e){var n=this[0]||{},s=0,o=this.length;if(void 0===e&&1===n.nodeType)return n.innerHTML;if("string"==typeof e&&!t2.test(e)&&!d[(ev.exec(e)||["",""])[1].toLowerCase()]){e=t.htmlPrefilter(e);try{for(;s<o;s++)1===(n=this[s]||{}).nodeType&&(t.cleanData(c(n,!1)),n.innerHTML=e);n=0}catch(e){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return D(this,arguments,function(s){var n=this.parentNode;t.inArray(this,e)<0&&(t.cleanData(c(this)),n&&n.replaceChild(s,this))},e)}}),t.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,n){t.fn[e]=function(r){for(var s,o=[],i=t(r),a=i.length-1,e=0;e<=a;e++)s=e===a?this:this.clone(!0),t(i[e])[n](s),e4.apply(o,s.get());return this.pushStack(o)}});function U(t){var e=t.ownerDocument.defaultView;return(e=!e||!e.opener?o:e).getComputedStyle(t)}function ex(t,n,s){var e,o={};for(e in n)o[e]=t.style[e],t.style[e]=n[e];for(e in s=s.call(t),n)t.style[e]=o[e];return s}el=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),tr=new RegExp(y.join("|"),"i");function $(){var e;h&&(Z.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",h.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",O.appendChild(Z).appendChild(h),e=o.getComputedStyle(h),eC="1%"!==e.top,eM=12===en(e.marginLeft),h.style.right="60%",eA=36===en(e.right),eE=36===en(e.width),h.style.position="absolute",ek=12===en(h.offsetWidth/3),O.removeChild(Z),h=null)}function en(e){return Math.round(parseFloat(e))}function N(s,o,i){var r,n,e=s.style;return(i=i||U(s))&&(""!==(n=i.getPropertyValue(o)||i[o])||k(s)||(n=t.style(s,o)),!a.pixelBoxStyles()&&el.test(n)&&tr.test(o)&&(r=e.width,s=e.minWidth,o=e.maxWidth,e.minWidth=e.maxWidth=e.width=n,n=i.width,e.width=r,e.minWidth=s,e.maxWidth=o)),void 0!==n?n+"":n}function eP(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}Z=i.createElement("div"),(h=i.createElement("div")).style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",a.clearCloneStyle="content-box"===h.style.backgroundClip,t.extend(a,{boxSizingReliable:function(){return $(),eE},pixelBoxStyles:function(){return $(),eA},pixelPosition:function(){return $(),eC},reliableMarginLeft:function(){return $(),eM},scrollboxSize:function(){return $(),ek},reliableTrDimensions:function(){var n,t,e;return null==ed&&(n=i.createElement("table"),t=i.createElement("tr"),e=i.createElement("div"),n.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",e.style.height="9px",e.style.display="block",O.appendChild(n).appendChild(t).appendChild(e),e=o.getComputedStyle(t),ed=parseInt(e.height,10)+parseInt(e.borderTopWidth,10)+parseInt(e.borderBottomWidth,10)===t.offsetHeight,O.removeChild(n)),ed}}));var eH=["Webkit","Moz","ms"],eI=i.createElement("div").style,eB={};function eo(e){var n=t.cssProps[e]||eB[e];return n||(e in eI?e:eB[e]=function(e){for(var n=e[0].toUpperCase()+e.slice(1),t=eH.length;t--;)if((e=eH[t]+n)in eI)return e}(e)||e)}var ta=/^(none|table(?!-c[ea]).+)/,eW=/^--/,ti={position:"absolute",visibility:"hidden",display:"block"},eK={letterSpacing:"0",fontWeight:"400"};function eq(s,t,n){var e=V.exec(t);return e?Math.max(0,e[2]-(n||0))+(e[3]||"px"):t}function ec(s,a,i,r,o,c){var e="width"===a?1:0,l=0,n=0;if(i===(r?"border":"content"))return 0;for(;e<4;e+=2)"margin"===i&&(n+=t.css(s,i+y[e],!0,o)),r?("content"===i&&(n-=t.css(s,"padding"+y[e],!0,o)),"margin"!==i&&(n-=t.css(s,"border"+y[e]+"Width",!0,o))):(n+=t.css(s,"padding"+y[e],!0,o),"padding"!==i?n+=t.css(s,"border"+y[e]+"Width",!0,o):l+=t.css(s,"border"+y[e]+"Width",!0,o));return!r&&0<=c&&(n+=Math.max(0,Math.ceil(s["offset"+a[0].toUpperCase()+a.slice(1)]-c-n-l-.5))||0),n}function eG(e,o,r){var s=U(e),i=(!a.boxSizingReliable()||r)&&"border-box"===t.css(e,"boxSizing",!1,s),c=i,n=N(e,o,s),l="offset"+o[0].toUpperCase()+o.slice(1);if(el.test(n)){if(!r)return n;n="auto"}return(!a.boxSizingReliable()&&i||!a.reliableTrDimensions()&&u(e,"tr")||"auto"===n||!parseFloat(n)&&"inline"===t.css(e,"display",!1,s))&&e.getClientRects().length&&(i="border-box"===t.css(e,"boxSizing",!1,s),(c=l in e)&&(n=e[l])),(n=parseFloat(n)||0)+ec(e,o,r||(i?"border":"content"),c,s,n)+"px"}function f(e,t,n,s,o){return new f.prototype.init(e,t,n,s,o)}t.extend({cssHooks:{opacity:{get:function(e,t){if(t)return e=N(e,"opacity"),""===e?"1":e}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(s,n,e,u){if(s&&3!==s.nodeType&&8!==s.nodeType&&s.style){var o,c,i,l=v(n),d=eW.test(n),r=s.style;if(d||(n=eo(l)),i=t.cssHooks[n]||t.cssHooks[l],void 0===e)return i&&"get"in i&&void 0!==(o=i.get(s,!1,u))?o:r[n];"string"===(c=_typeof(e))&&(o=V.exec(e))&&o[1]&&(e=tt(s,n,o),c="number"),null!=e&&e==e&&("number"!==c||d||(e+=o&&o[3]||(t.cssNumber[l]?"":"px")),a.clearCloneStyle||""!==e||0!==n.indexOf("background")||(r[n]="inherit"),i&&"set"in i&&void 0===(e=i.set(s,e,u))||(d?r.setProperty(n,e):r[n]=e))}},css:function(i,e,o,a){var n,s=v(e);return eW.test(e)||(e=eo(s)),"normal"===(n=void 0===(n=(s=t.cssHooks[e]||t.cssHooks[s])&&"get"in s?s.get(i,!0,o):n)?N(i,e,a):n)&&e in eK&&(n=eK[e]),""===o||o?(e=parseFloat(n),!0===o||isFinite(e)?e||0:n):n}}),t.each(["height","width"],function(n,e){t.cssHooks[e]={get:function(n,o,s){if(o)return!ta.test(t.css(n,"display"))||n.getClientRects().length&&n.getBoundingClientRect().width?eG(n,e,s):ex(n,ti,function(){return eG(n,e,s)})},set:function(n,i,s){var r,o=U(n),c=!a.scrollboxSize()&&"absolute"===o.position,l=(c||s)&&"border-box"===t.css(n,"boxSizing",!1,o),s=s?ec(n,e,s,l,o):0;return l&&c&&(s-=Math.ceil(n["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(o[e])-ec(n,e,"border",!1,o)-.5)),s&&(r=V.exec(i))&&"px"!==(r[3]||"px")&&(n.style[e]=i,i=t.css(n,e)),eq(0,i,s)}}}),t.cssHooks.marginLeft=eP(a.reliableMarginLeft,function(e,t){if(t)return(parseFloat(N(e,"marginLeft"))||e.getBoundingClientRect().left-ex(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),t.each({margin:"",padding:"",border:"Width"},function(e,n){t.cssHooks[e+n]={expand:function(s){for(var t=0,i={},o="string"==typeof s?s.split(" "):[s];t<4;t++)i[e+y[t]+n]=o[t]||o[t-2]||o[0];return i}},"margin"!==e&&(t.cssHooks[e+n].set=eq)}),t.fn.extend({css:function(e,n){return j(this,function(n,e,o){var i,a,r={},s=0;if(Array.isArray(e)){for(i=U(n),a=e.length;s<a;s++)r[e[s]]=t.css(n,e[s],!1,i);return r}return void 0!==o?t.style(n,e,o):t.css(n,e)},e,n,1<arguments.length)}}),((t.Tween=f).prototype={constructor:f,init:function(n,s,e,o,i,a){this.elem=n,this.prop=e,this.easing=i||t.easing._default,this.options=s,this.start=this.now=this.cur(),this.end=o,this.unit=a||(t.cssNumber[e]?"":"px")},cur:function(){var e=f.propHooks[this.prop];return(e&&e.get?e:f.propHooks._default).get(this)},run:function(e){var n,s=f.propHooks[this.prop];return this.options.duration?this.pos=n=t.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=n=e,this.now=(this.end-this.start)*n+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(s&&s.set?s:f.propHooks._default).set(this),this}}).init.prototype=f.prototype,(f.propHooks={_default:{get:function(e){return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(e=t.css(e.elem,e.prop,""))&&"auto"!==e?e:0},set:function(e){t.fx.step[e.prop]?t.fx.step[e.prop](e):1!==e.elem.nodeType||!t.cssHooks[e.prop]&&null==e.elem.style[eo(e.prop)]?e.elem[e.prop]=e.now:t.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=f.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},t.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},t.fx=f.prototype.init,t.fx.step={},to=/^(?:toggle|show|hide)$/,tn=/queueHooks$/;function er(){Y&&(!1===i.hidden&&o.requestAnimationFrame?o.requestAnimationFrame(er):o.setTimeout(er,t.fx.interval),t.fx.tick())}function te(){return o.setTimeout(function(){M=void 0}),M=Date.now()}function Q(n,t){var o,s=0,e={height:n};for(t=t?1:0;s<4;s+=2-t)e["margin"+(o=y[s])]=e["padding"+o]=n;return t&&(e.opacity=e.width=n),e}function eJ(o,t,i){for(var n,s=(m.tweeners[t]||[]).concat(m.tweeners["*"]),e=0,a=s.length;e<a;e++)if(n=s[e].call(i,t,o))return n}function m(n,d,a){var i,r,c=0,h=m.prefilters.length,o=t.Deferred().always(function(){delete u.elem}),u=function(){if(r)return!1;for(var t=M||te(),t=Math.max(0,e.startTime+e.duration-t),s=1-(t/e.duration||0),i=0,a=e.tweens.length;i<a;i++)e.tweens[i].run(s);return o.notifyWith(n,[e,s,t]),s<1&&a?t:(a||o.notifyWith(n,[e,1,0]),o.resolveWith(n,[e]),!1)},e=o.promise({elem:n,props:t.extend({},d),opts:t.extend(!0,{specialEasing:{},easing:t.easing._default},a),originalProperties:d,originalOptions:a,startTime:M||te(),duration:a.duration,tweens:[],createTween:function(s,o){return s=t.Tween(n,e.opts,s,o,e.opts.specialEasing[s]||e.opts.easing),e.tweens.push(s),s},stop:function(t){var s=0,i=t?e.tweens.length:0;if(r)return this;for(r=!0;s<i;s++)e.tweens[s].run(1);return t?(o.notifyWith(n,[e,1,0]),o.resolveWith(n,[e,t])):o.rejectWith(n,[e,t]),this}}),l=e.props;for(!function(s,a){var e,o,i,n,r;for(e in s)if(i=a[o=v(e)],n=s[e],Array.isArray(n)&&(i=n[1],n=s[e]=n[0]),e!==o&&(s[o]=n,delete s[e]),(r=t.cssHooks[o])&&"expand"in r)for(e in n=r.expand(n),delete s[o],n)e in s||(s[e]=n[e],a[e]=i);else a[o]=i}(l,e.opts.specialEasing);c<h;c++)if(i=m.prefilters[c].call(e,n,l,e.opts))return s(i.stop)&&(t._queueHooks(e.elem,e.opts.queue).stop=i.stop.bind(i)),i;return t.map(l,eJ,e),s(e.opts.start)&&e.opts.start.call(n,e),e.progress(e.opts.progress).done(e.opts.done,e.opts.complete).fail(e.opts.fail).always(e.opts.always),t.fx.timer(t.extend(u,{elem:n,anim:e,queue:e.opts.queue})),e}t.Animation=t.extend(m,{tweeners:{"*":[function(t,n){var e=this.createTween(t,n);return tt(e.elem,t,V.exec(n),e),e}]},tweener:function(e,o){for(var t,n=0,i=(e=s(e)?(o=e,["*"]):e.match(g)).length;n<i;n++)t=e[n],m.tweeners[t]=m.tweeners[t]||[],m.tweeners[t].unshift(o)},prefilters:[function(e,h,m){var s,f,g,d,v,c,i,r="width"in h||"height"in h,u=this,p={},a=e.style,l=e.nodeType&&W(e),o=n.get(e,"fxshow");for(s in m.queue||(null==(d=t._queueHooks(e,"fx")).unqueued&&(d.unqueued=0,v=d.empty.fire,d.empty.fire=function(){d.unqueued||v()}),d.unqueued++,u.always(function(){u.always(function(){d.unqueued--,t.queue(e,"fx").length||d.empty.fire()})})),h)if(f=h[s],to.test(f)){if(delete h[s],g=g||"toggle"===f,f===(l?"hide":"show")){if("show"!==f||!o||void 0===o[s])continue;l=!0}p[s]=o&&o[s]||t.style(e,s)}if((c=!t.isEmptyObject(h))||!t.isEmptyObject(p))for(s in r&&1===e.nodeType&&(m.overflow=[a.overflow,a.overflowX,a.overflowY],null==(i=o&&o.display)&&(i=n.get(e,"display")),"none"===(r=t.css(e,"display"))&&(i?r=i:(C([e],!0),i=e.style.display||i,r=t.css(e,"display"),C([e]))),("inline"===r||"inline-block"===r&&null!=i)&&"none"===t.css(e,"float")&&(c||(u.done(function(){a.display=i}),null==i&&(r=a.display,i="none"===r?"":r)),a.display="inline-block")),m.overflow&&(a.overflow="hidden",u.always(function(){a.overflow=m.overflow[0],a.overflowX=m.overflow[1],a.overflowY=m.overflow[2]})),c=!1,p)c||(o?"hidden"in o&&(l=o.hidden):o=n.access(e,"fxshow",{display:i}),g&&(o.hidden=!l),l&&C([e],!0),u.done(function(){for(s in l||C([e]),n.remove(e,"fxshow"),p)t.style(e,s,p[s])})),c=eJ(l?o[s]:0,s,u),s in o||(o[s]=c.start,l&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?m.prefilters.unshift(e):m.prefilters.push(e)}}),t.speed=function(n,o,i){var e=n&&"object"===_typeof(n)?t.extend({},n):{complete:i||!i&&o||s(n)&&n,duration:n,easing:i&&o||o&&!s(o)&&o};return t.fx.off?e.duration=0:"number"!=typeof e.duration&&(e.duration in t.fx.speeds?e.duration=t.fx.speeds[e.duration]:e.duration=t.fx.speeds._default),null!=e.queue&&!0!==e.queue||(e.queue="fx"),e.old=e.complete,e.complete=function(){s(e.old)&&e.old.call(this),e.queue&&t.dequeue(this,e.queue)},e},t.fn.extend({fadeTo:function(e,t,n,s){return this.filter(W).css("opacity",0).show().end().animate({opacity:t},e,n,s)},animate:function(i,a,r,c){function e(){var e=m(this,t.extend({},i),s);(o||n.get(this,"finish"))&&e.stop(!0)}var o=t.isEmptyObject(i),s=t.speed(a,r,c);return e.finish=e,o||!1===s.queue?this.each(e):this.queue(s.queue,e)},stop:function(e,o,s){function i(e){var t=e.stop;delete e.stop,t(s)}return"string"!=typeof e&&(s=o,o=e,e=void 0),o&&this.queue(e||"fx",[]),this.each(function(){var c=!0,o=null!=e&&e+"queueHooks",r=t.timers,a=n.get(this);if(o)a[o]&&a[o].stop&&i(a[o]);else for(o in a)a[o]&&a[o].stop&&tn.test(o)&&i(a[o]);for(o=r.length;o--;)r[o].elem!==this||null!=e&&r[o].queue!==e||(r[o].anim.stop(s),c=!1,r.splice(o,1));!c&&s||t.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var s,a=n.get(this),o=a[e+"queue"],r=a[e+"queueHooks"],i=t.timers,c=o?o.length:0;for(a.finish=!0,t.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),s=i.length;s--;)i[s].elem===this&&i[s].queue===e&&(i[s].anim.stop(!0),i.splice(s,1));for(s=0;s<c;s++)o[s]&&o[s].finish&&o[s].finish.call(this);delete a.finish})}}),t.each(["toggle","show","hide"],function(s,e){var n=t.fn[e];t.fn[e]=function(t,s,o){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(Q(e,!0),t,s,o)}}),t.each({slideDown:Q("show"),slideUp:Q("hide"),slideToggle:Q("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,n){t.fn[e]=function(e,t,s){return this.animate(n,e,t,s)}}),t.timers=[],t.fx.tick=function(){var s,e=0,n=t.timers;for(M=Date.now();e<n.length;e++)(s=n[e])()||n[e]!==s||n.splice(e--,1);n.length||t.fx.stop(),M=void 0},t.fx.timer=function(e){t.timers.push(e),t.fx.start()},t.fx.interval=13,t.fx.start=function(){Y||(Y=!0,er())},t.fx.stop=function(){Y=null},t.fx.speeds={slow:600,fast:200,_default:400},t.fn.delay=function(e,n){return e=t.fx&&t.fx.speeds[e]||e,this.queue(n=n||"fx",function(t,n){var s=o.setTimeout(t,e);n.stop=function(){o.clearTimeout(s)}})},r=i.createElement("input"),ee=i.createElement("select").appendChild(i.createElement("option")),r.type="checkbox",a.checkOn=""!==r.value,a.optSelected=ee.selected,(r=i.createElement("input")).value="t",r.type="radio",a.radioValue="t"===r.value,P=t.expr.attrHandle,t.fn.extend({attr:function(e,n){return j(this,t.attr,e,n,1<arguments.length)},removeAttr:function(e){return this.each(function(){t.removeAttr(this,e)})}}),t.extend({attr:function(e,n,o){var i,s,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===e.getAttribute?t.prop(e,n,o):(1===a&&t.isXMLDoc(e)||(s=t.attrHooks[n.toLowerCase()]||(t.expr.match.bool.test(n)?e$:void 0)),void 0!==o?null===o?void t.removeAttr(e,n):s&&"set"in s&&void 0!==(i=s.set(e,o,n))?i:(e.setAttribute(n,o+""),o):!(s&&"get"in s&&null!==(i=s.get(e,n)))&&null==(i=t.find.attr(e,n))?void 0:i)},attrHooks:{type:{set:function(e,t){if(!a.radioValue&&"radio"===t&&u(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,o=0,s=t&&t.match(g);if(s&&1===e.nodeType)for(;n=s[o++];)e.removeAttribute(n)}}),e$={set:function(n,s,e){return!1===s?t.removeAttr(n,e):n.setAttribute(e,e),e}},t.each(t.expr.match.bool.source.match(/\w+/g),function(s,e){var n=P[e]||t.find.attr;P[e]=function(a,s,o){var t,i,e=s.toLowerCase();return o||(i=P[e],P[e]=t,t=null!=n(a,s,o)?e:null,P[e]=i),t}}),tc=/^(?:input|select|textarea|button)$/i,tl=/^(?:a|area)$/i;function w(e){return(e.match(g)||[]).join(" ")}function x(e){return e.getAttribute&&e.getAttribute("class")||""}function eu(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(g)||[]}t.fn.extend({prop:function(e,n){return j(this,t.prop,e,n,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[t.propFix[e]||e]})}}),t.extend({prop:function(s,e,a){var o,n,i=s.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&t.isXMLDoc(s)||(e=t.propFix[e]||e,n=t.propHooks[e]),void 0!==a?n&&"set"in n&&void 0!==(o=n.set(s,a,e))?o:s[e]=a:n&&"get"in n&&null!==(o=n.get(s,e))?o:s[e]},propHooks:{tabIndex:{get:function(e){var n=t.find.attr(e,"tabindex");return n?parseInt(n,10):tc.test(e.nodeName)||tl.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),a.optSelected||(t.propHooks.selected={get:function(e){return e=e.parentNode,e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(e){e=e.parentNode,e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),t.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){t.propFix[this.toLowerCase()]=this}),t.fn.extend({addClass:function(a){var r,n,o,i,c,e,l=0;if(s(a))return this.each(function(e){t(this).addClass(a.call(this,e,x(this)))});if((r=eu(a)).length)for(;n=this[l++];)if(e=x(n),o=1===n.nodeType&&" "+w(e)+" "){for(c=0;i=r[c++];)o.indexOf(" "+i+" ")<0&&(o+=i+" ");e!==(e=w(o))&&n.setAttribute("class",e)}return this},removeClass:function(a){var r,o,n,i,c,e,l=0;if(s(a))return this.each(function(e){t(this).removeClass(a.call(this,e,x(this)))});if(!arguments.length)return this.attr("class","");if((r=eu(a)).length)for(;o=this[l++];)if(e=x(o),n=1===o.nodeType&&" "+w(e)+" "){for(c=0;i=r[c++];)for(;-1<n.indexOf(" "+i+" ");)n=n.replace(" "+i+" "," ");e!==(e=w(n))&&o.setAttribute("class",e)}return this},toggleClass:function(e,o){var i=_typeof(e),a="string"===i||Array.isArray(e);return"boolean"==typeof o&&a?o?this.addClass(e):this.removeClass(e):s(e)?this.each(function(n){t(this).toggleClass(e.call(this,n,x(this),o),o)}):this.each(function(){var s,r,o,c;if(a)for(r=0,o=t(this),c=eu(e);s=c[r++];)o.hasClass(s)?o.removeClass(s):o.addClass(s);else void 0!==e&&"boolean"!==i||((s=x(this))&&n.set(this,"__className__",s),this.setAttribute&&this.setAttribute("class",!s&&!1!==e&&n.get(this,"__className__")||""))})},hasClass:function(t){for(var e,n=0,s=" "+t+" ";e=this[n++];)if(1===e.nodeType&&-1<(" "+w(x(e))+" ").indexOf(s))return!0;return!1}}),t4=/\r/g,t.fn.extend({val:function(i){var e,n,a,o=this[0];return arguments.length?(a=s(i),this.each(function(n){1===this.nodeType&&(null==(n=a?i.call(this,n,t(this).val()):i)?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=t.map(n,function(e){return null==e?"":e+""})),(e=t.valHooks[this.type]||t.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))})):o?(e=t.valHooks[o.type]||t.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(n=e.get(o,"value"))?n:"string"==typeof(n=o.value)?n.replace(t4,""):n??"":void 0}}),t.extend({valHooks:{option:{get:function(e){var n=t.find.attr(e,"value");return n??w(t.text(e))}},select:{get:function(i){for(var e,a=i.options,n=i.selectedIndex,s="select-one"===i.type,r=s?null:[],c=s?n+1:a.length,o=n<0?c:s?n:0;o<c;o++)if(((e=a[o]).selected||o===n)&&!e.disabled&&(!e.parentNode.disabled||!u(e.parentNode,"optgroup"))){if(e=t(e).val(),s)return e;r.push(e)}return r},set:function(e,r){for(var n,s,o=e.options,i=t.makeArray(r),a=o.length;a--;)((s=o[a]).selected=-1<t.inArray(t.valHooks.option.get(s),i))&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),t.each(["radio","checkbox"],function(){t.valHooks[this]={set:function(e,n){if(Array.isArray(n))return e.checked=-1<t.inArray(t(e).val(),n)}},a.checkOn||(t.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),a.focusin="onfocusin"in o;function e7(e){e.stopPropagation()}e5=/^(?:focusinfocus|focusoutblur)$/,t.extend(t.event,{trigger:function(e,u,r,p){var b,l,j,h,m,d,f,g=[r||i],a=J.call(e,"type")?e.type:e,v=J.call(e,"namespace")?e.namespace.split("."):[],c=f=l=r=r||i;if(3!==r.nodeType&&8!==r.nodeType&&!e5.test(a+t.event.triggered)&&(-1<a.indexOf(".")&&(a=(v=a.split(".")).shift(),v.sort()),h=a.indexOf(":")<0&&"on"+a,(e=e[t.expando]?e:new t.Event(a,"object"===_typeof(e)&&e)).isTrigger=p?2:3,e.namespace=v.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),u=null==u?[e]:t.makeArray(u,[e]),d=t.event.special[a]||{},p||!d.trigger||!1!==d.trigger.apply(r,u))){if(!p&&!d.noBubble&&!S(r)){for(j=d.delegateType||a,e5.test(j+a)||(c=c.parentNode);c;c=c.parentNode)g.push(c),l=c;l===(r.ownerDocument||i)&&g.push(l.defaultView||l.parentWindow||o)}for(b=0;(c=g[b++])&&!e.isPropagationStopped();)f=c,e.type=1<b?j:d.bindType||a,(m=(n.get(c,"events")||Object.create(null))[e.type]&&n.get(c,"handle"))&&m.apply(c,u),(m=h&&c[h])&&m.apply&&B(c)&&(e.result=m.apply(c,u),!1===e.result&&e.preventDefault());return e.type=a,p||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(g.pop(),u)||!B(r)||h&&s(r[a])&&!S(r)&&((l=r[h])&&(r[h]=null),t.event.triggered=a,e.isPropagationStopped()&&f.addEventListener(a,e7),r[a](),e.isPropagationStopped()&&f.removeEventListener(a,e7),t.event.triggered=void 0,l&&(r[h]=l)),e.result}},simulate:function(e,n,s){e=t.extend(new t.Event,s,{type:e,isSimulated:!0}),t.event.trigger(e,null,n)}}),t.fn.extend({trigger:function(e,n){return this.each(function(){t.event.trigger(e,n,this)})},triggerHandler:function(n,s){var e=this[0];if(e)return t.event.trigger(n,s,e,!0)}}),a.focusin||t.each({focus:"focusin",blur:"focusout"},function(s,e){function o(n){t.event.simulate(e,n.target,t.event.fix(n))}t.event.special[e]={setup:function(){var t=this.ownerDocument||this.document||this,i=n.access(t,e);i||t.addEventListener(s,o,!0),n.access(t,e,(i||0)+1)},teardown:function(){var t=this.ownerDocument||this.document||this,i=n.access(t,e)-1;i?n.access(t,e,i):(t.removeEventListener(s,o,!0),n.remove(t,e))}}});var H=o.location,ep={guid:Date.now()},ei=/\?/;t.parseXML=function(n){var e,s;if(!n||"string"!=typeof n)return null;try{e=(new o.DOMParser).parseFromString(n,"text/xml")}catch(e){}return s=e&&e.getElementsByTagName("parsererror")[0],e&&!s||t.error("Invalid XML: "+(s?t.map(s.childNodes,function(e){return e.textContent}).join("\n"):n)),e};var t8=/\[\]$/,ej=/\r?\n/g,t6=/^(?:submit|button|image|reset|file)$/i,tp=/^(?:input|select|textarea|keygen)/i;t.param=function(e,a){function i(t,e){e=s(e)?e():e,o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(e??"")}var n,o=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!t.isPlainObject(e))t.each(e,function(){i(this.name,this.value)});else for(n in e)!function i(n,e,s,o){if(Array.isArray(e))t.each(e,function(t,e){s||t8.test(n)?o(n,e):i(n+"["+("object"===_typeof(e)&&null!=e?t:"")+"]",e,s,o)});else if(s||"object"!==E(e))o(n,e);else for(var a in e)i(n+"["+a+"]",e[a],s,o)}(n,e[n],a,i);return o.join("&")},t.fn.extend({serialize:function(){return t.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=t.prop(this,"elements");return e?t.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!t(this).is(":disabled")&&tp.test(this.nodeName)&&!t6.test(e)&&(this.checked||!L.test(e))}).map(function(s,n){var e=t(this).val();return null==e?null:Array.isArray(e)?t.map(e,function(e){return{name:n.name,value:e.replace(ej,"\r\n")}}):{name:n.name,value:e.replace(ej,"\r\n")}}).get()}});var tz=/%20/g,t5=/#.*$/,t7=/([?&])_=[^&]*/,tv=/^(.*?):[ \t]*([^\r\n]*)$/gm,t9=/^(?:GET|HEAD)$/,tb=/^\/\//,e_={},em={},eO="*/".concat("*"),e1=i.createElement("a");function eT(e){return function(n,o){"string"!=typeof n&&(o=n,n="*");var t,i=0,a=n.toLowerCase().match(g)||[];if(s(o))for(;t=a[i++];)"+"===t[0]?(t=t.slice(1)||"*",(e[t]=e[t]||[]).unshift(o)):(e[t]=e[t]||[]).push(o)}}function ez(i,n,a,r){var s={},o=i===em;function e(c){var l;return s[c]=!0,t.each(i[c]||[],function(i,t){return t=t(n,a,r),"string"!=typeof t||o||s[t]?o?!(l=t):void 0:(n.dataTypes.unshift(t),e(t),!1)}),l}return e(n.dataTypes[0])||!s["*"]&&e("*")}function ea(s,o){var e,n,i=t.ajaxSettings.flatOptions||{};for(e in o)void 0!==o[e]&&((i[e]?s:n=n||{})[e]=o[e]);return n&&t.extend(!0,s,n),s}return e1.href=H.href,t.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:H.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(H.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":eO,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":t.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,n){return n?ea(ea(e,t.ajaxSettings),n):ea(t.ajaxSettings,e)},ajaxPrefilter:eT(e_),ajaxTransport:eT(em),ajax:function(f,c){"object"===_typeof(f)&&(c=f,f=void 0);var d,s,_,u,y,a,m,v,r,e=t.ajaxSetup({},c=c||{}),l=e.context||e,b=e.context&&(l.nodeType||l.jquery)?t(l):t.event,j=t.Deferred(),C=t.Callbacks("once memory"),h=e.statusCode||{},w={},O={},x="canceled",n={readyState:0,getResponseHeader:function(t){var e;if(a){if(!u)for(u={};e=tv.exec(_);)u[e[1].toLowerCase()+" "]=(u[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=u[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return a?_:null},setRequestHeader:function(e,t){return null==a&&(e=O[e.toLowerCase()]=O[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(t){return null==a&&(e.mimeType=t),this},statusCode:function(e){if(e)if(a)n.always(e[n.status]);else for(var t in e)h[t]=[h[t],e[t]];return this},abort:function(e){return e=e||x,d&&d.abort(e),p(0,e),this}};if(j.promise(n),e.url=((f||e.url||H.href)+"").replace(tb,H.protocol+"//"),e.type=c.method||c.type||e.method||e.type,e.dataTypes=(e.dataType||"*").toLowerCase().match(g)||[""],null==e.crossDomain){r=i.createElement("a");try{r.href=e.url,r.href=r.href,e.crossDomain=e1.protocol+"//"+e1.host!=r.protocol+"//"+r.host}catch(t){e.crossDomain=!0}}if(e.data&&e.processData&&"string"!=typeof e.data&&(e.data=t.param(e.data,e.traditional)),ez(e_,e,c,n),a)return n;for(v in(m=t.event&&e.global)&&0==t.active++&&t.event.trigger("ajaxStart"),e.type=e.type.toUpperCase(),e.hasContent=!t9.test(e.type),s=e.url.replace(t5,""),e.hasContent?e.data&&e.processData&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&(e.data=e.data.replace(tz,"+")):(r=e.url.slice(s.length),e.data&&(e.processData||"string"==typeof e.data)&&(s+=(ei.test(s)?"&":"?")+e.data,delete e.data),!1===e.cache&&(s=s.replace(t7,"$1"),r=(ei.test(s)?"&":"?")+"_="+ep.guid+++r),e.url=s+r),e.ifModified&&(t.lastModified[s]&&n.setRequestHeader("If-Modified-Since",t.lastModified[s]),t.etag[s]&&n.setRequestHeader("If-None-Match",t.etag[s])),(e.data&&e.hasContent&&!1!==e.contentType||c.contentType)&&n.setRequestHeader("Content-Type",e.contentType),n.setRequestHeader("Accept",e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+("*"!==e.dataTypes[0]?", "+eO+"; q=0.01":""):e.accepts["*"]),e.headers)n.setRequestHeader(v,e.headers[v]);if(e.beforeSend&&(!1===e.beforeSend.call(l,n,e)||a))return n.abort();if(x="abort",C.add(e.complete),n.done(e.success),n.fail(e.error),d=ez(em,e,c,n)){if(n.readyState=1,m&&b.trigger("ajaxSend",[n,e]),a)return n;e.async&&0<e.timeout&&(y=o.setTimeout(function(){n.abort("timeout")},e.timeout));try{a=!1,d.send(w,p)}catch(e){if(a)throw e;p(-1,e)}}else p(-1,"No Transport");function p(i,v,u,c){var g,p,f,r=v;a||(a=!0,y&&o.clearTimeout(y),d=void 0,_=c||"",n.readyState=0<i?4:0,c=200<=i&&i<300||304===i,u&&(f=function(s,c,r){for(var o,t,n,a,i=s.contents,e=s.dataTypes;"*"===e[0];)e.shift(),void 0===o&&(o=s.mimeType||c.getResponseHeader("Content-Type"));if(o)for(t in i)if(i[t]&&i[t].test(o)){e.unshift(t);break}if(e[0]in r)n=e[0];else{for(t in r){if(!e[0]||s.converters[t+" "+e[0]]){n=t;break}a=a||t}n=n||a}if(n)return n!==e[0]&&e.unshift(n),r[n]}(e,n,u)),!c&&-1<t.inArray("script",e.dataTypes)&&t.inArray("json",e.dataTypes)<0&&(e.converters["text script"]=function(){}),f=function(n,s,l,d){var r,e,t,a,o,i={},c=n.dataTypes.slice();if(c[1])for(t in n.converters)i[t.toLowerCase()]=n.converters[t];for(e=c.shift();e;)if(n.responseFields[e]&&(l[n.responseFields[e]]=s),!o&&d&&n.dataFilter&&(s=n.dataFilter(s,n.dataType)),o=e,e=c.shift())if("*"===e)e=o;else if("*"!==o&&o!==e){if(!(t=i[o+" "+e]||i["* "+e]))for(r in i)if((a=r.split(" "))[1]===e&&(t=i[o+" "+a[0]]||i["* "+a[0]])){!0===t?t=i[r]:!0!==i[r]&&(e=a[0],c.unshift(a[1]));break}if(!0!==t)if(t&&n.throws)s=t(s);else try{s=t(s)}catch(n){return{state:"parsererror",error:t?n:"No conversion from "+o+" to "+e}}}return{state:"success",data:s}}(e,f,n,c),c?(e.ifModified&&((u=n.getResponseHeader("Last-Modified"))&&(t.lastModified[s]=u),(u=n.getResponseHeader("etag"))&&(t.etag[s]=u)),204===i||"HEAD"===e.type?r="nocontent":304===i?r="notmodified":(r=f.state,g=f.data,c=!(p=f.error))):(p=r,!i&&r||(r="error",i<0&&(i=0))),n.status=i,n.statusText=(v||r)+"",c?j.resolveWith(l,[g,r,n]):j.rejectWith(l,[n,r,p]),n.statusCode(h),h=void 0,m&&b.trigger(c?"ajaxSuccess":"ajaxError",[n,e,c?g:p]),C.fireWith(l,[n,r]),m&&(b.trigger("ajaxComplete",[n,e]),--t.active||t.event.trigger("ajaxStop")))}return n},getJSON:function(e,n,s){return t.get(e,n,s,"json")},getScript:function(e,n){return t.get(e,void 0,n,"script")}}),t.each(["get","post"],function(n,e){t[e]=function(o,n,i,a){return s(n)&&(a=a||i,i=n,n=void 0),t.ajax(t.extend({url:o,type:e,dataType:a,data:n,success:i},t.isPlainObject(o)&&o))}}),t.ajaxPrefilter(function(e){for(var t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),t._evalUrl=function(e,n,s){return t.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){t.globalEval(e,n,s)}})},t.fn.extend({wrapAll:function(e){return this[0]&&(s(e)&&(e=e.call(this[0])),e=t(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return s(e)?this.each(function(n){t(this).wrapInner(e.call(this,n))}):this.each(function(){var n=t(this),s=n.contents();s.length?s.wrapAll(e):n.append(e)})},wrap:function(e){var n=s(e);return this.each(function(s){t(this).wrapAll(n?e.call(this,s):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){t(this).replaceWith(this.childNodes)}),this}}),t.expr.pseudos.hidden=function(e){return!t.expr.pseudos.visible(e)},t.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},t.ajaxSettings.xhr=function(){try{return new o.XMLHttpRequest}catch(e){}},tE={0:200,1223:204},R=t.ajaxSettings.xhr(),a.cors=!!R&&"withCredentials"in R,a.ajax=R=!!R,t.ajaxTransport(function(e){var t,n;if(a.cors||R&&!e.crossDomain)return{send:function(a,r){var i,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];for(i in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||a["X-Requested-With"]||(a["X-Requested-With"]="XMLHttpRequest"),a)s.setRequestHeader(i,a[i]);t=function(e){return function(){t&&(t=n=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?r(0,"error"):r(s.status,s.statusText):r(tE[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),n=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=n:s.onreadystatechange=function(){4===s.readyState&&o.setTimeout(function(){t&&n()})},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}}),t.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),t.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return t.globalEval(e),e}}}),t.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),t.ajaxTransport("script",function(e){var s,n;if(e.crossDomain||e.scriptAttrs)return{send:function(a,o){s=t("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){s.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),i.head.appendChild(s[0])},abort:function(){n&&n()}}}),eD=[],eh=/(=)\?(?=&|$)|\?\?/,t.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=eD.pop()||t.expando+"_"+ep.guid++;return this[e]=!0,e}}),t.ajaxPrefilter("json jsonp",function(e,c,l){var n,i,a,r=!1!==e.jsonp&&(eh.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&eh.test(e.data)&&"data");if(r||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=s(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,r?e[r]=e[r].replace(eh,"$1"+n):!1!==e.jsonp&&(e.url+=(ei.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return a||t.error(n+" was not called"),a[0]},e.dataTypes[0]="json",i=o[n],o[n]=function(){a=arguments},l.always(function(){void 0===i?t(o).removeProp(n):o[n]=i,e[n]&&(e.jsonpCallback=c.jsonpCallback,eD.push(n)),a&&s(i)&&i(a[0]),a=i=void 0}),"script"}),a.createHTMLDocument=((r=i.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===r.childNodes.length),t.parseHTML=function(o,e,s){return"string"!=typeof o?[]:("boolean"==typeof e&&(s=e,e=!1),e||(a.createHTMLDocument?((n=(e=i.implementation.createHTMLDocument("")).createElement("base")).href=i.location.href,e.head.appendChild(n)):e=i),n=!s&&[],(s=eN.exec(o))?[e.createElement(s[1])]:(s=e6([o],e,n),n&&n.length&&t(n).remove(),t.merge([],s.childNodes)));var n},t.fn.load=function(n,e,o){var i,c,l,a=this,r=n.indexOf(" ");return-1<r&&(i=w(n.slice(r)),n=n.slice(0,r)),s(e)?(o=e,e=void 0):e&&"object"===_typeof(e)&&(c="POST"),0<a.length&&t.ajax({url:n,type:c||"GET",dataType:"html",data:e}).done(function(e){l=arguments,a.html(i?t("<div>").append(t.parseHTML(e)).find(i):e)}).always(o&&function(e,t){a.each(function(){o.apply(this,l||[e.responseText,t,e])})}),this},t.expr.pseudos.animated=function(e){return t.grep(t.timers,function(t){return e===t.elem}).length},t.offset={setOffset:function(n,e,u){var d,l,r,o,i=t.css(n,"position"),c=t(n),a={};"static"===i&&(n.style.position="relative"),r=c.offset(),d=t.css(n,"top"),o=t.css(n,"left"),o=("absolute"===i||"fixed"===i)&&-1<(d+o).indexOf("auto")?(l=(i=c.position()).top,i.left):(l=parseFloat(d)||0,parseFloat(o)||0),null!=(e=s(e)?e.call(n,u,t.extend({},r)):e).top&&(a.top=e.top-r.top+l),null!=e.left&&(a.left=e.left-r.left+o),"using"in e?e.using.call(n,a):c.css(a)}},t.fn.extend({offset:function(s){if(arguments.length)return void 0===s?this:this.each(function(e){t.offset.setOffset(this,s,e)});var n,e=this[0];return e?e.getClientRects().length?(n=e.getBoundingClientRect(),e=e.ownerDocument.defaultView,{top:n.top+e.pageYOffset,left:n.left+e.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,s,o,n=this[0],i={top:0,left:0};if("fixed"===t.css(n,"position"))s=n.getBoundingClientRect();else{for(s=this.offset(),o=n.ownerDocument,e=n.offsetParent||o.documentElement;e&&(e===o.body||e===o.documentElement)&&"static"===t.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((i=t(e).offset()).top+=t.css(e,"borderTopWidth",!0),i.left+=t.css(e,"borderLeftWidth",!0))}return{top:s.top-i.top-t.css(n,"marginTop",!0),left:s.left-i.left-t.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===t.css(e,"position");)e=e.offsetParent;return e||O})}}),t.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var s="pageYOffset"===n;t.fn[e]=function(t){return j(this,function(t,i,o){var e;return S(t)?e=t:9===t.nodeType&&(e=t.defaultView),void 0===o?e?e[n]:t[i]:void(e?e.scrollTo(s?e.pageXOffset:o,s?o:e.pageYOffset):t[i]=o)},e,t,arguments.length)}}),t.each(["top","left"],function(n,e){t.cssHooks[e]=eP(a.pixelPosition,function(s,n){if(n)return n=N(s,e),el.test(n)?t(s).position()[e]+"px":n})}),t.each({Height:"height",Width:"width"},function(e,n){t.each({padding:"inner"+e,content:n,"":"outer"+e},function(s,o){t.fn[o]=function(i,c){var a=arguments.length&&(s||"boolean"!=typeof i),r=s||(!0===i||!0===c?"margin":"border");return j(this,function(n,i,a){var s;return S(n)?0===o.indexOf("outer")?n["inner"+e]:n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):void 0===a?t.css(n,i,r):t.style(n,i,a,r)},n,a?i:void 0,a)}})}),t.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(n,e){t.fn[e]=function(t){return this.on(e,t)}}),t.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,s){return this.on(t,e,n,s)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),t.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(n,e){t.fn[e]=function(t,n){return 0<arguments.length?this.on(e,null,t,n):this.trigger(e)}}),tF=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t.proxy=function(e,n){var i,o;if("string"==typeof n&&(o=e[n],n=e,e=o),s(e))return i=_.call(arguments,2),(o=function(){return e.apply(n||this,i.concat(_.call(arguments)))}).guid=e.guid=e.guid||t.guid++,o},t.holdReady=function(e){e?t.readyWait++:t.ready(!0)},t.isArray=Array.isArray,t.parseJSON=JSON.parse,t.nodeName=u,t.isFunction=s,t.isWindow=S,t.camelCase=v,t.type=E,t.now=Date.now,t.isNumeric=function(e){var n=t.type(e);return("number"===n||"string"===n)&&!isNaN(e-parseFloat(e))},t.trim=function(e){return null==e?"":(e+"").replace(tF,"")},"function"==typeof e&&e.amd&&e("jquery",[],function(){return t}),tT=o.jQuery,ts=o.$,t.noConflict=function(e){return o.$===t&&(o.$=ts),e&&o.jQuery===t&&(o.jQuery=tT),t},void 0===tM&&(o.jQuery=o.$=t),t},"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=f.document?h(f,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return h(e)}:h(f),e("utils/jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return e&&e.nodeType===Node.TEXT_NODE&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){var t=this.find(e),e=this.filter(e);return e.length?t.add(e):t}})}),function(){var t,s={};function n(e){for(var t in e)this[t]=e[t]}function o(a,j){for(var u=a.innerText,e=null,o=0,c=o,b=u.length,n=null,t;o<b;){for(var m=u.slice(o),f=(e&&e.length?e[0]:a).innerMode,h=0,g=f.length;h<g;h+=1)if(t=s[f[h]],!(t.constraint&&!t.constraint(n)||t.cannotFollowText&&(n&&"text"===n.type||c<o))&&(t.plainCompare?m.startsWith(t.pattern):t.pattern.test(m))){var l=t.fn(t.plainCompare?t.pattern:t.pattern.exec(m)),v=!1,r=0;if(l.matches){for(;e&&r<e.length;r+=1){var d=e[r],p=d.type,d=d.aka;if(p in l.matches){v=!0;break}d&&(p=d),l.cannotCross&&-1<l.cannotCross.indexOf(p)&&(r=e.length-1)}if((!e||r>=e.length)&&!l.isFront)continue}c<o&&a.addChild({type:"text",text:u.slice(c,o),innerMode:f}),c=o+=(n=a.addChild(l)).text.length,t=!1,v&&(j&&i(a,n,e[r]),e=e.slice(r+1),t=!0),!t&&n.isFront&&(e?e.unshift(n):e=[n]);break}h===g&&(o+=1,null===n&&(n={type:"text"}))}for(c<o&&a.addChild({type:"text",text:u.slice(c,o),innerMode:(e&&e.length?e[0]:a).innerMode});e&&0<e.length;)e.shift().demote();return a}function i(s,e,t){var a=s.children.indexOf(e),o=s.children.indexOf(t),n,i,r;e.children=s.children.splice(o+1,a-(o+1)),e.type=e.matches[t.type],e.innerText="";for(i=0,r=e.children.length;i<r;i++)e.innerText+=e.children[i].text;for(n in e.start=t.start,e.text=t.text+e.innerText+e.text,t)hasOwnProperty.call(t,n)&&!hasOwnProperty.call(e,n)&&(e[n]=t[n]);e.isFront&&(e.isFront=!1),s.children.splice(o,1)}n.prototype={constructor:n,addChild:function(t){var s=this.lastChildEnd(),e=new n(t);return e.start=s,e.end=t.text&&s+t.text.length,e.place=this.place,e.children=[],e.innerText&&o(e),this.children.push(e),e},lastChildEnd:function(){var e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(var t=0,n;t<this.children.length;t+=1)if(n=this.children[t].tokenAt(e),n)return n;return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];var t=[],n,s;if(this.children.length)for(n=0;n<this.children.length;n+=1)if(s=this.children[n].pathAt(e),s.length){t=t.concat(s);break}return t.concat(this)},nearestTokenAt:function(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(function(n,t){return n||(e>=t.start&&e<t.end?t:null)},null):this},everyLeaf:function(e){return this.children&&0!==this.children.length?this.children.reduce(function(t,n){return t&&n.everyLeaf(e)},!0):!!e(this)},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&0<this.children.length&&(e+="["+this.children+"]"),e},copy:function(){var e=new n(this);return e.children=e.children.slice(),e},foldChildren:function(){for(var e=[],o=this.children.slice(),s=0,t,a,n;s<o.length;s+=1){if(t=o[s],a=!1,t.matches)for(n=0;n<e.length;n+=1)e[n].type in t.matches&&(i(this,t,e[n]),e=e.slice(n+1),a=!0);!a&&t.isFront&&e.unshift(t)}}},t={lex:function(e){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"start",a=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return o(new n({type:"root",place:s,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:t.modes[i]}),!a)},rules:s,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=t:"function"==typeof e&&e.amd?e("lexer",[],function(){return t}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=t):this.Lexer=t}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){function c(e){return e&&"object"===_typeof(e)?(Object.keys(e).forEach(function(t){e[t]=c(e[t])}),e):(e+"").replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function f(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var u,s=f("?:"),o=f("?!"),b=f("?="),a="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",t=a.replace("*","+"),n="\\b",l="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",m=l.replace("\\-",""),d=s("\\n","$"),z=a+"(\\*+)"+t,T=a+"((?:0\\.)+)"+t,S=a+"-{3,}"+a+d,O=a+"(==+>|<=+|=+><=+|<==+>)"+a+d,j=a+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+a+d,i={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(c).join("")+"]*"}("]")+")",rightSeparator:s("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+s("[^\\|\\]]","\\]"+o("\\]"))+"+)"},r=m+"*"+m.replace("\\w","a-zA-Z")+m+"*",y="\\$("+r+")",_="_("+r+")",w="'s"+t+"("+r+")",D="("+r+")"+t+"of"+n+o("it\\b"),x="'s"+t,C=s("it","time","turns?","visits?","exits?","pos")+n,E="its"+t+"("+r+")",k="("+r+")"+t+"of"+t+"it"+n,A="of"+t+"it"+n,h={opener:"\\(",name:"("+s("\\$","_")+"?"+l+"+):"+o("\\/"),closer:"\\)"},M=s("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+t+"a"+n),F="[a-zA-Z][\\w\\-]*",g="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",p="\\|("+l+"+)(>|\\))",v="(<|\\()("+l+"+)\\|",d="((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)"+o("m?s")+n;i.main=i.opener+s(i.text+i.rightSeparator,i.text.replace("*","*?")+i.leftSeparator)+i.text,u={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:l,anyLetterStrict:m,whitespace:t.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:"<\\/?"+F+g+">",scriptStyleTag:"<("+s("script","style","textarea")+")"+g+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+s("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:S,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:O,column:j,bulleted:z,numbered:T,verbatimOpener:"`+",hookAppendedFront:"\\["+o("=+"),hookPrependedFront:p+"\\["+o("=+"),hookFront:"\\["+o("=+"),hookBack:"\\]"+o(v),hookAppendedBack:"\\]"+v,unclosedHook:"\\[=+",unclosedHookPrepended:p+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:i.main+i.closer,legacyLink:i.opener+i.legacyText+i.legacySeparator+i.legacyText+i.closer,simpleLink:i.opener+i.legacyText+i.closer,macroFront:h.opener+b(h.name),macroName:h.name,groupingFront:"\\("+o(h.name),twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:r,property:w,belongingProperty:D,possessiveOperator:x,belongingOperator:"of\\b",itsOperator:"its\\b",belongingItOperator:A,variable:y,tempVariable:_,hookName:"\\?("+l+"+)\\b",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:s(s("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:s("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm","data"+s("map","type","set"),"ds","digit","gradient","empty","even","int"+o("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+n,number:d,boolean:s("true","false")+n,identifier:C,itsProperty:E,belongingItProperty:k,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+o(t+"not"+n,t+"an?"+n,t+"in"+n,t+"<",t+">")+n,isNot:"is"+t+"not"+o(t+s("an?","in")+n)+n,isA:"is"+t+"an?"+n,isNotA:"is"+t+"not"+t+"an?"+n,matches:"matches\\b",doesNotMatch:"does"+t+"not"+t+"match"+n,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+t+"not)?"+a+")*)("+s("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+t+"in"+n,contains:"contains\\b",doesNotContain:"does"+t+"not"+t+"contain"+n,isNotIn:"is"+t+"not"+t+"in"+n,addition:c("+")+o("="),subtraction:c("-")+o("=","type"),multiplication:c("*")+o("="),division:s("/","%")+o("="),spread:"\\.\\.\\."+o("\\."),to:s("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:s("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:c("-type")+n,incorrectOperator:M,PlainCompare:{comma:",",commentFront:"<!--",commentBack:"-->",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=u:"function"==typeof e&&e.amd?e("patterns",[],function(){return u}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=u):this.Patterns=u}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){Object.assign=Object.assign||function(s){for(var t=1,e,n;t<arguments.length;t++){n=arguments[t];for(e in n)hasOwnProperty.call(n,e)&&(s[e]=n[e])}return s};var t,n=Object.keys,s=Object.assign;function i(g){function o(e){return e=e||"innerText",function(t){var n=t.reduceRight(function(e,t,n){return e||(n?t:"")},""),t={};return t[e]=n,t}}function f(t,n){var e={};return e[t]=n,function(){return{isFront:!0,matches:e,cannotCross:["verbatimOpener"]}}}e=Object.bind(0,null);function c(t,e){return Object.keys(e).forEach(function(n){var s=e[n].fn;e[n].fn=function(o){var e=s(o);return e.text||(e.text="string"==typeof o?o:o[0]),e.type||(e.type=n),e.innerMode||(e.innerMode=t),e}}),e}function v(e){switch(e&&e.type){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1}var e,i=[],u=[],r=[],d=c(i,{hr:{fn:e},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(n){var e,t=n[1],n=t.indexOf("><");return~n?25===(e=Math.round(n/(t.length-2)*50))&&(e="center"):"<"===t[0]&&">"===t.slice(-1)?e="justify":-1<t.indexOf(">")?e="right":-1<t.indexOf("<")&&(e="left"),{align:e}}},column:{fn:function(t){var n,e=t[1],t=e.indexOf("|");return t&&t<e.length-1?n="center":"|"===e[0]&&"|"===e.slice(-1)?n="none":t===e.length-1?n="right":t||(n="left"),{column:n,width:/\|+/.exec(e)[0].length,marginLeft:/^=*/.exec(e)[0].length,marginRight:/=*$/.exec(e)[0].length}}}}),h;n(d).forEach(function(e){d[e].constraint=v,d[e].cannotFollowText=!0});var m=c(i,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:f("boldOpener","bold")},italicOpener:{fn:f("italicOpener","italic")},strikeOpener:{fn:f("strikeOpener","strike")},supOpener:{fn:f("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:e},tag:{fn:e},url:{fn:e},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:e},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var t=e[0].length,e={};return{type:(e["verbatim"+t]="verbatim")+t,isFront:!0,matches:e,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:e},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:e},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:i}}},br:{fn:e}}),p=s(c(u,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",e=e[3]||"";return{type:"twineLink",innerText:n?e:t,passage:t?e:n,innerMode:i}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:i}}},variable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:o("name")},tempVariable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:o("name")}}),{hookFront:m.hookFront,hookBack:m.hookBack}),l=c(u,s({macroName:{constraint:function(e){return e&&"macroFront"===e.type},fn:o("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:o("name"),constraint:function(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0}}},possessiveOperator:{fn:e},itsProperty:{cannotFollowText:!0,fn:o("name")},itsOperator:{cannotFollowText:!0,fn:e},belongingItProperty:{cannotFollowText:!0,fn:o("name")},belongingItOperator:{cannotFollowText:!0,fn:e},belongingProperty:{cannotFollowText:!0,fn:o("name")},belongingOperator:{cannotFollowText:!0,fn:e},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:r}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:r}}},hookName:{fn:o("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollowText:!0,fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollowText:!0,fn:function(t){var e=t[0].toLowerCase(),t={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"},e=hasOwnProperty.call(t,e)?"#"+t[e]:e;return{colour:e}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:-1<e[1].indexOf("not")}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:o("name"),cannotFollowText:!0},whitespace:{fn:e,cannotFollowText:!0},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(t,n){return t[n]={fn:e,cannotFollowText:!0},t},{}),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(t,n){return t[n]={fn:e},t},{}))),a=c(r,{singleStringCloser:l.singleStringOpener,doubleStringCloser:l.doubleStringOpener,escapedStringChar:l.escapedStringChar});return i.push.apply(i,_toConsumableArray(n(d)).concat(_toConsumableArray(n(p)),_toConsumableArray(n(m)))),u.push.apply(u,_toConsumableArray(n(p)).concat(_toConsumableArray(n(l)))),r.push.apply(r,_toConsumableArray(n(a))),h=s({},d,m,p,l,a),n(h).forEach(function(e){t.PlainCompare[e]?(h[e].pattern=t.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp("^(?:"+t[e]+")","i")}),s(g.rules,h),a=g.modes,a.start=a.markup=i,a.macro=u,a.string=r,g}function o(e){return Object.freeze({lex:i(e).lex,Patterns:t})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(t=c("./patterns"),module.exports=o(c("./lexer"))):"function"==typeof e&&e.amd?e("markup",["lexer","patterns"],function(e,n){return t=n,o(e)}):this&&this.loaded&&this.modules?(t=this.modules.Patterns,this.modules.Markup=o(this.modules.Lexer)):(t=this.Patterns,this.Markup=o(this.Lexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),e("utils/polyfills",[],function(){var e=Array.prototype;"function"!=typeof e.includes&&(e.includes=function(n){if(t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,!Number.isNaN(n)&&Number.isFinite(t)&&void 0!==n)return-1<e.indexOf.call(this,n,t);var t,i=Object(this),s=parseInt(i.length),o;if(s<=0)return!1;for(o=0<=t?t:Math.max(0,s+t);o<s;){if(Object.is(n,i[o]))return!0;o+=1}return!1}),window.Symbol||(window.Symbol={iterator:"_es6-shim iterator_"})}),e("utils",["jquery","markup","utils/polyfills"],function(a){var t=String.fromCharCode,p="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),f="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),g=["audio"],i=_slicedToArray([function(e){return t(e)!==t(e).toLowerCase()},function(e){return t(e)!==t(e).toUpperCase()},function(e){return t(e).toLowerCase()!==t(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(t,e){return e}).filter(e).map(function(e,n,s){return e===s[n-1]+1&&e===s[n+1]-1?"-":t(e)}).join("").replace(/-+/g,"-")+"]"}),3),v=i[0],j=i[1],i=i[2],b,n;function u(e){return"instant"===e?0:800}var e,m,r=[],l={},o=0,d={},s=0,c={};function h(e,c,d,a,l){var i=null,r=0,t=c+d;function n(d){var u;1&e[0].compareDocumentPosition(document)&&(t=0),i&&(t-=u=d-i),i=d,0<a&&0<o+s&&e.data("expediteAnim")(a),t<=c&&(r+=u||0,"paused"===e.css("animation-play-state")&&e.css({visibility:"","animation-play-state":"running"})),t<=0?(e.removeData("expediteAnim"),l()):requestAnimationFrame(n)}e.data("expediteAnim",function(s){var n;t-=s=void 0===s?r:s,"running"===e.css("animation-play-state")&&e.css("animation-delay",(("ms"===(n=(n=e.css("animation-delay")).toLowerCase()).slice(-2)?+n.slice(0,-2)||0:"s"===n.slice(-1)&&1e3*+n.slice(0,-1)||0)||0)-s+"ms")}),t?requestAnimationFrame(n):n()}return a(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,i=e.button,a=e.type.includes("down"),e=t?l:d,i=t&&n.insensitiveName(t)||i;e[i]&&!a?t?o=Math.max(o-1,0):s=Math.max(s-1,0):!e[i]&&a&&(t?o+=1:s+=1),e[i]=a}).on("mousemove",function(e){var t=e.pageX,e=e.pageY;c.x=t,c.y=e}),b=/-|_/g,n={permutations:function(){for(var i=arguments.length,t=new Array(i),s=0;s<i;s++)t[s]=arguments[s];for(var o,a,r=t.length,c=[[].concat(t)],n=Array(r).fill(0),e=1;e<r;)n[e]<e?(o=e%2&&n[e],a=t[e],t[e]=t[o],t[o]=a,++n[e],e=1,c.push([].concat(t))):(n[e]=0,++e);return c},nth:function(t){var e=(+t+"").slice(-1);return t+("1"===e?"st":"2"===e?"nd":"3"===e?"rd":"th")},plural:function(e,t,n){return e+" "+(1!==Math.abs(e)?n||t+"s":t)},andList:function(e){return e.length<=1?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:v,anyLowercase:j,anyCasedLetter:i,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(b,"")},allKeysDown:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return n.every(function(e){return l[e]})},someKeysDown:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return n.some(function(e){return l[e]})},buttonsDown:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return n.every(function(e){return d[e]})},anyInputDown:function(){return 0<o+s},mouseCoords:c,parentColours:function(t){for(var n,e={colour:null,backgroundColour:null},s=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;t.length&&t[0]!==document;t=t.parent())if(e.backgroundColour||(n=t.css("background-color")).match(s)||(e.backgroundColour=n),e.colour||(n=t.css("color")).match(s)||(e.colour=n),e.colour&&e.backgroundColour)return e;return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(t){var e=[];return[].every.call(t.findAndFilter("*"),function(t){return!!(t.hidden||/none|inline/.test(t.style.display)||/display: (none|inline)/.test(t.getAttribute("style")))||!p.includes(t.tagName.toLowerCase())&&!/display: (?!none|inline|inherit|unset)/.test(t.getAttribute("style"))&&(f.includes(t.tagName.toLowerCase())||e.push(t),!0)})&&e.every(function(e){return window.getComputedStyle(e).display.includes("inline")})},transitionOut:function(e,s,t){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,i=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(t=t||u(s),!(1<e.length)&&n.childrenProbablyInline(e)&&["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(e.tag())||(e=e.wrapAll("<tw-transition-container>").parent()),i&&e.css("transform-origin",i),e.attr("data-t8n",s).addClass("transition-out").css({"animation-duration":"".concat(t,"ms"),"animation-delay":"".concat(-o,"ms"),"animation-play-state":"paused"}),requestAnimationFrame(function(){n.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),h(e,t,a-o,r,function(){e.remove()}))},transitionIn:function(e,o,t){var i,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,c=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(t=t||u(o),(i=1<e.length||!n.childrenProbablyInline(e)||!["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(e.tag()))&&(e=e.wrapAll("<tw-transition-container>").parent()),c&&e.css("transform-origin",c),e.attr("data-t8n",o).addClass("transition-in").css(Object.assign({"animation-duration":"".concat(t,"ms"),"animation-delay":"".concat(-s,"ms")},r-s?{visibility:"hidden","animation-play-state":"paused"}:{})),requestAnimationFrame(function(){n.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),h(e,t,r-s,l,function(){if(u=0===e.filter(g.join(",")).length,i&&u){e.find("tw-transition-container, .transition-in, .transition-out").each(function(t,e){((e=a(e)).data("expediteAnim")||Object)()});for(var l=[],c=e.find("*"),s=0;s<c.length;s+=1)n=c[s],0===n.scrollTop&&0===n.scrollLeft||l.push([n,n.scrollLeft,n.scrollTop]);e.contents().unwrap();for(o=0,r=l;o<r.length;o++){var u,n,o,r,t=_slicedToArray(r[o],3),d=t[0],h=t[1],t=t[2];d.scrollLeft=h,d.scrollTop=t}}else e.removeClass("transition-in").removeAttr("data-t8n")}))},debounce:function(o){function r(){300<Date.now()-c?(t=0,s=!l,a?(o(e),e=[]):o.apply(void 0,_toConsumableArray(e)),s=!1):t=requestAnimationFrame(r)}var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=n.batch,a=void 0!==i&&i,n=n.recur,l=void 0!==n&&n,e=[],c=0,s=!1;return function(){s||(c=Date.now(),a?e.push(arguments):e=arguments,t&&cancelAnimationFrame(t),t=requestAnimationFrame(r))}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},onStartup:function(e){r?r.push(e):e()},get storyElement(){return e},detachStoryElement:function(){document.documentElement.contains(e[0])&&(m=e.parent(),e.detach())},reattachStoryElement:function(){document.documentElement.contains(e[0])||(m||a(document.body)).append(e.parents().length?e.parents().last():e)},options:{}},a(function(){e=a("tw-story"),r.forEach(function(e){return e()}),r=null}),Object.freeze(n)}),e("utils/naturalsort",[],function(){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:String;return function(s,n){var o,a,l,f,m=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,d=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=/^0x[0-9a-f]+$/i,u=/^0/,s=t(s).trim(),n=t(n).trim(),r=s.replace(m,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),c=n.replace(m,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),s=parseInt(s.match(h))||1!==r.length&&s.match(d)&&Date.parse(s),n=parseInt(n.match(h))||s&&n.match(d)&&Date.parse(n)||null,i,p;if(e&&window.Intl&&window.Intl.Collator&&(l=window.Intl.Collator(e)),n){if(s<n)return-1;if(n<s)return 1}for(i=0,p=Math.max(r.length,c.length);i<p;i++){if(o=!(r[i]||"").match(u)&&parseFloat(r[i])||r[i]||0,a=!(c[i]||"").match(u)&&parseFloat(c[i])||c[i]||0,isNaN(o)!==isNaN(a))return isNaN(o)?1:-1;if(_typeof(o)!==_typeof(a))o+="",a+="";else if("string"==typeof o&&l&&0!==(f=l.compare(o,a)))return f;if(o<a)return-1;if(a<o)return 1}return 0}}}),e("internaltypes/twineerror",["jquery","utils"],function(e,n){o=n.impossible,i=n.escape,e(document.documentElement).on("click","tw-folddown",function(n){var t=n.target;(t=e(t)).toggleClass("open"),n=t.popData("folddown");for("function"==typeof n&&n(t);t&&!t.next().length;)t=t.parent();t&&t.next().toggle()});var o,i,a={syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true.",debugonly:"This macro is not meant to be used outside of debugging your story."},s=[],t={TwineError:!0,create:function(t,e,n,s){return e&&"string"==typeof e||o("TwineError.create","has a bad message string"),n||t in a||o("TwineError.create","no error explanation given"),"user"!==t&&(e=e[0].toUpperCase()+e.slice(1)),Object.assign(Object.create(this),{type:t,message:e,explanation:n,source:void 0,innerDOM:s,appendTitleText:!1})},containsError:function(){for(var n=0,e;n<arguments.length;n+=1){if(e=arguments[n],t.isPrototypeOf(e))return e;if(Array.isArray(e))if(e=t.containsError.apply(t,e),e)return e}return!1},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(t){r=this,c=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t="string"==typeof t?t:this.source||"";var r,c,o=e("<tw-error class='"+(this.warning?"warning":"error")+"' title='"+i(t)+"'>"+i(this.message+(this.appendTitleText?" "+t:""))+"</tw-error>"),l=e("<tw-error-explanation>").text(this.explanation||a[this.type]).hide(),d=e("<tw-folddown tabindex=0>");return this.innerDOM&&e("<tw-open-button label='Open'>").on("click",function(){var t=e("<tw-backdrop><tw-dialog></tw-backdrop>");t.find("tw-dialog").prepend(r.innerDOM,e("<tw-link tabindex=0>OK</tw-link>").on("click",function(){r.innerDOM.detach(),t.remove()}).wrap("<tw-dialog-links>").parent()),n.storyElement.prepend(t)}).appendTo(o),o.append(d).append(l),o.data("TwineError",this),c||s.forEach(function(e){return e(r,t)}),o},on:function(e){return"function"!=typeof e||s.includes(e)||s.push(e),t}};return Object.preventExtensions(t)}),e("passages",["jquery","utils/naturalsort","utils","markup","internaltypes/twineerror"],function(c,d,o,s,t){var a=o.insensitiveName,f=o.unescape,m=o.onStartup,p=o.impossible,l=Object.assign,h=RegExp(s.Patterns.macroFront+s.Patterns.macroName,"ig");function u(e){var n=e.attr("name"),o=f(e.html()),i=function(o,r){if(n=["metadata","storylet","exclusivity","urgency"],!(o.match(h)||[]).some(function(e){return n.some(function(t){return a(e.slice(1,-1))===t})}))return{};var n,i=!1,e={};return s.lex(o,r).children.forEach(function r(s){if("macro"===s.type){var o=a(s.name);if(n.some(function(e){return o===e})){if(t.isPrototypeOf(e[o]))return;if(i)return void(e[o]=t.create("syntax","The (".concat(s.name,":) macro can't appear after non-metadata macros.")));if(e[o])return void(e[o]=t.create("syntax","There is more than one (".concat(s.name,":) macro.")));e[o]=s}else i=!0;s.children.forEach(function i(s){var o=a(s.name);"macro"===s.type&&n.some(function(e){return o===e})?e[o]=t.create("syntax","The (".concat(s.name,":) macro can't be inside another macro.")):s.children.forEach(i)})}else s.children.forEach(r)}),e}(o,n);return l(new Map([["source",o],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",n]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:i,tree:null})}var i=Object.create(null),e=[],r=null,n=l(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(e){if(i[e])return i[e];var n=d("en",function(e){return e.get("name")}),t=[];return this.forEach(function(n){var s=n instanceof Map&&n.get("tags");Array.isArray(s)&&s.includes(e)&&t.push(n)}),t.sort(n),i[e]=t},clearTagCache:function(){i=Object.create(null)},clear:function(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete:function(){var e;(e=Map.prototype.delete).call.apply(e,[this].concat(Array.prototype.slice.call(arguments))),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree:function(n){if(!this.has(n))return p("Passages.getTree","No passage name?"),[];var t=this.get(n),i=t.get("tags"),o,a;if(i.includes("header")||i.includes("footer")||i.includes("debug-header")||i.includes("debug-footer"))return t.tree||(t.tree=s.lex(t.get("source"),n)),t.tree;for(o=0;o<e.length;o+=1)if(e[o]&&e[o].place===n)return a=e.splice(o,1)[0],e.unshift(a),a;return t=s.lex(t.get("source"),n),e.unshift(t),16<e.length&&e.pop(),t},clearTreeCache:function(){e=[]},getStorylets:function(o,e){if(e=e?e.filter(o,_toConsumableArray(n.values())):_toConsumableArray(n.values()),t.containsError(e))return e;var i=[],s=-1/0,e=e.reduce(function(e,n){if(e)return e;var a=n.get("storylet"),e;if(a){if(e=o.speculate(a,n.get("name"),"a (storylet:) macro"),t.containsError(e))return e.message="There's an error in the storylet passage \""+n.get("name")+'":\n'+e.message,e.source=a.TwineScript_ToSource(),e;e&&(e=n.get("exclusivity"),s=Math.max(s,"number"==typeof e?e:0),i.push(n))}},void 0),a;return e||(a=d("en"),i.filter(function(e){var e=e.get("exclusivity");return(e="number"==typeof e?e:0)===s}).sort(function(n,s){var e=n.get("urgency"),t=s.get("urgency");return(e="number"==typeof e?e:0)!==(t="number"==typeof t?t:0)?t-e:a(n.get("name"),s.get("name"))}))},allStorylets:function(){return r=r||_toConsumableArray(n.values()).filter(function(e){return e.get("storylet")})},clearStoryletCache:function(){r=null},loadMetadata:function(s){var e=[];return n.forEach(function(n){n.metadata&&Object.keys(n.metadata).forEach(function(i){if(t.containsError(n.metadata[i]))e.push(n.metadata[i]);else{var a=n.metadata[i],o=s.speculate(a,n.get("name"),"a ("+i+":) macro"),c='In "'+n.get("name")+'":\n';if(t.containsError(o))return o.message=c+o.message,o.source=a.text,void e.push(o);o instanceof Map?o.forEach(function(e,t){return r(t,e)}):r(i,o)}function r(s,o){n.has(s)?e.push(t.create("syntax","This passage's datamap already has a '"+JSON.stringify(s)+"' data name.")):n.set(s,o)}}),n.metadata=void 0}),e},hasValid:function(e){return e=this.get(e),e&&e instanceof Map&&e.has("source")},create:u});return m(function(){c("tw-storydata > tw-passagedata").get().forEach(function(e){e=c(e),n.set(e.attr("name"),new u(e))})}),n}),e("renderer",["jquery","utils","markup","internaltypes/twineerror"],function(n,s,a,l){var t=s.escape,o=s.insensitiveName,i=s.options,c;function r(n,t,e){return e=2<arguments.length&&void 0!==e?e:"","<"+t+(e?" "+e:"")+">"+n+"</"+t+">"}c="text-align: center; max-width:50%; ";function e(u,h){function f(t,n,s){return t=e(t.children,h),t&&r(t,n,s)}var d="",O=[],m,s,n,b,y,v,w,g,j,x,E,p,C,_;if(!u)return d;for(m=(u=Array.isArray(u)?u:[u]).length,s=0;s<m;s+=1)switch(n=u[s],n.type){case"include":d+=f(n,"tw-"+n.type,'type="'.concat(n.tag,'" name="').concat(n.name,'"'));break;case"error":d+=l.create("syntax",n.message,n.explanation).render(t(n.text))[0].outerHTML;break;case"numbered":case"bulleted":b="numbered"===n.type?"ol":"ul",d+="<"+b+">";for(y=1;s<m&&u[s];){if("br"===u[s].type){if(d+="</li>",!u[s+1]||u[s+1].type!==n.type)break}else u[s].type===n.type?(d+=("<"+b+">").repeat(Math.max(0,u[s].depth-y)),d+=("</"+b+">").repeat(Math.max(0,y-u[s].depth)),d+="<li>",y=u[s].depth):d+=e([u[s]],h);s+=1}d+=("</"+b+">").repeat(y+1);break;case"align":for(;n&&"align"===n.type;){if(v=n.align,w=s+=1,"left"===v){--s;break}for(;s<m&&u[s]&&"align"!==u[s].type;)s+=1;switch(w=e(u.slice(w,s),h),g="",v){case"center":g+=c+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":g+="text-align: "+v+";";break;default:+v&&(g+=c+"margin-left: "+v+"%;")}d+="<tw-align "+(g?'style="'+g+'"':"")+">"+w+"</tw-align>\n",n=u[s]}break;case"column":for(j=[];n&&"column"===n.type;){if(x=n.column,E=s+=1,"none"===x){--s;break}for(;s<m&&u[s]&&"column"!==u[s].type;)s+=1;j.push({text:n.text,type:x,body:e(u.slice(E,s),h),width:n.width,marginLeft:n.marginLeft,marginRight:n.marginRight}),n=u[s]}j.length&&function(){var e=j.reduce(function(e,t){return e+t.width},0);d+="<tw-columns>"+j.map(function(t){return"<tw-column type=".concat(t.type," ",' style="width:').concat(t.width/e*100,"%; margin-left: ").concat(t.marginLeft,"em; margin-right: ").concat(t.marginRight,'em;">').concat(t.body,"</tw-column>\n")}).join("")+"</tw-columns>"}();break;case"heading":for(d+="<h"+n.depth+">";++s<m&&u[s];){if("br"===u[s].type){d+="</h"+n.depth+">";break}d+=e([u[s]],h)}break;case"br":if(!O.length||/td|th/.test(O[0])){d+="<br>";for(p=u[s+1];p&&("br"===p.type||"tag"===p.type&&/^<br\b/i.test(p.text));)d+="<tw-consecutive-br"+("tag"===p.type?" data-raw":"")+"></tw-consecutive-br>",p=u[(s+=1)+1]}break;case"hr":d+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":d+='<a class="link" href="'+t(n.text)+'">'+n.text+"</a>";break;case"scriptStyleTag":case"tag":C=n.text.toLowerCase(),/^<\/?(?:table|thead|tbody|tr|tfoot|td|th)\b/.test(C)&&O[n.text.startsWith("</")?"shift":"unshift"](C),d+=n.text.startsWith("</")?n.text:n.text.replace(/>$/," data-raw>");break;case"sub":case"sup":case"strong":case"em":d+=f(n,n.type);break;case"strike":d+=f(n,"s");break;case"bold":d+=f(n,"b");break;case"italic":d+=f(n,"i");break;case"twineLink":_=_slicedToArray(a.lex("(link-goto:"+JSON.stringify(n.innerText)+","+JSON.stringify(n.passage)+")").children,1)[0],d+='<tw-expression type="macro" name="link-goto"'+(i.debug?' title="'+t(n.text)+'"':"")+' code="'+h.code.length+'"></tw-expression>',h.code.push(_);break;case"hook":d+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+o(n.name)+'"':"")+(i.debug&&n.name?' title="Hook: ?'+n.name+'"':"")+' source="'+h.source.length+'"></tw-hook>',h.source.push(n.children);break;case"unclosedHook":return d+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+o(n.name)+'"':"")+'source="'+h.source.length+'"></tw-hook>',h.source.push(u.slice(s+1,m)),d;case"verbatim":d+=r(t(n.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":d+=f(n,"tw-collapsed");break;case"unclosedCollapsed":return d+="<tw-collapsed>"+e(u.slice(s+1,m),h)+"</tw-collapsed>";case"variable":case"tempVariable":case"macro":if(_=function(){var s=[],e=[],a;if("macro"===n.type&&!function i(t){"string"!==t.type&&"hook"!==t.type&&t.children.every(i);var n=o(t.name);if("macro"!==t.type||"prompt"!==n&&"confirm"!==n){if("hook"===t.type&&!t.everyLeaf(function(t){return"error"!==t.type||(e.push(t),!1)}))return!1}else s.push(t);return!0}(n),e.length)return{v:l.create("syntax","This code hook's markup contained "+e.length+" error"+(e.length?"s":"")+":<br>\u2014"+e.map(function(e){return e.message}).join("<br>\u2014")).render(t(n.text))[0].outerHTML};a=s.map(function(e){return e.blockerTree=h.blockers.length,h.blockers.push(e),e.blockerTree}),d+='<tw-expression type="'+n.type+'" name="'+t(n.name||n.text)+'"'+(i.debug?' title="'+t(n.text)+'"':"")+(a.length?' blockers="'+a+'"':"")+' code="'+h.code.length+'"></tw-expression>',h.code.push(n)}(),"object"===_typeof(_))return _.v;break;default:d+=n.children&&n.children.length?e(n.children,h):n.text}return d}return Object.freeze({exec:function(t){var s={code:[],blockers:[],source:[]},t=e("string"==typeof t?a.lex(t).children:t,s),t=n(n.parseHTML(t,document,!0));return t.findAndFilter("script:not([src])").each(function(n,e){var t=e.getAttribute("type");t&&"text/javascript"!==t.toLowerCase()||e.setAttribute("type","application/x-harlowe")}),s.blockers=s.blockers.map(function(e){return e.blockedValue=!0,e=Object.create(e),e.blockedValue=!1,e}),t.findAndFilter("tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])").each(function(o,e){var t;(e=n(e)).attr("blockers")&&(t=e.popAttr("blockers").split(",").map(function(e){return s.blockers[e]}),e.data("blockers",t)),e.attr("source")&&e.data("source",s.source[e.popAttr("source")]),e.attr("code")&&e.data("code",s.code[e.popAttr("code")])}),t}})}),e("utils/renderutils",["jquery","utils","renderer"],function(e,t,l){var s=RegExp(t.realWhitespace+"+"),r=RegExp(t.realWhitespace+"+","g"),i,c,n,a;function o(e,n,t){var s=e.textContent.length,o,e;if(!(s<=n))return e=[o=0===n?e:e.splitText(n)],t&&(t=t<=0?s-t:t)<s&&e.push(o.splitText(t-n)),e}return c=function(){if(void 0!==i)return i;var t=e("<p>");return i=!!t[0].normalize&&(t.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),1===t.contents().length)},n="tw-collapsed,[collapsing=true]",a=/^(=*)([^=]+)=*$/,Object.freeze({dialog:function(){var c=(n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).section,u=void 0===(o=n.parent)?t.storyElement:o,i=n.cd,o=void 0===(a=n.message)?"":a,a=n.defaultValue,r=void 0===(n=n.buttons)?[{name:"OK",confirm:!0,callback:Object}]:n,d,s,n;return"a code hook"===o.TwineScript_TypeName&&(o=o.code),s=e("<tw-backdrop><tw-dialog>"+(a||""===a?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(r.length?r.reduce(function(n,e,t){return e=e.name,n+"<tw-link style='margin:0 "+(t===r.length-1?"0 0 0.5em":0===t?"0.5em 0 0":"0.5em")+"' tabindex=0>"+e+"</tw-link>"},""):"<tw-link tabindex=0>"+r[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>"),n=s.find("tw-dialog"),u.append(s),c?(c.renderInto(o,n,Object.assign({},i,{append:"prepend"})),(i=i&&i.transition&&s.find("tw-dialog > tw-transition-container"))&&i.length&&i.appendTo(s).append(n.prepend(i.contents().detach()))):n.prepend(l.exec(o)),a&&((d=s.find("input").last()).val(a).on("keypress",function(e){13===e.which&&(s.remove(),r.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return d.focus()},100)),r.reverse().forEach(function(t,n){e(s.find("tw-link").get(-n-1)).on("click",function(){s.remove(),t.callback()})}),s},realWhitespace:s,textNodeToChars:function(e){var t=_toConsumableArray(e.textContent);return 1===t.length?[e]:t.reduce(function(e,t){return t.match(s)&&e.length&&e[e.length-1].match(s)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(n,t){var s=e;return t.length<e.textContent.length&&(e=e.splitText(t.length)),n.concat(s)},[])},findTextInNodes:function l(n,i){var e=[],r="",t=[],s,a,c;if(!n.length||!i)return t;for(;0<n.length;)if(e.push(n[0]),r+=n[0].textContent,n.shift(),s=r.indexOf(i),-1<s){for(a=r.length-(s+i.length);s>=e[0].textContent.length;)s-=e[0].textContent.length,e.shift();if(1===e.length){c=o(e[0],s,s+i.length),t.push(c[0]),c[1]&&n.unshift(c[1]);break}t.push(o(e[0],s,e[0].length)[0]),t.push.apply(t,_toConsumableArray(e.slice(1,-1))),a=o(e[e.length-1],0,e[e.length-1].textContent.length-a),t.push(a[0]),a[1]&&n.unshift(a[1]),t=t.filter(Boolean);break}return[t].concat(_toConsumableArray(l(n,i)))},collapse:function(t){function s(t){return 0===e(this||t).parentsUntil(n).filter("tw-verbatim, tw-expression, [collapsing=false]").length}i=function n(e){var s=e[0],t=e.parent();return!t.length||e.findAndFilter("tw-story").length?null:(e=t.textNodes().filter(function(e){return 4&(e=e.compareDocumentPosition(s))&&!(8&e)}),(e=e[e.length-1])||n(t))}(t),e(i).parents(n).length||(i=null),a=function n(e){var s=e[0],t=e.parent();return!t.length||e.findAndFilter("tw-story").length?null:(e=t.textNodes().filter(function(e){return 2&(e=e.compareDocumentPosition(s))&&!(8&e)})[0],e||n(t))}(t),e(a).parents(n).length||(a=null),d="br:not([data-raw]),tw-consecutive-br:not([data-raw])",t.find(d).filter(s).replaceWith(document.createTextNode(" "));var i,a,d,o=(t=e(t.get().map(function(t){return e(t).filter(s).is(d)?e(document.createTextNode(" ")).replaceAll(t)[0]:t}))).textNodes(),l=0;o.reduce(function(t,e){return s(e)?(e.textContent=e.textContent.replace(r," ")," "!==e.textContent[0]||t&&t.textContent&&!(-1<t.textContent.search(/\s$/))||(e.textContent=e.textContent.slice(1)),e):document.createTextNode("A")},i),_toConsumableArray(o).reverse().every(function(e){return!!s(e)&&(e.textContent.match(/^\s*$/)?(l+=e.textContent.length,!(e.textContent="")):(e.textContent=e.textContent.replace(/\s+$/,function(e){return l+=e.length,""}),!1))}),0<l&&a&&(o[o.length-1].textContent+=" "),t[0]&&c()&&t[0].normalize()},geomStringRegExp:a,geomParse:function(t){if(!t)return{marginLeft:0,size:0};var n=t.length,s=(e=_slicedToArray(a.exec(t)||[],3))[0],o=e[1],e=e[2];return!s||e===t&&1<e.length?{marginLeft:0,size:0}:{marginLeft:o.length/n*100,size:e.length/n*100}}})}),e("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(b,u,n,_){var h=u.impossible,r=u.nth,j=u.permutations,y=u.plural,O=_.validPropertyName,a="object",f="boolean",e="string",d="number",o="function",t;function l(e){return!!e&&(_typeof(e)===a||_typeof(e)===o)}t=Array.isArray;function m(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function v(n){return t(n)?"array":n instanceof Map?"datamap":n instanceof Set?"dataset":_typeof(n)===e?e:n&&_typeof(n)===a?a:""}function g(e){if(!l(e))return e;if(_typeof(e.TwineScript_Clone)===o)return e.TwineScript_Clone();if(t(e))return _toConsumableArray(e);if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(_typeof(e)===o)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return Object.assign({},e);case null:return Object.assign(Object.create(null),e)}return h("OperationUtils.clone","The value "+e+" cannot be cloned!"),e}function p(t,s,i,a){for(var n="",e=0,o;n.length<=s&&e<t.length;){if(o=a(t[e]),!(o.length+n.length<=s)){n+=(0<e?" and ":"")+y(t.length-e,(0<e?"other ":"")+i);break}n+=(0<e&&e===t.length-1?" and ":"")+o+(e<t.length-1?", ":""),e+=1}return n}function s(n){if(l(n)&&"TwineScript_ObjectName"in n)return n.TwineScript_ObjectName;if(t(n))return 0===n.length?"an empty array":"an array (with "+p(n,48,"item",s)+")";if(n instanceof Map)return 0===n.size?"an empty datamap":"a datamap (with "+p(_toConsumableArray(n.keys()),48,"dataname",c)+")";if(n instanceof Set)return 0===n.size?"an empty dataset":"a dataset (with "+p(_toConsumableArray(n.values()),48,"item",s)+")";if(_typeof(n)!==e)return _typeof(n)===f?"the boolean value '"+n+"'":_typeof(n)===d?"the number "+JSON.stringify(n):void 0===n?"an empty variable":"...whatever this is";if(0===n.length)return"an empty string";var o=_toConsumableArray(n);return 48<o.length?"a ".concat(o.length,"-character string starting with ").concat(JSON.stringify(o.slice(0,48).join(""))):"the string ".concat(JSON.stringify(n))}function w(e,t){return[e[0],t[0]].sort(b("en"))[0]===e[0]?-1:1}function c(s,f){if(j=n.containsError(s),j&&h("toSource","received a TwineError: "+j.message),_typeof(s.TwineScript_ToSource)===o)return s.TwineScript_ToSource();if(m(s)&&"first"in s&&"last"in s)return(s.first<0?(-1!==s.first?r(-s.first):"")+"last":r(s.first+1))+"to"+(s.last<0?(-1!==s.last?r(-s.last):"")+"last":r(s.last+1));if(t(s)){i="",u=_createForOfIteratorHelper(s);try{for(u.s();!(v=u.n()).done;)p=v.value,i+=i?",":"(a:",i+="property"===f?p+(0<p):c(p)}catch(e){u.e(e)}finally{u.f()}return i+(i?")":"(a:)")}if(s instanceof Map){l="",a=_createForOfIteratorHelper(Array.from(s.entries()).sort(w));try{for(a.s();!(g=a.n()).done;){var j,v,i,u,p,g,l,a,y=_slicedToArray(g.value,2),_=y[0],x=y[1];l+=(l?",":"(dm:")+c(_)+","+c(x)}}catch(e){a.e(e)}finally{a.f()}return l+(l?")":"(dm:)")}return s instanceof Set?"(ds:"+Array.from(s).sort(b("en")).map(c)+")":_typeof(s)===d&&"property"===f?s<0?-1===s?"last":r(-s)+"last":r(s+1):_typeof(s)===e&&"property"===f?RegExp(O).test(s)?s:"("+JSON.stringify(s)+")":JSON.stringify(s)}function i(e,n){return _typeof(e)!==a&&_typeof(n)!==a?e===n:t(e)&&t(n)?e.length===n.length&&e.every(function(e,t){return i(n[t],e)}):e instanceof Map&&n instanceof Map?i(Array.from(e.entries()).sort(),Array.from(n.entries()).sort()):e instanceof Set&&n instanceof Set?i(_toConsumableArray(e),_toConsumableArray(n)):e&&_typeof(e.TwineScript_is)===o?e.TwineScript_is(n):e&&_typeof(e)===a&&n&&_typeof(n)===a&&m(e)&&m(n)?i(Object.getOwnPropertyNames(e).map(function(t){return[t,e[t]]}),Object.getOwnPropertyNames(n).map(function(e){return[e,n[e]]})):Object.is(e,n)}return Object.freeze({isObject:l,isValidDatamapName:function(o,t){if(o instanceof Map||h("isValidDatamapName","called with non-Map"),n.containsError(t))return t;if(_typeof(t)!==e&&_typeof(t)!==d)return n.create("property","Only strings and numbers can be used as data names for "+s(o)+", not "+s(t)+".");var i=_typeof(t)===e?+t:""+t;return!(!Number.isNaN(i)&&o.has(i))||n.create("property","You mustn't use both "+s(t)+" and "+s(i)+" as data names in the same datamap.")},collectionType:v,isSequential:function(n){return _typeof(n)===e||t(n)||_typeof(n.hooks)===o},unstorableValue:function n(e){return e&&e.TwineScript_Unstorable&&e||t(e)&&e.find(n)||e instanceof Map&&_toConsumableArray(e.values()).find(n)||e instanceof Set&&_toConsumableArray(e).find(n)},isHarloweJSValue:function n(t){return _typeof(t)===e||_typeof(t)===f||_typeof(t)===d&&!Number.isNaN(t)&&Math.abs(t)!==1/0||Array.isArray(t)&&t.every(n)||t instanceof Set&&_toConsumableArray(t).every(n)||t instanceof Map&&_toConsumableArray(t.values()).every(n)&&_toConsumableArray(t.keys()).every(function(t){return _typeof(t)===e})},clone:g,objectName:s,typeName:function o(e){if(n=m(e),n&&e.innerType)return e.typeName||("insensitive set"===e.pattern?"a case-insensitive string name":"either"===e.pattern?(t(e.innerType)||h("typeName",'"either" pattern had non-array inner type'),e.innerType.map(o).join(" or ")):"optional"===e.pattern?"(optional) "+o(e.innerType):o(e.innerType));if(n&&"range"===e.pattern){if(e.name)return e.name;var i=e.min,n=e.max;return"a"+(0<i?" positive":"")+(e.integer?" whole":"")+" number"+(0===i?" between 0 and "+n:n<1/0?" up to "+n:"")}return e===String||e===Number||e===Boolean?"a "+_typeof(e()):e===parseInt?"a whole number":e===Map?"a datamap":e===Set?"a dataset":e===Array?"an array":l(e)&&"TwineScript_TypeName"in e?e.TwineScript_TypeName:s(e)},typeID:function(n){var s=_typeof(n);return[f,e,d].includes(s)?s:t(n)?"array":n instanceof Map?"datamap":n instanceof Set?"dataset":n.TwineScript_TypeID||""},toSource:c,is:i,contains:function(o,a){if(o||""===o){if(_typeof(o)===e)return _typeof(a)!==e?n.create("operation",s(o)+" can only contain strings, not "+s(a)+"."):o.includes(a);if(t(o))return o.some(function(e){return i(e,a)});if(o instanceof Set||o instanceof Map)return Array.from(o.keys()).some(function(e){return i(e,a)})}return n.create("operation",s(o)+" cannot contain any values, let alone "+s(a))},isA:function(t,e){return _typeof(e.TwineScript_IsTypeOf)===o?e.TwineScript_IsTypeOf(t):n.create("operation",'"is a" should only be used to compare type names, not '+s(e)+".")},matches:function d(e,s){if(m=!1,e&&_typeof(e.TwineScript_IsTypeOf)===o){if(r=e.TwineScript_IsTypeOf(s),n.containsError(r))return r;m|=r}if(s&&_typeof(s.TwineScript_IsTypeOf)===o){if(r=s.TwineScript_IsTypeOf(e),n.containsError(r))return r;m|=r}if(m)return!0;if(t(e)&&t(s)){for(var m,r,c=0,a=0,h=!0,u,l;h&&c<e.length&&a<s.length;)if(u=e[c],l=s[a],u.rest){for(;a<s.length&&d(u,l);)l=s[a+=1];c+=1}else if(l.rest){for(;c<e.length&&d(u,l);)u=e[c+=1];a+=1}else d(u,l)?(c+=1,a+=1):h=!1;return h&&c>=e.length&&a>=s.length}return e instanceof Map&&s instanceof Map?d(Array.from(e.entries()).sort(),Array.from(s.entries()).sort()):e instanceof Set&&s instanceof Set?(e=_toConsumableArray(e),j.apply(void 0,_toConsumableArray(s)).some(function(t){return d(e,t)})):i(e,s)},subset:function a(o,s,t){if(!s||!t)return n.create("macrocall","The sub"+v(o)+" index value must not be "+(s&&t)+".");var i=_typeof(o)===e;return i&&(o=Array.from(o)),s<0&&(s=Math.max(0,o.length+s+1)),(t=t<0?Math.max(0,o.length+t+1):t)<s?a(arguments[0],t,s):(t=o.slice(0<s?s-1:s,t).map(g),i?t.join(""):t)},range:function s(e,t){if(t<e)return s(t,e);var n=[e];for(t-=e;0<t--;)n.push(++e);return n},printBuiltinValue:function i(s){return n.containsError(s)?s:s&&_typeof(s.TwineScript_Print)===o?s.TwineScript_Print():s instanceof Map?(s=Array.from(s.entries()),n.containsError(s)?s:s.reduce(function(n,e){var e=(t=_slicedToArray(e,2))[0],t=t[1];return n+"<tr><td>`"+i(e)+"`</td><td>`"+i(t)+"`</td></tr>"},"<table class=datamap>")+"</table>"):s instanceof Set?Array.from(s.values()).map(i)+"":t(s)?s.map(i)+"":s&&_typeof(s.jquery)===e?s:l(s)?n.create("unimplemented","I don't know how to print this value yet."):s+""},unique:function(e,t,n){return n.findIndex(function(t){return i(e,t)})===t}})}),e("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(e,n,i,l){var d=i.textNodeToChars,a=i.realWhitespace,r=i.findTextInNodes,c=l.toSource,t;function s(o){var l=o.dom,m=":not(tw-error, tw-error *)",i=e(),t,c,o,u;this.next&&(i=i.add(s.call(this.next,o)));function h(n,t){if(Array.isArray(t))return t.reduce(function(e,t){return e.add(n.get(t))},e());if(t&&"object"===_typeof(t)&&"first"in t&&"last"in t){var s=t.first,r=t.last,u=n.length,p,h,v,c,f,b,i,g,l,o;s<0&&(s+=u),r<0&&(r+=u);for(p=[n.get(s)];s!==r;)s+=Math.sign(r-s),p.push(n.get(s));return e(p)}if("string"==typeof t){if("chars"===t){v=[],c=_createForOfIteratorHelper(n.textNodes(m));try{for(c.s();!(h=c.n()).done;){b=h.value,i=_createForOfIteratorHelper(d(b));try{for(i.s();!(f=i.n()).done;)g=f.value,g.textContent.match(a)||v.push(g)}catch(e){i.e(e)}finally{i.f()}}}catch(e){c.e(e)}finally{c.f()}return e(v)}if("links"===t)return n.findAndFilter("tw-link, .enchantment-link");if("visited"===t)return n.findAndFilter("tw-link.visited");if("lines"===t)return l=n.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),o=[[]],n.contents().each(function s(i,t){var n=(t.tagName||"").toLowerCase();if("tw-sidebar"!==n)if("tw-passage"!==n&&"tw-transition-container"!==n){if(l.length){if(t===l[0])return l.shift(),void o.push([]);if(16&t.compareDocumentPosition(l[0]))return o.push([]),e(t).contents().each(s),void o.push([])}o[o.length-1].push(t)}else e(t).contents().each(s)}),e(o.map(function(t){return!!t.length&&e(t).wrapAll("<tw-pseudo-hook>").parent()[0]}).filter(Boolean))}return e(n.get(t))}if(this.selector){if("string"===this.selector.type)t=this.selector.data,t=r(l.textNodes(),t),c=e(),t.forEach(function(t){c=c.add(e(t).wrapAll("<tw-pseudo-hook>").parent())}),u=c;else{if("base"===this.selector.type)return i.add(h(s.call(this.selector.data,o),this.property));o=(t=this.selector.data,o='tw-hook[name="'+(t=n.insensitiveName(t).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+t+'"]',o+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[t]||""),u=l.findAndFilter(o).add(l.parentsUntil(n.storyElement.parent())).filter(o)}i=this.property?i.add(h(u,this.property)):i.add(u)}return i=i.get().reduce(function(n,t){return t=e(t),n.add(t.is("tw-enchantment")&&t.contents().length<=1?t.contents():t)},e())}function o(e){if(!e)return[];var t=e.selector,s=e.property,e=e.next;return[JSON.stringify(["base"===t.type?o(t.data):n.insensitiveName(t.data),s])].concat(_toConsumableArray(o(e))).sort()}return t=Object.freeze({forEach:function(t,n){var o=s.call(this,t).each(function(t,s){return n(e(s),t)});return t.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),o},hooks:function(e){return s.call(this,e)},get TwineScript_ObjectName(){return"the hook name ".concat(this.TwineScript_ToSource())},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var t="",e=this.selector,s=e.type,e=e.data;return"name"===s?e.match(RegExp("^"+n.anyRealLetter+"+$"))?t+="?"+e:t+="(hooks-named:"+JSON.stringify(e)+")":"string"===s?t+=JSON.stringify(e):"base"===s&&(t+=e.TwineScript_ToSource()+"'s "+c(this.property,"property")),this.next&&(t+=" + "+this.next.TwineScript_ToSource()),t},"TwineScript_+":function(n){for(var t=this.TwineScript_Clone(),e=t;e.next;)e=e.next;return e.next=n,t},TwineScript_is:function(e){return o(this)+""==o(e)+""},TwineScript_GetProperty:function(e){return t.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return t.create(this.selector,this.property,this.next)},create:function(e,n){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||t),{selector:Object.freeze(e),property:n,next:s})},from:function(e){return t.isPrototypeOf(e)||"string"==typeof e||n.impossible("HookSet.from() was given a non-HookSet non-string."),t.isPrototypeOf(e)?e:t.create({type:"string",data:e})}}),t}),e("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset","internaltypes/twineerror"],function(e,d,s,o,h){function r(e){return("string"==typeof e?e:e.map(function(e){return e.text}).join("")).split(/\n/g).reduce(function(n,t,s,e){return e=e.length,n.concat(document.createTextNode(t),s!==e-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])}var n=d.impossible,u=d.transitionIn,c=s.exec,l=Object.assign,i=Object.keys,m=Object.create,s=Object.seal,t=Array.isArray,a={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,innerEnchantments:null,section:null,timestamp:0,output:!1,summary:function(){var e=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","innerEnchantments","enablers","output"].filter(function(t){return hasOwnProperty.call(e,t)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",i(this.loopVars).length&&"loopVars",i(this.data).length&&"data"].filter(Boolean))},create:function(t,e){if(t=l(m(this),{attr:this.attr?this.attr.slice():[],styles:this.styles?this.styles.slice():[],loopVars:this.loopVars||{},data:this.data||{}},t),e)if(e=e.run(t),h.containsError(e))return e;return t},update:function(){var n=this,d=this.section,l=this.newTargets,h=this.transition,f=this.transitionDeferred,m=this.append,e=this.target,s,r,c;"function"==typeof e&&(e=e());function a(e){var s,o,a;t(n.styles)&&0<n.styles.length&&(o=(s=_slicedToArray(n.styles.reduce(function(e,t){return i(t).forEach(function(n){var s=t[n];e[+("function"==typeof s)].push(_defineProperty({},n,s))}),e},[[],[]]),2))[0],a=s[1],o.forEach(function(t){return e.css(t)}),setTimeout(function(){a.forEach(function(t){return e.css(t)})})),n.attr&&n.attr.forEach(function(t){return e.attr(t)}),n.data&&e.data(n.data)}if(t(l)&&l.length&&(e=l.map(function(e){return e.target})),t(e))for(s=0;s<e.length;s+=1)o.isPrototypeOf(e[s])?e[s].forEach(d,a):a(e[s]);else o.isPrototypeOf(e)?e.forEach(d,a):a(e);if(h&&!f&&!m){for(c=e;(r=c.data("timestamp"))||(c=c.parent()),!r&&c.length;);u(e,h,this.transitionTime,this.transitionDelay,this.transitionSkip,r?Date.now()-r:0,this.transitionOrigin)}},render:function(){var b=this,g=this.source,_=this.transition,E=this.transitionTime,C=this.transitionDeferred,x=this.enabled,m=this.enablers,O=this.data,v=this.section,i=this.newTargets,j=this.innerEnchantments,y=this.appendSource,h=this.output,s=this.target,w=this.target,p=this.append,d;if("function"==typeof s&&(s=s()),!p)return n("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),e();if(h)return e();if(m&&m.length){var f=m[0],h=f.descriptor,m=f.changer,f=h.render();return m&&(h=a.create({section:v,target:f}),m.run(h),h.update()),f}if(!x||void 0!==s.attr("hidden"))return a.create({target:s,attr:this.attr.filter(function(e){return!("style"in e)}),data:l({},O,{originalSource:g,hidden:!0})}).update(),e();if(!(s=t(i)&&i.length?i:s))return n("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),e();if(d=e(),[].concat(s).filter(function(e){return!e.jquery}).map(function(e){var t,n,s=p;return e.target&&e.append&&(s=(t=e).append,n=t.before,e=e.target),{elements:e.hooks(v,w).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(w[0]))}),append:s}},[]).forEach(function(t){var n=t.elements,s=t.append;n.each(function(n,t){t=e(t),d=d.add(b.create({target:t,append:s,newTargets:null}).render()),t.filter("tw-pseudo-hook").contents().unwrap()})}),d.length||t(s)||o.isPrototypeOf(s))return d;if(i=p,!(i in s)){if("replace"!==i)return n("ChangeDescriptor.render","The target doesn't have a '"+i+"' method."),e();i=s[0]instanceof Text?"replaceWith":(s.empty(),"append")}return s[0]instanceof Text&&"prepend"===(i="append"===i?"after":i)&&(i="before"),d=e(g&&(this.verbatim?r:c)(g)),t(y)&&y.forEach(function(t){var n=t.source,t=t.append,n=e((b.verbatim?r:c)(n));d="append"===t?d.add(n):"prepend"===t?n.add(d):n}),s[i](d.length?d:void 0),s.data("timestamp",Date.now()),this.update(),_&&!C&&u("replace"===p?s:d,_,E,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),j&&j.map(function(e){return e(s)}).forEach(function(e){return v.addEnchantment(e)}),d}};return s(a)}),e("datatypes/customcommand",["internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t){var n=Object.assign,s=Object.create;return Object.seal({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},create:function(i){var r,h=i.toSource,l=i.changer,d=i.hook,u=i.variables,a={},o,c;for(r in u)a[r]=[u[r]];return o=e.create({source:d,loopVars:a},l),t.containsError(o)?o:(c=n(s(this),{TwineScript_Attach:function(n,e){return o.section=n,e=e.run(o),t.containsError(e)?e:c},TwineScript_Run:function(t){return o.section=t,t=o,o=e.create({source:d,loopVars:a},l),t},TwineScript_ToSource:function(){return h},TwineScript_CustomCommand:function(){return i}}),c)}})}),e("state",["jquery","utils","passages","datatypes/customcommand","utils/operationutils","markup"],function(E,f,j,k,C,l){var o=C.toSource,x=C.is,h=l.lex,y=Object.assign,a=Object.create,l=Object.defineProperty,b=Array.isArray,c=Math.imul,e,p;l(Map.prototype,"toJSON",{value:void 0}),l(Set.prototype,"toJSON",{value:void 0}),l=["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}});function v(a,n){var s=0<arguments.length&&void 0!==a?a:String.fromCodePoint(Date.now()%1114112),n=1<arguments.length&&void 0!==n?n:0,o,i,t;e.seedIter=n,e.seed=s;for(i=0,t=2166136261;i<s.length;i+=1)o=c(s.charCodeAt(i),3432918353),t^=c(o<<15|o>>>17,461845907),t=c(t=t<<13|t>>>19,5)+3864292196|0;return t^=s.length,t=c(t^=t>>>16,2246822507),t=c(t^=t>>>13,3266489909),t=((t^=t>>>16)>>>0)+1831565813*n,function(){e.seedIter+=1;var n=t+=1831565813,n=c(n^n>>>15,1|n);return(((n^=n+c(n^n>>>7,61|n))^n>>>14)>>>0)/4294967296}}function O(r,e){for(var u,s=e.variables,m=a(null),o=r.length-1,i,l,f;0<=o;--o){for(var t,c,n=r[o],d=0,h=["mockVisits","mockTurns","seed","seedIter"];d<h.length;d++)i=h[d],hasOwnProperty.call(n,i)&&!hasOwnProperty.call(e,i)&&(e[i]=n[i]);for(t in n.forgetVisits&&(e.forgetVisits=Math.max(e.forgetVisits||0,n.forgetVisits)),void 0!==n.turns&&(e.turns=(e.turns||0)+n.turns),e.pastVisits||(e.pastVisits=[]),o!==r.length-1&&(void 0!==r[o+1].visits&&Array.isArray(e.pastVisits[0])?e.pastVisits[0]:e.pastVisits).unshift(n.passage),void 0!==n.pastVisits&&e.pastVisits.unshift(n.pastVisits),void 0!==n.visits&&e.pastVisits.unshift(n.visits),n.variables)if("TwineScript_TypeDefs"===t)for(l in s[t]||(s[t]=a(null)),n.variables[t])s[t][l]||(s[t][l]=n.variables[t][l]);else t.startsWith("TwineScript_")||t in s||(null===n.variables[t]&&(m[t]=!0),m[t]||(s[t]=n.variables[t],!(c=n.valueRefs[t])||"via"in c||e.valueRefs[t]||(e.valueRefs[t]=c)))}for(u in e.valueRefs)f=e.valueRefs[u],f&&"via"in f&&delete e.valueRefs[u]}var u,r={passage:"",variables:a(null),visits:void 0,turns:void 0,seed:void 0,seedIter:void 0,mockVisits:void 0,mockTurns:void 0,forgetVisits:void 0,create:function(t){var e=a(r);return e.passage=t||"",e.variables=a(null),e.valueRefs=a(null),e}},i={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]},s=[],n=-1,t=r.create(),d="";function _(){e.history=e.pastVisits.slice(e.forgetVisits).reduce(function(e,t){return e.concat(t)},[]),e.mockVisits&&(e.history=e.mockVisits.concat(e.history))}function m(){var i=r.create();i.pastVisits=[],y(i.variables,{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:a(null),TwineScript_VariableStore:"global",TwineScript_Delete:function(e){delete this[e],t.variables[e]=null,delete t.valueRefs[e]},TwineScript_Set:function(i,e,c){if(this[i]=e,t.variables[i]=e,c)t.valueRefs[i]=c;else if(b(e)||e instanceof Map||e instanceof Set||"string"==typeof e)for(var r=n,a;0<=r;--r)if(a=s[r].variables[i],void 0!==a){a=function y(n,e,s){if(l="it"===s?"its":s+"'s",t="",b(e)&&b(n)&&e.length){for(var l,A=e.length===n.length,t="(a:",a=0,r,i,u,C,O,f,E,k,p,S;a<e.length;a+=1)u=e[a],x(u,n[a])?(i=o(u),r="".concat(l," ").concat(a+1,"th"),t+=(i.length<r.length?i:r)+","):(A=!1,-1<(i=n.indexOf(u))?(r=o(u),i="".concat(l," ").concat(i+1,"th"),t+=(r.length<i.length?r:i)+","):t+=y(n[a],u,"".concat(l," ").concat(a+1,"th"))+",");t=A?s:t.slice(0,-1)+")"}else if(e instanceof Map&&n instanceof Map&&e.size){C=e.size===n.size,t="(dm:",f=_createForOfIteratorHelper(e.entries());try{for(f.s();!(O=f.n()).done;){var g,v,w=_slicedToArray(O.value,2),h=w[0],j=w[1];t+="".concat(o(h),","),x(j,n.get(h))?(g=o(j),v="".concat(l," (").concat(o(h),")"),t+=(g.length<v.length?g:v)+","):(C=!1,t+=y(n.get(h),j,"".concat(l," (").concat(o(h),")"))+",")}}catch(e){f.e(e)}finally{f.f()}t=C?s:t.slice(0,-1)+")"}else if(e instanceof Set&&n instanceof Set&&e.size){var _,d=new Set,c=new Set,m=_createForOfIteratorHelper(n);try{for(m.s();!(_=m.n()).done;)E=_.value,e.has(E)||d.add(E)}catch(e){m.e(e)}finally{m.f()}p=_createForOfIteratorHelper(e);try{for(p.s();!(k=p.n()).done;)S=k.value,n.has(S)||c.add(S)}catch(e){p.e(e)}finally{p.f()}d.size||c.size||(t=s),t=d.size+c.size>e.size?o(e):s+(c.size?"+"+o(c):"")+(d.size?"-"+o(d):"")}else"string"==typeof e&&"string"==typeof n&&e&&(e.startsWith(n)?t=s+"+"+o(e.slice(n.length)):e.endsWith(n)&&(t=o(e.slice(0,e.length-n.length))+"+"+s));return t?"it"===s?{via:t}:t:"it"===s?void 0:o(e)}(a,e,"it"),a&&("it"===a.via?delete t.variables[i]:t.valueRefs[i]=a);break}},TwineScript_GetProperty:function(e){return this[e]},TwineScript_DefineType:function(e,n){this.TwineScript_TypeDefs[e]=n,hasOwnProperty.call(t.variables,"TwineScript_TypeDefs")||(t.variables.TwineScript_TypeDefs=a(null)),t.variables.TwineScript_TypeDefs[e]=n}}),O(s.slice(0,n+1),i),e=i,_(),p=v(i.seed,i.seedIter)}function g(e){t=r.create(e),e=u.serialise(!0),d=e.past,function(e){if(u.hasSessionStorage&&"string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){return}}(e.pastAndPresent)}function w(n,o,c,t){for(e in t)if(hasOwnProperty.call(t,e)&&!e.startsWith("TwineScript_"))if("object"===_typeof(t[e]))if(hasOwnProperty.call(t[e],"at")){c.valueRefs[e]=t[e];var e,s=t[e],r=s.at,u=s.from,i=s.to,l=s.seed,d=s.seedIter,s=s.blockedValues,r=j.get(r).get("source"),i=h(r.slice(u,i),"","macro"),a;void 0!==l&&void 0!==d&&(p=v(l,d)),void 0!==s&&(n.stackTop.blockedValues=s,i.forEach(function n(e){var t;"string"!==e.type&&"hook"!==e.type&&e.children.every(n),"macro"===e.type&&("prompt"!==(t=f.insensitiveName(e.name))&&"confirm"!==t||(e.blockedValue=!0))})),t[e]=n.eval(i)}else if(hasOwnProperty.call(t[e],"via")){for(a=o.length-1;0<=a;--a)if(hasOwnProperty.call(o[a].variables,e)){n.Identifiers.it=o[a].variables[e];break}t[e]=n.eval(h(t[e].via,"","macro")),n.Identifiers.it=0}else hasOwnProperty.call(t[e],"changer")&&(t[e].changer=n.eval(h(t[e].changer,"","macro")),t[e].hook=n.eval(h(t[e].hook,"","macro")),w(n,o,c,t[e].variables),t[e]=k.create(t[e]));else t[e]=n.eval(h(t[e],"","macro"));else"TwineScript_MockVisits"===e&&(c.mockVisits=t[e])}return m(),t.seed=e.seed,t.seedIter=0,(u={get passage(){return t.passage},get variables(){return e.variables},get pastLength(){return n},get turns(){return n+1+(e.turns||0)+(e.mockTurns||0)},get futureLength(){return s.length-1-n},get mockVisits(){return e.mockVisits||[]},set mockVisits(n){e.mockVisits=n,t.mockVisits=n,_()},get mockTurns(){return e.mockTurns||0},set mockTurns(n){e.mockTurns=n,t.mockTurns=n},history:function(){return e.history},forgetUndos:function(t){t<0&&(t=s.length+t);var o=s.splice(0,Math.min(s.length-1,t));o.length&&(n=s.length-1,t=s[0],O(o,t),t.pastVisits.push(o[o.length-1].passage),t.turns=(t.turns||0)+o.length,e.turns=(e.turns||0)+o.length,t.forgetVisits&&(t.pastVisits=t.pastVisits.slice(t.forgetVisits-t.turns),t.forgetVisits-=t.turns),d="",0===n&&E("tw-link[undo], tw-icon[alt='Undo']",f.storyElement).each(function(t,e){(E(e).closest("tw-expression, tw-hook").data("forgetUndosEvent")||Object)(e)}),i.forgetUndos.forEach(function(e){return e()}))},forgetVisits:function(o){(o=o<0?s.length+o:o)>n+e.turns&&(o=n+e.turns),t.forgetVisits=e.forgetVisits=Math.max(e.forgetVisits||0,o),_()},passageNameVisited:function(n){var s=0,t;if(!j.get(n))return 0;for(t=0;t<e.history.length;t++)s+=+(n===e.history[t]);return s},get timeline(){return s},play:function(o){t||f.impossible("State.play","present is undefined!"),i.beforeForward.forEach(function(e){return e()}),t.passage&&((t.visits&&t.visits.length&&Array.isArray(e.pastVisits[e.pastVisits.length-1])?e.pastVisits[e.pastVisits.length-1]:e.pastVisits).push(t.passage),e.history.push(t.passage)),t.passage=o,s=s.slice(0,n+1).concat(t),n+=1,g(o),i.forward.forEach(function(e){return e(o)})},redirect:function(n){t||f.impossible("State.redirect","present is undefined!"),t.passage&&(t.visits&&t.visits.length&&Array.isArray(e.pastVisits[e.pastVisits.length-1])?e.pastVisits[e.pastVisits.length-1].push(t.passage):e.pastVisits.push([t.passage]),e.history.push(t.passage)),t.visits=(t.visits||[]).concat(n),t.passage=n},rewind:function(t){for(var o=void 0!==t?t:1,e=!1;0<o&&0<n;o--)e=!0,--n;return e&&(i.beforeBack.forEach(function(e){return e()}),d="",g(s[n].passage),m(),i.back.forEach(function(e){return e()})),e},fastForward:function(o){var e=1,t=!1;for("number"==typeof o&&(e=o);0<e&&0<s.length;e--)t=!0,n+=1;return t&&(i.beforeForward.forEach(function(e){return e()}),g(s[n].passage),m(),i.forward.forEach(function(e){return e(s[n].passage,"fastForward")})),t},on:function(e,t){if(e in i)return"function"!=typeof t||i[e].includes(t)||i[e].push(t),u;f.impossible("State.on","invalid event name")},reset:function(){i.beforeLoad.forEach(function(e){return e()}),s=[],n=-1,m(),(t=r.create()).seed=e.seed,t.seedIter=0,d="",p=v(),i.load.forEach(function(e){return e(s)})},hasStorage:l[0],hasSessionStorage:l[1],setSeed:function(n){p=v(n),t.seed=e.seed,t.seedIter=0},get seed(){return e.seed},get seedIter(){return e.seedIter},random:function(){var n=p();return t.seedIter=e.seedIter,n},shuffled:function(){for(var i=this,s=arguments.length,o=new Array(s),n=0,a;n<s;n++)o[n]=arguments[n];return a=o.reduce(function(e,n,s){var t=i.random()*(s+1)|0;return t===s?e.push(n):(e.push(e[t]),e[t]=n),e},[]),t.seedIter=e.seedIter,a}}).serialise=function(e){function t(n,e){if("TwineScript_TypeDefs"===e){var i,a={},s;for(i in n[e])a[i]=o(n[e][i]);return a}return null===n[e]?null:n[e]&&hasOwnProperty.call(n[e],"TwineScript_CustomCommand")?(s=n[e].TwineScript_CustomCommand(),{changer:o(s.changer),toSource:s.toSource,hook:o(s.hook),variables:Object.keys(s.variables).reduce(function(e,n){return e[n]=t(s.variables,n),e},{})}):o(n[e])}function i(o,e){if(r.isPrototypeOf(e)&&void 0===e.visits&&void 0===e.turns&&void 0===e.mockVisits&&void 0===e.forgetVisits&&void 0===e.pastVisits&&void 0===e.mockTurns&&void 0===e.seed&&void 0===e.seedIter&&Object.keys(e.variables).every(function(e){return e.startsWith("TwineScript_")}))return e.passage;if(!r.isPrototypeOf(this)||"valueRefs"!==o){if(r.isPrototypeOf(this)&&"variables"===o){var n,s={};for(n in this.variables)this.valueRefs[n]?s[n]=this.valueRefs[n]:s[n]=t(this.variables,n);return s}return e}}var a=s.slice(d?e?n-1:n:0,n+1),c=a.slice(0,-1),e=d;try{return{past:e=c.length?(e?e.slice(0,-1)+",":"[")+JSON.stringify(c,i).slice(1):e,pastAndPresent:e.slice(0,-1)+(e?",":"[")+JSON.stringify(a.slice(-1),i).slice(1)}}catch(e){return{past:!1,pastAndPresent:!1}}},u.deserialise=function(c,l){try{t=JSON.parse(l)}catch(e){return Error("The save data is unintelligible.")}if(!b(t))return Error("The save data isn't a sequence of past turns.");for(var t,o=0,e;o<t.length;o+=1){if(e=t[o],"string"==typeof e)e={passage:e,variables:{}};else if("object"!==_typeof(e)||!hasOwnProperty.call(e,"variables")){t.splice(o--,1);continue}if(e.valueRefs=a(null),e.variables=y(a(null),e.variables),!j.hasValid(e.passage))return Error("The data refers to a passage named '".concat(e.passage,"', but it isn't in this story."));if(hasOwnProperty.call(e.variables,"TwineScript_TypeDefs"))try{w(c,t.slice(0,o),e,e.variables.TwineScript_TypeDefs)}catch(e){return Error("The variable types on turn ".concat(o+1," couldn't be reconstructed."))}try{w(c,t.slice(0,o),e,e.variables)}catch(e){return Error("The variables on turn ".concat(o+1," couldn't be reconstructed."))}t[o]=y(a(r),e)}return n=(s=t).length-1,i.load.forEach(function(e){return e(s)}),d="",m(),g(s[n].passage),!0},Object.seal(r),Object.freeze(u)}),e("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(n,s,c,l){var a=n.plural,r=n.impossible,o=s.is,i=s.toSource,e={},t={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(i))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},get TwineScript_ObjectName(){1===this.params.length&&36<(s=i(this.params[0])).length&&(s=void 0);var s,t="a (".concat(this.macroName,":").concat(s||"",") changer"),e=this.next,o,r,n;e&&(t+=" combined with ");for(o=0;e&&t.length<48;)r="(".concat(e.macroName,":)"),t+=(0<o&&!e.next?" and ":"")+r+(e.next?", ":""),e=e.next,o+=1;for(n=0;e&&n<99;)e=e.next,n+=1;return 0<n&&(t+="".concat(0<o?" and ":"").concat(a(n,"other changer"))),t},summary:function(){var e=c.create();return this.run(e),e.summary()},create:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,s=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return Array.isArray(e)||r("ChangerCommand.create","params was not an array but "+e),Object.assign(Object.create(this),{macroName:t,params:e,next:n,canEnchant:s})},"TwineScript_+":function(n){for(var t=this.TwineScript_Clone(),e=t;e.next;)e=e.next;return e.next=n,t.canEnchant=this.canEnchant&&n.canEnchant,t},TwineScript_is:function(e){if(t.isPrototypeOf(e))return this.macroName===e.macroName&&o(this.params,e.params)&&o(this.next,e.next)},TwineScript_Clone:function(){for(var n=t.create(this.macroName,this.params,this.next),e=n;e.next;)e=e.next=e.next.TwineScript_Clone();return n.canEnchant=this.canEnchant,n},run:function(n,s){var t="output"===this.macroName?[s||this]:this.params,t=e[this.macroName].apply(e,[n].concat(_toConsumableArray(t)));if(l.containsError(t))return t;this.next&&this.next.run(n,s||this)},register:function(t,n){e[t]=n}};return Object.freeze(t)}),e("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(l,e,y,n,o){var d,D=y.impossible,m=y.andList,z=y.nth,T=n.is,F=n.isObject,i=n.toSource,r=n.isSequential,t=n.objectName,v=n.typeName,g=n.clone,M=n.isValidDatamapName,A=n.subset,N=n.collectionType,E=n.unstorableValue,C=n.matches,s=Array.isArray,u={set:[],delete:[]},p="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), ",O="You can't access the '0th' or '0thlast' position of ",k,f;function _(a,n){if(e.containsError(n))return u;if(a instanceof Map&&(u=e.containsError(M(a,n))))return u;if(r(a)){if("number"==typeof n){if(0===n)return e.create("property","You can't access elements at position 0 of ".concat(t(a),"."),"Only positive and negative position values exist.");0<n&&--n}else if("string"==typeof n&&(d=/^(\d+)(?:st|[nr]d|th)last$/i.exec(n))){if("0"===d[1])return e.create("property",O+t(a)+".");n=-d[1]}else if("string"==typeof n&&(d=/^(\d+)(?:st|[nr]d|th)$/i.exec(n))){if("0"===d[1])return e.create("property",O+t(a)+".");n=d[1]-1}else if("string"==typeof n&&(d=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(n))){var h=_slicedToArray(d,5),c=h[1],u=void 0===c?0:c,d=h[2],c=h[3],c=void 0===c?0:c;n={last:c=h[4]?-c:c-1,first:u=d?-u:u-1}}else if("last"===n)n=-1;else if("random"===n){if(!a.length)return e.create("property","I can't get a random value from ".concat(t(a),", because it's empty."));n=l.random()*Array.from(a).length|0}else{if(o.isPrototypeOf(a)&&!o.TwineScript_Properties.includes(n))return e.create("property","".concat(p+m(o.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(t(a),", not ").concat(("string"==typeof n?i:t)(n),"."));if(!["length","some","any","all","start","end","random"].includes(n)&&!o.isPrototypeOf(a))return e.create("property","".concat(p,"'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ").concat(t(a),", not ").concat(("string"==typeof n?i:t)(n),"."))}}else if(a instanceof Set){if(!["length","some","any","all"].includes(n))return e.create("property","".concat(p,"'length', 'some', 'any', and 'all' of ").concat(t(a),"."),"You can't access specific individual data values from datasets.");"length"===n&&(n="size")}else{if(s(a.TwineScript_Properties)&&!a.TwineScript_Properties.includes(n))return e.create("property","You can only get the ".concat(m(a.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(t(a),", not ").concat(("string"==typeof n?i:t)(n),"."));if("number"==typeof a||"boolean"==typeof a)return e.create("property","You can't get any data values, let alone ".concat(t(n),", from ").concat(t(a)))}return n}function h(t,e){return+e<0&&Math.abs(e)<=t.length?t.length+ +e:e}k=/[^\x0000-\xFFFF]/,f=new Map;function S(e,n){if(void 0===e)return e;if(e instanceof Map)return e.get(n);if(("some"===n||"any"===n||"all"===n||"start"===n||"end"===n)&&!e.TwineScript_VariableStoreName)return s=e,a=n,o='"'.concat(a," value").concat("any"===a?"":"s",'" of '),{determiner:a,determined:s,array:_toConsumableArray(s),string:"string"==typeof s&&s,TwineScript_ObjectName:o+t(s),TwineScript_ToSource:function(){return"".concat(a," of ").concat(i(s))},TwineScript_TypeName:o+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}};var s,a,o;return"string"==typeof e&&(f.has(e)?e=f.get(e):k.test(e)?(o=_toConsumableArray(e),f.set(e,o),e=o):f.set(e,e)),r(e)&&Number.isFinite(n)&&(n=h(e,n)),e.TwineScript_GetProperty?e.TwineScript_GetProperty(n):(n=e[n],"function"!=typeof n?n:void 0)}function c(t){if(t.computed){var e=t.value;return"string"==typeof(e=d.isPrototypeOf(e)?e.get():e)?"('"+e+"')":"("+e+")"}return"number"==typeof t?z(t):"'"+t+"'"}function b(a,n,u){if(a.TwineScript_VariableStore){if(a.TwineScript_TypeDefs&&n in a.TwineScript_TypeDefs){var d=a.TwineScript_TypeDefs[n];if("const"===d.name){if(void 0!==a[n])return e.create("operation","I can't alter ".concat(a===l.variables?"$":"_").concat(n," because it's been restricted to a constant value."),"This variable can't be changed for the rest of the story.")}else if(!C(d,u))return e.create("operation","I can't set ".concat(a===l.variables?"$":"_").concat(n," to ").concat(v(u)," because it's been restricted to ").concat(i(d),"-type data."),"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return s(n)?n.map(function(e){return b(a,e)}):a instanceof Map?"string"==typeof n||e.create("operation","".concat(t(a)," can only have string data names, not ").concat(t(n),".")):r(a)?["length","random","some","any","all","start","end"].includes(n)?e.create("operation","I can't forcibly alter the '"+n+"' of "+t(a)+".","start"===n||"end"===n?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+n+"'.":void 0):+n==(0|n)||e.create("property",t(a)+" can only have position keys ('3rd', '1st', (5), etc.), not "+c(n)+"."):a.TwineScript_Identifiers&&n in a?e.create("keyword","I can't alter the value of the '"+n+"' identifier.","You can only alter data in variables, not fixed identifiers."):e.create("operation","I can't modify "+t(a),a instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":o.isPrototypeOf(a)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function j(e,t,n,s){var o=t;e instanceof Map?e.set(t,n):(r(e)&&(t=h(e,t)),e.TwineScript_Set?e.TwineScript_Set(t,n,s):e[t]=n),u.set.forEach(function(t){return t(e,o,n)})}function w(e,t){var n=t;r(e)&&(t=h(e,t)),s(e)&&/^(?:[1-9]\d*|0)$/.exec(t)?e.splice(t,1):e instanceof Map||e instanceof Set?e.delete(t):e.TwineScript_Delete?e.TwineScript_Delete(t):delete e[t],u.delete.forEach(function(t){return t(e,n)})}function a(n,i){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:i,h=3<arguments.length&&void 0!==arguments[3]&&arguments[3],u,r;return i&&"object"===_typeof(i)&&"last"in i&&"first"in i?o.isPrototypeOf(n)?n.TwineScript_GetProperty(i):(u=i.first,r=i.last,A(n,u+(0<=u),r+(0<=r))):s(i)?o.isPrototypeOf(n)?n.TwineScript_GetProperty(i):i.map(function(e){return a(n,e,e)})["string"==typeof n?"join":"valueOf"](""):(r=S(n,i),void 0!==r||h)?r:n===l.variables?0:n.TwineScript_VariableStore?e.create("property","There isn't a temp variable named _".concat(d," in this place."),"Temp variables only exist inside the same passage, hook, or lambda in which they're created."):s(n)&&"number"==typeof i?e.create("property","This array of ".concat(n.length," elements doesn't have a ").concat(c(d+("number"==typeof d?1:""))," element."),n.length?"It contains: ".concat(m(n.map(t)),"."):"The array is empty."):(i=Array.from("function"==typeof n.keys&&n.keys()),e.create("property","I can't find a ".concat(c(d)," data name in ").concat(t(n)),n instanceof Map&&i.length?"Its names include: ".concat(m(i),"."):void 0))}function x(n,t){var s=this,t=this.compiledPropertyChain.reduce(function(e,t){var n=0===e.length?s.object:a.apply(void 0,_toConsumableArray(e[e.length-1]));return e.push([n,t])&&e},[]).reduceRight(n,t);return e.containsError(t)?t:void 0}return d=Object.freeze({get:function(){for(var t=this.object,n=0;n<this.compiledPropertyChain.length-1;n+=1)if(t=a(t,this.compiledPropertyChain[n]),e.containsError(t))return t;return a(t,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},has:function(){for(var t=this.object,n=0;n<this.compiledPropertyChain.length-1;n+=1)if(void 0===(t=a(t,this.compiledPropertyChain[n],void 0,!0))||e.containsError(t))return!1;return void 0!==a(t,this.compiledPropertyChain.slice(-1)[0],void 0,!0)},set:function(o,n){var a=this;return!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?x.call(this,function(o,u,m){var u=_slicedToArray(u,2),c=u[0],d=u[1],h,f;if(u=e.containsError(o,c,d)||e.containsError(b(c,d,o)))return u;if(u=E(o))return e.create("operation","".concat(t(o)," can't be stored").concat(!o.TwineScript_Unstorable&&N(o)?" because it holds ".concat(t(u)):"","."));if(0<m)c=g(c);else if(c.TwineScript_VariableStore&&c!==l.variables){for(h=c;h.TwineScript_VariableStore&&!hasOwnProperty.call(h,d);)h=Object.getPrototypeOf(h);h.TwineScript_VariableStore&&(c=h)}if("string"==typeof c){if("string"!=typeof o)return e.create("datatype","I can't put this non-string value, ".concat(t(o),", in a string."));if(o.length!==(s(d)?d.length:1))return e.create("datatype","".concat(t(o),"is not the right length to fit into this string location."));c=_toConsumableArray(c),f=_toConsumableArray(o),[].concat(d).forEach(function(e){0+e<0&&(e=c.length+(0+e)),c=[].concat(_toConsumableArray(c.slice(0,e)),[f.shift()],_toConsumableArray(c.slice(e+1)))}),c=c.join("")}else F(c)&&(void 0!==o.TwineScript_KnownName&&((o=""!==o.TwineScript_KnownName?g(o):o).TwineScript_KnownName=i(a)),s(d)&&r(o)?("string"==typeof o&&(o=_toConsumableArray(o)),d.map(function(e,t){return[e,o[t]]}).forEach(function(t){var e=_slicedToArray(t,2),t=e[0],e=e[1];return j(c,t,e,n)})):j(c,d,o,n));return c},o):e.create("macrocall","I can't (set:) ".concat(t(this),", if the ").concat((t(this.object).match(/ (.+$)/)||["","value"])[1]," isn't stored in a variable."),"Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return x.call(this,function(i,n,a){var o=_slicedToArray(n,2),t=o[0],n=o[1];return(o=e.containsError(i,t,n)||e.containsError(b(t,n)))||(0<a&&(t=g(t)),null===i?((a="string"==typeof t)&&(t=_toConsumableArray(t)),s(n)?(r(t)&&(n=_toConsumableArray(new Set(n))).sort(function(e,n){return h(t,n)-h(t,e)}),n.forEach(function(e){return w(t,e)})):w(t,n),a&&(t=t.join(""))):j(t,n,i,!1),t)},null)},defineType:function(s){var n=this.object,o=this.compiledPropertyChain[0],a,i;if(hasOwnProperty.call(n,"TwineScript_TypeDefs")||(n.TwineScript_TypeDefs=Object.create(n.TwineScript_TypeDefs||null)),a=n.TwineScript_TypeDefs,i=a[o],i&&!T(i,s))return e.create("operation","I can't redefine the type of "+t(this)+" to "+(s.TwineScript_ObjectName||v(s))+", as it is already "+(i.TwineScript_ObjectName||v(i))+".");n.TwineScript_DefineType?n.TwineScript_DefineType(o,s):a[o]=s,"const"===s.name&&(n[o]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(t,n){if(o=e.containsError(t))return o;Array.isArray(n)||(n=[].concat(n)),d.isPrototypeOf(t)&&(n=t.propertyChain.concat(n),t=t.object);var o,i=function(n,r){for(var c,l=[],i=0,t,u,o;i<r.length;i+=1){if(t=r[i],t.computed&&(t=t.value),d.isPrototypeOf(t)&&(t=t.get()),s(t)){for(u=[],o=0;o<t.length;o+=1)u[o]=_(n,t[o]);t=u}else t=_(n,t);if(c=e.containsError(t))return c;i<r.length-1&&(n=a(n,t)),l.push(t)}return l}(t,n);return(o=e.containsError(i))||Object.assign(Object.create(d),{object:t,propertyChain:n,compiledPropertyChain:i})},TwineScript_ToSource:function(){function e(e,n){return!n&&t.object.TwineScript_VariableStore?e:c(e)}var t=this;return(this.object===l.variables?"$":this.object.TwineScript_VariableStore?"_":i(this.object)+"'s ")+(1===this.propertyChain.length?e(this.propertyChain[0]):this.propertyChain.reduce(function(t,n,s){return t+"'s "+e(n,s)}))},get TwineScript_ObjectName(){return this.object.TwineScript_VariableStore?"the ".concat(this.object.TwineScript_VariableStoreName?"temp ":"","variable ").concat(this.TwineScript_ToSource()):t(this.object)+"'s "+(1===this.propertyChain.length?c(this.propertyChain[0]):this.propertyChain.reduce(function(e,t){return e+"'s "+c(t)}))},on:function(e,t){if(e in u)return"function"!=typeof t||u[e].includes(t)||u[e].push(t),d;D("VarRef.on","invalid event name")}})}),e("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:!0,TwineScript_TypeDefs:Object.create(null)})}),e("internaltypes/twinenotifier",["jquery","utils"],function(t,n){var s=n.impossible,e={create:function(t){return t||s("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(e),{message:t})},render:function(){return t("<tw-notifier>").attr("message",this.message)}};return Object.preventExtensions(e)}),e("datatypes/custommacro",["jquery","utils","renderer","utils/operationutils","datatypes/customcommand","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(v,g,p,s,f,a,u,o,l){function c(n){return function(c){n.called+=1;for(var A=n.varNames,m=n.params,g=n.body,d=t(e(u),{TwineScript_VariableStoreName:n.TwineScript_ObjectName+" call #"+n.called,TwineScript_TypeDefs:e(null)}),k=[],s=0,x=arguments.length,j=new Array(1<x?x-1:0),O=1,w,C,y,_,E,h,b,S;O<x;O++)j[O-1]=arguments[O];for(w=0;w<j.length;w+=1){if(C=j[w],y=A[s],d.TwineScript_TypeDefs[y]=m[s].datatype.rest?m[s].datatype.create("array"):m[s].datatype,_=a.create(d,y),o.containsError(_))return _;if(m[s].datatype.rest){if(E=(d[y]||[]).concat([C]),w<j.length-1){d[y]=E;continue}_.set(E)}else _.set(C),s+=1;k.push(l.create(r(_)+" is now "+r(d[y])))}if(j.length&&(s+=1),m[s]&&m[s].datatype.rest){if(h=a.create(d,A[s]),o.containsError(h))return h;h.set([]),d.TwineScript_TypeDefs[name]=m[s].datatype.create("array")}h=v("<p>").append(p.exec(g.code)),S=c.stack.length,c.stack.unshift({tempVariables:d,dom:h,output:function(e){b=e}}),g=c.evalReplay;for(c.evalReplay=null,c.execute();c.stack.length>S;)c.stack.shift();return c.evalReplay=g,g=h.find("tw-error"),g.length?(h.prepend(k.map(function(e){return e.render()}),"<br>"),o.create("propagated","".concat(g.length," error").concat(1<g.length?"s":""," occurred when running ").concat(n.TwineScript_ObjectName,"."),void 0,h)):void 0===b?o.create("custommacro","".concat(n.TwineScript_ObjectName," didn't output any data or hooks using (output:) or (output-data:).")):"object"===_typeof(b)&&"changer"in b?f.create(t(b,{toSource:"(".concat(n.TwineScript_KnownName||"unnamed",":").concat(j.map(i),")")})):b}}var d=g.andList,r=s.objectName,h=s.typeName,m=s.matches,i=s.toSource,t=Object.assign,e=Object.create,n=Object.seal({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",TwineScript_GetProperty:function(e){if("params"===e)return _toConsumableArray(this.params)},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){var s=t(e(n),this);return s.fn=c(s),s},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},createFromFn:function(s,o,i,a){return t(e(n),{params:[],fn:s,typeSignature:a,TwineScript_ObjectName:o,TwineScript_ToSource:i,TwineScript_KnownName:""})},create:function(s,o){return s=t(e(n),{params:s,called:0,varNames:s.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:s.map(function(e){var t=e.datatype.toTypeSignatureObject?e.datatype.toTypeSignatureObject({rest:e.rest}):{pattern:"range",range:function(t){return m(e.datatype,t)},name:h(e.datatype)};return e.rest?{pattern:"zero or more",innerType:t}:t}),body:o,TwineScript_KnownName:"",TwineScript_ObjectName:"a custom macro (with ".concat(s.length?d(s.map(i)):"no params",")")}),s.fn=c(s),s}});return n}),e("datatypes/lambda",["utils","utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(a,o,s,i,e){a.nth;var n=o.objectName,t=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("each"in this?"each ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return{pattern:"lambda",innerType:t,clauses:n,typeName:'a "'+n.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(t),this)},create:function(o,r,c,u){var a,l="temp variable, or typed temp variable";function d(e){return e=e&&e.varRef?e.varRef:e,void 0===e||e&&i.isPrototypeOf(e)&&s.isPrototypeOf(e.object)&&1===e.propertyChain.length}if(e.containsError(c))return c;if("making"===r&&!d(c))return e.create("syntax","I need a "+l+", to the right of '"+r+"', not "+n(c)+".");if(e.containsError(o))return o;if(t.isPrototypeOf(o)){if("when"===r||"when"in o)return e.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+r+"'.");if(r in o)return e.create("syntax","This lambda has two '"+r+"' clauses.");a=o}else{if("when"===r&&void 0!==o)return e.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!d(o))return e.create("syntax","This lambda needs to start with a single "+l+", not "+n(o)+".");(a=Object.create(this)).loop=o||""}return a.source=u.trim(),a[r]=c,a.making&&a.making.getName()===(a.loop&&a.loop.getName())?e.create("syntax","This lambda has two variables named '"+a.loop.getName()+"'.","Lambdas should have all-unique parameter names."):a},apply:function(t,o){var r=o.loop,v=o.pos,f=o.making,m=o.ignoreVia,u,a;function g(t,o){if(t){if("datatype"in t&&"varRef"in t){var s=t.varRef.create(u,t.varRef.propertyChain),n;return e.containsError(s)?s:(n=s.defineType(t.datatype),e.containsError(n)?n:(n=s.set(o),e.containsError(n)?n:void 0))}u[t.getName()]=o}}if(u=(u=o.tempVariables)||Object.create(t.stack.length?t.stackTop.tempVariables:s),a=g(this.loop,r)||g(this.making,f),e.containsError(a))return a;t.stack.unshift(Object.assign(Object.create(t.stackTop||null),{tempVariables:u,lambdaPos:this.when?void 0:v})),!r||this.making||this.when?t.Identifiers.it=e.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName):t.Identifiers.it=r;var l,h,c,d,i=!m&&this.via,p="where"in this||"when"in this,o=t.evalReplay;return t.evalReplay=o?[]:null,p?(l=t.eval(this.where||this.when),h=t.evalReplay,t.evalReplay=h&&i?[]:null,!r||this.making||this.when||(t.Identifiers.it=r),a=l,c=!i||t.eval(i),d=null,c=(m=e.containsError(a))?m:"boolean"!=typeof a?e.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+n(a)+"."):a?c:d):l=c=!i||t.eval(i),d=i?t.evalReplay:null,t.stack.shift(),(t.evalReplay=o)&&(p||i)&&(((t=o[o.length-1])||{}).lambda&&t.lambda.obj===this||((t={lambda:{obj:this,loops:[]},code:(o[o.length-1]||{}).code||""}).fromCode=t.code,o.push(t)),t.lambda.loops.push(Object.assign({it:r,pos:v},void 0!==f&&{making:f},i&&{viaReplay:d,viaResult:c},p&&{whereReplay:h,whereResult:null!==l&&l}))),c},filter:function(s,n){var t,o=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=n.reduce(function(a,r,n){return(t=e.containsError(a))||(n=o.apply(s,{loop:r,pos:n+1,ignoreVia:!0,tempVariables:i}),(t=e.containsError(n))||a.concat(n?[r]:[]))},[]);return(t=e.containsError(n))||n}});return t}),e("datatypes/codehook",[],function(){var e=Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_ToSource:function(){return this.source},TwineScript_Print:function(){return this.code},TwineScript_toString:function(){return this.source},TwineScript_is:function(t){return e.isPrototypeOf(t)&&this.source===t.source},TwineScript_Clone:function(){return e.create(this.code,this.source)},create:function(e,t){return Object.assign(Object.create(this),{code:e,source:t})}});return e}),e("macros",["utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/twineerror"],function(y,c,d,j,b,v,g,f,e){var i=c.insensitiveName,h=c.nth,s=c.andList,n=d.objectName,m=d.typeName,l=d.toSource,o=Array.isArray,r={},t;function a(e){return e===t.TypeSignature.Any||(o(e.innerType)?e.innerType.some(a):!!e.innerType&&a(e.innerType))}function p(t,_,C,u){var f,x=_.fn,d=_.typeSignature,E=_.returnType,p,j,l,O,r,c,b,w;u=function(r){for(var i,t,c,s=[],a=0;a<r.length;a+=1)a in r&&((i=r[a])&&!0===i.spreader?(t=i.value,(c=e.containsError(t))?s.push(c):o(t)||"string"==typeof t?s.push.apply(s,_toConsumableArray(t)):t instanceof Set?s.push.apply(s,_toConsumableArray(Array.from(t).sort(y("en")))):s.push(e.create("operation","I can't spread out "+n(t)+", because it is not a string, dataset, or array."))):s.push(i));return s}(u),"string"!=typeof t&&(f=t,t=""),w=f?"":"("+(o(t)&&1<t.length?t[0]:t)+":)";for(t=f?f.TwineScript_KnownName?"the custom macro, ".concat(f.TwineScript_KnownName):"an unnamed custom macro":"the ".concat(w," macro"),p=0<d.length?1===d.length&&a(d[0])?1===u.length?"That value can't be given to macros as-is.":"Give only a single value to this macro.":t+" must only be given "+s(d.map(m))+(1<d.length?", in that order":"."):t+" must not be given any data."+(f?"":" Just write "+w),l=0,O=Math.max(u.length,d.length);l<O;l+=1){if(r=d[l],c=u[l],e.containsError(c))return c;if(l>=d.length&&!j)return e.create("datatype",u.length-d.length+" too many values were given to "+t+".",p);if(!(r=r||j).innerType||"rest"!==r.pattern&&"zero or more"!==r.pattern||(j=r.innerType,"rest"===r.pattern&&(r=r.innerType)),!function n(t,e){if(null===e)return void 0===t;var s=_typeof(t),a;if("function"!=typeof e&&e.pattern){if("optional"===e.pattern||"zero or more"===e.pattern)return void 0===t||n(t,e.innerType);if("either"===e.pattern){for(a=0;a<e.innerType.length;a+=1)if(n(t,e.innerType[a]))return!0;return!1}if("lambda"===e.pattern&&n(t,e.innerType))return e.clauses.includes("where")===("where"in t||"each"in t)&&e.clauses.includes("making")==="making"in t&&e.clauses.includes("via")==="via"in t&&e.clauses.includes("with")==="with"in t;if("insensitive set"===e.pattern)return e.innerType.includes(i(t));if("range"===e.pattern)return e.range(t);if("wrapped"===e.pattern)return n(t,e.innerType)}return(void 0===e||void 0!==t)&&("anything"===e.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===e.TwineScript_TypeName&&void 0!==t||(e===String?"string"===s:e===Boolean?"boolean"===s:e===parseInt?"number"===s&&!Number.isNaN(t)&&!(t+"").includes("."):e===Number?"number"===s&&!Number.isNaN(t):e===Array?o(t):e===Map||e===Set?t instanceof e:Object.isPrototypeOf.call(e,t)))}(c,r))return void 0===c?(b=d.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length,e.create("datatype","".concat(t," was given ").concat(u.length?s(u.map(n)):"nothing",", but needs ").concat(b-l," more value").concat(1<b-l?"s":"","."),p)):c&&c.TwineScript_Unstorable&&a(r)?e.create("datatype",t+"'s "+h(l+1)+" value, "+n(c)+", is not valid data for this macro.",p):g.isPrototypeOf(c)&&"Changer"===E?e.create("syntax","Please put this hook outside the parentheses of "+t+", not inside it.","Hooks should appear after a macro"+(f?".":": "+w+"[Some text]")):c&&v.isPrototypeOf(c)&&"lambda"===r.pattern?e.create("datatype",t+"'s "+h(l+1)+" value (a lambda) should have "+s(["where","when","making","via","with"].filter(function(e){return r.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+s(["where","when","making","via","with"].filter(function(e){return e in c}).map(function(e){return"a '"+e+"' clause"}))+"."):"insensitive set"===r.pattern?e.create("datatype",n(c)+" is not a valid name string for "+t+".","Only the following names are recognised (capitalisation and hyphens ignored): "+s(r.innerType)+"."):e.create("datatype","".concat(t,"'s ").concat(h(l+1)," value is ").concat(n(c),", but should be ").concat(m(r),"."),r.message||p)}return x.apply(null,[C].concat(u))}function u(n,s,o,e){var t={fn:o,typeSignature:e=[].concat(e||[]),returnType:s};Object.freeze(t),[].concat(n).forEach(function(e){return Object.defineProperty(r,i(e),{value:t})})}return t={has:function(e){return e=i(e),hasOwnProperty.call(r,e)},get:function(e){return e=i(e),hasOwnProperty.call(r,e)&&r[e]},add:function e(t,n,s,o){return u(t,n,s,o),e},addChanger:function t(e,n,s,i){return u(e,"Changer",n,i),j.register(o(e)?e[0]:e,s),t},addCommand:function r(o,c,i,a){var e,n,t,s,d=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],h=[].concat(o)[0];return u(o,"Command",(e=h,n=c,t=i,s=d,function(){for(var r=arguments.length,o=new Array(1<r?r-1:0),i=1,d,a,c;i<r;i++)o[i-1]=arguments[i];return d=n.apply(void 0,o),d||(a=f.create(),c=Object.assign({TwineScript_TypeID:"command",TwineScript_ObjectName:"a ("+e+":) command",TwineScript_TypeName:"a ("+e+":) command",TwineScript_Print:function(){return"`[A ("+e+":) command]`"},TwineScript_ToSource:function(){return"("+e+":"+o.map(l)+")"},TwineScript_is:function(e){return l(this)===l(e)}},s?{TwineScript_Attach:function(e,t){return a.section=e,t.run(a),c},TwineScript_Run:function(e){return e=t.apply(void 0,[a,e].concat(o)),a=f.create(),e}}:{TwineScript_Run:function(e){return t.apply(void 0,[e].concat(o))}}),c)}),a),r},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return{pattern:"either",innerType:n}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return{pattern:"insensitive set",innerType:n}},numberRange:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:e,max:t,range:function(n){return"number"==typeof n&&!Number.isNaN(n)&&e<=n&&n<=t}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&0<=e&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&1<=e&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(n,s,o){return t.has(n)?p(n,t.get(n),s,o):e.create("macrocall","I can't run the macro '"+n+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(t,s,o){return b.isPrototypeOf(t)?p(t,t,s,o):e.containsError(t)?t:e.create("macrocall","I can't call ".concat(n(t)," because it isn't a custom macro."))}},Object.assign(t.TypeSignature,{positiveNumber:t.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:t.TypeSignature.numberRange(0,1/0),percent:t.TypeSignature.numberRange(0,1)}),Object.freeze(t)}),e("datatypes/typedvar",["utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,c,t){var l=e.typeName,a=e.matches,o=e.toSource,r=e.unstorableValue,e=Object.freeze,s=Object.assign,i=Object.create,n=e({TwineScript_TypeName:"a TypedVar (typed variable name)",get TwineScript_ObjectName(){var e=o(this.datatype);return"the ".concat(e.length<24?e+"-":"","typed variable name, ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return s(i(n),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return o(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return a(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(a,o){if(d=t.containsError(o)||t.containsError(a)||o.error)return d;if(!c.isPrototypeOf(o))return t.create("syntax","The -type syntax must have a variable to its right.");var e=o.object,d=o.compiledPropertyChain;return!e||!e.TwineScript_VariableStore||1!==d.length||!e.TwineScript_TypeDefs?t.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else."):(e=r(a),e&&!n.isPrototypeOf(e)?t.create("syntax","The -type syntax can't have "+l(e)+" to its left."):s(i(this),{datatype:a,varRef:o}))}});return n}),e("datatypes/colour",["jquery"],function(E){var p=Math.max,s=Math.min,_=Math.sin,j=Math.cos,e=Math.pow,c=Math.round,r=Math.floor,y=Math.atan2,w=Math.cbrt,O=Math.sqrt,h=Math.PI,i=Object.assign,m=Object.create,b=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,x=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,u=m(null),n;function t(e,s){for(var r=arguments.length,l=new Array(2<r?r-2:0),i=2,c,n,a,d,o;i<r;i++)l[i-2]=arguments[i];if(0<l.length)return t.apply(void 0,[t(e,s)].concat(l));if(!s)return e;for(c=[],n=0;n<e.length;n++){c[n]=[];for(a=0;a<s[0].length;a++){for(d=0,o=0;o<e[0].length;o++)d+=e[n][o]*s[o][a];c[n][a]=d}}return c}function l(e){var i,a=e.r,t=e.g,n=e.b,d=e.a,o=p(a/=255,t/=255,n/=255),r=s(a,t,n),e=(o+r)/2,l=o-r;if(o===r)return{h:0,s:0,l:e};switch(o){case a:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-a)/l+2;break;case n:i=(a-t)/l+4}return{h:i=c(60*i),s:.5<e?l/(2-o-r):l/(o+r),l:e,a:d}}var f=[.9642956764295677,1,.8251046025104602],o=24389/27,a=216/24389,v=function(e){return e.map(function(e){return[e]})},g=function(e){return e.map(function(e){return e[0]})};function d(i){var c=i.l,r=i.c,n=i.h,i=i.a,r=[c*=100,r*j(n*h/180),r*_(n*h/180)],n=[];return n[1]=(r[0]+16)/116,n[0]=r[1]/500+n[1],n[2]=n[1]-r[2]/200,n=[e(n[0],3)>a?e(n[0],3):(116*n[0]-16)/o,o*a<c?e((16+c)/116,3):c/o,e(n[2],3)>a?e(n[2],3):(116*n[2]-16)/o].map(function(e,t){return e*f[t]}),n=_slicedToArray(g(t([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],t([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],v(n)))).map(function(t){return s(255,p(0,255*(.0031308<(t=t)?1.055*e(t,1/2.4)-.055:12.92*t)))}),3),{r:n[0],g:n[1],b:n[2],a:i}}function C(e){function o(e){return 1e-5<=t[e]&&t[e]<=255-1e-5}if(t=d(e),Object.keys(t).every(o))return t;var t,n=(e=i({},e)).c,s=0;for(e.c/=2;1e-5<n-s;)t=d(e),Object.keys(t).every(o)?s=e.c:n=e.c,e.c=(n+s)/2;return d(e)}return n=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),e=e.toRGBA();return n.create({r:s(c(.6*(t.r+e.r)),255),g:s(c(.6*(t.g+e.g)),255),b:s(c(.6*(t.b+e.b)),255),a:(t.a+e.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){if(!n.isPrototypeOf(e))return!1;if(e.lcha&&this.lcha)return e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a;var t=this.toRGBA();return(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},TwineScript_Clone:function(){return n.create(this)},toRGBAString:function(){var e=this.toRGBA(),t=e.r,n=e.g,s=e.b,e=e.a;return"rgba(".concat(t,", ").concat(n,", ").concat(s,", ").concat(e,")")},toHSLA:function(){return l(this.toRGBA())},toRGBA:function(){return this.lch?C(i({a:this.a},this.lch)):this},toLCHA:function(){return this.lch?i({a:this.a},this.lch):(c=(r=this).r,n=r.g,s=r.b,r=r.a,s=[116*(n=g(t([[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],t([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],v([c/255,n/255,s/255].map(function(t){return t<.04045?t/12.92:e((t+.055)/1.055,2.4)}))))).map(function(e,t){return e/f[t]}).map(function(e){return a<e?w(e):(o*e+16)/116}))[1]-16,500*(n[0]-n[1]),200*(n[1]-n[2])],n=180*y(s[2],s[1])/h,{l:s[0]/100,c:O(e(s[1],2)+e(s[2],2)),h:0<=n?n:360+n,a:r});var r,c,n,s},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,n.create(t)},TwineScript_GetProperty:function(e){if("lch"===e){var t=this.toLCHA();return new Map([["l",t.l],["c",t.c],["h",t.h]])}return t=this.toRGBA(),"h"===e||"s"===e||"l"===e?l(t)[e]:"r"===e||"g"===e||"b"===e||"a"===e?t[e]:void 0},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){if(0===this.a)return"transparent";var e=!this.lch&&l(this),t;if(1===e.l&&!e.h&&!e.s)return"white";if(0===e.l&&!e.h&&!e.s)return"black";if(.5<=e.l&&e.l<.5334&&0===e.s)return"gray";if(.5===e.l&&.8<=e.s&&e.s<.804)if(t={0:"red",30:"orange",60:"yellow",90:"lime",120:"green",180:"cyan",210:"blue",240:"navy",270:"purple",300:"magenta"}[e.h],t)return t;return"(".concat(this.lch?"lch":"hsl",":").concat(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l]).concat(1!==this.a?","+this.a:"",")")},create:function(e){return"string"==typeof e?this.create((n.isHexString(e)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(b,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(e){if(e in u)return u[e];var t="transparent"===(t=E("<p>").css("background-color",e).css("background-color"))?{r:0,g:0,b:0,a:0}:t.startsWith("rgb")?t.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192};return u[e]=t})(e)):!("h"in e&&"s"in e&&"l"in e)||"r"in e||"g"in e||"b"in e?("a"in e&&"number"==typeof e.a||(e.a=1),"h"in e&&"c"in e&&!("s"in e)&&"l"in e?i(m(this),{a:e.a,lch:{l:e.l,c:e.c,h:e.h}}):i(m(this),e)):this.create(function(e){var i=e.h,s=e.s,t=e.l,c=e.a,o,n;if(0===s)return e=r(255*t),{r:e,g:e,b:e};o=t<.5?t*(1+s):t+s-t*s,n=2*t-o;function a(e){return e<0&&(e+=1),1<e&&--e,e<1/6?n+6*(o-n)*e:e<.5?o:e<2/3?n+(o-n)*(2/3-e)*6:n}return{r:r(255*a((i/=360)+1/3)),g:r(255*a(i)),b:r(255*a(i-1/3)),a:c}}(e))},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(b)||e.slice(1).match(x))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?%?\s*,\s*\d+(?:\.\d+)?%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}}),n}),e("datatypes/gradient",["utils/operationutils"],function(n){var t=n.toSource,e=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var t=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,n){var s=e.colour,e=e.stop;return t.stops[n].stop===e&&t.stops[n].colour.TwineScript_is(s)})},TwineScript_Clone:function(){return e.create(this.angle,_toConsumableArray(this.stops))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(t){return e.create(this.angle,this.stops.map(function(e){return{colour:e.colour,stop:e.stop*t}}))},toLinearGradientString:function(){var e=this;return(this.repeating?"repeating-":"")+"linear-gradient(".concat(this.angle,"deg, ").concat(this.stops.reduce(function(n,t){var s=t.colour,t=t.stop;return n+s.toRGBAString()+" "+t*(e.repeating?1:100)+(e.repeating?"px,":"%,")},"").slice(0,-1),")")}});return e}),e("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","datatypes/codehook","internaltypes/twineerror"],function(e,n,b,v,d,r,g,p,c){var l=e.realWhitespace,j=e.anyRealLetter,u=e.anyCasedLetter,h=e.anyNewline,m=n.objectName,e=Object.assign,n=Object.seal,f=Object.keys,i=Math.floor,a=Math.abs,t={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return t.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(t){var e=this.name,n=this.rest;return!!o[e]&&o[e](t,n)},toTypeSignatureObject:function(){var e=this.name,e={pattern:"range",range:o[e],name:"a "+("dm"===e?"datamap":"ds"===e?"dataset":"num"===e?e+"ber":"str"===e?e+"ing":"color"===e?"colour":"bool"===e?e+"ean":"alnum"===e?"alphanumeric character":"int"===e?e+"eger":"even"===e||"odd"===e?e+" number":e.endsWith("case")||"whitespace"===e?e+" character":"empty"===e?e+" value":e)};return this.rest?{pattern:"zero or more",innerType:e}:e},create:function(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t;return e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":"newline"===e?"linebreak":e,t=Object.create(this),t.name=e,t.rest=n,t},from:function(e){var n=f(s).find(function(t){return s[t](e)});return n?t.create(n):c.create("datatype",m(e)+" doesn't correspond to a datatype value.")}},s={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return t.isPrototypeOf(e)},changer:function(e){return b.isPrototypeOf(e)},colour:function(e){return v.isPrototypeOf(e)},gradient:function(e){return d.isPrototypeOf(e)},lambda:function(e){return r.isPrototypeOf(e)},macro:function(e){return g.isPrototypeOf(e)},codehook:function(e){return p.isPrototypeOf(e)},command:function(e){return e&&"command"===e.TwineScript_TypeID},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},o=e({},s,{even:function(e){return!isNaN(e)&&i(a(e))%2==0},odd:function(e){return!isNaN(e)&&i(a(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e)&&!e.length},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+j+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+h+"$")},any:function(){return!0},const:function(){return!0}});return n(t)}),e("twinescript/operations",["utils","utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(a,t,m,v,e){var g=a.plural,f=t.isObject,u=t.collectionType,c=t.is,d=t.isA,h=t.clone,b=t.unique,l=t.contains,a=t.matches,i=t.objectName,p=t.toSource;function o(t,s,n,o){return n=n||"do this to",function(a,r){var c;return 1===s.length&&(r=a),(c=e.containsError(a,r))?c:_typeof(a)!==t||_typeof(r)!==t?e.create("operation","I can only ".concat(n," ").concat(t,"s, not ").concat(i(_typeof(a)!==t?a:r),"."),o):s(a,r)}}function s(t){return function(n,s){if(o=e.containsError(n,s))return o;if(_typeof(n)!==_typeof(s)||f(n)&&"TwineScript_TypeName"in n&&f(s)&&"TwineScript_TypeName"in s&&n.TwineScript_TypeName!==s.TwineScript_TypeName||u(n)!==u(s)){var a,o="".concat(i(n)," isn't the same type of data as ").concat(i(s));return _typeof(n)+_typeof(s)!=="stringnumber"&&_typeof(n)+_typeof(s)!=="numberstring"||(a="You might want to convert one side to a number using (num:), or to a string using (str:)."),e.create("operation",o[0].toUpperCase()+o.slice(1),a)}return t(n,s)}}function n(o,t,n){var s=2<arguments.length&&void 0!==n&&n;return function h(a,c){if(p=e.containsError(a,c))return p;var p,n=_slicedToArray(a.determiner?[a,c]:c.determiner?[c,a]:[],2),r=n[0],d=n[1],f,u,l,g;if(r){var n=r,m=n.determiner,n=n.determined;if("start"===m||"end"===m){if(t)return e.create("operation","I can't use '".concat(t,"' with the 'start' or 'end' of ").concat(i(n),"."));if(d.determiner){if("start"===d.determiner||"end"===d.determiner)return e.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");n=[d,r],r=n[0],d=n[1]}for(f=r.string||r.array,u=0;u<f.length+1;u+=1){if(l=u?"end"===m?f.slice(-u):f.slice(0,u):f.constructor(),l=r===a?h(l,c):h(a,l),p=e.containsError(l))return p;if(l!==s)return l}return s}return g="all"===m,r.array.reduce(function(n,t){var s=r===a?h(t,c):h(a,t);return(t=e.containsError(n,s))?t:g?n&&s:n||s},g)}return o(a,c)}}function r(t,s){return n(function(s,n){return n=t(s,n),e.containsError(n)?n:!n},s,!0)}return t="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.",a={and:o("boolean",s(function(e,t){return e&&t}),"use 'and' to join",t),or:o("boolean",s(function(e,t){return e||t}),"use 'or' to join",t),not:o("boolean",function(e){return!e},"use 'not' to invert",t),"+":s(function(t,n){return Array.isArray(t)?[].concat(_toConsumableArray(t),_toConsumableArray(n)):t instanceof Map?(s=new Map(t),n.forEach(function(e,t){return s.set(t,e)}),s):t instanceof Set?new Set([].concat(_toConsumableArray(t),_toConsumableArray(n)).filter(b).map(h)):"function"==typeof t["TwineScript_+"]?t["TwineScript_+"](n):"string|number|boolean".includes(_typeof(t))?t+n:e.create("operation","I can't use + on ".concat(i(t),"."));var s}),"-":s(function(t,n){if(Array.isArray(t))return t.filter(function(e){return!n.some(function(t){return c(e,t)})});if(t instanceof Set){var s=_toConsumableArray(n);return new Set(_toConsumableArray(t).filter(function(e){return!s.some(function(t){return c(e,t)})}))}return"string"==typeof t?t.split(n).join(""):"number"==typeof t?t-n:e.create("operation","I can't use - on ".concat(i(t),"."))}),"*":o("number",s(function(e,t){return e*t}),"multiply"),"/":o("number",s(function(t,n){return 0===n?e.create("operation","I can't divide ".concat(i(t)," by zero.")):t/n}),"divide"),"%":o("number",s(function(t,n){return 0===n?e.create("operation","I can't modulo ".concat(i(t)," by zero.")):t%n}),"modulus"),"<":n(o("number",s(function(e,t){return e<t}),"do < to"),"<"),">":n(o("number",s(function(e,t){return t<e}),"do > to"),">"),"<=":n(o("number",s(function(e,t){return e<=t}),"do <= to"),"<="),">=":n(o("number",s(function(e,t){return t<=e}),"do >= to"),">="),is:n(c),isNot:r(c),contains:n(l,"contains"),doesNotContain:r(l,"does not contain"),isIn:n(function(e,t){return l(t,e)},"is in"),isNotIn:r(function(e,t){return l(t,e)},"is not in"),isA:n(d,"is a"),isNotA:r(d,"is not a"),typifies:n(function(e,t){return d(t,e)}),untypifies:r(function(e,t){return d(t,e)}),matches:n(a),doesNotMatch:r(a),makeSpreader:function(t){if(e.containsError(t))return t;if(m.isPrototypeOf(t)||v.isPrototypeOf(t)){var n=h(t);return(m.isPrototypeOf(t)?n.datatype:n).rest=!0,n}return{value:t,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:g("string"==typeof t||Array.isArray(t)?_toConsumableArray(t).length:1,"spreaded '...' value"),TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return""+_toConsumableArray(t).map(p)}}}},Object.freeze(a)}),e("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(n,s,o,t,e){var i=o.objectName;return t.on("set",function(e,t){e.TwineScript_VariableStore&&s.storyElement.find("[data-2bind]").each(function(i,s){var o=(s=n(s)).data("twoWayBindEvent");"function"==typeof o&&o(s,e,t)})}),Object.freeze({TwineScript_TypeName:"a VarBind (bound variable name)",get TwineScript_ObjectName(){return"a ".concat(this.bind," bind to ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A bound variable name]`"},TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(t){var t=this.varRef.set(t);if(t=e.containsError(t))return t},create:function(n){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"one way";return e.containsError(n)?n:t.isPrototypeOf(n)?n.error||Object.assign(Object.create(this),{varRef:n,bind:s}):e.create("operation","I can only 'bind' a variable, not "+i(n)+".")}})}),e("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(i,s,a,t,e){var n=i.objectName,r=i.matches,o=i.toSource;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ObjectName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ToSource:function(){return"into"===this.operator?"".concat(o(this.src)," ").concat(this.operator," ").concat(o(this.dest)):"".concat(o(this.dest)," ").concat(this.operator," ").concat(o(this.src))},TwineScript_Unstorable:!0,set:function(){var o,p=0<arguments.length&&void 0!==arguments[0]&&arguments[0],u=[],l=function g(o,l,_){var m=!(2<arguments.length&&void 0!==_)||_,c=[],i=l&&t.isPrototypeOf(l)?l.get():l,h,u,d,v,b,j,f;if(e.containsError(i))return i;if(Array.isArray(i)&&Array.isArray(o)){for(h=0,u=0;h<o.length&&u<i.length;){if(d=o[h],v=i[u],s.isPrototypeOf(d)&&d.datatype.rest||a.isPrototypeOf(d)&&d.rest){for(b=u;u<i.length&&r(d,v);)v=i[u+=1];s.isPrototypeOf(d)?d.datatype=[d.datatype]:a.isPrototypeOf(d)&&(d=a.create("array")),c=c.concat(g(d,t.isPrototypeOf(l)?t.create(l,{first:b+1,last:u+1}):i.slice(b,u)))}else c=c.concat(g(d,t.isPrototypeOf(l)?t.create(l,u+1):v)),u+=1;h+=1}return h<o.length?m&&e.create("operation","I can't unpack this array because it needs ".concat(o.length-h," more value").concat(0<o.length-h?"s":"",".")):c}if(o instanceof Map&&i instanceof Map){f=_createForOfIteratorHelper(o.entries());try{for(f.s();!(j=f.n()).done;){var y=_slicedToArray(j.value,2),p=y[0],w=y[1];if(!i.has(p))return m&&e.create("operation","I can't unpack this datamap because it needs a '"+p+"' data name.");c=c.concat(g(w,t.isPrototypeOf(l)?t.create(l,p):i.get(p)))}}catch(e){f.e(e)}finally{f.f()}return c}if(s.isPrototypeOf(o)){if("function"==typeof o.datatype.destructure)return[{dest:o,value:i,src:l}].concat(o.datatype.destructure(i));if(!r(i,o.datatype))return m&&e.create("operation","I can't put ".concat(n(i)," into ").concat(o.varRef.TwineScript_ToSource()," because it doesn't match ").concat(o.varRef.TwineScript_ToSource(),"'s datatype, ").concat(n(o.datatype),"."));c=c.concat(g(o.datatype,i))}return t.isPrototypeOf(o)||s.isPrototypeOf(o)?c.concat({dest:o,value:i,src:l}):"function"==typeof o.destructure?c.concat(o.destructure(i)):r(i,o)?c:m&&e.create("operation","I tried to unpack, but "+n(o)+" in the pattern didn't match "+n(i)+".")}(this.dest,this.src);if(o=e.containsError(l))return o;if(!l.length)return e.create("operation","I can't store a new value inside "+n(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");c=_createForOfIteratorHelper(l.reverse());try{for(c.s();!(h=c.n()).done;){var h,c,d=h.value,i=d.dest,m=d.value,f=d.src;if(s.isPrototypeOf(i)){if(o=e.containsError(i.defineType()))return o;i=i.varRef}if(o=i.set(m,this.srcRef),e.isPrototypeOf(o))return o;p&&f&&f.delete(),u.shift(n(i)+" is now "+n(m))}}catch(e){c.e(e)}finally{c.f()}return u.join("; ")},create:function(t,n,s,o){return e.containsError(t)?t:e.containsError(n)?n:Object.assign(Object.create(this),{dest:t,src:n,operator:s,srcRef:o})}})}),e("twinescript/runner",["macros","state","utils","utils/operationutils","twinescript/operations","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","datatypes/assignmentrequest","internaltypes/varref","internaltypes/twineerror"],function(O,s,j,d,g,F,M,m,_,S,A,c,k,n,e){var p=j.insensitiveName,i=j.impossible,t=d.toSource,b=d.typeName,r=d.objectName,u,w,C,T,v;function E(o,t){var e,n=o.freeVariables;"macro"===t.type?"current-time"===(e=p(t.name))||"current-date"===e||"monthday"===e||"weekday"===e||"history"===e||"visited"===e||"passage"===e?o.freeVariables=!0:t.blockedValue&&!n.blockedValues?n.blockedValues=o.stackTop.blockedValues.concat():"random"!==e&&"either"!==e&&"shuffled"!==e||n.seed||(n.seed=s.seed,n.seedIter=s.seedIter):"identifier"===t.type?"time"!==(e=p(t.text))&&"exits"!==e&&"it"!==e&&"visits"!==e&&"turns"!==e||(o.freeVariables=!0):"property"===t.type||"belongingProperty"===t.type?"random"!==p(t.name)||n.seed||(n.seed=s.seed,n.seedIter=s.seedIter):"variable"!==t.type&&"tempVariable"!==t.type||(o.freeVariables=!0)}u=[["error","text"],["comma"],["to","into"],["where","when","via","making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink","macro","identifier","variable","tempVariable","hookName","number","cssTime","boolean","string","hook","colour","datatype","root"],["grouping"]];function l(e,l){if(a=[],!e.length)return a;for("most"===l?(n=u.length-1,c=i=-1):(n=0,c=u.length,i=1);n!==c;n+=i){var n,c,i,a,r=u[n],t=NaN,o,s;if(r.rightAssociative){for(o=0;o<e.length;o+=1)if(r.rightAssociative.includes(e[o].type)){t=o;break}}else for(s=e.length-1;0<=s;--s)if(r.includes(e[s].type)){t=s;break}if(!Number.isNaN(t)&&-1<t){a=[e[t],t];break}}return a}w=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"],C={">":"<=","<":">=",">=":"<","<=":">"};function h(e){return"inequality"===e.type?e.negate?C[e.operator]:e.operator:e.type}T={">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"};function y(e){return e=h(e),T[e]||e}v={error:"neither",identifier:"neither",variable:"neither",tempVariable:"neither",hookName:"neither",number:"neither",boolean:"neither",string:"neither",hook:"neither",colour:"neither",datatype:"neither",root:"neither",twineLink:"neither",macro:"neither",grouping:"neither",itsProperty:"neither",belongingItProperty:"neither",to:"both",into:"both",typeSignature:"both",augmentedAssign:"both",and:"both",or:"both",belongingOperator:"both",possessiveOperator:"both",multiplication:"both",division:"both",spread:"after",bind:"after",not:"after",belongingProperty:"after",each:"after",itsOperator:"after",positive:"after",negative:"after",belongingItOperator:"before",property:"before"};function a(t,n,s){return e.create("syntax","I need usable code to be ".concat(t?"left ":"").concat(t&&n?"and ":"").concat(n?"right ":"","of ").concat(s.text,"."))}function f(t,n,s){return e.create("syntax","There can't be a ".concat(t&&n?t.map(function(e){return e.text}).join("")+" or "+n.map(function(e){return e.text}).join(""):(t||n).map(function(e){return e.text}).join("")," to the ").concat(t?"left ":"").concat(t&&n?"or ":"").concat(n?"right ":"","of ").concat(s.text,"."),"There could be a comma missing between them.")}function o(d,n){var u=n.val,g=n.fromCode,h=n.toCode,_=n.toDesc,y=n.reason,j=n.it,i=n.tokens,c=n.i,m=i[c],o=i.slice(0,c),s=i.slice(c+1),f;if(1===i.length&&(o=s=!1,m=i[0]),!d[d.length-1].error){n=e.containsError(u),c=d[d.length-1].code,i=d[0].basis,o&&o.length&&s&&s.length&&o[0].start>s[0].start&&(o=(p=[s,o])[0],s=p[1]);var b,p=h||"".concat(o&&o.length&&"whitespace"===o[o.length-1].type?" ":"").concat(n?" \ud83d\udc1e ":(u&&!u.TwineScript_ToSource&&u.TwineScript_Unstorable?r:t)(u)).concat(s&&s.length&&("whitespace"===s[0].type||"addition"===m.type||"subtraction"===m.type)?" ":""),l=(o.length?o[0]:m).start-i,a=(s.length?s[s.length-1]:m).end-i,v=_createForOfIteratorHelper(d);try{for(v.s();!(b=v.n()).done;)f=b.value,f.start<l?(l+=f.diff,a+=f.diff):f.start<a&&(a+=f.diff)}catch(e){v.e(e)}finally{v.f()}!g&&(g=c.slice(l,a),h&&h.trim()===g.trim())||(i=p.length-(a-l),d.push({code:c.slice(0,l)+p+c.slice(a),fromCode:g,toCode:!n&&h,toDesc:!n&&!h&&(_||r(u)),start:l,end:a,diff:i,reason:y,itIdentifier:void 0!==j&&r(j),error:n&&n.render(c.slice(l,a),!0)}))}}function x(t,e){return(n.isPrototypeOf(e)||c.isPrototypeOf(e))&&(t.Identifiers.it=e.get()),e}return function z(u,D){var R=2<arguments.length&&void 0!==arguments[2]&&arguments[2],eh=3<arguments.length&&void 0!==arguments[3]&&arguments[3],B=u.evalReplay,L=B&&B.length,H,N=!1,er,V=g,j,d,I,C,T,e7,e2,j,I,C,T,p,es,P,ej,ey,ew,e1,J,e_,eO,K,q,eo,W,eC,ex,eE,ei,e3,eg,e0,e4,eu,ec,e8,Y,et,ea,en,Z,G,ee,U;if(Array.isArray(D)||(D=[D]),!D.length||!D[0])return i("Runner.run","No tokens to run!"),0;if(1===D.length?j=D[0]:(e7=l(D,"least"),e2=_slicedToArray(e7,2),j=e2[0],I=e2[1],C=D.slice(0,I),T=D.slice(I+1),C.length&&(1!==C.length||"whitespace"!==C[0].type)||(C=!1),T.length&&(1!==T.length||"whitespace"!==T[0].type)||(T=!1)),p=j.type,!p)return i("Runner.run","Token has no type!"),0;if(es=v[p]||"","both"!==es||C&&T?"neither"===es&&(C||T)?d=f(C,T,j):"before"===es?C?T&&(d=f(null,T,j)):d=a(!0,!1,j):"after"===es&&(T?C&&(d=f(C,null,j)):d=a(!1,!0,j)):d=a(!C,!T,j),u.freeVariables&&"object"===_typeof(u.freeVariables)&&E(u,j),P=!0,ej=!0,!d){if("comma"===p)return i("Section.run","a comma token was run() somehow."),0;if("root"===p)d=z(u,j.children);else if("identifier"===p)d=R?n.create(u.Identifiers,j.text.toLowerCase()):u.Identifiers[j.text.toLowerCase()];else if("variable"===p||"tempVariable"===p)d=n.create("tempVariable"===p?u.stackTop.tempVariables:s.variables,j.name),eh?(d=c.create(_.create("any"),d),H=L&&"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value."):R||e.containsError(d)?N=!0:(ey=d.get(),H=L&&(d&&d.object===s.variables&&!hasOwnProperty.call(d.object,d.compiledPropertyChain[0])?"This variable didn't exist; for story-wide $ variables, a default value of 0 is used if they don't exist.":""),d=ey);else if("hookName"===p)d=M.create({type:"name",data:j.name}),N=!0;else if("number"===p||"cssTime"===p)d=j.value,H=L&&"cssTime"===p&&(j.text.endsWith("ms")?"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.":"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000)."),N=!H;else if("boolean"===p)d="true"===j.text.toLowerCase(),N=!0;else if("string"===p)eO=j.text.replace(/(.?)\n/g,function(t,e){return("\\"===e?"\\\\":"\n"===e?"\\n":e)+"\\n"}).replace(/(\\*)\\0/g,function(t,e){return(e?"\\".repeat(2*e.length):"")+"0"}),d=eval(eO),N=!0;else if("hook"===p)d=A.create(j.children,j.text),N=!0;else if("colour"===p)d=F.create(j.colour),N=!0;else if("datatype"===p)d=_.create(j.name),N=!0;else if("spread"===p)d=V.makeSpreader(z(u,T,!1,eh));else if("bind"===p)d=S.create(z(u,T,P),j.text.startsWith("2")?"two way":""),N=!0;else if("to"===p||"into"===p)if(K="to"===p?x(u,z(u,C,P,ej)):z(u,T,P,ej),e.containsError(K))d=K;else{if((n.isPrototypeOf(K)&&K.propertyChain.length<=1||c.isPrototypeOf(K)&&K.varRef.propertyChain.length<=1)&&(u.freeVariables=Object.create(null)),q="to"===p?z(u,T,P):x(u,z(u,C,P)),e.containsError(q))return q;eo=u.freeVariables,u.freeVariables=null,j.place&&eo&&"object"===_typeof(eo)&&"boolean"!=typeof q&&"number"!=typeof q&&(W=eo,W.at=j.place,W.from=T[0].start,W.to=T[T.length-1].end,JSON.stringify(W).length>=t(q).length&&(W=void 0)),d=k.create(K,q,p,W),N=!0,er=u.Identifiers.it}else if("typeSignature"===p)eC=z(u,C,R),ex=u.freeVariables,u.freeVariables=null,eE=z(u,T,P),u.freeVariables=ex,d=c.create(eC,eE),N=!0;else if("where"===p||"when"===p||"via"===p)T?(ew=D.map(function(e){return e.text}).join(""),d=m.create(C?z(u,C,P):void 0,j.type,T,ew),N=!0):d=a(!1,!0,j);else if("making"===p||"each"===p)T?(e1=[].concat(D).map(function(e){return e.text}).join(""),d="each"===p?m.create(z(u,T,P),"each",null,e1):m.create(C?z(u,C,P):void 0,j.type,z(u,T,P),e1),N=!0):d=a(!1,!0,j);else if("augmentedAssign"===p)d=V.makeAssignmentRequest(z(u,C,P),V[j.operator](z(u,C),z(u,T)),j.operator),N=!0;else if("and"===p||"or"===p){var e9=function s(n){var e=_slicedToArray(l(n,"least"),2),t=e[0],e=e[1];if(t&&"whitespace"!==t.type)return w.includes(t.type)?t:t.type===p?s(n.slice(0,e))||s(n.slice(e+1)):void 0},el=e9(C),ed=e9(T),ev=e.create("operation",'This use of "is not" and "'.concat(p,'" is grammatically ambiguous.'),'Maybe try rewriting this as "__ is not __ '.concat(p,' __ is not __"')),X,ef=function a(e){var n=_slicedToArray(l(e,"least"),2),s=n[0],i=n[1];return!s||"whitespace"===s.type?[]:s.type===p?[].concat(_toConsumableArray(a(e.slice(0,i))),_toConsumableArray(a(e.slice(i+1)))):(n=z(u,e),L&&"boolean"!=typeof n&&(s=X.replace(/[A-Z]/g,function(e){return" "+e.toLowerCase()}),o(B,{toCode:" it ".concat(s," ").concat(t(n)," "),reason:"A missing 'it ".concat(s,"' was inferred to correct the '").concat(p,"' operation."),tokens:e,i}),o(B,{toCode:" ".concat(t(u.Identifiers.it)," ").concat(s," ").concat(t(n)," "),tokens:e,i})),[{val:n,tokens:e,i}])},e5=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return n.reduce(function(n,t){var e=t.val,s=t.tokens,t=t.i;return"boolean"==typeof e?e:(e=g[j.type](n,g[X](u.Identifiers.it,e)),L&&o(B,{val:e,tokens:s,i:t}),e)},"and"===j.type)},Q,ep,X,$,em,e6,eb;d=el&&!ed?(Q=el,X=h(Q),"isNot"===Q.type||"isNotA"===Q.type||"untypifies"===Q.type?ev:(ep=z(u,C),V[p](ep,e5.apply(void 0,_toConsumableArray(ef(T)))))):!el&&ed?($=ed,em=D.indexOf($),X=y($),"isNot"===$.type||"isNotA"===$.type||"untypifies"===$.type?ev:(e6=[].concat(_toConsumableArray(D.slice(em+1)),[Object.assign(Object.create($),_defineProperty({},"inequality"===$.type?"operator":"type",y($)))],_toConsumableArray(D.slice(I+1,em))),eb=z(u,e6),V[p](eb,e5.apply(void 0,_toConsumableArray(ef(C)))))):V[p](z(u,C),z(u,T))}else if(w.includes(p))T||a(!1,!0,j),ei=C?z(u,C):u.Identifiers.it,d=V[h(j)](ei,z(u,T)),u.Identifiers.it=ei,er=ei,H=L&&!C&&"A missing 'it' was inferred to complete the operation.";else if("addition"===p||"subtraction"===p)T||a(!1,!0,j),e3=!C,C&&(eg=l(C,"least"),e0=_slicedToArray(eg,2),e4=e0[0],eu=e0[1],ec=v[e4.type],e8=e4.type,e3=("both"===ec||"after"===ec||"addition"===e8||"subtraction"===e8)&&(eu===C.length-1||eu===C.length-2&&"whitespace"===C[C.length-1].type)),e3?(j.type="addition"===p?"positive":"negative",d=z(u,D),j.type=p,N=!0):d=V[j.text](z(u,C),z(u,T));else if("multiplication"===p||"division"===p)d=V[j.text](z(u,C),z(u,T));else if("positive"===p||"negative"===p)d=V["*"]("negative"===p?-1:1,z(u,T)),N=!0;else if("not"===p)d=V.not(z(u,T));else if("belongingProperty"===p)Y=z(u,T,R),d=n.create(Y,j.name),et=R||e.containsError(d),d=et?d:d.get(),et=R||e.containsError(d),L&&!et?o(B,{toCode:" ".concat(j.name," of ").concat(t(n.isPrototypeOf(Y)?Y.get():Y)," "),tokens:D,i:I}):et||(H="The value to the right of 'of', ".concat(b(Y),', had a "').concat(j.name,'" data name corresponding to that data value.'));else if("belongingOperator"===p||"belongingItOperator"===p)ea=z(u,C),"random"===ea&&u.freeVariables&&"object"===_typeof(u.freeVariables)&&!u.freeVariables.seed&&(u.freeVariables.seed=s.seed,u.freeVariables.seedIter=s.seedIter),d=n.create("belongingItOperator"===p?u.Identifiers.it:z(u,T,R),{computed:!0,value:ea}),d=R||e.containsError(d)?d:d.get(),"belongingItOperator"===p&&L&&o(B,{toCode:" ".concat(t(ea)," of ").concat(t(u.Identifiers.it)," "),tokens:D,i:I});else if("property"===p)en=z(u,C,P),d=n.create(en,j.name),Z=R||e.containsError(d),d=Z?d:d.get(),Z=R||e.containsError(d),L&&n.isPrototypeOf(en)&&!Z?o(B,{toCode:" ".concat(t(en.get()),"'s ").concat(j.name," "),tokens:D,i:I}):Z||(H="The value to the left of 's, ".concat(b(en),', had a "').concat(j.name,'" data name corresponding to that data value.'));else if("itsProperty"===p||"belongingItProperty"===p)d=n.create(u.Identifiers.it,j.name),d=R||e.containsError(d)?d:d.get(),L&&o(B,{toCode:"itsProperty"===p?" ".concat(t(u.Identifiers.it),"'s ").concat(j.name," "):" ".concat(j.name," of ").concat(t(u.Identifiers.it)," "),tokens:D,i:I});else if("possessiveOperator"===p||"itsOperator"===p)!T||!C&&"itsOperator"!==j.type?d=a(!C,!T,j):(J=z(u,T),"random"===J&&u.freeVariables&&"object"===_typeof(u.freeVariables)&&!u.freeVariables.seed&&(u.freeVariables.seed=s.seed,u.freeVariables.seedIter=s.seedIter),d=n.create("itsOperator"===j.type?u.Identifiers.it:z(u,C,R),{computed:!0,value:J}),d=R||e.containsError(d)?d:d.get(),"itsOperator"===p&&L&&o(B,{toCode:" ".concat(t(u.Identifiers.it),"'s ").concat(t(J)," "),tokens:D,i:I}));else if("twineLink"===p)d=O.run("link-goto",u,[j.innerText,j.passage]),H=L&&"Passage links are the same as (link-goto:) macro calls.";else if("macro"===p)if(j.blockedValue&&!u.blocked){if(d=u.blockedValue(),void 0===d)return i("Runner.run","section.blockedValue() returned undefined"),0}else{if(G=j.children[0],ee="$"===G.text[0]||"_"===G.text[0],"macroName"!==G.type&&!ee)return i("Runner.run","macro token had no macroName child token"),0;ee?(U=n.create("_"===G.text[0]?u.stackTop.tempVariables:s.variables,G.text.trim().slice(1,-1)),e.containsError(U)||(U=U.get())):U=j.name,d=O[ee?"runCustom":"run"](U,u,j.children.slice(1).reduce(function(e,t){return"comma"===t.type?e.push([]):e[e.length-1].push(t),e},[[]]).filter(function(e){return e.length&&(1<e.length||"whitespace"!==e[0].type)}).map(function(e){return z(u,e,!1,eh)})),H=L&&ee&&"I called ".concat(r(U),".")}else if("grouping"===p)d=z(u,j.children,R),N=!0;else if("error"===p)d=e.create("syntax",j.message,j.explanation||"");else{if("text"!==p)return i("Section.run","unknown syntax token type: ".concat(p,"!!")),0;j.text.trim().match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(e_='Position data names like "'.concat(j.text,'" need to be either left of "of" or right of "\'s".')),d=e.create("syntax",e_||'"'.concat(j.text,"\" isn't valid Harlowe syntax for the inside of a macro call."),"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.")}}return void 0===d?(i("Section.run","token ".concat(p).concat(j.name?" (".concat(j.name,":)"):""," produced undefined")),0):d===u?(i("Section.run","token ".concat(p).concat(j.name?" (".concat(j.name,":)"):""," produced the section")),0):(L&&!N&&o(B,{val:d,reason:H,it:er,tokens:D,i:I}),d)}}),e("utils/scripttag",["state","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(t,e,s,n){return function(i,o){Function("script","scope","with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}")(i,Object.create(null,Object.keys(t.variables).map(function(e){return!e.startsWith("TwineScript_")&&"$"+e}).concat(Object.keys(o).map(function(e){return!e.startsWith("TwineScript_")&&"_"+e})).reduce(function(a,i){return i&&(a[i]={get:function(){var s=("$"===i[0]?t.variables:o)[i.slice(1)];if(!e.isHarloweJSValue(s))throw n.create("","The contents of the variable ".concat(i,", ").concat(e.objectName(s),", couldn't be converted to a Javascript value."),"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.");return e.clone(s)},set:function(a){var r="$"===i[0]?t.variables:o;if(!e.isHarloweJSValue(a))throw n.create("","The Javascript value, ".concat(a,", couldn't be converted to a Harlowe value and assigned to the variable ").concat(i,"."),"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.");if(a=e.clone(a),a=s.create(r,i.slice(1)).set(a),n.containsError(a))throw a}}),a},{})))}}),e("section",["jquery","utils","twinescript/runner","twinescript/operations","state","utils/operationutils","utils/renderutils","utils/scripttag","datatypes/changercommand","datatypes/colour","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(n,t,h,O,o,a,v,y,s,_,x,C,i,u,e,p){var b=a.printBuiltinValue,r=a.objectName,g=a.typeID,j=a.isObject,f=v.collapse,m=Object.assign,d;function w(o,a,n){if(a&&"object"===_typeof(a)&&s.isPrototypeOf(a)){{r=n.popData("source"),n.data("originalSource",r);var r,c=i.create({target:n,source:r,section:this,append:"append"}),l=a.run(c);if(e.containsError(l)&&o.replaceWith(l.render(o.attr("title"))),!this.renderInto(r,null,c))return r=t.insensitiveName(o.attr("name")),["if","elseif","unless","else","testfalse"].includes(r)&&(o.addClass("false"),"elseif"!==r&&(this.stackTop.lastHookShown=!1)),n.data("live")&&function(h,n,s){var t=this,u=s.data("live"),c=u.delay,i=u.event;(n=m({},n,{append:"replace",transitionDeferred:!1,enabled:!0})).data=m({},n.data,{live:void 0});function o(e){a&&(r-=e-a),a=e,0<r?requestAnimationFrame(o):(r=c,l())}var f=s.data("originalSource")||"",d=this.stackTop.tempVariables,a=null,r=c,l=this.whenUnblocked.bind(this,function(){var a;t.inDOM()&&(a=i&&i.filter(t,[!0],d),e.containsError(a)?a.render(t,h.attr("title")).replaceAll(h):!i||a[0]?(t.renderInto(f,s,n,d),a||s.find("tw-expression[name='stop']").length||t.inDOM()&&requestAnimationFrame(o)):requestAnimationFrame(o))});requestAnimationFrame(o)}.call(this,o,c,n),!0}}else{if(!1===a)return n.data("source")&&(n.data("originalSource",n.popData("source")),n.data("hidden",!0)),o.addClass("false"),!(this.stackTop.lastHookShown=!1);if(!0!==a)return!1}return this.stackTop.lastHookShown=!0}function c(t){if(e=(t instanceof n?t[0]:t).nextSibling,e&&(e instanceof Text&&!e.textContent.trim()||["br","tw-consecutive-br"].includes((e.tagName||"").toLowerCase()))){var e,s=c(e),t=s.whitespace,s=s.nextElem;return{whitespace:n(e).add(t),nextElem:s}}return{whitespace:n(),nextElem:n(e)}}function l(e){if(e&&e.length)return n("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)}return d={add:[],remove:[]},Object.preventExtensions({create:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:t.storyElement,s=Object.assign(Object.create(this),{timestamp:Date.now(),dom:i,stack:[],enchantments:[],unblockCallbacks:[],freeVariables:null,evalReplay:null,loadedGame:!1,Identifiers:{TwineScript_Identifiers:!0,it:0,get time(){return s.stackTop&&s.stackTop.evaluateOnly?e.create("operation","'time' can't be used in ".concat(s.stackTop.evaluateOnly,".")):Date.now()-s.timestamp},get turns(){return o.turns},get turn(){return o.turns},get visits(){var e=s.stackTop.speculativePassage;return o.history().filter(function(t){return t===(e||o.passage)}).length+(!e||e===o.passage)},get visit(){return s.Identifiers.visits},get exits(){return s.stackTop&&s.stackTop.evaluateOnly?e.create("operation","'exit' and 'exits' can't be used in ".concat(s.stackTop.evaluateOnly,".")):s.dom.find("tw-enchantment, tw-link").filter(function(t,e){return(e=n(e)).data("enchantmentEvent")||e.parent().data("linkPassageName")||e.parent().data("clickEvent")}).length},get exit(){return s.Identifiers.exits},get pos(){return s.stackTop&&!s.stackTop.evaluateOnly&&s.stackTop.lambdaPos?+s.stackTop.lambdaPos||1:e.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}}});return s},eval:function(n){var s,o;t.options.debug&&t.options.evalReplay&&(s=Array.isArray(n)?n.reduce(function(e,t){return e+t.text},""):n.text||"",this.evalReplay=[{code:s,fromCode:s,basis:(Array.isArray(n)?n[0]:n).start,start:0,end:s.length,diff:0}]);try{o=h(this,n)}catch(t){return window.console&&window.console.error(t),this.evalReplay=null,e.create("","An internal error occurred while trying to run ".concat([].concat(n).map(function(e){return e.text}).join(""),"."),'The error was "'.concat(t.message,'".\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).'))}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),o},get stackTop(){return this.stack[0]},inDOM:function(){return 0<t.storyElement.find(this.dom).length},evaluateTwineMarkup:function(s,e){var t=n("<p>");return this.stack.unshift({desc:i.create({target:t,source:s,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:e,finalIter:!0}),this.execute(),0<(e=t.find("tw-error")).length?e:t},speculate:function(e,t,s){this.stack.unshift({evaluateOnly:s,finalIter:!0,tempVariables:Object.assign(Object.create(u),{TwineScript_VariableStoreName:s}),speculativePassage:t});var n,t=this.evalReplay;return this.evalReplay=null,x.isPrototypeOf(e)?n=e.apply(this,{fail:!1,pass:!0}):e&&(n=h(this,e)),this.stack.shift(),this.evalReplay=t,n},renderInto:function(l,t,o){var c=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=i.create({target:t,source:l,section:this,append:"append"});if(o)if(s.isPrototypeOf(o)){if(l=o.run(a),e.containsError(l))return l.render(t.attr("title")).replaceAll(t),!1}else Object.assign(a,o);if(t=a.target,50<=this.stack.length&&50<=this.stack.reduce(function(e,t){return e+!!t.finalIter},0))return e.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(t.attr("title")).replaceAll(t),!1;function d(e,s,o){var i=t instanceof n&&t.is("tw-hook")&&0<t.parents("tw-collapsed,[collapsing=true]").length;c.stack.unshift({desc:e,finalIter:o,tempVariables:s,collapses:i,evaluateOnly:c.stackTop&&c.stackTop.evaluateOnly})}return r=r||Object.create(this.stack.length?this.stackTop.tempVariables:u),hasOwnProperty.call(r,"TwineScript_VariableStoreName")||(o=t&&t.tag(),r.TwineScript_VariableStoreName="tw-hook"===o?t.attr("name")?"?"+t.attr("name"):"an unnamed hook":"tw-expression"===o?"a "+t.attr("type")+" expression":"tw-passage"===o?"this passage":"an unknown scope"),Object.keys(a.loopVars).length?function(){var n=Object.assign({},a.loopVars),e=Math.min.apply(Math,_toConsumableArray(Object.keys(n).map(function(e){return n[e].length}))),s,o;if(p.create(e+" loop"+(1!==e?"s":"")).render().prependTo(t),e){for(s=e-1;0<=s;--s)!function(t){d(a,Object.keys(n).reduce(function(e,s){return e[s]=n[s][t],e},Object.create(r),t===e-1))}(s);for(o=e-1;0<=o&&!c.stackTop.blocked;--o)c.execute()}}():(d(a,r,!0),this.execute()),0===this.stack.length&&this.updateEnchantments(),a.enabled},execute:function(){var o=this,d=this.stackTop,u=d.desc,a=d.dom,m=d.collapses,h=d.evaluateOnly;u&&!a&&(a=u.render(),this.stackTop.dom=a,this.stackTop.desc=void 0),a.findAndFilter('tw-hook,tw-expression,script[type="application/x-harlowe"]').each(function(u,a){if(o.stackTop.blocked)return!1;switch((a=n(a)).tag()){case"tw-hook":var d=a.popData("source");if(d&&a.data("originalSource",d),a.data("tempVariables",o.stackTop.tempVariables),a.popAttr("hidden")){a.data("hidden",!0);break}d&&o.renderInto(d,a);break;case"tw-expression":if(a.data("blockers")){if(h)return void a.removeData("blockers").removeData("code").replaceWith(e.create("syntax","I can't use a macro like (prompt:) or (confirm:) in ".concat(h,"."),"Please rewrite this without putting such macros here.").render(a.attr("title"),a));if(d=a.data("blockers"),d.length)return o.stackTop.blocked=!0,d=o.eval(d.shift()),e.containsError(d)&&(o.stackTop.blocked=!1,a.removeData("blockers").replaceWith(d.render(a.attr("title"),a))),!1;a.removeData("blockers")}a.data("code")&&!function(a){o=this.eval(a.popData("code")),a.append(l(this.evalReplay)),this.stackTop.evaluateOnly&&o&&(s.isPrototypeOf(o)||"function"==typeof o.TwineScript_Run)&&(o=e.create("syntax","I can't work out what ".concat(this.stackTop.evaluateOnly," should evaluate to, because it contains a ").concat(s.isPrototypeOf(o)?"changer.":"command."),"Please rewrite this without putting changers or commands here.")),m=n();for(d=a;s.isPrototypeOf(o);){if(f=c(d),v=f.whitespace,(d=f.nextElem)[0]&&d[0].nodeType===Node.TEXT_NODE&&"+"===d[0].textContent.trim()){var o,x,m,v,d,y=d,h=c(y),f=h.whitespace,u;if((d=h.nextElem).is("tw-expression")){if(h=this.eval(d.popData("code")),e.containsError(h)){o=h;break}u=O["+"](o,h),n(v).add(y).add(f).remove(),o=e.containsError(u)?e.create("operation","I can't combine "+r(o)+" with "+r(h)+".","function"==typeof h.TwineScript_Run?"If you want to attach this changer to ".concat(r(h),", remove the + between them."):"Changers can only be added to other changers."):u;continue}}if(d.is("tw-expression")){if(u=this.eval(d.popData("code")),d.append(l(this.evalReplay)),e.containsError(u)){o=u;break}if(u&&"object"===_typeof(u)&&"function"==typeof u.TwineScript_Attach){o=u.TwineScript_Attach(this,o);break}return s.isPrototypeOf(u)?void a.replaceWith(e.create("operation","Changers like (".concat(o.macroName,":) need to be combined using + between them."),"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(a.attr("title"))):void a.replaceWith(e.create("operation","".concat(r(u)," can't have changers like (").concat(o.macroName,":) attached."),"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(a.attr("title")))}if(d.is("tw-hook")){v.remove(),m=d;break}return o.macroName||t.impossible("Section.runExpression","changer has no macroName"),v=a.attr("title")||"("+o.macroName+": ...)",void a.replaceWith(e.create("syntax","The (".concat(o.macroName,":) changer should be stored in a variable or attached to a hook."),"Macros like this should appear before a hook: ".concat(v,"[Some text]")).render(a.attr("title")))}a.attr("return",g(o)),m=m.length?m:c(a).nextElem.filter("tw-hook"),(x=e.containsError(o))?a.replaceWith(x.render(a.attr("title")).append(l(this.evalReplay))):p.isPrototypeOf(o)?a.append(o.render()):o&&"function"==typeof o.TwineScript_Run?(o=o.TwineScript_Run(this),e.containsError(o)?a.replaceWith(o.render(a.attr("title"))):i.isPrototypeOf(o)?o.data&&o.data.live?a.replaceWith(e.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(a.attr("title"))):(o.section=this,o.target=d,this.renderInto("",d,o)):j(o)&&o.blocked?(this.stackTop.blocked=o.blocked,a.data("code",{type:"macro",blockedValue:!0,text:a.attr("title")||"",start:0,end:(a.attr("title")||"").length})):o&&t.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor ".concat(_typeof(o),': "').concat(o,'"'))):m.length&&w.call(this,a,o,m)||("string"==typeof o||"number"==typeof o||o instanceof Map||o instanceof Set||Array.isArray(o)||_.isPrototypeOf(o)||C.isPrototypeOf(o)||o&&"function"==typeof o.TwineScript_Print&&!s.isPrototypeOf(o)?(o=b(o),e.containsError(o)?a.replaceWith(o.render(a.attr("title"))):"string"==typeof o||Array.isArray(o)?this.renderInto(o,a):t.impossible("printBuiltinValue() produced a non-string non-array ".concat(_typeof(o)))):s.isPrototypeOf(o)||"boolean"==typeof o||t.impossible("Section.runExpression","The expression evaluated to an unknown value: ".concat(o)))}.call(o,a);break;case"script":if(t.reattachStoryElement(),!a.text())break;try{y(a.text(),o.stackTop.tempVariables)}catch(t){e.isPrototypeOf(t)?a.replaceWith(t.render(a.text(),a)):(window.console&&window.console.error(t),a.replaceWith(e.create("","A Javascript error occurred while running this <script> element.",'The error was "'.concat(t,'". Check the browser console for more details.')).render(a.text(),a)))}}}),this.stackTop.blocked||(a.length&&m&&f(a),a.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){f(n(this))}),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return d[e].push(t),this},addEnchantment:function(e){var t=this;this.enchantments.push(e),d.add.forEach(function(n){return n(t,e)})},removeEnchantment:function(e){var t=this,n=this.enchantments.indexOf(e);this.enchantments.splice(n,1),e.disenchant(),d.remove.forEach(function(n){return n(t,e)})},unblock:function(e){for(this.stack.length||t.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;0<this.unblockCallbacks.length;)if(this.unblockCallbacks.shift()(),this.stackTop&&this.stackTop.blocked)return},whenUnblocked:function(e,t){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):(t||e)()},blockedValue:function(){var e=this.stackTop;return e?e.blockedValues&&e.blockedValues.length?e.blockedValues.shift():(t.impossible("Section.blockedValue","blockedValues is missing or empty"),0):(t.impossible("Section.blockedValue","stack is empty"),0)}})}),e("engine",["jquery","utils","state","section","passages"],function(o,n,e,u,t){var a,c=n.impossible,l=n.passageSelector,d=n.transitionOut,r=n.options;function s(n,a,s){var o,i,e;for(s?(i=s.get("name"),(s=t.getTree(i))&&s.children.length&&(o={type:"include",tag:a,name:i,children:s.children,text:s.text})):o=t.getTree(a);(e=n[n.length-1])&&("root"===e.type||"include"===e.type)&&e.children.some(function(e){return e.type.startsWith("unclosed")});)n[n.length-1]=Object.create(e),n=e.children=e.children.slice();n.push(o)}function i(x){var h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},R=h.loadedGame,v=t.get(x),f=n.storyElement,k=f.parent(),A=h.stretch,a=h.transition,i=(a=void 0===a?{}:a).depart,M=void 0===i?"instant":i,y=a.arrive,P=void 0===y?"dissolve":y,w=a.departOrigin,O=a.arriveOrigin,L=a.time,m,D,_,S,j,F,g,z,p,N,b,T,C;k.findAndFilter("tw-enchantment").each(function(n,e){var t=(e=o(e)).data("enchantedProperties");t&&f.css(t.reduce(function(e,t){return e[t]="",e},{})),e[0]===k[0]&&(k=f.unwrap().parent())}),t.hasValid(x)||c("Engine.showPassage","There's no passage with the name \""+x+'"!');var E=f.children(l).not(".transition-out, .transition-out *"),h=(v.get("tags")||[]).join(" "),i=(i=o("<tw-passage><tw-sidebar>"),y=i.children("tw-sidebar"),a=o('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),v=o('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),e.pastLength<=0&&a.css("visibility","hidden"),e.futureLength<=0&&v.css("visibility","hidden"),y.append(a,v),i);if("function"==typeof w&&(w=w.call(E)),"function"==typeof O&&(O=O.call(i)),n.detachStoryElement(),i.appendTo(f).attr({tags:h}),!A&&M&&(d(E,M,L,0,0,0,w),E.css("position","absolute")),f.attr({tags:h}),h=u.create(i),R&&(h.loadedGame=!0),m=[],e.pastLength<=0&&1===e.turns){_=_createForOfIteratorHelper(t.getTagged("startup"));try{for(_.s();!(D=_.n()).done;)s(m,"startup",D.value)}catch(e){_.e(e)}finally{_.f()}if(r.debug){j=_createForOfIteratorHelper(t.getTagged("debug-startup"));try{for(j.s();!(S=j.n()).done;)s(m,"debug-startup",S.value)}catch(e){j.e(e)}finally{j.f()}}}g=_createForOfIteratorHelper(t.getTagged("header"));try{for(g.s();!(F=g.n()).done;)s(m,"header",F.value)}catch(e){g.e(e)}finally{g.f()}if(r.debug){p=_createForOfIteratorHelper(t.getTagged("debug-header"));try{for(p.s();!(z=p.n()).done;)s(m,"debug-header",z.value)}catch(e){p.e(e)}finally{p.f()}}s(m,x),b=_createForOfIteratorHelper(t.getTagged("footer"));try{for(b.s();!(N=b.n()).done;)s(m,"footer",N.value)}catch(e){b.e(e)}finally{b.f()}if(r.debug){C=_createForOfIteratorHelper(t.getTagged("debug-footer"));try{for(C.s();!(T=C.n()).done;)s(m,"debug-footer",T.value)}catch(e){C.e(e)}finally{C.f()}}h.renderInto(m,i,{transition:P,transitionTime:L,transitionOrigin:O}),h.loadedGame=!1,n.reattachStoryElement(),scroll(0,A?i.offset().top-.05*o(window).height():f[0].getBoundingClientRect().top+document.body.scrollTop)}return Object.freeze({goBack:function(t){e.rewind()&&i(e.passage,t)},goForward:function(t){e.fastForward()&&i(e.passage,t)},goToPassage:function(t,n){e.play(t),i(t,n)},redirect:function(t,n){e.redirect(t),i(t,n)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:i,enableDebugMode:function(){a&&a()},registerDebugMode:function(e){a=a||e}})}),e("debugmode/panel",["jquery","utils/naturalsort"],function(e,t){var n=t();return Object.seal({create:function(t){var r,i=t.className,d=t.rowWrite,u=t.rowCheck,h=t.rowSort,l=t.columnHead,s=t.tabName,c=t.tabNameCounter,a=void 0===c||c,t=t.tabUpdate,o=e("<div class='panel panel-".concat(i,"' style='").concat(this.defaultMaxHeight?"max-height:"+this.defaultMaxHeight+"px":"","' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>")),n=e("<button class='tab tab-".concat(i,"'>").concat(a?"0 ".concat(s,"s"):s,"</button>"));return n.click(function(){n.toggleClass("enabled"),n.parent().siblings(".panel").attr("hidden",""),n.is(".enabled")&&(n.siblings(".tab:not(.tab-"+i+")").removeClass("enabled"),o.removeAttr("hidden"))}),o.on("click","th",function(t){var n=t.target,t="desc"===(t=(n=e(n)).attr("data-order"))?"asc":"desc";r.sort(n.attr("data-col"),t),o.find("th[data-order]").removeAttr("data-order"),n.attr("data-order",t)}),t=t||function(e){return n.text(a?"".concat(e," ").concat(s).concat(1!==e?"s":""):s)},r=Object.assign(Object.create(this),{tabName:s,tab:n,panel:o,panelRows:o.find(".panel-rows"),rowWrite:d,rowSort:h,rowCheck:u,columnHead:l,tabUpdate:t})},sort:function(t,o){var s=this;this.panelRows.children(":not(.panel-head, .panel-row-source)").get().sort(function(i,a){var r;return"desc"===o&&(i=(r=[a,i])[0],a=r[1]),i=i.querySelector("."+t),a=a.querySelector("."+t),s.rowSort&&s.rowSort(t,e(i),e(a))||n(i.textContent,a.textContent)}).forEach(function(t){var n=e(t).next(".panel-row-source").get();s.panelRows.append(t,n)})},update:function(c,s){var l=this.rowCheck,a=this.rowWrite,n=this.panelRows,r=this.columnHead,t=this.panel,o=[],i=n.children();c.forEach(function(s){var t=i.filter(function(n,t){return l(s,e(t))}),r=a(s,t.length&&t);t.length||n.append(r),o.push.apply(o,_toConsumableArray(r.get()))}),i.filter(function(t,e){return!o.includes(e)&&!e.className.includes("panel-head")}).remove(),this.tabUpdate(s),0<s&&!n.find(".panel-head").length?n.prepend(r()):0===s&&n.find(".panel-head").remove(),t=t.find("th[data-order]"),t.length&&this.sort(t.attr("data-col"),t.attr("data-order"))},defaultMaxHeight:300})}),function(){n={boolean:"color:hsla(0,0%,30%,1.0)",array:"color:hsla(0,100%,30%,1.0)",dataset:"color:hsla(30,100%,40%,1.0)",number:"color:hsla(30,100%,30%,1.0)",datamap:"color:hsla(60,100%,30%,1.0)",changer:"color:hsla(90,100%,30%,1.0)",lambda:"color:hsla(120,100%,40%,1.0)",hookName:"color:hsla(160,100%,30%,1.0)",string:"color:hsla(180,100%,30%,1.0)",identifier:"color:hsla(200,80%,40%,1.0)",variable:"color:hsla(200,100%,30%,1.0)",tempVariable:"color:hsla(200,70%,20%,1.0)",datatype:"color:hsla(220,100%,30%,1.0)",colour:"color:hsla(280,100%,30%,1.0)",macro:"color:hsla(320,80%,30%,1.0)",twineLink:"color:hsla(240,100%,20%,1.0)"},n.gradient=n.colour,n.command=n.twineLink,n.instant=n.metadata=n.any=n.customMacro=n.macro;function i(e,t,n){return function(s){return"background-color: hsla(".concat(e,",").concat(t,"%,").concat(n,"%,").concat(s,");")}}var n,c=Math.min,t=i(40,100,50),s=i(220,100,50),a=/hsla\((\d+),\s*(\d+)%,\s*(\d+)%,\s*(\d+\.\d+)\)/g,o="cm-harlowe-3-",r=(_defineProperty(t={root:"box-sizing:border-box;",hook:t(.05),"hook-2":t(.1),"hook-3":t(.15),"hook-4":t(.2),"hook-5":t(.25),"hook-6":t(.3),"hook-7":t(.35),"hook-8":t(.4),"^=hook , ^=hook-":"font-weight:bold;",unclosedHook:t(.05)+"font-weight:bold;"},"error:not([class*='"+o+"string'])","background-color: hsla(17,100%,50%,0.5) !important;"),_defineProperty(t,"^=macroName","font-style:italic;"),_defineProperty(t,"macroName-boolean",n.boolean),_defineProperty(t,"macroName-array",n.array),_defineProperty(t,"macroName-dataset",n.dataset),_defineProperty(t,"macroName-datatype",n.datatype),_defineProperty(t,"macroName-number",n.number),_defineProperty(t,"macroName-datamap",n.datamap),_defineProperty(t,"macroName-changer",n.changer),_defineProperty(t,"macroName-string",n.string),_defineProperty(t,"macroName-colour, macroName-gradient",n.colour),_defineProperty(t,"macroName-command, macroName-instant, macroName-metadata",n.command),_defineProperty(t,"macroName-custommacro, macroName-macro, macroName-any",n.macro),_defineProperty(t,"^=macro ","font-weight:bold;"+n.macro),_defineProperty(t,"comma, spread",n.macro),_defineProperty(t,"addition",n.any),_defineProperty(t,"subtraction, multiplication, division",n.number),_defineProperty(t,"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch",n.boolean),_defineProperty(t,"bold, strong","font-weight:bold;"),_defineProperty(t,"italic, em","font-style:italic;"),_defineProperty(t,"sup","vertical-align: super;font-size:0.8em;"),_defineProperty(t,"strike","text-decoration: line-through;"),_defineProperty(t,"verbatim","background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)"),_defineProperty(t,"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike","font-weight:100; color: hsla(0,0,0,0.5)"),_defineProperty(t,"^=collapsed","font-weight:bold; color: hsla(201,100%,30%,1.0);"),_defineProperty(t,"unclosedCollapsed",s(.025)+"font-weight:bold; color: hsla(201,100%,30%,1.0);"),_defineProperty(t,"collapsed",s(.025)),_defineProperty(t,"collapsed.hook",s(.05)),_defineProperty(t,"collapsed.hook-2",s(.1)),_defineProperty(t,"collapsed.hook-3",s(.15)),_defineProperty(t,"collapsed.hook-4",s(.2)),_defineProperty(t,"collapsed.hook-5",s(.25)),_defineProperty(t,"collapsed.hook-6",s(.3)),_defineProperty(t,"collapsed.hook-7",s(.35)),_defineProperty(t,"collapsed.hook-8",s(.4)),_defineProperty(t,"twineLink:not(.text)",n.twineLink),_defineProperty(t,"tag, scriptStyleTag, comment","color: hsla(240,34%,25%,1.0);"),_defineProperty(t,"boolean",n.boolean),_defineProperty(t,"string",n.string),_defineProperty(t,"number",n.number),_defineProperty(t,"variable",n.variable),_defineProperty(t,"tempVariable",n.tempVariable),_defineProperty(t,"hookName",n.hookName),_defineProperty(t,"datatype",n.datatype),_defineProperty(t,"colour",n.colour),_defineProperty(t,"cssTime",n.number),_defineProperty(t,"passageString",n.variable+";text-decoration:underline 1px;"),_defineProperty(t,"tagString",n.variable+";text-decoration:underline 1px dotted;"),_defineProperty(t,"variableOccurrence, hookOccurrence","background: hsla(159,50%,75%,1.0) !important;"),_defineProperty(t,"^=where, ^=via, ^=with, ^=making, ^=each, ^=when",n.lambda+"; font-style:italic;"),_defineProperty(t,"heading","font-weight:bold;"),_defineProperty(t,"hr","background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);"),_defineProperty(t,"align","color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);"),_defineProperty(t,"column","color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);"),_defineProperty(t,"escapedLine","font-weight:bold; color: hsla(51,100%,30%,1.0);"),_defineProperty(t,"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator",n.identifier),_defineProperty(t,"toString",function(){var e=this;return Object.keys(this).reduce(function(n,t){if("toString"===t)return n;var s=t.split(", ").map(function t(e){return-1<e.indexOf(".")?e.split(/\./g).map(t).join(""):0===e.indexOf("^=")?"[class^='"+o+e.slice(2)+"']":"."+o+e});return n+=s.join(", ")+"{"+e[t]+"}",e[t].match(a)&&[".theme-dark","[data-app-theme=dark]"].forEach(function(o){n+=s.map(function(e){return o+" "+e}).join(", ")+"{"+e[t].replace(a,function(o,e,t,n,s){return"hsla("+e+","+c(100,1.5*+t)+"%,"+(100-n)+"%,"+s+")"})+"}"}),n},"")}),t+"");"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports={Colours:n,CSS:r,versionClass:o}:"function"==typeof e&&e.amd&&e("utils/typecolours",[],function(){return{Colours:n,CSS:r,versionClass:o}})}.call(this),e("debugmode/highlight",["jquery","utils","utils/typecolours","macros","lexer"],function(a,n,s,t,o){var i=n.insensitiveName,e=s.versionClass,r=o.lex;return function(h,m,f,d){for(var o=r(h,"",m||"macro"),n=[],c="",l=o,s=o.start,u;s<o.end;s+=1)u=o.pathAt(s),u[0]!==l[0]&&(n.length&&(n[n.length-1].textContent=c),c="",l=u,n.push(a("<".concat(d&&f<=s&&s<d?"mark":"span",' class="').concat(function(a){for(var c={},l="",o=0,n,s;o<a.length;o+=1){var d=a[o],r=d.type,u=d.text;switch("verbatim"!==r&&"comment"!==r||(l=""),n=e+r,c[n]=(c[n]||0)+1,1<c[n]&&(n+="-"+c[n]),r){case"text":u.trim()&&a.slice(o+1).reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0)&&(n+=" ".concat(e,"error"));break;case"macroName":if(s=a[o].text[0],"_"===s||"$"===s){n+=" ".concat(e,"customMacro ").concat(e+("_"===s?"tempV":"v"),"ariable");break}s=i(a[o].text.slice(0,-1)),t.has(s)?n+="-"+t.get(s).returnType.toLowerCase():n+=" ".concat(e,"error")}l+=n+" "}return l}(l),'">'))[0])),c+=o.text[s-o.start];return n.length&&(n[n.length-1].textContent=c),n}}),e("debugmode/mode",["jquery","utils","utils/naturalsort","state","engine","internaltypes/varref","internaltypes/twineerror","utils/operationutils","utils/renderutils","passages","section","debugmode/panel","debugmode/highlight","utils/typecolours"],function(e,n,v,t,d,f,r,c,m,a,h,i,o,p){var u=c.objectName,g=c.isObject,s=c.toSource,b=c.typeID,j=m.dialog,y=p.CSS,l=function($,G){var p=n.escape,Y=n.nth,B=n.debounce,w=e(document.documentElement),V=v(),m={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400},O,T,U,k,X,x,F;if(t.hasStorage)try{O=localStorage.getItem("(Debug Options "+n.options.ifid+")"),O&&(m=JSON.parse(O))}catch(e){}function I(){if(t.hasStorage)try{localStorage.setItem("(Debug Options "+n.options.ifid+")",JSON.stringify(m))}catch(e){}}i.defaultMaxHeight=m.maxHeight;function S(e){return B(function(){if(n.options.debug)return e.apply(this,arguments)})}var c=e('<tw-debugger class="'.concat([m.darkMode?"theme-dark":"",m.fadePanel?"fade-panel":""].join(" "),'" style="').concat(m.width?"width:"+m.width+"px":"","\">\n<div class='panel panel-errors' hidden><table></table></div>\n<div class='tabs'></div>\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\n<button class='show-invisibles'>\ud83d\udd0d Debug View</button>\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\n<button class='close'>\u2716</button>\n<div class='resizer-h'>\n</tw-debugger>")),q=c.find(".tabs"),R=c.find(".show-dom"),N=c.find(".show-invisibles"),z=c.find(".close"),C=c.find(".turns");e(document.documentElement).on("click","tw-expression, tw-error, tw-eval-explanation",B(function(t){var n=e(t.target).data("evalReplay");n&&function(n){var t=0,l=j({buttons:[{name:"Understood",confirm:!0,callback:function(){return!c.find("tw-backdrop").length&&c.removeClass("show-dialog")}}]}),i=e("<tw-eval-replay>".concat(1===n.length?"":"<tw-eval-code></tw-eval-code>","<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>").concat(1===n.length?"":"<tw-dialog-links><tw-link style='visibility:hidden'>\u2190 10</tw-link><tw-link style='visibility:hidden'>\u2190 \u2190</tw-link><b></b><tw-link>\u2192 \u2192</tw-link><tw-link>10 \u2192</tw-link></tw-dialog-links>","</tw-eval-replay>"));l.find("tw-dialog").css({width:"75vw","max-width":"75vw"}).prepend(i);var d=i.find("tw-link:first-of-type"),u=d.next(),m=u.next(),h=m.next(),f=h.next();function a(){var g,c,a=n[t],l=i.find("tw-eval-explanation").empty(),v=i.find("tw-eval-code");a.toCode||a.toDesc||a.error||a.lambda?(i.find("tw-eval-code").empty().append(o(a.code,"macro",0<t&&a.start,0<t&&a.end+a.diff)),l.append(a.lambda?"":"<code class='".concat(56<a.fromCode.length?"from-block":"from-inline","'></code>"),a.error?"<span> caused an error: </span>":a.lambda?"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>":"<span> became".concat(a.ToDesc?"\u2026":""," </span>").concat(a.toDesc?"<span class='to-desc'>".concat(p(a.toDesc),".</span>"):"<code class='to-code'></code>")),a.error?l.append(a.error):a.lambda?(c=function(t,n){return e("<".concat(t,"><code></").concat(t,">")).find("code").append(o(n,"macro")).end()},l.find(".to-lambda").append(o(a.lambda.obj.source,"macro")).end().append((g=e("<table>")).append.apply(g,[e("<tr>").append(c("th","pos"),a.lambda.obj.loop?c("th","_"+a.lambda.obj.loop.getName()).append(" / ",e("<code>").append(o("it","macro"))):c("th","it"),a.lambda.obj.making&&c("th","_"+a.lambda.obj.making.getName()),a.lambda.obj.where&&c("th","where").append(" result"),a.lambda.obj.via&&c("th","via").append(" result"))].concat(_toConsumableArray(a.lambda.loops.map(function(t){var d=t.it,u=t.pos,i=t.making,n=t.whereResult,l=t.whereReplay,o=t.viaResult,t=t.viaReplay;return e("<tr>").append(c("td",s(u)),c("td",s(d)),void 0!==i&&c("td",s(i)),null!=n&&(r.containsError(n)?e("<td>").append(n.render(a.lambda.obj.source,!0)):c("td",s(n))).append(l&&e("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",l)),null!=o&&(r.containsError(o)?e("<td>").append(o.render(a.lambda.obj.source,!0)):c("td",s(o))).append(t&&e("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",t)))})))))):a.toDesc||l.find(".to-code").append(o(a.toCode,"macro")),l.next().html(a.itIdentifier?'(The <code class="cm-harlowe-3-identifier">it</code> identifier now refers to '.concat(p(a.itIdentifier),".)"):"").next().text(a.reason||"")):(v.html(o(a.code,"macro")),l.html("<center>First, there was <code></code>.</center>").next().empty().next().empty()),a.lambda||l.find("code").first().append(o(a.fromCode,"macro")),i.find("mark").each(function(t,e){e.scrollIntoView()}),d.css("visibility",t<=9?"hidden":"visible"),u.css("visibility",t<=0?"hidden":"visible"),h.css("visibility",t>=n.length-1?"hidden":"visible"),f.css("visibility",t>=n.length-10?"hidden":"visible"),m.html("( ".concat(t+1,"/").concat(n.length," )"))}a(),d.on("click",function(){t=Math.max(0,t-10),a()}),u.on("click",function(){t=Math.max(0,t-1),a()}),h.on("click",function(){t=Math.min(n.length-1,t+1),a()}),f.on("click",function(){t=Math.min(n.length-1,t+10),a()}),c.find("tw-backdrop").length?c.find("tw-backdrop").before(l):c.addClass("show-dialog").append(l)}(n),t.stopPropagation()})),c.find(".resizer-h").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=c.width();w.on("mousemove.debugger-resizer-h",function(e){e=e.pageX,c.width("".concat(n+t-e|0,"px"))}).on("mouseup.debugger-resizer-h",function(){w.off(".debugger-resizer-h"),m.width=c.width(),I()})}),c.on("mousedown",".resizer-v",function(t){if(1!==t.which)return!0;t.stopPropagation();var n=t.pageY,s=e(t.target.parentNode).height();w.on("mousemove.debugger-resizer-v",function(e){e=e.pageY,c.find(".panel").css("maxHeight","".concat(s+n-(0|e),"px"))}).on("mouseup.debugger-resizer-v",function(){w.off(".debugger-resizer-v"),m.maxHeight=c.find(".panel").css("maxHeight"),I()})}),N.click(function(){w.toggleClass("debug-mode").removeClass("dom-debug-mode"),N.toggleClass("enabled"),R.removeClass("enabled")}),R.click(function(){w.toggleClass("dom-debug-mode").removeClass("debug-mode"),R.toggleClass("enabled"),N.removeClass("enabled")}),z.click(function(){w.removeClass("debug-mode dom-debug-mode"),c.detach(),n.options.debug=!1}),T=S(function(){var n=C.children().get(),s=t.timeline,o=0;s.forEach(function(e,t){var s=e.turns,e=e.passage,e=(o+=1+(void 0===s?0:s))+": "+e;n[t]?n[t].textContent=e:C.append("<option value='"+t+"'>"+e+"</option>")}),s.length<n.length&&e(n.slice(s.length)).remove(),C[1<=s.length?"removeAttr":"attr"]("disabled")}),C.change(function(e){e=e.target.value-t.pastLength,0!=e&&(t[e<0?"rewind":"fastForward"](Math.abs(e)),d.showPassage(t.passage))}),T(),t.on("forward",T).on("load",T).on("forgetUndos",function(){return T}).on("back",function(){t.pastLength<=1&&C.attr("disabled"),C.find("[selected]").removeAttr("selected"),C.val(t.pastLength)});function L(e){(e=e.parents(".variable-row, .enchantment-row, .source-row")).next(".panel-row-source").find("td").empty().append(o(e.data("value")||s(e.data("enchantment").changer),e.is("source-row")?"markup":"macro"))}var M=new Set,E=i.create({className:"variables",tabName:"Variable",rowWrite:function(t,i){var h=t.name,l=t.dataset,d=t.path,n=t.value,a=t.tempScope,c=t.type,r=n&&48<n.length&&!n.TwineScript_DebugName,m=g(n)&&n.TwineScript_DebugName?n.TwineScript_DebugName():p(u(n)),t="";return d.length&&(t=d.reduce(function(e,t){return e+t+"'s "},"")),l&&(h="???"),l=c?s(c):"",c="object"===_typeof(n)||r,i?(i.find(".variable-type").html(l||""),t&&i.find(".variable-path").html((a?"_":"$")+p(t)),i.find(".variable-name").contents().last().replaceWith(e.parseHTML((t?"":a?"_":"$")+p(h+""))),i.find(".temporary-variable-scope").html(a||""),i.find(".variable-value").html(m),i.find("tw-folddown")[c?"show":"hide"](),r=i.next(".panel-row-source"),r.is(":visible")&&r.find("td").empty().append(o(s(n))),i.data("value",s(n)),i.add(r)):i=e('<div class="variable-row">').attr("data-name",h).attr("data-path",d+"").attr("data-scope",a||"").css("padding-left",Math.min(5,d.length)+"em").append("<td class='variable-type'>"+(l||"")+"</td>","<td class='variable-name cm-harlowe-3-"+(a?"tempV":"v")+"ariable'><span class='variable-path'>"+(t?(a?"_":"$")+p(t):"")+"</span> "+(t?"":a?"_":"$")+p(h+"")+"</td>","<td class='temporary-variable-scope'>"+(a||"")+"</td>","<td class='variable-value cm-harlowe-3-macroName-"+b(n)+"'>"+m+"</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:"+(c?"visible":"none")+"'>(source:) </tw-folddown></td>").data("value",s(n)).find("tw-folddown").data("folddown",L).end().add("<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>")},rowCheck:function(e,t){var n=e.name,s=e.path,e=e.tempScope;return t.attr("data-name")===n&&t.attr("data-path")===s+""&&t.attr("data-scope")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="variable-type">Type</th><th data-col="variable-name">Name</th><th data-col="temporary-variable-scope">Scope</th><th data-col="variable-value">Value</th></tr>'},rowSort:function(n,e,t){if("variable-value"===n)return V(e.attr("class"),t.attr("class"))||V(e.parent().data("value"),t.parent().data("value"))}}),H=S(function(){var n,e=[],s=t.variables,o=e.length;for(n in s)n.startsWith("TwineScript")||(o+=1,function i(n){var s,t,o;500<e.length||(e.push(n),s=n.path.concat(n.name),t=n.value,o=n.tempScope,s.length<=4&&(Array.isArray(t)?t.forEach(function(e,t){return i({name:Y(t+1),path:s,value:e,tempScope:o})}):t instanceof Map?_toConsumableArray(t).forEach(function(e){var e=(t=_slicedToArray(e,2))[0],t=t[1];return i({name:e,path:s,value:t,tempScope:o})}):t instanceof Set&&_toConsumableArray(t).forEach(function(e,t){return i({name:t,dataset:!0,path:s,value:e,tempScope:o})})))}({name:n,path:[],value:s[n],tempScope:"",type:s.TwineScript_TypeDefs&&s.TwineScript_TypeDefs[n]}));e.push.apply(e,_toConsumableArray(M)),o+=M.size,E.update(e,o),E.panel[(o?"remove":"add")+"Class"]("panel-variables-empty")});f.on("set",function(e,n,o){var s,i;e!==t.variables&&e.TwineScript_VariableStoreName&&!e.TwineScript_VariableStoreName.match(/#\d+$/)&&(s=e.TwineScript_VariableStoreName,i=e.TwineScript_TypeDefs&&e.TwineScript_TypeDefs[n],(e=_toConsumableArray(M).find(function(e){return e.name===n&&e.tempScope===s}))?e.value=o:M.add({name:n,path:[],value:o,tempScope:s,type:i})),H(),D()}).on("delete",function(){H(),D()}),E.panel.append("<div class='panel-variables-bottom'>\n			<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n			<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n		</div>").removeAttr("hidden"),E.tab.addClass("enabled"),U=E.panel.find(".clipboard"),w.on("click",".panel-variables-copy",function(){var e,n=[];for(e in t.variables)e.startsWith("TwineScript")||n.push("$"+e+" to "+s(t.variables[e]));U.val("(set:"+n+")")[0].select(),document.execCommand("copy")}),k=i.create({className:"enchantments",tabName:"Enchantment",rowWrite:function(t,a){var r=t.scope,n=t.changer,i=t.name,o=t.localHook,i=n?p(u(n)):"<em>enchanted via ("+i+":)</em>";return a||e('<div class="enchantment-row">').data("enchantment",t).append("<td><span class='enchantment-name'>"+s(r)+(o?"</span><span class='enchantment-local cm-harlowe-3-hookName'>"+("function"==typeof o.TwineScript_ToSource?o.TwineScript_ToSource():o.attr("name")?"?"+o.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value cm-harlowe-3-macroName-"+(n?"changer":"command")+" '>"+i+"</td>"+(n?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).find("tw-folddown").data("folddown",L).end().add(n?e("<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>"):"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="enchantment-name">Scope</th><th data-col="enchantment-value">Value</th></div>'}}),O=S(function(e){k.update(e.enchantments,e.enchantments.length)}),h.on("add",O).on("remove",O),X=h.create(),x=i.create({className:"storylets",tabName:"Storylet",rowWrite:function(t,n){var i=t.name,s=t.active,a=t.storyletSource,r=t.exclusive,t=t.urgent;return n?(n[(s?"remove":"add")+"Class"]("storylet-closed"),n.find(".storylet-open").text(s?"\u2713":""),n):(t=e('<tr class="storylet-row '.concat(s?"":"storylet-closed",'">')).attr("data-name",i).append("<td class='storylet-open'>"+(s?"\u2713":"")+"</td><td class='storylet-name'>"+i+"</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>"+r+"</td><td class='storylet-urgent'>"+t+"</td>"),t.find(".storylet-lambda").append(o(a.replace(/^when\s+/i,""))),t)},rowCheck:function(e,t){return e=e.name,t.attr("data-name")===p(e+"")},columnHead:function(){return'<tr class="panel-head"><th data-col="storylet-open" data-order="desc">Open</th><th data-col="storylet-name">Name</th><th data-col="storylet-lambda">Condition</th><th data-col="storylet-exclusive" class=\'storylet-exclusive\'>Exclusivity</th><th data-col="storylet-urgent" class=\'storylet-urgent\'>Urgency</th></tr>'}}),x.tab.hide();var D=S(function(){var e,t,n=a.getStorylets(X),s=r.containsError(n),o=a.allStorylets();x.update(o.map(function(o){var i="number"==typeof o.get("exclusivity")?o.get("exclusivity"):0,a="number"==typeof o.get("urgency")?o.get("urgency"):0;return e=e||i,t=t||i,{name:o.get("name"),storyletSource:o.get("storylet").TwineScript_ToSource(),active:!s&&n.some(function(e){return e.get("name")===o.get("name")}),exclusive:i,urgent:a}}),s?0:n.length),x.panel[(s?"add":"remove")+"Class"]("storylet-error"),x.panel[(e?"add":"remove")+"Class"]("panel-exclusive"),x.panel[(t?"add":"remove")+"Class"]("panel-urgent"),o.length&&x.tab.show()}),A=i.create({className:"source",tabName:"Source",tabNameCounter:!1,rowWrite:function(t,n){var s=t.name,t=t.tag;return n?n.add(n.next(".panel-row-source")):(n=a.get(s).get("source"),e('<div class="source-row" data-tag="'.concat(t,'">')).data("value",n).append('<td class="source-name">'.concat(s,'</td><td class="source-tags">').concat(t,"</td><td class='panel-row-buttons'><tw-folddown class='").concat(t?"":"open","' tabindex=0></tw-folddown></td>")).find("tw-folddown").data("folddown",L).end().add(e("<tr class='panel-row-source' style='".concat(t?"display:none":"","'><td colspan='3'></td></tr>")).find("td").append(!t&&o(n,"markup")).end()))},rowCheck:function(e,t){return e=e.name,t.find(".source-name").text()===p(e+"")},tabUpdate:e.noop,columnHead:e.noop}),K=["debug-startup","startup","header","debug-header","footer","debug-footer"].reduce(function(t,e){return t.concat(a.getTagged(e).map(function(t){return{name:t.get("name"),tag:e}}))},[]),_=i.create({className:"errors",tabName:"Error",rowWrite:e.noop,rowCheck:e.noop,columnHead:e.noop,tabUpdate:function(e){return _.tab.css({background:e?"rgba(230,101,204,0.3)":""}).text("".concat(e," Error").concat(1!==e?"s":""))}}),z=B(function(s){var o;n.options.debug&&(_.panelRows.append(s.reduce(function(s,e){var n=_slicedToArray(e,2),e=n[0],n=n[1];return"propagated"===e.type?s:s+'<tr class="error-row"><td class="error-passage">'+t.passage+'</td><td class="error-message" title="'+p(n)+'">'+e.message+"</td></tr>"},"")),500<(s=(o=_.panelRows.children()).length)&&e(Array.prototype.slice.call(_.panelRows[0].childNodes,0,s-500)).remove(),_.tabUpdate(Math.min(500,o.length)))},{batch:!0});r.on(z),_.panel.append("<div class='panel-errors-bottom'>\n			<button class='panel-errors-clean'>\ud83e\uddf9 Clear this panel</button>\n		</div>"),w.on("click",".panel-errors-clean",function(){_.panelRows.empty(),_.tabUpdate(0)}),O=i.create({className:"options",tabName:"\u2699\ufe0f",tabNameCounter:!1,rowWrite:function(t,s){var n=t.name,o=t.label,t={darkMode:m.darkMode,fadePanel:m.fadePanel,evalReplay:m.evalReplay}[n];return s?s.find("input").prop("checked",t):e('<span><input id="debug-'.concat(n,'" type="checkbox" ').concat(t?"checked":"",'></input><label for="debug-').concat(n,'">').concat(o,"</label></span>"))},rowCheck:e.noop,tabUpdate:e.noop,columnHead:e.noop}),w.on("click",'.panel-options [type="checkbox"]',function(s){var t=s.target,s=(t=e(t)).attr("id"),t=t.is(":checked");"debug-darkMode"===s&&(m.darkMode=t,c[(t?"add":"remove")+"Class"]("theme-dark")),"debug-fadePanel"===s&&(m.fadePanel=t,c[(t?"add":"remove")+"Class"]("fade-panel")),"debug-evalReplay"===s&&(n.options.evalReplay=m.evalReplay=t),I()}),O.update([{name:"darkMode",label:"Debug panel is dark"},{name:"fadePanel",label:"Debug panel is transparent unless the cursor is over it"},{name:"evalReplay",label:"Record expression replays (viewable via \ud83d\udd0d buttons in Debug View; slower)"}]),c.prepend(E.panel,k.panel,_.panel,x.panel,A.panel,O.panel),q.prepend(E.tab,k.tab,_.tab,x.tab,A.tab,O.tab);function P(){return M=new Set}t.on("beforeForward",P).on("beforeBack",P).on("beforeLoad",P),F=S(function(){H(),D(),k.panelRows.empty(),k.tabUpdate(0),t.passage&&a.get(t.passage)&&(A.update(K.concat({name:t.passage,tag:""})),A.panel.find('[data-tag=""], [data-tag=""] + .panel-row-source').insertBefore(A.panel.find('[data-tag="footer"]').first()))}),t.on("forward",F).on("back",F).on("load",F);function W(){e(document.body).append(c),n.options.debug=!0,n.options.evalReplay=m.evalReplay,F()}l=W,e(document.head).append(e("<style>").html(y)),W(),$&&z($,G)};return d.registerDebugMode(function(e,t){return!n.options.debug&&l(e,t)}),l}),e("macrolib/values",["macros","state","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","datatypes/codehook","internaltypes/twineerror"],function(r,m,i,a,n,O,j,k,g,t){var F=i.realWhitespace,w=i.nth,_=i.anyRealLetter,M=i.plural,S=a.subset,p=a.objectName,h=a.clone,A=a.toSource,e=r.TypeSignature,o=e.rest,E=e.zeroOrMore,x=e.either,u=e.optional,C=e.insensitiveSet,d=e.numberRange,s=e.percent,i=e.nonNegativeInteger,a=e.positiveInteger,e=e.Any,y=Math.max,b=Math.min,c=Math.round,f=Math.floor,v=Math.ceil;function l(e){return function(){var n=e.apply(void 0,arguments);return"number"!=typeof n||isNaN(n)?t.create("macrocall","This mathematical expression doesn't compute!"):n}}r.add(["str","string","text"],"String",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return n.map(function(e){return g.isPrototypeOf(e)?e.source:e}).join("")},[E(r.TypeSignature.either(String,Number,Boolean,Array,g))])("source","String",function(n,e){return e&&"command"===e.TwineScript_TypeID&&!e.TwineScript_ToSource?t.create("datatype","I can't construct the source code of a command created by a custom macro."):A(e)},[e])("substring","String",function(s,e,t,n){return S(e,t,n)},[String,parseInt,parseInt])("lowercase","String",function(t,e){return e.toLowerCase()},[String])("uppercase","String",function(t,e){return e.toUpperCase()},[String])("lowerfirst","String",function(t,e){return e.replace(RegExp(_+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst","String",function(t,e){return e.replace(RegExp(_+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words","Array",function(t,e){return e.split(RegExp(F+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],"String",function(s,n,e){return 0===e.length?t.create("macrocall","I can't repeat an empty string."):e.repeat(n)},[i,String])(["str-reversed","string-reversed"],"String",function(t,e){return _toConsumableArray(e).reverse().join("")},[String])("joined","String",function(o,s){for(var t=arguments.length,n=new Array(2<t?t-2:0),e=2;e<t;e++)n[e-2]=arguments[e];return n.join(s)},[o(String)])("plural","String",function(o,s,e,n){return e&&""!==n?M(s,e,n):t.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,u(String)])(["str-nth","string-nth"],"String",function(t,e){return w(e)},[parseInt])("digit-format","String",function(m,e,a){if(1e21<=Math.abs(a))return t.create("macrocall","The number given to (digit-format:) is too big.");var u=/([^#0])(?=[#0]*$)/g,d=(u.exec(e)||[])[1],c=(/^[#0]*([^#0])/g.exec(e)||[])[1],r=(e=_toConsumableArray(e)).length;d&&(","!==d||c&&","!==c)&&(r=u.lastIndex-1);for(var i=Math.abs(a).toFixed(16).replace(/(\.\d*?)0+$/,function(t,e){return e}).replace(/^0+/,""),h=i.includes(".")?i.indexOf("."):i.length,l=0,s="",n=e.length-1,o;0<=n;--n)o=e[n],"0"===o||"#"===o?s=(i[h-r+n+l]||("0"===o?"0":""))+s:n<e.length-1&&0<n&&(s=o+s,l+=n===r?0:1);return(a<0?"-":"")+s},[String,Number])(["num","number"],"Number",function(n,e){return Number.isNaN(+e)?t.create("macrocall","I couldn't convert "+p(e)+" to a number."):+e},[String])("datatype","Datatype",function(t,e){return j.from(e)},[e])("datapattern","Any",function(n,e){return function s(e){var n;return Array.isArray(e)?n=e.map(s):e instanceof Map?(n=new Map,_toConsumableArray(e).forEach(function(t){var e=_slicedToArray(t,2),t=e[0],e=e[1];return n.set(t,s(e))})):n=j.from(e),(e=t.containsError(n))||n}(e)},[e])(["rgb","rgba"],"Colour",function(){return n.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[d(0,255),d(0,255),d(0,255),u(s)])(["hsl","hsla"],"Colour",function(i,e,t,s,o){return(e=c(e)%360)<0&&(e+=360),n.create({h:e,s:t,l:s,a:o})},[Number,s,s,u(s)])(["lch","lcha"],"Colour",function(i,t,s,e,o){return(e=c(e)%360)<0&&(e+=360),n.create({l:t,c:s,h:e,a:o})},[s,d(0,132),Number,u(s)])("complement","Colour",function(t,e){return e.LCHRotate(180)},[n])("mix","Colour",function(l,o,e,s,t){e=e.toLCHA(),t=t.toLCHA(),r=1,o+s!==1&&(o+s<1&&(r=o+s),o=(a=[o/(o+s),s/(o+s)])[0],s=a[1]),e.c<2||e.l<.01||.99<e.l?e.h=t.h:(t.c<2||t.l<.01||.99<t.l)&&(t.h=e.h),e.l*=e.a,e.c*=e.a,t.l*=t.a,t.c*=t.a,180<t.h-e.h?e.h+=360:t.h-e.h<-180&&(t.h+=360);var r,i=e.a*o+t.a*s,c=(e.l*o+t.l*s)/i,a=(e.c*o+t.c*s)/i,s=(e.h*o+t.h*s)/i;return n.create({l:c,c:a,h:s,a:i*r})},[s,n,s,n])("palette","Array",function(r,i,a){var s=a.toLCHA(),o=s.l,e={l:o<=.75?.75+o/3:.75-3*(1-o),c:80,h:s.h,a:1},t=n.create(e);return e.l+=o<=.75?-.1:.1,e.l<.5&&(e.l*=.5/e.l),s=n.create(e),e.l+=o<=.85?.15:-.15,e=n.create(e),"adjacent"===i?(s=(t=t.LCHRotate(-30)).LCHRotate(30),e=t.LCHRotate(60)):"triad"===i&&(e=t.LCHRotate(180),s=t.LCHRotate(140),t=t.LCHRotate(-140)),[a,t,s,e]},[C("mono","adjacent","triad"),n])("gradient","Gradient",function(d,s){(s=c(s)%360)<0&&(s+=360);for(var e,i=arguments.length,a=new Array(2<i?i-2:0),o=2,r,l;o<i;o++)a[o-2]=arguments[o];return a.length<4?t.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours."):(r=[],l=a.reduce(function(s,o){if(t.containsError(s))return s;if(void 0===e)e=o;else{if("number"!=typeof e||!n.isPrototypeOf(o))return t.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");r.push({stop:e,colour:h(o)}),e=void 0}return s},!0),t.containsError(l)?l:void 0!==e?t.create("macrocall","This gradient has a colour-stop percent without a colour."):O.create(s,r))},[Number,o(x(s,n))])("stripes","Gradient",function(r,e,a){(e=c(e)%360)<0&&(e+=360);for(var n=0,s=[],o=arguments.length,i=new Array(3<o?o-3:0),t=3;t<o;t++)i[t-3]=arguments[t];return i.forEach(function(e){s.push({stop:n,colour:h(e)}),n+=a,s.push({stop:n,colour:h(e)})}),O.create(e,s,!0)},[Number,a,n,o(n)])("hooks-named","HookName",function(n,e){return e?k.create({type:"name",data:e}):t.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond","Any",function(){for(var i=arguments.length,e=new Array(1<i?i-1:0),o=1,n,s;o<i;o++)e[o-1]=arguments[o];for(n=0;n<e.length;n+=2){if(s=e[n],n===e.length-1||t.containsError(s))return s;if("boolean"!=typeof s)return t.create("datatype","(cond:)'s "+w(n+1)+" value is "+p(s)+", but should be a boolean.");if(s)return e[n+1]}return t.create("macrocall","An odd number of values must be given to (cond:), not "+e.length,"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,e,o(e)]),{weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[b,o(Number)],max:[y,o(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[f,Number],round:[c,Number],trunc:[function(e){return(0<e?f:v)(e)},Number],ceil:[v,Number],pow:[l(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[l(Math.sqrt),Number],log:[l(Math.log),Number],log10:[l(Math.log10),Number],log2:[l(Math.log2),Number],random:[function(e,n){var t,e=n?(t=b(e,n),y(e,n)):(t=0,e);return e+=1,~~(m.random()*(e-t))+t},[parseInt,r.TypeSignature.optional(parseInt)]],"":function(){for(var e in this)e&&hasOwnProperty.call(this,e)&&r.add(e,"Number",function(e){return function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];return e.apply(void 0,s)}}(this[e][0]),this[e][1])}}[""](),r.add("either","Any",function(){var e=1+~~(m.random()*(arguments.length<=1?0:arguments.length-1));return e<1||arguments.length<=e?void 0:arguments[e]},o(e))("nth","Any",function(n,e){return e<=0?t.create("datatype","(nth:)'s first value should be a positive whole number, not "+e):(e=(e-1)%(arguments.length<=2?0:arguments.length-2)+2)<2||arguments.length<=e?void 0:arguments[e]},[parseInt,o(e)])}),e("macrolib/commands",["jquery","macros","utils","state","passages","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(l,a,n,o,m,d,e,V,T,h,b,v,_,N,L,r,f,p){var y=f.printBuiltinValue,A=f.objectName,I=f.clone,E=f.toSource,g=p.dialog,w=p.geomParse,B=p.geomStringRegExp,t=a.TypeSignature,O=t.Any,R=t.Everything,u=t.rest,c=t.either,s=t.optional,F=t.zeroOrMore,D=t.percent,f=t.nonNegativeInteger,x=t.positiveInteger,p=t.positiveNumber,i=Object.assign,M=Math.floor,S=Math.ceil,k=Math.abs,P=Math.max,H=Math.min,t=l.noop,C;function j(e){return"("+e+" "+n.options.ifid+") "}["set","put","unpack"].forEach(function(t){return a.add(t,"Instant",function(){for(var o=0,s;o<(arguments.length<=1?0:arguments.length-1);o+=1){if(s=o+1<1||arguments.length<=o+1?void 0:arguments[o+1],"into"===s.operator&&"set"===t)return e.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===s.operator&&"set"!==t)return e.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((N.isPrototypeOf(s.dest)||L.isPrototypeOf(s.dest))===("unpack"===t))return e.create("macrocall","unpack"===t?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the ("+t+":) macro with just single variables and typed variables to the "+("set"===t?"left of 'to'.":"right of 'into'."),"You may wish to change this to the (".concat("unpack"!==t?"unpack":"to"===s.operator?"set":"put",":) macro."));if(s=s.set(),e.containsError(s))return s}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a ("+t+":) operation",TwineScript_ObjectName:"a ("+t+":) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return n.options.debug,""}}},[u(T)])}),a.add("move","Instant",function(){for(var t=0,s;t<(arguments.length<=1?0:arguments.length-1);t+=1){if(s=t+1<1||arguments.length<=t+1?void 0:arguments[t+1],"into"!==s.operator)return e.create("macrocall","Please say 'into' when using the (move:) macro.");if(s=s.set(!0),e.containsError(s))return s}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return n.options.debug,""}}},[u(T)]),a.addCommand("display",function(t){if(!m.hasValid(t))return e.create("macrocall","I can't (display:) the passage '"+t+"' because it doesn't exist.")},function(e,n,t){return e.source=m.getTree(t),e},[String])("print",t,function(e,n,t){return i(e,{source:y(t)})},[O])(["verbatim-print","v6m-print"],t,function(e,n,t){return i(e,{verbatim:!0,source:y(t)})},[O])(["verbatim-source","v6m-source"],function(t){if(t&&"command"===t.TwineScript_TypeID&&!t.TwineScript_ToSource)return e.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,n,t){return i(e,{verbatim:!0,source:y(E(t))})},[O])("go-to",function(t){if(!m.hasValid(t))return e.create("macrocall","I can't (go-to:) to the passage '".concat(t,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,n,t){return requestAnimationFrame(function(){return d.goToPassage(t,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("redirect",function(t){if(!m.hasValid(t))return e.create("macrocall","I can't (redirect:) to the passage '".concat(t,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,n,t){return requestAnimationFrame(function(){return d.redirect(t,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("undo",t,function(e,n,t){return o.pastLength<1?i(e,{source:t}):(requestAnimationFrame(function(){return d.goBack({transition:e.data.passageT8n})}),{blocked:!0})},[s(String)])("debug",t,d.enableDebugMode,[],!1),n.onStartup(function(){return n.storyElement.on("click.icon","tw-icon",function(t){var n=l(this),s=n.data("clickEvent"),e=n.attr("alt");s&&s(n),"Undo"===e&&(t.stopPropagation(),d.goBack()),"Redo"===e&&(t.stopPropagation(),d.goForward()),"Fullscreen"===e&&(t.stopPropagation(),d.toggleFullscreen()),"Restart"===e&&(o.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return 0<o.pastLength}],["Redo","&#8631;",function(){return 0<o.futureLength}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(n){var n=_slicedToArray(n,3),t=n[0],o=n[1],r=n[2];a.addCommand("icon-".concat(t.toLowerCase()),function(n,s){if("string"==typeof n&&"string"==typeof s)return n=_toConsumableArray(n).length,s=_toConsumableArray(s).length,1<n&&1<s?e.create("datatype","One of the two strings given to (icon-".concat(t.toLowerCase(),":) should be 1 character long, for its icon.")):1===n&&1===s?e.create("datatype","One of the two strings given to (icon-".concat(t.toLowerCase(),":) should be 2 or more characters long, for its label.")):void 0},function(s,c,n,e){var a;return("string"==typeof e&&1===_toConsumableArray(e).length||"string"==typeof n&&1<_toConsumableArray(n).length)&&(n=(a=[e,n])[0],e=a[1]),"Undo"===t&&(s.data.forgetUndosEvent=function(e){s.section.whenUnblocked(function(){return l(e).css("visibility","hidden")})}),i(s,{source:'<tw-icon tabindex=0 alt="'.concat(t,'" ').concat(e?'data-label="'.concat(e.replace('"',"&quot;"),'"'):"",' title="').concat(t,'" ').concat(r()?"":'style="visibility:hidden"',">").concat(n||o,"</tw-icon>")})},[s(String),s(String)])}),a.addCommand("icon-counter",function(o,t,n){var s=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:e.create("datatype","The 2nd "+s):e.create("datatype","The 1st "+s)},function(s,c,a,r,o){s.attr.push({"data-2bind":!0}),s.data.twoWayBindEvent=function(n,t,e){!a.varRef.matches(t,e)||"number"==typeof(e=a.varRef.get())&&s.target.children("tw-icon").text((0<e?M:S)(e)).attr("data-label",1!==k(e)&&void 0!==o?o:r)};var t=a.varRef.get();return"number"!=typeof t?e.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not ".concat(A(t),".")):i(s,{source:'<tw-icon data-label="'.concat(n.escape(1!==k(t)&&void 0!==o?o:r),'">').concat((0<t?M:S)(t),"</tw-icon>")})},[r,String,s(String)]),a.addCommand("meter",function(s,o,t,n){return"two way"===s.bind?e.create("datatype","(meter:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".'):"string"!=typeof n||n.trim()?-1===t.search(B)||!t.includes("=")&&1<t.length?e.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(t)+"."):void 0:e.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(a,r,l,u,s,n,t){n&&"string"!=typeof n&&(t=n,n=void 0),t=t||v.create({h:0,s:0,l:.5,a:.5}),v.isPrototypeOf(t)&&(t=_.create(90,[{colour:t,stop:0},{colour:t,stop:1}]));function d(e){var n=P(0,H(1,e/u)),e=t.repeating?t:t.multiply(u/e);return"height:100%;background-repeat:no-repeat;background-image:".concat((c?i(e,e.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+i(e,e.repeating?{}:{angle:c||0===o?90:270}).toLinearGradientString(),";background-size:").concat(c?Array(2).fill(50*n+"%"):100*n+"%",";background-position-x:").concat(c?-100/(2-n)+100+"%,"+100/(2-n)+"%":0===o?"left":"right",";text-align:").concat(c?"center":0===o?"left":"right")}var s=w(s),o=s.marginLeft,s=s.size,c=0<o&&Math.ceil(o+s)<100,h;return a.styles.push({"margin-left":o+"%",width:s+"%",height:"1.5em",display:"block"}),a.attr.push({"data-2bind":!0}),h=n&&r.stackTop.tempVariables,a.data.twoWayBindEvent=function(s,e,t){!l.varRef.matches(e,t)||"number"==typeof(e=l.varRef.get())&&((t=a.target.children("tw-meter")).attr("style",d(e)),n&&a.section.renderInto("",null,{source:n,target:t,append:"replace",transitionDeferred:!1},h))},r=l.varRef.get(),"number"!=typeof r?e.create("datatype","(meter:) can only be bound to a variable holding a number, not ".concat(A(r),".")):i(a,{source:'<tw-meter style="'.concat(d(r),'">').concat(n||"","</tw-meter>")})},[r,p,String,s(c(String,v,_)),s(c(v,_))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(t,n){return a.addCommand(t,function(){return""===(arguments.length<=0?void 0:arguments[0])?e.create("datatype","The first string in a ("+t[0]+":) can't be empty."):arguments.length<=(r.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?e.create("datatype","I need two or more strings to "+(n?"sequence":"cycle")+" through, not just '"+((s=arguments.length-1)<0||arguments.length<=s?void 0:arguments[s])+"'."):void 0;var s},function(a,c){for(var o,d=arguments.length,t=new Array(2<d?d-2:0),l=2,s,m,u;l<d;l++)t[l-2]=arguments[l];r.isPrototypeOf(t[0])&&(o=t.shift()),s=0,o&&"two way"===o.bind&&(a.attr.push({"data-2bind":!0}),-1<(u=t.indexOf(o.varRef.get()))&&(s=u)),m=c.stackTop.tempVariables;function h(d,r){var l=s>=t.length-1&&n,c=""===t[s]?"":l?t[s]:"<tw-link>"+t[s]+"</tw-link>";if(l&&(a.data.clickEvent=void 0),o&&!r)if(r=o.set(t[s]),e.containsError(r))return void d.replaceWith(r.render(t[s]));c=i({},a,{source:c,transitionDeferred:!1}),a.section.renderInto("",null,c,m)}if(t[s]&&(a.data.clickEvent=function(e){s=(s+1)%t.length,h(e,!1)})&&(a.data.twoWayBindEvent=function(n,i,e){o.varRef.matches(i,e)&&(e=o.varRef.get(),-1<(e=t.indexOf(e))&&e!==s&&(s=e,h(n,!0)))}),u="<tw-link>"+t[s]+"</tw-link>",o)if(c=o.set(t[s]),e.containsError(c))return c;return i(a,{source:u,append:"replace",transitionDeferred:!0})},[c(r,String),u(String)])}),n.onStartup(function(){return n.storyElement.on("change.dropdown-macro","select",function(){var e=l(this),t=e.closest("tw-expression, tw-hook").data("dropdownEvent");t&&t(e)})}),a.addCommand("dropdown",function(){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===((t=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=t?void 0:arguments[t])?e.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?e.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(o,m,t){for(var d=arguments.length,s=new Array(3<d?d-3:0),c=3,a,u,h,r;c<d;c++)s[c-3]=arguments[c];return a=0,"two way"===t.bind&&(o.attr.push({"data-2bind":!0}),-1<(r=s.indexOf(t.varRef.get()))&&(a=r)),u=Math.max.apply(Math,_toConsumableArray(s.map(function(e){return _toConsumableArray(e).length}))),h="<select>"+s.map(function(e,t){return"<option"+(t===a?" selected":"")+(""===e?" disabled":"")+">"+n.escape(e||"\u2500".repeat(u))+"</option>"}).join("\n")+"</select>",o.data.dropdownEvent=function(n){var s=n.val(),o=t.set(s);e.containsError(o)&&n.replaceWith(o.render(s))},o.data.twoWayBindEvent=function(o,e,n){t.varRef.matches(e,n)&&(e=t.varRef.get(),-1<(n=s.indexOf(e))&&n!==a&&(o.find("select").val(e),a=n))},o.styles.push({"background-color":function(){return n.parentColours(l(this)).backgroundColour}}),r=t.set(s[a]),e.containsError(r)?r:i(o,{source:h,append:"replace"})},[r,String,u(String)]),n.onStartup(function(){return n.storyElement.on("input.checkbox-macro","input[type=checkbox]",function(){var e=l(this),t=e.closest("tw-expression").data("checkboxEvent");t&&t(e)})}),C=1,a.addCommand("checkbox",function(){},function(n,c,t,r){var o=!1,a="checkbox-"+ ++C,s;return"two way"===t.bind&&(n.attr.push({"data-2bind":!0}),"boolean"==typeof(s=t.varRef.get())&&(o=s),n.data.twoWayBindEvent=function(n,s,e){!t.varRef.matches(s,e)||"boolean"==typeof(e=t.varRef.get())&&n.children("input[type=checkbox]").prop("checked",e)}),n.data.checkboxEvent=function(s){var n=s.is(":checked"),n=t.set(n);e.containsError(n)&&s.replaceWith(n.render(""))},s=t.set(o),e.containsError(s)?s:i(n,{source:'<input id="'.concat(a,'" type="checkbox" ').concat(o?"checked":"",'><label for="').concat(a,'">').concat(r,"</label>"),append:"replace"})},[r,String]),n.onStartup(function(){return l(document).on("fullscreenchange",function(){l("input[type=checkbox][id^=fullscreen]",n.storyElement).each(function(t,e){(l(e).closest("tw-expression").data("fullscreenEvent")||Object)(e)})})}),a.addCommand("checkbox-fullscreen",function(){},function(e,s,n){var t="fullscreenCheckbox-"+ ++C;return e.data.fullscreenEvent=function(e){return l(e).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},e.data.checkboxEvent=function(){return d.toggleFullscreen()},i(e,{source:'<input id="'.concat(t,'" type="checkbox" ').concat(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ").concat(document.fullscreenElement||document.msFullscreenElement?"checked":"",'><label for="').concat(t,'">').concat(n,"</label>"),append:"replace"})},[String]),n.onStartup(function(){return n.storyElement.on("input.input-box-macro","textarea, input[type=text]",function(){var e=l(this),t=e.closest("tw-expression").data("inputBoxEvent");t&&t(e)})}),["input","force-input","input-box","force-input-box"].forEach(function(t){return a.addCommand(t,function(){for(var d=arguments.length,n=new Array(d),i=0;i<d;i++)n[i]=arguments[i];var a=t.endsWith("box"),s=r.isPrototypeOf(n[0]),l="string"==typeof n[+s],c=a&&"number"==typeof n[l+s],o=l?n[+s]:n[s+c],a=0<w(o).size,o=a?n[s+c+l]:o;return t.startsWith("force")&&"string"!=typeof o?e.create("datatype","The (".concat(t,":) macro requires a string of text to forcibly input.")):n.length>s+c+a+("string"==typeof o)?e.create("datatype","An incorrect combination of values was given to this (".concat(t,":) macro.")):void 0},function(h){for(var g=arguments.length,c=new Array(2<g?g-2:0),p=2;p<g;p++)c[p-2]=arguments[p];var u=t.startsWith("force"),m=t.endsWith("box"),s=r.isPrototypeOf(c[0]),a="string"==typeof c[+s],l=m&&"number"==typeof c[a+s],o=s&&c[0],b=l?c[1+s]:3,d=a?w(c[+s]):{},j=d.marginLeft,d=d.size,f=(d?c[s+l+a]:a&&c[+s])||"",l=u?"":f,a=!1,v;if("two way"===o.bind){if(h.attr.push({"data-2bind":!0}),s=o.varRef.get(),"string"==typeof s)if(l=u?f.slice(0,s.length):s,s=o.set(l),a=!0,e.containsError(s))return s;h.data.twoWayBindEvent=function(t,n,e){!o.varRef.matches(n,e)||"string"==typeof(e=o.varRef.get())&&t.find(m?"textarea":"input").val(u?f.slice(0,e.length):e)}}if(o&&!a)if(a=o.set(u?"":f),e.containsError(a))return a;return!u&&o&&(h.data.inputBoxEvent=function(n){var t=n.val(),t=o.set(t);e.containsError(t)&&n.replaceWith(t.render(""))}),l="<".concat(m?"textarea":"input type=text",' style="width:100%" ').concat(m?"rows=".concat(b,">"):'value="').concat(n.escape(l)).concat(m?"</textarea>":'">'),u&&(v=Array.from(f),h.data.inputBoxEvent=function(n){var t=n.val().length,t=v.slice(0,t).join("");return n.val(t),o&&(t=o.set(t),e.containsError(t)&&n.replaceWith(t.render(""))),!0}),h.styles.push({display:"block","margin-left":d?j+"%":void 0,width:d?d+"%":"100%","border-style":function(){return this.style.borderStyle||"solid"}}),i(h,{source:l,append:"replace"})},t.endsWith("box")?[c(r,String),s(c(x,String)),s(c(x,String)),s(String)]:[s(c(r,String)),s(String),s(String)])}),["show","rerun"].forEach(function(t){return a.addCommand(t,function(){for(var n,s=arguments.length,o=new Array(s),t=0;t<s;t++)o[t]=arguments[t];return o.some(function o(t){var s=t.selector,t=t.next;return"name"===s.type&&"page"===s.data?(n=e.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===s.type&&o(s.data)||t&&o(t))||void 0}),n},function(s,a){for(var n=arguments.length,r=new Array(2<n?n-2:0),e=2;e<n;e++)r[e-2]=arguments[e];return r.forEach(function(e){return e.forEach(a,function(e){var r,d,c,n=e.data("hidden");void 0!==n!=("rerun"===t)&&(e.removeData("hidden"),n instanceof l?e.empty().append(n):(r=e.data("tempVariables"),n=(d="tw-passage"===e.tag())?m.getTree(o.passage):e.data("originalSource")||"",d&&(c=e.find("tw-sidebar").detach()),a.renderInto("",null,i({},s,{append:"replace",source:n,target:e}),r&&Object.create(r)),c&&e.prepend(c)))})}),s},[u(h)])});function z(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]}a.addCommand("hide",function(){for(var n,s=arguments.length,o=new Array(s),t=0;t<s;t++)o[t]=arguments[t];return o.some(function o(t){var s=t.selector,t=t.next;return"name"===s.type&&"page"===s.data?(n=e.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===s.type&&o(s.data)||t&&o(t))||void 0}),n},function(i){for(var t=arguments.length,s=new Array(1<t?t-1:0),e=1,n,o;e<t;e++)s[e-1]=arguments[e];for(n=0,o=s;n<o.length;n++)o[n].forEach(i,function(e){Boolean(e.data("hidden"))||e.data("hidden",e.contents().detach())})},[u(h)],!1)("scroll",t,function(t,s,e){var n="number"==typeof e&&e;requestAnimationFrame(function(){s.forEach(t,function(s){if(!1!==n)s[0].scrollTo&&s[0].scrollTo(0,(s[0].scrollHeight-s[0].clientHeight)*n);else{i=_createForOfIteratorHelper(e.hooks(t).get());try{for(i.s();!(c=i.n()).done;)if(l=c.value,s.find(l)){for(d=[],o=s[0];o=o.parentNode;)d.push([o,o.scrollLeft,o.scrollTop]);l.scrollIntoView();for(a=0,u=d;a<u.length;a++){var c,i,l,d,o,a,u,r=_slicedToArray(u[a],3),h=r[0],m=r[1],f=r[2];h.scrollLeft=m,h.scrollTop=f}break}}catch(e){i.e(e)}finally{i.f()}}})})},[h,c(D,h)],!1)("stop",t,t,[],!1)("load-game",t,function(n,s){if(n.loadedGame)return e.create("infinite","I can't use (load-game:) immediately after loading a game.");var t=localStorage.getItem(j("Saved Game")+s),i;if(!t)return e.create("saving","I can't find a save slot named '"+s+"'!");if(t=o.deserialise(n,t),t instanceof Error)return i=g({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+t.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===i.find("input").last().val()&&localStorage.removeItem(j("Saved Game")+s),n.unblock("")}},{name:"No",cancel:!0,callback:function(){return n.unblock()}}]}),{blocked:i};requestAnimationFrame(d.showPassage.bind(d,o.passage,{loadedGame:!0}))},[String],!1)("forget-undos",t,function(t,e){o.futureLength||o.forgetUndos(e)},[parseInt],!1)("forget-visits",t,function(t,e){o.forgetVisits(e)},[parseInt],!1)("mock-visits",function(){if(!n.options.debug)return e.create("debugonly","(mock-visits:) cannot be used outside of debug mode.");for(var s=arguments.length,o=new Array(s),t=0,i;t<s;t++)o[t]=arguments[t];return i=o.find(function(e){return!m.hasValid(e)}),i?e.create("datatype","I can't mock-visit '"+i+"' because no passage with that name exists."):void 0},function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];o.mockVisits=I(n)},[u(String)],!1)("mock-turns",function(){if(!n.options.debug)return e.create("debugonly","(mock-turns:) cannot be used outside of debug mode.")},function(t,e){o.mockTurns=e},[f],!1)("seed",t,function(t,e){o.setSeed(e)},[String],!1)(["dialog","alert"],function(a,t){for(var o=arguments.length,i=new Array(2<o?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];if(r.isPrototypeOf(a)){{if("two way"===a.bind)return e.create("datatype","(dialog:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".');if(void 0===t)return e.create("datatype","(dialog:) needs a message string or codehook to display.")}}else void 0!==t&&i.unshift(t);if(t=i.findIndex(function(e){return""===e}),-1<t)return e.create("datatype","(dialog:)'s ".concat(n.nth(t+1)," link text shouldn't be an empty string."))},function(a,i,e,s){for(var o=arguments.length,t=new Array(4<o?o-4:0),n=4;n<o;n++)t[n-4]=arguments[n];return r.isPrototypeOf(e)||(void 0!==s&&t.unshift(s),s=e,e=void 0),t.length||(t=["OK"]),{blocked:g({section:i,message:s,cd:a,buttons:t.map(function(t){return{name:t,callback:function(){i.unblock(e&&e.set(t)||"")}}})})}},[c(r,String,b),s(c(b,String)),F(String)])("open-url",t,function(t,e){window.open(e,"")},[String],!1)(["restart","reload"],t,function(){return o.turns<=1?e.create("infinite","I mustn't (restart:) the story in the starting passage."):(o.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),void window.location.reload())},[],!1)("goto-url",t,function(t,e){window.location.assign(e)},[String],!1)("ignore",t,t,[F(R)])("assert-exists",function(t){if(""===t)return e.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(s,o,t){var n=0;return("string"==typeof t?h.create({type:"string",data:t}):t).forEach(o,function(){++n}),n?s:e.create("assertion","I didn't see any ".concat("string"==typeof t?"text occurrences of":"hooks matching"," ").concat(E(t)," in this passage."))},[c(h,String)]),a.add("assert","Instant",function(n,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:i(e.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game","Boolean",function(i,s,n){if(n=n||"",!o.hasStorage)return!1;var t=o.serialise(!1).pastAndPresent;if(e.containsError(t))return t;if(!1===t)return!1;try{return localStorage.setItem(j("Saved Game")+s,t),localStorage.setItem(j("Saved Game Filename")+s,n),!0}catch(e){return!1}},[String,s(String)])("prompt","String",function(t,a,s,o,i){if(t.stackTop&&t.stackTop.evaluateOnly)return e.create.apply(e,["macrocall"].concat(_toConsumableArray(z(t.stackTop.evaluateOnly))));if(""===i)return e.create("datatype","The text for (prompt:)'s confirm link can't be blank.");var n=g({section:t,message:a,defaultValue:s,buttons:[{name:i||"OK",confirm:!0,callback:function(){return t.unblock(n.find("input").last().val())}}].concat(""===o?[]:{name:o||"Cancel",cancel:!0,callback:function(){return t.unblock(s)}})});return t.stackTop.blocked=n,setTimeout(function(){return n.find("input").last().focus()},100),0},[c(String,b),String,s(String),s(String)])("confirm","Boolean",function(t,o,n,s){return t.stackTop&&t.stackTop.evaluateOnly?e.create.apply(e,["macrocall"].concat(_toConsumableArray(z(t.stackTop.evaluateOnly)))):""===s?e.create("datatype","The text for (confirm:)'s confirm link can't be blank."):(n=g({section:t,message:o,defaultValue:!1,buttons:[{name:s||"OK",confirm:!0,callback:function(){return t.unblock(!0)}}].concat(""===n?[]:{name:n||"Cancel",cancel:!0,callback:function(){return t.unblock(!1)}})}),t.stackTop.blocked=n,0)},[c(String,b),s(String),s(String)])("page-url","String",function(){return window.location.href},[])}),e("macrolib/datastructures",["utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/typedvar","internaltypes/twineerror"],function(n,d,f,t,i,x,c,s,m,e){var w=n.permutations,_=n.options,r=t.objectName,y=t.subset,b=t.collectionType,v=t.isValidDatamapName,O=t.is,p=t.unique,o=t.clone,j=t.range,a=f.TypeSignature,h=a.optional,u=a.rest,l=a.either,n=a.zeroOrMore,t=a.Any,a=a.nonNegativeInteger,g=d("en");f.add(["a","array"],"Array",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return n},n(l(m,t)))("range","Array",function(n,e,t){return j(e,t)},[parseInt,parseInt])("subarray","Array",function(s,e,t,n){return y(e,t,n)},[Array,parseInt,parseInt])("reversed","Array",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return n.reverse().map(o)},n(t))("shuffled","Array",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return i.shuffled.apply(i,n).map(o)},[n(t)])("sorted","Array",function(d){for(var l=arguments.length,t=new Array(1<l?l-1:0),c=1,a,o,n,i;c<l;c++)t[c-1]=arguments[c];if(!s.isPrototypeOf(t[0]))return a=t.filter(function(e){return"string"!=typeof e&&"number"!=typeof e}),a&&a.length?1===a.length&&Array.isArray(a[0])?e.create("macrocall","Please give multiple numbers or strings to (sorted:), not a single array.","You can use the spread ... syntax to spread out the array's values into (sorted:)."):e.create("datatype","If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ".concat(r(a[0]),".")):t.sort(g);if(o=t.shift(),"making"in o||"where"in o||"when"in o||!("via"in o))return e.create("datatype","The optional lambda given to (sorted:) must be a 'via' lambda, not ".concat(r(o),"."));for(n=0;n<t.length;n+=1){if(i=o.apply(d,{loop:t[n],pos:n+1}),e.containsError(i))return i;if("string"!=typeof i&&"number"!=typeof i)return e.create("datatype",'The "via" lambda given to (sorted:) couldn\'t convert '.concat(r(t[n])," into a string or number."));t[n]=[t[n],i]}return t.sort(function(e,t){return g(e[1],t[1])}).map(function(e){return e[0]})},[n(t)])("rotated","Array",function(a,t){if(0===t)return e.create("macrocall","I can't rotate these values by 0 positions.");for(var i=arguments.length,n=new Array(2<i?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return t=-1*(t=Math.abs(t)%n.length*Math.sign(t)),n.slice(t).concat(n.slice(0,t)).map(o)},[parseInt,n(t)])("rotated-to","Array",function(t,a){for(var i=arguments.length,n=new Array(2<i?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return t=a.filter(t,n),e.containsError(t)?t:t.length?(t=n.indexOf(t[0]),n.slice(t).concat(n.slice(0,t)).map(o)):e.create("macrocall","None of these "+n.length+" values matched the lambda, so I can't rotate them.")},[s.TypeSignature("where"),u(t)])("repeated","Array",function(a,i){for(var e=[],n=arguments.length,s=new Array(2<n?n-2:0),t=2;t<n;t++)s[t-2]=arguments[t];if(!s.length)return e;for(;0<i--;)e.push.apply(e,s);return e.map(o)},[a,u(t)])("interlaced","Array",function(){for(var s=arguments.length,e=new Array(1<s?s-1:0),t=1,i;t<s;t++)e[t-1]=arguments[t];for(var r=Math.min.apply(Math,_toConsumableArray(e.map(function(e){return e.length}))),a=[],n=0;n<r;n+=1)for(i=0;i<e.length;i+=1)a.push(o(e[i][n]));return a},[Array,u(Array)])("permutations","Array",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return n.length?w.apply(void 0,n):[]},[n(t)])("unique","Array",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return n.filter(p)},[n(t)])("altered","Array",function(s,o){for(var t=arguments.length,n=new Array(2<t?t-2:0),e=2;e<t;e++)n[e-2]=arguments[e];return n.map(function(t,e){return e=o.apply(s,{loop:t,pos:e+1}),null===e?t:e})},[l(s.TypeSignature("via"),s.TypeSignature("where","via")),n(t)])("find","Array",function(s,o){for(var t=arguments.length,n=new Array(2<t?t-2:0),e=2;e<t;e++)n[e-2]=arguments[e];return o.filter(s,n)},[s.TypeSignature("where"),n(t)])(["all-pass","pass"],"Boolean",function(t,i){for(var s=arguments.length,o=new Array(2<s?s-2:0),n=2;n<s;n++)o[n-2]=arguments[n];return t=i.filter(t,o),e.containsError(t)||t.length===o.length},[s.TypeSignature("where"),n(t)])("some-pass","Boolean",function(t,i){for(var s=arguments.length,o=new Array(2<s?s-2:0),n=2;n<s;n++)o[n-2]=arguments[n];return t=i.filter(t,o),e.containsError(t)||0<t.length},[s.TypeSignature("where"),n(t)])("none-pass","Boolean",function(t,i){for(var s=arguments.length,o=new Array(2<s?s-2:0),n=2;n<s;n++)o[n-2]=arguments[n];return t=i.filter(t,o),e.containsError(t)||0===t.length},[s.TypeSignature("where"),n(t)])("folded","Any",function(i,s){for(var o=arguments.length,t=new Array(2<o?o-2:0),n=2;n<o;n++)t[n-2]=arguments[n];return"where"in s&&(t=s.filter(i,t)),e.containsError(t)||t.reduce(function(e,t,n){return s.apply(i,{making:e,loop:t,pos:n+1})})},[l(s.TypeSignature("where","via","making"),s.TypeSignature("via","making")),u(t)])(["dm-names","datamap-names","datanames"],"Array",function(t,e){return Array.from(e.keys()).sort(d("en"))},[Map])(["dm-values","datamap-values","datavalues"],"Array",function(t,e){return Array.from(e.entries()).sort(d("en",function(e){return String(e[0])})).map(function(e){return o(e[1])})},[Map])(["dm-entries","datamap-entries","dataentries"],"Array",function(t,e){return Array.from(e.entries()).sort(function(e,t){return[e[0],t[0]].sort(d("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",o(e[1])]])})},[Map])(["dm-altered","datamap-altered"],"Datamap",function(t,n,s){return Array.from(s.entries()).sort(function(e,t){return[e[0],t[0]].sort(d("en"))[0]===e[0]?-1:1}).reduce(function(i,a,s){if(e.containsError(i))return i;var r=new Map([["name",a[0]],["value",o(a[1])]]),s=n.apply(t,{loop:r,pos:s+1});return e.containsError(s)?s:(i.set(a[0],null===s?a[1]:s),i)},new Map)},[l(s.TypeSignature("via"),s.TypeSignature("where","via")),Map])("history","Array",function(s,n){var t=i.history();return n?(t=n.filter(s,t.map(function(e){return c.get(e)})),e.containsError(t)?t:t.map(function(e){return e.get("name")})):t},[h(s.TypeSignature("where"))])("visited","Boolean",function(s,t){if("string"==typeof t)return c.has(t)?0<i.passageNameVisited(t)||i.passage===t:e.create("macrocall","There's no passage named '"+t+"' in this story.");var n=i.history(),n=t.filter(s,n.concat(i.passage).map(function(e){return c.get(e)}));return e.containsError(n)?n:0<n.length},[l(String,s.TypeSignature("where"))])("passage","Datamap",function(n,t){return o(c.get(t||i.passage))||e.create("macrocall","There's no passage named '"+t+"' in this story.")},[h(String)])("passages","Array",function(t,s){var i=d("en"),n=_toConsumableArray(c.values()).map(function(e){return o(e)}),t=s?s.filter(t,n):n,n=e.containsError(t);return n||t.sort(function(e,t){return i(e.get("name"),t.get("name"))})},[h(s.TypeSignature("where"))])("open-storylets","Array",function(t,n){return t.stackTop.evaluateOnly?e.create("macrocall","(open-storylets:) can't be used in "+t.stackTop.evaluateOnly+"."):(t=c.getStorylets(t,n),n=e.containsError(t),n||t.map(o))},[h(s.TypeSignature("where"))])("savedgames","Datamap",function(){function t(e){return"("+e+" "+_.ifid+") "}var e,n=0,s=new Map,o;do{if(!i.hasStorage)break;e=localStorage.key(n),n+=1,o=t("Saved Game")}while(e&&e.startsWith(o)&&(e=e.slice(o.length),s.set(e,localStorage.getItem(t("Saved Game Filename")+e))),e)return s},[])(["datamap","dm"],"Datamap",function(){for(var t,n=new Map,i=arguments.length,c=new Array(1<i?i-1:0),s=1,a;s<i;s++)c[s-1]=arguments[s];return a=c.reduce(function(s,i){var a;if(e.containsError(s))return s;if(void 0===t)t=i;else{if(a=e.containsError(v(n,t)))return a;if(n.has(t))return e.create("macrocall","You used the same data name ("+r(t)+") twice in the same (datamap:) call.");n.set(t,o(i)),t=void 0}return s},!0),e.containsError(a)?a:void 0!==t?e.create("macrocall","This datamap has a data name without a value."):n},n(l(m,t)))(["dataset","ds"],"Dataset",function(){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return new Set(n.filter(p).map(o))},n(t))("count","Number",function l(d,t){for(var i=arguments.length,s=new Array(2<i?i-2:0),o=2,a,c,n;o<i;o++)s[o-2]=arguments[o];if(1<s.length)return c=s.map(function(e){return l(d,t,e)}),(a=e.containsError(c))||c.reduce(function(e,t){return e+t},0);switch(n=s[0],b(t)){case"dataset":case"datamap":return e.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof n?e.create("macrocall",r(t)+" can't contain  "+r(n)+" because it isn't also a string."):n?t.split(n).length-1:0;case"array":return t.reduce(function(e,t){return e+O(t,n)},0);default:return e.create("macrocall",r(t)+" can't contain values, let alone "+r(n)+".")}},[t,u(t)])}),e("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(t,p,n,d,a,k,_,e,w,O,o){var f=d.geomParse,x=d.geomStringRegExp,l=Object.assign,s=p.TypeSignature,c=s.either,m=s.wrapped,i=s.optional,C=s.Any,j=s.Everything,b=s.zeroOrMore,y=s.rest,h=s.insensitiveSet,g=s.positiveNumber,E=s.positiveInteger,r=s.nonNegativeNumber,A=s.percent,d=[m(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')],v,u;n.onStartup(function(){return n.storyElement.on("mouseenter.hover-macro","[hover=false]",function(){var e=t(this),n=e.data("hoverChanger");e.data({mouseoutStyle:e.attr("style")||""}),O.create({target:e},n).update(),e.attr("hover",!0)}).on("mouseleave.hover-macro","[hover=true]",function(){var e=t(this),n=e.data("mouseoutStyle");e.attr("style",n).removeData("mouseoutStyle").attr("hover",!1)})}),o.on(function(){t("tw-expression, tw-hook",n.storyElement).each(function(n,e){((e=t(e)).data("errorEvent")||Object)(e)})}),s=h("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur"),m=h("dotted","dashed","solid","double","groove","ridge","inset","outset","none"),p.addChanger("if",function(n,t){return e.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},d)("unless",function(n,t){return e.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},d)("elseif",function(t,n){return"lastHookShown"in t.stack[0]?e.create("elseif",[!1===t.stack[0].lastHookShown&&!!n]):o.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},d)("else",function(t){return"lastHookShown"in t.stack[0]?e.create("else",[!1===t.stack[0].lastHookShown]):o.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return e.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return e.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(n,t){return e.create("live",t?[t]:[])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}},i(Number))("event",function(n,t){return e.create("event",[t])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}},w.TypeSignature("when"))("more",function(){return e.create("more")},function(e){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return 0!==e.Identifiers.exits?[]:[!0]}}}},null)("after",function(s,n,t){return e.create("after",[n].concat(void 0!==t?[t]:[]))},function(e,t,s){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return n.anyInputDown()&&s&&(t-=s),e.Identifiers.time>t?[!0]:[]}}}},[g,i(r)])("after-error",function(){return e.create("after-error",[])},function(e){e.enabled=!1,e.transitionDeferred=!0;var t=e.section.stackTop.tempVariables;e.data.errorEvent=function(s){s.removeData("errorEvent");var n=l({},e,{enabled:!0,transitionDeferred:!1});n.data&&(n.data.errorEvent=void 0),e.section.whenUnblocked(function(){return e.section.renderInto("",null,n,t)})}},[])("hook",function(i,t){if(!t)return o.create("datatype","The string given to (hook:) was empty.");var s=n.insensitiveName(t);return s?e.create("hook",[s]):o.create("datatype",'The string given to (hook:), "'.concat(t,'", contained only dashes and underscores.'))},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(a,s){if(!s.loop)return o.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.");for(var n=arguments.length,i=new Array(2<n?n-2:0),t=2;t<n;t++)i[t-2]=arguments[t];return e.create("for",[s].concat(i))},function(n,s){for(var t=arguments.length,i=new Array(2<t?t-2:0),e=2,a,r;e<t;e++)i[e-2]=arguments[e];if(r=s.filter(n.section,i),a=o.containsError(r))return a;n.loopVars[s.loop.getName()]=r||[]},[w.TypeSignature("where"),b(C)])(["transition","t8n"],function(s,t){return e.create("transition",[n.insensitiveName(t)])},function(e,s){return"zoom"===(e.transition=s)&&(e.transitionOrigin=function(){var e=t(this).offset(),s=e.left,e=e.top;return n.mouseCoords.x-s+"px "+(n.mouseCoords.y-e)+"px"}),e},[s])(["transition-time","t8n-time"],function(n,t){return e.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=l(e.data.passageT8n||{},{time:t}),e},[g])(["transition-delay","t8n-delay"],function(n,t){return e.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[r])(["transition-skip","t8n-skip"],function(n,t){return e.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[g])(["transition-depart","t8n-depart"],function(s,t){return e.create("transition-depart",[n.insensitiveName(t)])},function(e,s){return e.data.passageT8n=l(e.data.passageT8n||{},{depart:s}),"zoom"===s&&(e.data.passageT8n.departOrigin=function(){var e=t(this).offset(),s=e.left,e=e.top;return n.mouseCoords.x-s+"px "+(n.mouseCoords.y-e)+"px"}),e},[s])(["transition-arrive","t8n-arrive"],function(s,t){return e.create("transition-arrive",[n.insensitiveName(t)])},function(e,s){return e.data.passageT8n=l(e.data.passageT8n||{},{arrive:s}),"zoom"===s&&(e.data.passageT8n.arriveOrigin=function(){var s=t(this),e=s.offset(),o=e.left,i=e.top,e=s.height();return{"transform-origin":100*(n.mouseCoords.x-o)/s.width()+"% "+100*(n.mouseCoords.y-i)/e+"%",height:e+"px"}}),e},[s])("button",function(n,t){return void 0===t||f(t).size?e.create("button",t?[t]:[]):o.create("datatype",'The string given to (button:) should be a sizing line ("==X==", "==X", "=XXXX=" etc.), not '.concat(JSON.stringify(t),"."))},function(t,n){var e=f(n),n=e.marginLeft,e=e.size;return t.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(0<this.className.length)+"enchantment-button")}}),t.styles.push({"margin-left":e?n+"%":void 0,width:e?e+"%":"100%"}),t},[i(String)]).apply(void 0,_toConsumableArray((u={click:{className:"enchantment-link",blockClassName:"enchantment-clickblock"},doubleclick:{className:"enchantment-dblclick",blockClassName:"enchantment-dblclickblock"},mouseover:{className:"enchantment-mouseover",blockClassName:"enchantment-mouseoverblock"},mouseout:{className:"enchantment-mouseout",blockClassName:"enchantment-mouseoutblock"}},["action",function(s,t){return e.create("action",[n.insensitiveName(t)])},function(e,n){return e.attr.push({class:function(){var e=function n(e){return(e=t(e)).is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(e.css("display"))||e.children().get().some(n)}(this);return Array.from(this.classList).filter(function(e){return!Object.keys(u).some(function(t){return u[t].className===e||u[t].blockClassName===e})}).concat(u[n][e?"blockClassName":"className"]).join(" ")}}),e},[h.apply(void 0,_toConsumableArray(Object.keys(u)))]])))(["border","b4r"],function(){for(var s=arguments.length,o=new Array(1<s?s-1:0),t=1;t<s;t++)o[t-1]=arguments[t];return e.create("border",o.map(n.insensitiveName))},function(o){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return o.styles.push({display:function(){var e=t(this).css("display");return s.every(function(e){return"none"===e})||!e.includes("inline")?e:"inline-block"},"border-style":s.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),o},[m].concat(_toConsumableArray(Array(3).fill(i(m)))))(["border-size","b4r-size"],function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];return e.create("border-size",s)},function(n){for(var t=arguments.length,s=new Array(1<t?t-1:0),e=1;e<t;e++)s[e-1]=arguments[e];return n.styles.push({"border-width":s.map(function(e){return e+"px"}).join(" ")}),n},[r].concat(_toConsumableArray(Array(3).fill(i(r)))))("corner-radius",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];return e.create("corner-radius",s)},function(s){for(var t=arguments.length,n=new Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return s.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),s},[r].concat(_toConsumableArray(Array(3).fill(i(r)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];return e.create("border-colour",s.map(function(e){return a.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(n){for(var t=arguments.length,s=new Array(1<t?t-1:0),e=1;e<t;e++)s[e-1]=arguments[e];return n.styles.push({"border-color":s.join(" ")}),n},[c(String,a)].concat(_toConsumableArray(Array(3).fill(i(c(String,a))))))("opacity",function(n,t){return e.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[A])("font",function(n,t){return e.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(i,t){var n,s=t.indexOf("><");return/^(==+>|<=+|=+><=+|<==+>)$/.test(t)?((n=~s?(n=Math.round(s/(t.length-2)*50),l({"text-align":"center","max-width":"50%"},25===n?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":n+"%"})):"<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"}).display="inline-block",e.create("align",[n])):o.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"')},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(n,t){return e.create("text-colour",[t])},function(t,e){return a.isPrototypeOf(e)&&(e=e.toRGBAString(e)),t.styles.push({color:e}),t},[c(String,a)])(["text-size","size"],function(n,t){return e.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[r])("text-indent",function(n,t){return e.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[r])(["text-rotate-z","text-rotate"],function(n,t){return e.create("text-rotate-z",[t])},function(e,n){return e.styles.push({display:"inline-block",transform:function(){var e=t(this).css("transform")||"";return(e="none"===e?"":e)+" rotate("+n+"deg)"}}),e},[Number])("text-rotate-y",function(n,t){return e.create("text-rotate-y",[t])},function(e,n){return e.styles.push({display:"inline-block",transform:function(){var e=t(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateY("+n+"deg)"}}),e},[Number])("text-rotate-x",function(n,t){return e.create("text-rotate-x",[t])},function(e,n){return e.styles.push({display:"inline-block",transform:function(){var e=t(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateX("+n+"deg)"}}),e},[Number])(["background","bg"],function(n,t){return e.create("background",[t])},function(s,e){return a.isPrototypeOf(e)?e=e.toRGBAString():_.isPrototypeOf(e)&&(e=e.toLinearGradientString()),e=a.isHexString(e)||a.isCSS3Function(e)?{"background-color":e}:e.startsWith("linear-gradient(")||e.startsWith("repeating-linear-gradient(")?{"background-image":e}:{"background-size":"cover","background-image":"url(".concat(e,")"),"background-attachment":"fixed"},s.styles.push(e,{display:function(){var e=t(this);return!e.children().length||n.childrenProbablyInline(e)?t(this).css("display"):"block"}}),s},[c(String,a,_)]).apply(void 0,_toConsumableArray((c={color:function(){return"transparent"}},v=l(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var e=t(this).css("color");return"-1px -1px 0 "+e+", 1px -1px 0 "+e+",-1px  1px 0 "+e+", 1px  1px 0 "+e}},{color:function(){return n.parentColours(t(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+t(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+t(this).css("color")}},smear:[{"text-shadow":function(){var e=t(this).css("color");return"0em   0em 0.02em "+e+",-0.2em 0em  0.5em "+e+", 0.2em 0em  0.5em "+e}},c],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+t(this).css("color")}},c],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+t(this).css("color")},"user-select":"none"},c],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},tall:{display:"inline-block",transform:"scaleY(1.5) translateY(-0.25ex)"},flat:{display:"inline-block",transform:"scaleY(0.5) translateY(0.25ex)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(){for(var s=arguments.length,o=new Array(1<s?s-1:0),t=1;t<s;t++)o[t-1]=arguments[t];return e.create("text-style",o.map(n.insensitiveName))},function(e){for(var o=arguments.length,t=new Array(1<o?o-1:0),n=1,s;n<o;n++)t[n-1]=arguments[n];for(s=0;s<t.length;s+=1)"none"===t[s]?e.styles=[]:e.styles=e.styles.concat(v[t[s]]);return e},[y(h.apply(void 0,_toConsumableArray(Object.keys(v))))]])))("collapse",function(){return e.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(i,n){var t=O.create(),s=(n.run(t),t.summary());return s+""=="styles"||s.every(function(e){return"styles"===e||"attr"===e})&&t.attr.every(function(e){return Object.keys(e)+""=="style"})?e.create("hover-style",[n]):o.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(t,e){return void 0!==e&&e}}),e},[e])("css",function(n,t){return t.trim().endsWith(";")||(t+=";"),e.create("css",[t])},function(e,n){return e.attr.push({style:function(){return(t(this).attr("style")||"")+n}}),e},[String])("test-true",function(){return e.create("test-true",[])},function(e){return e.enabled=!0},b(j))("test-false",function(){return e.create("test-false",[])},function(e){return e.enabled=!1},b(j)),p.addCommand("animate",t.noop,function(e,t,s,o,i){s.forEach(t,function(s){var a,t;"zoom"===name&&(a=(t=s.offset()).left,t=t.top,t=n.mouseCoords.x-a+"px "+(n.mouseCoords.y-t)+"px"),n.transitionIn(s,o,e.transitionTime||i,e.transitionDelay,e.transitionSkip,0,t)})},[y(k),h.apply(void 0,_toConsumableArray(s.innerType.filter(function(e){return"instant"!==e}))),i(g)]),["box","float-box"].forEach(function(s){return p.addChanger(s,function(r,t,n){var i=-1===t.search(x)||1<t.length&&!t.includes("="),a="float-box"===s&&(-1===n.search(x)||1<n.length&&!n.includes("="));return i||a?o.create("datatype","The ("+s+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(i?t:n)+'".'):e.create(s,[t,n].filter(function(e){return void 0!==e}))},function(r,a,i){var c,e=f(a),a=e.marginLeft,e=e.size,o;return"float-box"===s&&(c=(o=f(i)).marginLeft,i=o.size),o="box"===s?"%":"vw",e=(_defineProperty(e={display:"block",width:e+o,"max-width":e+o},"box"===s?"margin-left":"left",a+o),_defineProperty(e,"box-sizing","content-box"),_defineProperty(e,"overflow-y","auto"),_defineProperty(e,"padding",function(){var e=t(this).css("padding");return e&&"0px"!==e?e:"1em"}),e),void 0!==i&&(e.height=i+("box"===s?"em":"vh")),"float-box"===s&&l(e,{position:"fixed",top:c+"vh","background-color":function(){return n.parentColours(t(this)).backgroundColour}}),r.styles.push(e),r},[String,"box"===s?i(E):String])})}),e("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(e,t,c,i,o,n,a){var r=o.objectName,s=o.toSource,l=a.collapse;return Object.freeze({create:function(t){return Object.assign(Object.create(this),{enchantments:e()},t)},enchantScope:function(){var v=this,h=this.attr,u=this.data,m=this.functions,d=this.section,f=this.scope,o=this.localHook,a=this.lambda,p=[],g=0;f.forEach(d,function(j,_){if(o){o=o.jquery?o:o.hooks(d);var w=j.find(o),y,O,b;if(w.length)j=w;else if(!o.has(j[0]).length)return}(!j.is(":empty")||j.data("source")&&j.data("source").length)&&(g+=1,a?(b=a.apply(d,{loop:f.TwineScript_GetProperty(_),pos:g}),n.containsError(b)?(j.replaceWith(b.render()),a=b=null):i.isPrototypeOf(b)?b.canEnchant||(j.replaceWith(n.create("macrocall",'The lambda "'.concat(s(a),"\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")).render()),a=b=null):(j.replaceWith(n.create("macrocall",'The lambda "'.concat(s(a),'" must return a changer, not ').concat(r(b),".")).render()),a=b=null)):b=v.changer,w=!h&&!u&&(!b||b.summary().every(function(e){return e.startsWith("transition")})),y=w?j:j.wrap("<tw-enchantment>").parent(),h&&y.attr(h),u&&y.data(u),m&&m.forEach(function(e){return e(y)}),b&&(_=c.create({section:d,target:y}),b.run(_),_.update(),j.is(t.storyElement)?(O=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(_.styles)))),j.css(O.reduce(function(e,t){return"background-color"===t||"background-image"===t?(e["background-color"]="transparent",e["background-image"]="none",O.push("background-".concat("background-color"===t?"image":"color"))):e[t]="inherit",e},{})),y.data({enchantedProperties:O})):j.is("tw-passage")&&_.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})&&(b="padding-right",t.storyElement.css(_="padding-left","0px").css(b,"0px"),y.data({enchantedProperties:[_,b]}))),j.is(t.storyElement)&&y.css({"min-width":"100%","min-height":"100%"}),"true"===y.attr("collapsing")&&(y.find("[collapsing=false]").each(function(){e(this).removeAttr("collapsing")}),l(y)),w||p.push(y))}),this.enchantments=e(p)},disenchant:function(){this.enchantments.each(function(s,n){(n=e(n)).contents().unwrap(),n=n.data("enchantedProperties"),n&&t.storyElement.css(n.reduce(function(e,t){return e[t]="",e},{}))})}})}),e("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/codehook","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/enchantment","internaltypes/twineerror"],function(o,u,l,p,y,j,n,t,g,e,d,w,h,a){var _=l.is,i=n.TypeSignature,s=i.either,v=i.rest,b=i.optional,r=Object.assign,f;function m(n,t){if(e.isPrototypeOf(t)&&!t.canEnchant)return a.create("datatype","The changer given to (".concat(n,":) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."))}["enchant","change"].forEach(function(o){n.addCommand(o,function(t,e){if(e=m(o,e),e)return e},function(s,i,a){i=t.from(i);var r,n,c=[];return e.isPrototypeOf(a)&&(r=w.create({section:s}),a.run(r),0<(r.innerEnchantments||[]).length&&(n=r.innerEnchantments.map(function(e){return e(i)}),c.push.apply(c,_toConsumableArray(n)))),c.push(h.create((_defineProperty(n={scope:i},e.isPrototypeOf(a)?"changer":"lambda",a),_defineProperty(n,"section",s),n))),c.forEach(function(e){"enchant"===o?(s.addEnchantment(e),s.updateEnchantments()):e.enchantScope()}),""},[s(t,String),s(e,d.TypeSignature("via"))],!1)}),n.addChanger("enchant-in",function(o,n,t){var s=m("enchant-in",t);return s||e.create("enchant-in",[n,t])},function(n,o,s){return n.innerEnchantments=(n.innerEnchantments||[]).concat(function(i){return h.create((_defineProperty(i={scope:t.from(o),localHook:i},e.isPrototypeOf(s)?"changer":"lambda",s),_defineProperty(i,"section",n.section),i))}),n},[s(t,String),s(e,d.TypeSignature("via"))]),[["link-style",t.create({type:"name",data:"link"})],["line-style",t.create({type:"base",data:t.create({type:"name",data:"page"})},"lines",void 0)],["char-style",t.create({type:"base",data:t.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(t){var t=_slicedToArray(t,2),o=t[0],i=t[1];n.addChanger(o,function(s,t){var n=m(o,t);return n||e.create(o,[t])},function(t,n){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(s){return h.create((_defineProperty(s={scope:i,localHook:s},e.isPrototypeOf(n)?"changer":"lambda",n),_defineProperty(s,"section",t.section),s))}),t},[s(e,d.TypeSignature("via"))])}),l=["replace","append","prepend"];function c(n,i){return u.onStartup(function(){var s=n.classList.replace(/ /g,"."),e=n.blockClassList?n.blockClassList.replace(/ /g,"."):"",t="."+s+(e?",."+e:"");u.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),t,function(e){var n;o(e.target).is("tw-open-button")||(e=(n=o(Array.from(o(this).parents(t).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(n)})}),[function(r,s,n){if(!s)return a.create("datatype","A string given to this ("+i+":) macro was empty.");if(n){var o=m(i,n);if(o)return o}return e.create(i,[t.from(s)].concat(n?[n]:[]))},function(t,o,a){t.enabled=!1,t.transitionDeferred=!0,n.rerender&&(t.newTargets=(t.newTargets||[]).concat({target:o,append:n.rerender}));var c=t.section&&t.section.stackTop?t.section.stackTop.tempVariables:Object.create(null),s=h.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(e.children().css("display"))?n.blockClassList:n.classList),e.attr({tabIndex:"0"})}],data:{enchantmentEvent:function(){t.section.stackTop&&t.section.stackTop.blocked||(n.once&&t.section.removeEnchantment(s),n.goto?p.goToPassage(n.goto,{transition:n.transition}):n.undo?p.goBack({transition:n.transition}):t.section.renderInto(t.source,null,r({},t,{append:n.once?"append":"replace",enabled:!0,transitionDeferred:!1}),c))}},scope:o,section:t.section,name:i},e.isPrototypeOf(a)?"changer":"lambda",a));return t.section&&(t.section.addEnchantment(s),s.enchantScope()),t},[s(t,String),b(s(e,d.TypeSignature("via")))]]}l.forEach(function(i){n.addChanger(i,function(){for(var s=arguments.length,o=new Array(1<s?s-1:0),n=1;n<s;n++)o[n-1]=arguments[n];return o.every(Boolean)?e.create(i,o.map(t.from),null,!1):a.create("datatype","A string given to this (".concat(i,":) macro was empty."))},function(e){0<o(e.target).parents().filter("tw-collapsed,[collapsing=true]").length||e.attr.some(function(e){return e.collapsing})||(e.attr=[].concat(_toConsumableArray(e.attr),[{collapsing:!1}])),e.newTargets=e.newTargets||[];for(var s,n=arguments.length,a=new Array(1<n?n-1:0),t=1;t<n;t++)a[t-1]=arguments[t];return(s=e.newTargets).push.apply(s,_toConsumableArray(a.filter(function(t){return!e.newTargets.some(function(e){var n=e.target,e=e.append;return _(t,n)&&i===e})}).map(function(e){return{target:e,append:i,before:!0}}))),e},v(s(t,String)))(i+"-with",function(n,t){return e.create(i+"-with",[t],null,!1)},function(t,e){return g.isPrototypeOf(e)&&(e=e.code),t.appendSource=(t.appendSource||[]).concat({source:e,append:i}),t},s(g,String))}),i="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,f=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",i?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",i?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}},{name:"doubleclick",enchantDesc:{event:["dblclick"],once:!0,rerender:"",classList:"link enchantment-dblclick",blockClassList:"enchantment-dblclickblock"}}],f.forEach(function(e){"doubleclick"!==e.name&&(n.addChanger.apply(n,[e.name].concat(_toConsumableArray(c(e.enchantDesc,e.name)))),"click"===e.name&&n.addChanger.apply(n,[e.name+"-rerun"].concat(_toConsumableArray(c(r({},e.enchantDesc,{once:!1}),e.name+"-rerun")))))}),u.onStartup(function(){f.forEach(function(t){var e=t.enchantDesc;e.blockClassList&&u.storyElement.on(e.event.map(function(e){return e+".enchantment"}).join(" "),function(t){var n;o(t.target).is("tw-open-button")||(t=(n=o(Array.from(o(this).parents("."+e.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&t(n)})})}),l.forEach(function(e){f.forEach(function(t){var s;"doubleclick"!==t&&(s=r({},t.enchantDesc,{rerender:e}),t=t.name+"-"+e,n.addChanger.apply(n,[t].concat(_toConsumableArray(c(s,t)))))})}),f.forEach(function(e){"doubleclick"!==e&&["goto","undo"].forEach(function(o){var i=e.name+"-"+o;n.addCommand(i,function(t,e){return!t||!e&&"goto"===o?a.create("datatype","A string given to this ("+i+":) macro was empty."):"goto"!==o||j.hasValid(e)?void 0:a.create("macrocall","I can't ("+i+":) the passage '"+e+"' because it doesn't exist.")},function(n,s,l,d){return"undo"===o&&y.pastLength<1?a.create("macrocall","I can't (undo:) on the first turn."):((0,_slicedToArray(c(r({},e.enchantDesc,{transition:n.data.passageT8n},"undo"===o?{undo:!0}:{goto:d}),i),2)[1])({section:s},t.from(l)),r(n,{source:""}))},[s(t,String)].concat("undo"===o?[]:String))})})}),e("macrolib/metadata",["macros","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(s,e,c,t){function o(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}}var i=e.clone,a=e.objectName,r=e.isValidDatamapName,n=s.TypeSignature,e=n.zeroOrMore,n=n.Any;[["storylet",c.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];s.add(t,"Metadata",function(e,n){return e.stackTop.speculativePassage?n:o(t)},e)}),s.add("metadata","Metadata",function(u){for(var e,n=new Map,c=arguments.length,d=new Array(1<c?c-1:0),s=1,l;s<c;s++)d[s-1]=arguments[s];return l=d.reduce(function(s,o){var c;if(t.containsError(s))return s;if(void 0===e)e=o;else{if(c=t.containsError(r(n,e)))return c;if(n.has(e))return t.create("macrocall","You used the same data name ("+a(e)+") twice in the same (metadata:) call.");n.set(e,i(o)),e=void 0}return s},!0),t.containsError(l)?l:void 0!==e?t.create("macrocall","This (metadata:) macro has a data name without a value."):u.stackTop.speculativePassage?n:o("metadata")},e(n))}),e("macrolib/patterns",["macros","utils","utils/operationutils","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror","internaltypes/varscope"],function(p,o,l,a,s,r,e,u){function t(o){var n=o.name,p=o.fullArgs,f=o.args,i=o.makeRegExpString,E=void 0===i?function(e){return e.join("")}:i,a=void 0!==(i=o.insensitive)&&i,l=void 0===(i=o.canContainTypedVars)||i,k=void 0===(i=o.canBeUsedAlone)||i,w=void 0===(o=o.canContainTypedGlobals)||o,O=f||p,A=g(null),o=O.map(function f(t){if(r.isPrototypeOf(t)){var o=t.varRef,i;return l?!w&&!u.isPrototypeOf(o.object)?e.create("operation","Only typed temp variables can be used in patterns given to ("+n+":)"):(o=o.getName(),o in A)?e.create("operation","There's already a typed temp variable named _"+o+" inside this ("+n+":) call."):(A[o]=!0,o=f(t.datatype),e.containsError(o)?o:"("+o+")"):e.create("operation","Optional string patterns, like ("+n+":)"+("p-many"===n?" with a minimum of 0 matches":"")+", can't have typed variables inside them.")}if(s.isPrototypeOf(t)){if(!(l&&w||"function"!=typeof t.typedVars)){if(i=t.typedVars(),!l&&i.length)return e.create("operation","("+n+":) can't have typed variables inside its pattern.");if(!w&&i.some(function(e){return!u.isPrototypeOf(e.varRef.object)}))return e.create("operation","Only typed temp variables can be used in patterns given to ("+n+":)")}return t.regExp?(t.rest?"(?:":"")+(a?t.insensitive():t).regExp+(t.rest?")*":""):(o=t.name,i=t.rest?"*":"","alnum"===o?y+i:"whitespace"===o?j+i:"uppercase"===o?(a?d:h)+i:"lowercase"===o?(a?d:m)+i:"anycase"===o?d+i:"digit"===o?"\\d"+i:"linebreak"===o?"(?:\\r|\\n|\\r\\n)"+i:"str"===o?".*?":["even","odd","int","num"].includes(o)?e.create("datatype","Please use string datatypes like 'digit' in ("+n+":) instead of number datatypes."):e.create("datatype","The ("+n+":) macro must only be given string-related datatypes, not "+c(t)+"."))}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),a?t.replace(RegExp("("+h+"|"+m+")","g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"}):t):(b("createPattern","mapper() was given a non-string non-datatype "+t),"")}),x,C;return(f=e.containsError(o))||(x=E(o),C=_(g(s),{name:n,regExp:x,insensitive:function(){return a?C:t({name:n,fullArgs:p,args:O.map(function(e){return s.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:E,insensitive:!0,canContainTypedVars:l,canBeUsedAlone:k})},typedVars:function(){return O.reduce(function(n,e){return r.isPrototypeOf(e)&&(n=n.concat(a?r.create(t({name:"p-ins",fullArgs:[e.datatype],insensitive:!0}),e.varRef):e),e=e.datatype),n=s.isPrototypeOf(e)&&"function"==typeof e.typedVars?n.concat(e.typedVars()):n},[])},destructure:function(n){if("string"!=typeof n)return[e.create("operation","I can't put "+c(n)+" into "+this.TwineScript_ToSource()+" because it isn't a string.")];var s=this.typedVars(),o;return s.length?(o=(RegExp("^"+(this.rest?"(?:":"")+x+(this.rest?")*":"")+"$").exec(n)||[]).slice(1),o.length?o.map(function(n,e){if(e=s[e],e)return e.datatype.rest&&!e.datatype.regExp&&((e=e.TwineScript_Clone()).datatype=t({name:"p",fullArgs:[e.datatype]})),{dest:e,value:n||"",src:void 0}}).filter(Boolean):[e.create("operation","I can't put "+c(n)+" because it doesn't match the pattern "+this.TwineScript_ToSource()+".")]):[]},TwineScript_IsTypeOf:function(t){return k?"string"==typeof t&&!!t.match("^"+(this.rest?"(?:":"")+x+(this.rest?")*":"")+"$"):e.create("operation","A ("+n+":) datatype must only be used with a (p:) macro.")},TwineScript_toTypeSignatureObject:function(){var e=this;return{pattern:"range",name:n,range:function(t){return e.TwineScript_IsTypeOf(t)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+n+":"+p.map(v)+")"}}),Object.defineProperty(C,"TwineScript_ObjectName",{get:function(){return"a ("+n+":) datatype"}}),C)}var y=o.anyRealLetter,h=o.anyUppercase,m=o.anyLowercase,d=o.anyCasedLetter,j=o.realWhitespace,b=o.impossible,c=l.objectName,v=l.toSource,n=p.TypeSignature,f=n.rest,i=n.either,o=n.optional,l=n.nonNegativeInteger,_=Object.assign,g=Object.create,n=f(i(String,s,r));p.add(["p","pattern"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p",fullArgs:s})},n)(["p-either","pattern-either"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-either",fullArgs:s,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},n)(["p-opt","pattern-opt","p-optional","pattern-optional"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-opt",fullArgs:s,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},n)(["p-not","pattern-not"],"Datatype",function(){for(var s=arguments.length,o=new Array(1<s?s-1:0),n=1;n<s;n++)o[n-1]=arguments[n];return o.find(function(e){return"string"==typeof e?1!==_toConsumableArray(e).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?e.create("datatype","(p-not:) should only be given single characters, or datatypes that match single characters"):t({name:"p-not",fullArgs:o,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.map(function(e){return e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e}).join("")+"]"}})},n)(["p-not-before","pattern-not-before"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-not-before",fullArgs:s,canContainTypedVars:!1,makeRegExpString:function(e){return"(?!"+e.join("")+")"}})},n)(["p-before","pattern-before"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-before",fullArgs:s,canContainTypedVars:!1,makeRegExpString:function(e){return"(?="+e.join("")+")"}})},n)(["p-start","pattern-start"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-start",fullArgs:s,makeRegExpString:function(e){return"^(?:"+e.join("")+")"}})},n)(["p-end","pattern-end"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-end",fullArgs:s,makeRegExpString:function(e){return"(?:"+e.join("")+")$"}})},n)(["p-many","pattern-many"],"Datatype",function(){for(var l=arguments.length,n=new Array(1<l?l-1:0),a=1,o,i,u,d;a<l;a++)n[a-1]=arguments[a];return u=n.slice(),"number"==typeof n[0]&&(o=n.shift(),i="number"==typeof n[0]?n.shift():1/0),void 0!==i&&i<o?e.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers."):n.length?(d=n.find(function(e){return"string"!=typeof e&&!s.isPrototypeOf(e)&&!r.isPrototypeOf(e)}),d?e.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+c(d)+"."):t({name:"p-many",args:n,fullArgs:u,canContainTypedVars:0<o,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==o?"{"+o+(i===1/0?",":i!==o?","+i:"")+"}":"+")}})):e.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.")},[f(i(l,String,s,r))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],"Datatype",function(){for(var n=arguments.length,s=new Array(1<n?n-1:0),e=1;e<n;e++)s[e-1]=arguments[e];return t({name:"p-ins",fullArgs:s,insensitive:!0})},n)(["split","splitted"],"Array",function(r,s,n){if(s=t({name:"split",fullArgs:[s],canContainTypedVars:!1}),e.containsError(s))return s;if(!n)return[""];if(!s.regExp)return _toConsumableArray(n);for(var o,a=RegExp(s.regExp),i=[];n&&(o=a.exec(n));){if(o.index+o[0].length===0)return i;i.push(n.slice(0,o.index)),n=n.slice(o.index+o[0].length)}return i.concat(n||[])},[i(String,s),String])("trimmed","String",function(i,n,o){return void 0===o||s.isPrototypeOf(n)&&"whitespace"===n.name?n.trim():(n=t({name:"trimmed",fullArgs:[n],canContainTypedVars:!1}),e.containsError(n)?n:n.regExp?o.replace(RegExp("^("+n.regExp+")*|("+n.regExp+")*$","g"),""):o)},[i(String,s),o(String)])(["str-find","string-find"],"String",function(u,n,d){if(n=t({name:"str-find",fullArgs:[n],canContainTypedGlobals:!1}),e.containsError(n))return n;for(var a,o=n.typedVars(),i=RegExp(n.regExp,"g"),r=[],l=i.lastIndex,c,s;(a=i.exec(d))&&l!==i.lastIndex;)if(l=i.lastIndex,o.length){for(c=new Map,s=0;s<o.length;s+=1){if("match"===o[s].varRef.getName())return e.create("macrocall","There was a typed temp variable named _match in the pattern given to (str-find:)","The variable _match is reserved, and can't be used inside (str-find:)'s pattern.");c.set(o[s].varRef.getName(),a[s+1]),c.set("match",a[0])}r.push(c)}else r.push(a[0]);return r},[s,String])(["str-replaced","string-replaced","replaced"],"String",function(v,d,n,i,o){if("number"!=typeof d){if(void 0!==o)return e.create("macrocall","1 too many values were given to (str-replaced:).","If this is given 5 values, the first value must be a number of replacements.");o=i,i=n,n=d,d=1/0}else if(void 0===o)return e.create("macrocall","The (str-replaced:) macro needs 1 more value.","The final string seems to be missing.");if(s.isPrototypeOf(i))return e.create("datatype","The replacement value for (str-replaced:) must be a string or lambda, not ".concat(c(i)));if(a.isPrototypeOf(o)||a.isPrototypeOf(n))return e.create("datatype","The ".concat(a.isPrototypeOf(o)?"final string":"search pattern"," given to (str-replaced:) can't be a lambda."),"Only the replacement value (after the search pattern) can be a 'via' lambda.");if(n=t({name:"str-replaced",fullArgs:[n],canContainTypedGlobals:!1}),e.containsError(n))return n;if(!n.regExp)return o;for(var r,f=RegExp(n.regExp,"g"),_=a.isPrototypeOf(i)?n.typedVars():[],w=1,g=0,y="",j=f.lastIndex,l,p,h;o&&(r=f.exec(o))&&0<d&&j!==f.lastIndex;){for(var j=f.lastIndex,b=Object.create(v.stack.length?v.stackTop.tempVariables:u),m=0;m<_.length;m+=1){if(l=_[m],p=l.varRef.create(b,l.varRef.propertyChain),e.containsError(p))return p;if(l=p.defineType(l.datatype),e.containsError(l))return l;p.set(r[m+1])}if(h=a.isPrototypeOf(i)?i.apply(v,{loop:r[0],pos:w,tempVariables:b}):i,e.containsError(h))return h;if("string"!=typeof h)return e.create("datatype","(str-replaced:)'s lambda must produce a string, but it produced ".concat(c(h),' when given "').concat(r[0],'".'));y+=o.slice(g,r.index)+h,w+=1,--d,g=r.index+r[0].length}return y+=o.slice(g)},[i(l,String,s),i(s,String,a.TypeSignature("via")),i(String,a.TypeSignature("via")),o(String)])}),e("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(i,d,r,c,l,u,o,f,g,h,e){var s=d.TypeSignature,n=s.optional,p=s.rest,s=s.either,a=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],t=Object.assign;function m(t,n,e){e=e||n;var o,s=l.hasValid(n)&&n===e,t=t.evaluateTwineMarkup(r.unescape(e),"a link's passage name");return s?n=(s=0<t.children().length?"`".repeat((e.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"")+"\0".repeat(!!s)+n+"\0".repeat(!!s)+s:(t.findAndFilter("tw-error").length&&(o=t.findAndFilter("tw-error").data("TwineError")),e=t.text()),{text:n,passage:e,error:o}}r.onStartup(function(){var t="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;function e(s){var e=i(this),o=e.closest("tw-expression"),t=e.closest("tw-expression, tw-hook"),n=t.data("clickEvent"),t=t.data("section"),a;if(!e.is("tw-open-button")&&(!(t&&t.stackTop&&t.stackTop.blocked)||t.stackTop.blocked instanceof i&&t.stackTop.blocked.find(e).length))return n?0<e.find("tw-error").length?void 0:(s.stopPropagation(),void n(e)):(n=o.data("linkPassageName"),a=Object.assign({},o.data("passageT8n")||{}),o.find("tw-enchantment").each(function(t,e){Object.assign(a,i(e).data("passageT8n")||{})}),n?(s.stopPropagation(),void u.goToPassage(n,{transition:a})):e.is("[undo]")?(s.stopPropagation(),void u.goBack({transition:a})):void(e.is("[fullscreen]")&&(s.stopPropagation(),u.toggleFullscreen())))}r.storyElement.on("click.passage-link","tw-link"+(t?"":":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)"),e).on("mouseover.passage-link","tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link",e).on("mouseout.passage-link","tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link",e).on("dblclick.passage-link","tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link",e),i(document).on("fullscreenchange",function(){i("tw-link[fullscreen]",r.storyElement).each(function(t,e){(i(e).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(e)})})}),[["link","link-replace"],["link-reveal","link-append"],["link-repeat"],["link-rerun"]].forEach(function(t){return d.addChanger(t,function(i,s,n){return s?n&&!n.canEnchant?e.create("datatype","The changer given to (".concat(t[0],":) can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")):o.create(t[0],[s].concat(n||[]),null,!0):e.create("datatype",a[0])},function(e,o,i){var n=t[0],a=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),s=f.create({source:"<tw-link tabindex=0>"+o+"</tw-link>",target:function(){return e.target},append:"replace",data:{section:e.section,clickEvent:function(t){e.enablers=e.enablers.filter(function(e){return e.descriptor!==s}),"link-reveal"===n&&t.contents().unwrap();var i,o=t.parentsUntil(":not(tw-enchantment)").parent();o.length||(o=t.parent()),"link-rerun"===n&&(i=t.parentsUntil(":not(tw-enchantment)"),t.detach(),i.remove()),"link"!==n&&"link-rerun"!==n||o.empty(),e.section.renderInto("",null,e,a),"link-rerun"===n&&o.prepend(t)}}});return e.enablers=(e.enablers||[]).concat({descriptor:s,changer:i}),e},[String,n(o)])}),d.addCommand("link-goto",function(t){if(!t)return e.create.apply(e,["datatype"].concat(a))},function(o,d,i,s){var a,n=m(d,i,s);return(i=n.text,s=n.passage,n=n.error)?n:o.transition?(n="transition",e.create("datatype","Please attach ("+n+"-depart:) or ("+n+"-arrive:) to a passage link, not ("+n+":).")):(a=(a=l.hasValid(s)?a:'<tw-broken-link passage-name="'+r.escape(s)+'">'+i+"</tw-broken-link>")||"<tw-link tabindex=0 "+(0<c.passageNameVisited(s)?'class="visited" ':"")+">"+i+"</tw-link>",o.data.linkPassageName=s,o.data.section=d,t(o,{source:a,transitionDeferred:!0}))},[String,n(String)])("link-storylet",function(){var t=(t=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1)<0||arguments.length<=t?void 0:arguments[t];if(!t||"string"==typeof t)return e.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(i,m){var n=(a=2+(1==(arguments.length<=2?0:arguments.length-2)?0:3==(arguments.length<=2?0:arguments.length-2)||"string"==typeof(arguments.length<=2?void 0:arguments[2])?1:2))<2||arguments.length<=a?void 0:arguments[a],u="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),a=((r=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=r?void 0:arguments[r])!==n&&((s=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=s?void 0:arguments[s]),o,d;if(i.transition)return o="transition",e.create("datatype","Please attach ("+o+"-depart:) or ("+o+"-arrive:) to (link-storylet:), not ("+o+":).");var r=h.isPrototypeOf(n),s=l.getStorylets(m,r&&n),o=e.containsError(s);if(o)return o;if(n=s[r?0:n<0?s.length+n:n-1],n)n=n.get("name"),u=u||n,d=d||"<tw-link tabindex=0 "+(0<c.passageNameVisited(n)?'class="visited" ':"")+">"+u+"</tw-link>",i.data.linkPassageName=n,i.data.section=m;else{if(!a)return i;d=a}return t(i,{source:d,transitionDeferred:!0})},[s(parseInt,String,h.TypeSignature("where")),n(s(parseInt,String,h.TypeSignature("where"))),n(String)])("link-undo",function(t){if(!t)return e.create("datatype",a[0])},function(e,s,o){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",i;return c.pastLength<1?t(e,{source:n}):(i=(e.data.section=s).stackTop.tempVariables,e.data.forgetUndosEvent=function(){return e.data.section.whenUnblocked(function(){var s=t({},e,{append:"replace",source:n,transitionDeferred:!1});e.section.renderInto("",null,s,i)})},t(e,{source:"<tw-link tabindex=0 undo>"+o+"</tw-link>",transitionDeferred:!0}))},[String,n(String)])("link-show",function(t){if(!t)return e.create("datatype",a[0])},function(e,s,r){for(var o=arguments.length,a=new Array(3<o?o-3:0),n=3;n<o;n++)a[n-3]=arguments[n];return e.data.section=s,e.data.clickEvent=function(n){n.contents().unwrap(),a.forEach(function(n){return n.forEach(s,function(n){var a=n.data("originalSource")||"",o=n.data("hidden");o&&(n.removeData("hidden"),o instanceof i?n.empty().append(o):(o=n.data("tempVariables"),s.renderInto("",null,t({},e,{source:a,target:n,transitionDeferred:!1}),o&&Object.create(o))))})})},t(e,{source:"<tw-link tabindex=0>"+r+"</tw-link>",transitionDeferred:!0})},[String,p(g)])("link-fullscreen",function(t,n){if(!t||!n)return e.create("datatype",a[0])},function(e,s,i,n){function o(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?n:i)+"</tw-link>":n?"<tw-broken-link>"+n+"</tw-broken-link>":""}var a=s.stackTop.tempVariables;return e.data.section=s,e.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&e.data.section.whenUnblocked(function(){var n=t({},e,{append:"replace",source:o(),transitionDeferred:!1});e.section.renderInto("",null,n,a)})},t(e,{source:o(),transitionDeferred:!0})},[String,String,n(String)]),d.addChanger(["link-reveal-goto"],function(t,i,n,s){if(!i)return e.create.apply(e,["datatype"].concat(a));if(o.isPrototypeOf(n)){if(o.isPrototypeOf(s))return e.create("datatype","You mustn't give two changers to (link-reveal-goto:)");s=n,n=void 0}if(s&&!s.canEnchant)return e.create("datatype","The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).");var t=m(t,i,n);return i=t.text,n=t.passage,(t=t.error)||o.create("link-reveal-goto",[i,n,s].filter(function(e){return void 0!==e}),null,!1)},function(e,n,t,o){if(l.hasValid(t)){var i=c.passageNameVisited(t),a=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),s=f.create({source:"<tw-link tabindex=0 "+(0<i?'class="visited" ':"")+">"+n+"</tw-link>",target:e.target,append:"replace",data:{section:e.section,append:"replace",clickEvent:function(n){e.enablers=e.enablers.filter(function(e){return e.descriptor!==s}),n.contents().unwrap(),e.section.renderInto("",null,e,a),e.section.whenUnblocked(function(){return u.goToPassage(t,{transition:e.data.passageT8n})})}}});return e.enablers=(e.enablers||[]).concat({descriptor:s,changer:o}),e}e.source='<tw-broken-link passage-name="'+r.escape(t)+'">'+n+"</tw-broken-link>"},[String,n(s(o,String)),n(o)])}),e("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(b,t,g,s,f,o,m,l,e){var u=s.objectName,a=s.toSource,r=t.add,h=t.addChanger,c=t.addCommand,n=t.TypeSignature,p=n.rest,d=n.either,v=n.Any,s=n.Everything,n=n.zeroOrMore;r("macro","CustomMacro",function(){for(var n,c=[],r=arguments.length,t=new Array(1<r?r-1:0),i=1,s,a;i<r;i++)t[i-1]=arguments[i];for(n=0;n<t.length;n+=1){if(s=n===t.length-1,l.isPrototypeOf(t[n])===s)return e.create("datatype","The "+(s?"":b.nth(t.length-n+1)+"-")+"last value given to (macro:) should be a "+(s?"code hook":"datatyped variable")+", not "+u(t[n]));if(!s){if(a="A custom macro",t[n].varRef.object===g.variables)return e.create("datatype",a+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(1<t[n].varRef.propertyChain.length)return e.create("datatype",a+"'s typed variables can't be properties inside a data structure.");if(t[n].datatype.rest&&n!==t.length-2)return e.create("datatype",a+" can only have one spread variable, and it must be its last variable.");if(s=t[n].varRef.propertyChain[0],c.includes(s))return e.create("datatype",a+"'s typed variables can't both be named '"+s+"'.");c.push(s)}}return o.create(t.slice(0,-1),t[t.length-1])},[p(d(l,m))]);function i(t,n,s){if(!n.some(function(e){if("function"==typeof e.output)return e.output(s),!0}))return e.create("macrocall","("+t+":) should only be used inside a code hook passed to (macro:).")}c(["output-data","out-data"],function(){},function(e,t){return e=e.stack,i("output-data",e,t)||{blocked:!0}},[v],!1),h(["output","out"],function(){return Object.assign(f.create("output",[]))},function(e,a){if(e.section){var t,s=e.section,r=s.stack,n=s.stackTop,o={};for(t in n.tempVariables)t.startsWith("TwineScript_")||(o[t]=n.tempVariables[t]);i("output",r,{changer:a,variables:o,hook:Array.isArray(e.source)?"["+e.source.map(function(e){return e.text}).join("")+"]":e.source}),e.output=!0,n.blocked=!0}},[]),c("error",function(t){if(!t)return e.create("datatype","This (error:) macro was given an empty string.")},function(t,n){return t=t.stack,i("error",t,e.create("user",n))||{blocked:!0}},[String],!1),r("partial","CustomMacro",function(h,n){for(var l=arguments.length,i=new Array(2<l?l-2:0),c=2,r,s,u,d;c<l;c++)i[c-2]=arguments[c];if(r="string"!=typeof n&&n,s=!r&&n,!r){if(!t.has(s))return e.create("macrocall",'The macro name given to (partial:), "'.concat(n,"\", isn't the name of a built-in macro."));if("Metadata"===t.get(s).returnType)return e.create("macrocall","(partial:) can't be used with metadata macros such as (".concat(n,":)"))}return u="(partial:".concat(a(n),",").concat(i.map(function(e){return a(e)}),")"),d=o.createFromFn(function(s){for(var a=arguments.length,r=new Array(1<a?a-1:0),o=1;o<a;o++)r[o-1]=arguments[o];return s=t["string"==typeof n?"run":"runCustom"](n,s,i.concat(r)),e.containsError(s)&&(s.message="An error occurred while running the (partial:)-created macro, ".concat(d.TwineScript_ObjectName,":\n")+s.message),s},"a (partial:) custom macro of ".concat(s||r.TwineScript_KnownName?"(".concat(s||r.TwineScript_KnownName,":").concat(i.map(function(e){return a(e)}),")"):"another unnamed custom macro"),function(){return u},(s?t.get(s):r).typeSignature.filter(function(e,t){return t>=i.length||"rest"===e.pattern||"zero or more"===e.pattern})),d},[d(String,o),n(s)])}),e("repl",["utils","engine","markup","section"],function(e,t,n){e.onStartup(function(){return setTimeout(function(){e.options.debug&&(window.REPL=function(e){return e=n.create().eval(t.lex("(print:"+e+")")),e.TwineScript_Run?e.TwineScript_Run().source:e},window.LEX=function(e){return e=t.lex(e),1===e.length?e[0]:e})})})}),c.config({paths:{jquery:"../node_modules/jquery/dist/jquery",almond:"../node_modules/almond/almond","es6-shim":"../node_modules/es6-shim/es6-shim",markup:"./markup/markup",lexer:"./markup/lexer",patterns:"./markup/patterns"},deps:["es6-shim","utils/jqueryplugins"]}),c(["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/varscope","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","repl"],function(e,h,m,s,d,a,c,t,r,l){var o=r.dialog,n;function u(e){return eval(e+"")}function i(e){var t,n=e.name+": "+e.message;return e.stack&&(e=(t=e.stack.split("\n")).findIndex(function(e){return e.includes("__HarloweEval")}),n+="\n"+t.slice(0,e).join("\n").replace(/\([^)]+\)/g,"")),"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+n+"```</div>"}n=window.onerror,window.onerror=function(s,a,r,c,e){window.onerror=n,t.storyElement.parent().append(o({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n"+i(e)+"\n(This is probably due to a bug in the Harlowe game engine.)"})),"function"==typeof n&&n.apply(void 0,arguments)},t.onStartup(function(){var r,m,f,p,n=e("tw-storydata");0!==n.length&&(t.options.ifid=n.attr("ifid"),(n.attr("options")||"").split(/\s/).forEach(function(e){e&&(t.options[e]=!0),"debug"===e&&h()}),r=(r=n.attr("startnode"))||[].reduce.call(e("tw-passagedata"),function(t,e){return e=e.getAttribute("pid"),e<t?e:t},1/0),r=e("tw-passagedata[pid='"+r+"']").attr("name"),e(document.documentElement).on("keydown",function(t){13===t.which&&"0"===t.target.getAttribute("tabindex")&&e(t.target).trigger("click")}),m=!1,e("[role=script]").each(function(n){try{u(e(this).html())}catch(e){m||(m=!0,o({parent:t.storyElement.parent(),message:"There is a problem with this story's "+t.nth(n+1)+" script:\n\n"+i(e)}))}}),e("[role=stylesheet]").each(function(t,n){e(document.head).append("<style data-title=\"Story stylesheet '".concat(t+1,"'\">").concat(e(n).html()))}),(f=d.create()).stack=[{tempVariables:Object.create(l)}],(n=c.loadMetadata(f)).length&&(p=o({parent:t.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"}),n.forEach(function(e){return p.find("p").append(e.render())})),(n=!t.options.debug&&s.hasSessionStorage&&sessionStorage.getItem("Saved Session"))&&!0===s.deserialise(f,n)?a.showPassage(s.passage,!1):a.goToPassage(r))})}),e("harlowe",function(){}),c(["harlowe"])}()</script></body></html>